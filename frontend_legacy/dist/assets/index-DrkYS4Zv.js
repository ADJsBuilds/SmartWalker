var w0=Object.defineProperty;var x0=(i,e,t)=>e in i?w0(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var ot=(i,e,t)=>x0(i,typeof e!="symbol"?e+"":e,t);function E0(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in i)){const l=Object.getOwnPropertyDescriptor(r,o);l&&Object.defineProperty(i,o,l.get?l:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();function gm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Cc={exports:{}},ks={},wc={exports:{}},Ce={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hf;function P0(){if(Hf)return Ce;Hf=1;var i=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),v=Symbol.iterator;function k(x){return x===null||typeof x!="object"?null:(x=v&&x[v]||x["@@iterator"],typeof x=="function"?x:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},P=Object.assign,w={};function _(x,D,re){this.props=x,this.context=D,this.refs=w,this.updater=re||b}_.prototype.isReactComponent={},_.prototype.setState=function(x,D){if(typeof x!="object"&&typeof x!="function"&&x!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,x,D,"setState")},_.prototype.forceUpdate=function(x){this.updater.enqueueForceUpdate(this,x,"forceUpdate")};function M(){}M.prototype=_.prototype;function z(x,D,re){this.props=x,this.context=D,this.refs=w,this.updater=re||b}var U=z.prototype=new M;U.constructor=z,P(U,_.prototype),U.isPureReactComponent=!0;var I=Array.isArray,A=Object.prototype.hasOwnProperty,V={current:null},$={key:!0,ref:!0,__self:!0,__source:!0};function Y(x,D,re){var ue,se={},le=null,fe=null;if(D!=null)for(ue in D.ref!==void 0&&(fe=D.ref),D.key!==void 0&&(le=""+D.key),D)A.call(D,ue)&&!$.hasOwnProperty(ue)&&(se[ue]=D[ue]);var me=arguments.length-2;if(me===1)se.children=re;else if(1<me){for(var Re=Array(me),He=0;He<me;He++)Re[He]=arguments[He+2];se.children=Re}if(x&&x.defaultProps)for(ue in me=x.defaultProps,me)se[ue]===void 0&&(se[ue]=me[ue]);return{$$typeof:i,type:x,key:le,ref:fe,props:se,_owner:V.current}}function B(x,D){return{$$typeof:i,type:x.type,key:D,ref:x.ref,props:x.props,_owner:x._owner}}function ee(x){return typeof x=="object"&&x!==null&&x.$$typeof===i}function ne(x){var D={"=":"=0",":":"=2"};return"$"+x.replace(/[=:]/g,function(re){return D[re]})}var ve=/\/+/g;function Pe(x,D){return typeof x=="object"&&x!==null&&x.key!=null?ne(""+x.key):D.toString(36)}function je(x,D,re,ue,se){var le=typeof x;(le==="undefined"||le==="boolean")&&(x=null);var fe=!1;if(x===null)fe=!0;else switch(le){case"string":case"number":fe=!0;break;case"object":switch(x.$$typeof){case i:case e:fe=!0}}if(fe)return fe=x,se=se(fe),x=ue===""?"."+Pe(fe,0):ue,I(se)?(re="",x!=null&&(re=x.replace(ve,"$&/")+"/"),je(se,D,re,"",function(He){return He})):se!=null&&(ee(se)&&(se=B(se,re+(!se.key||fe&&fe.key===se.key?"":(""+se.key).replace(ve,"$&/")+"/")+x)),D.push(se)),1;if(fe=0,ue=ue===""?".":ue+":",I(x))for(var me=0;me<x.length;me++){le=x[me];var Re=ue+Pe(le,me);fe+=je(le,D,re,Re,se)}else if(Re=k(x),typeof Re=="function")for(x=Re.call(x),me=0;!(le=x.next()).done;)le=le.value,Re=ue+Pe(le,me++),fe+=je(le,D,re,Re,se);else if(le==="object")throw D=String(x),Error("Objects are not valid as a React child (found: "+(D==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":D)+"). If you meant to render a collection of children, use an array instead.");return fe}function Me(x,D,re){if(x==null)return x;var ue=[],se=0;return je(x,ue,"","",function(le){return D.call(re,le,se++)}),ue}function $e(x){if(x._status===-1){var D=x._result;D=D(),D.then(function(re){(x._status===0||x._status===-1)&&(x._status=1,x._result=re)},function(re){(x._status===0||x._status===-1)&&(x._status=2,x._result=re)}),x._status===-1&&(x._status=0,x._result=D)}if(x._status===1)return x._result.default;throw x._result}var Ie={current:null},ie={transition:null},te={ReactCurrentDispatcher:Ie,ReactCurrentBatchConfig:ie,ReactCurrentOwner:V};function H(){throw Error("act(...) is not supported in production builds of React.")}return Ce.Children={map:Me,forEach:function(x,D,re){Me(x,function(){D.apply(this,arguments)},re)},count:function(x){var D=0;return Me(x,function(){D++}),D},toArray:function(x){return Me(x,function(D){return D})||[]},only:function(x){if(!ee(x))throw Error("React.Children.only expected to receive a single React element child.");return x}},Ce.Component=_,Ce.Fragment=t,Ce.Profiler=o,Ce.PureComponent=z,Ce.StrictMode=r,Ce.Suspense=h,Ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=te,Ce.act=H,Ce.cloneElement=function(x,D,re){if(x==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+x+".");var ue=P({},x.props),se=x.key,le=x.ref,fe=x._owner;if(D!=null){if(D.ref!==void 0&&(le=D.ref,fe=V.current),D.key!==void 0&&(se=""+D.key),x.type&&x.type.defaultProps)var me=x.type.defaultProps;for(Re in D)A.call(D,Re)&&!$.hasOwnProperty(Re)&&(ue[Re]=D[Re]===void 0&&me!==void 0?me[Re]:D[Re])}var Re=arguments.length-2;if(Re===1)ue.children=re;else if(1<Re){me=Array(Re);for(var He=0;He<Re;He++)me[He]=arguments[He+2];ue.children=me}return{$$typeof:i,type:x.type,key:se,ref:le,props:ue,_owner:fe}},Ce.createContext=function(x){return x={$$typeof:c,_currentValue:x,_currentValue2:x,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},x.Provider={$$typeof:l,_context:x},x.Consumer=x},Ce.createElement=Y,Ce.createFactory=function(x){var D=Y.bind(null,x);return D.type=x,D},Ce.createRef=function(){return{current:null}},Ce.forwardRef=function(x){return{$$typeof:u,render:x}},Ce.isValidElement=ee,Ce.lazy=function(x){return{$$typeof:m,_payload:{_status:-1,_result:x},_init:$e}},Ce.memo=function(x,D){return{$$typeof:f,type:x,compare:D===void 0?null:D}},Ce.startTransition=function(x){var D=ie.transition;ie.transition={};try{x()}finally{ie.transition=D}},Ce.unstable_act=H,Ce.useCallback=function(x,D){return Ie.current.useCallback(x,D)},Ce.useContext=function(x){return Ie.current.useContext(x)},Ce.useDebugValue=function(){},Ce.useDeferredValue=function(x){return Ie.current.useDeferredValue(x)},Ce.useEffect=function(x,D){return Ie.current.useEffect(x,D)},Ce.useId=function(){return Ie.current.useId()},Ce.useImperativeHandle=function(x,D,re){return Ie.current.useImperativeHandle(x,D,re)},Ce.useInsertionEffect=function(x,D){return Ie.current.useInsertionEffect(x,D)},Ce.useLayoutEffect=function(x,D){return Ie.current.useLayoutEffect(x,D)},Ce.useMemo=function(x,D){return Ie.current.useMemo(x,D)},Ce.useReducer=function(x,D,re){return Ie.current.useReducer(x,D,re)},Ce.useRef=function(x){return Ie.current.useRef(x)},Ce.useState=function(x){return Ie.current.useState(x)},Ce.useSyncExternalStore=function(x,D,re){return Ie.current.useSyncExternalStore(x,D,re)},Ce.useTransition=function(){return Ie.current.useTransition()},Ce.version="18.3.1",Ce}var Kf;function Nu(){return Kf||(Kf=1,wc.exports=P0()),wc.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gf;function R0(){if(Gf)return ks;Gf=1;var i=Nu(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(u,h,f){var m,v={},k=null,b=null;f!==void 0&&(k=""+f),h.key!==void 0&&(k=""+h.key),h.ref!==void 0&&(b=h.ref);for(m in h)r.call(h,m)&&!l.hasOwnProperty(m)&&(v[m]=h[m]);if(u&&u.defaultProps)for(m in h=u.defaultProps,h)v[m]===void 0&&(v[m]=h[m]);return{$$typeof:e,type:u,key:k,ref:b,props:v,_owner:o.current}}return ks.Fragment=t,ks.jsx=c,ks.jsxs=c,ks}var $f;function _0(){return $f||($f=1,Cc.exports=R0()),Cc.exports}var S=_0(),N=Nu();const vm=gm(N),I0=E0({__proto__:null,default:vm},[N]);var Zo={},xc={exports:{}},Ot={},Ec={exports:{}},Pc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jf;function N0(){return Jf||(Jf=1,(function(i){function e(ie,te){var H=ie.length;ie.push(te);e:for(;0<H;){var x=H-1>>>1,D=ie[x];if(0<o(D,te))ie[x]=te,ie[H]=D,H=x;else break e}}function t(ie){return ie.length===0?null:ie[0]}function r(ie){if(ie.length===0)return null;var te=ie[0],H=ie.pop();if(H!==te){ie[0]=H;e:for(var x=0,D=ie.length,re=D>>>1;x<re;){var ue=2*(x+1)-1,se=ie[ue],le=ue+1,fe=ie[le];if(0>o(se,H))le<D&&0>o(fe,se)?(ie[x]=fe,ie[le]=H,x=le):(ie[x]=se,ie[ue]=H,x=ue);else if(le<D&&0>o(fe,H))ie[x]=fe,ie[le]=H,x=le;else break e}}return te}function o(ie,te){var H=ie.sortIndex-te.sortIndex;return H!==0?H:ie.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;i.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();i.unstable_now=function(){return c.now()-u}}var h=[],f=[],m=1,v=null,k=3,b=!1,P=!1,w=!1,_=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function U(ie){for(var te=t(f);te!==null;){if(te.callback===null)r(f);else if(te.startTime<=ie)r(f),te.sortIndex=te.expirationTime,e(h,te);else break;te=t(f)}}function I(ie){if(w=!1,U(ie),!P)if(t(h)!==null)P=!0,$e(A);else{var te=t(f);te!==null&&Ie(I,te.startTime-ie)}}function A(ie,te){P=!1,w&&(w=!1,M(Y),Y=-1),b=!0;var H=k;try{for(U(te),v=t(h);v!==null&&(!(v.expirationTime>te)||ie&&!ne());){var x=v.callback;if(typeof x=="function"){v.callback=null,k=v.priorityLevel;var D=x(v.expirationTime<=te);te=i.unstable_now(),typeof D=="function"?v.callback=D:v===t(h)&&r(h),U(te)}else r(h);v=t(h)}if(v!==null)var re=!0;else{var ue=t(f);ue!==null&&Ie(I,ue.startTime-te),re=!1}return re}finally{v=null,k=H,b=!1}}var V=!1,$=null,Y=-1,B=5,ee=-1;function ne(){return!(i.unstable_now()-ee<B)}function ve(){if($!==null){var ie=i.unstable_now();ee=ie;var te=!0;try{te=$(!0,ie)}finally{te?Pe():(V=!1,$=null)}}else V=!1}var Pe;if(typeof z=="function")Pe=function(){z(ve)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,Me=je.port2;je.port1.onmessage=ve,Pe=function(){Me.postMessage(null)}}else Pe=function(){_(ve,0)};function $e(ie){$=ie,V||(V=!0,Pe())}function Ie(ie,te){Y=_(function(){ie(i.unstable_now())},te)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ie){ie.callback=null},i.unstable_continueExecution=function(){P||b||(P=!0,$e(A))},i.unstable_forceFrameRate=function(ie){0>ie||125<ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<ie?Math.floor(1e3/ie):5},i.unstable_getCurrentPriorityLevel=function(){return k},i.unstable_getFirstCallbackNode=function(){return t(h)},i.unstable_next=function(ie){switch(k){case 1:case 2:case 3:var te=3;break;default:te=k}var H=k;k=te;try{return ie()}finally{k=H}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ie,te){switch(ie){case 1:case 2:case 3:case 4:case 5:break;default:ie=3}var H=k;k=ie;try{return te()}finally{k=H}},i.unstable_scheduleCallback=function(ie,te,H){var x=i.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?x+H:x):H=x,ie){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=H+D,ie={id:m++,callback:te,priorityLevel:ie,startTime:H,expirationTime:D,sortIndex:-1},H>x?(ie.sortIndex=H,e(f,ie),t(h)===null&&ie===t(f)&&(w?(M(Y),Y=-1):w=!0,Ie(I,H-x))):(ie.sortIndex=D,e(h,ie),P||b||(P=!0,$e(A))),ie},i.unstable_shouldYield=ne,i.unstable_wrapCallback=function(ie){var te=k;return function(){var H=k;k=te;try{return ie.apply(this,arguments)}finally{k=H}}}})(Pc)),Pc}var Qf;function O0(){return Qf||(Qf=1,Ec.exports=N0()),Ec.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yf;function D0(){if(Yf)return Ot;Yf=1;var i=Nu(),e=O0();function t(n){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,o={};function l(n,s){c(n,s),c(n+"Capture",s)}function c(n,s){for(o[n]=s,n=0;n<s.length;n++)r.add(s[n])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},v={};function k(n){return h.call(v,n)?!0:h.call(m,n)?!1:f.test(n)?v[n]=!0:(m[n]=!0,!1)}function b(n,s,a,d){if(a!==null&&a.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return d?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function P(n,s,a,d){if(s===null||typeof s>"u"||b(n,s,a,d))return!0;if(d)return!1;if(a!==null)switch(a.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function w(n,s,a,d,p,g,y){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=d,this.attributeNamespace=p,this.mustUseProperty=a,this.propertyName=n,this.type=s,this.sanitizeURL=g,this.removeEmptyString=y}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){_[n]=new w(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var s=n[0];_[s]=new w(s,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){_[n]=new w(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){_[n]=new w(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){_[n]=new w(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){_[n]=new w(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){_[n]=new w(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){_[n]=new w(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){_[n]=new w(n,5,!1,n.toLowerCase(),null,!1,!1)});var M=/[\-:]([a-z])/g;function z(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var s=n.replace(M,z);_[s]=new w(s,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var s=n.replace(M,z);_[s]=new w(s,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var s=n.replace(M,z);_[s]=new w(s,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){_[n]=new w(n,1,!1,n.toLowerCase(),null,!1,!1)}),_.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){_[n]=new w(n,1,!1,n.toLowerCase(),null,!0,!0)});function U(n,s,a,d){var p=_.hasOwnProperty(s)?_[s]:null;(p!==null?p.type!==0:d||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(P(s,a,p,d)&&(a=null),d||p===null?k(s)&&(a===null?n.removeAttribute(s):n.setAttribute(s,""+a)):p.mustUseProperty?n[p.propertyName]=a===null?p.type===3?!1:"":a:(s=p.attributeName,d=p.attributeNamespace,a===null?n.removeAttribute(s):(p=p.type,a=p===3||p===4&&a===!0?"":""+a,d?n.setAttributeNS(d,s,a):n.setAttribute(s,a))))}var I=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),V=Symbol.for("react.portal"),$=Symbol.for("react.fragment"),Y=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),ee=Symbol.for("react.provider"),ne=Symbol.for("react.context"),ve=Symbol.for("react.forward_ref"),Pe=Symbol.for("react.suspense"),je=Symbol.for("react.suspense_list"),Me=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),Ie=Symbol.for("react.offscreen"),ie=Symbol.iterator;function te(n){return n===null||typeof n!="object"?null:(n=ie&&n[ie]||n["@@iterator"],typeof n=="function"?n:null)}var H=Object.assign,x;function D(n){if(x===void 0)try{throw Error()}catch(a){var s=a.stack.trim().match(/\n( *(at )?)/);x=s&&s[1]||""}return`
`+x+n}var re=!1;function ue(n,s){if(!n||re)return"";re=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(j){var d=j}Reflect.construct(n,[],s)}else{try{s.call()}catch(j){d=j}n.call(s.prototype)}else{try{throw Error()}catch(j){d=j}n()}}catch(j){if(j&&d&&typeof j.stack=="string"){for(var p=j.stack.split(`
`),g=d.stack.split(`
`),y=p.length-1,T=g.length-1;1<=y&&0<=T&&p[y]!==g[T];)T--;for(;1<=y&&0<=T;y--,T--)if(p[y]!==g[T]){if(y!==1||T!==1)do if(y--,T--,0>T||p[y]!==g[T]){var E=`
`+p[y].replace(" at new "," at ");return n.displayName&&E.includes("<anonymous>")&&(E=E.replace("<anonymous>",n.displayName)),E}while(1<=y&&0<=T);break}}}finally{re=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?D(n):""}function se(n){switch(n.tag){case 5:return D(n.type);case 16:return D("Lazy");case 13:return D("Suspense");case 19:return D("SuspenseList");case 0:case 2:case 15:return n=ue(n.type,!1),n;case 11:return n=ue(n.type.render,!1),n;case 1:return n=ue(n.type,!0),n;default:return""}}function le(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case $:return"Fragment";case V:return"Portal";case B:return"Profiler";case Y:return"StrictMode";case Pe:return"Suspense";case je:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case ne:return(n.displayName||"Context")+".Consumer";case ee:return(n._context.displayName||"Context")+".Provider";case ve:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Me:return s=n.displayName||null,s!==null?s:le(n.type)||"Memo";case $e:s=n._payload,n=n._init;try{return le(n(s))}catch{}}return null}function fe(n){var s=n.type;switch(n.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=s.render,n=n.displayName||n.name||"",s.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return le(s);case 8:return s===Y?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function me(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Re(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function He(n){var s=Re(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,s),d=""+n[s];if(!n.hasOwnProperty(s)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var p=a.get,g=a.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return p.call(this)},set:function(y){d=""+y,g.call(this,y)}}),Object.defineProperty(n,s,{enumerable:a.enumerable}),{getValue:function(){return d},setValue:function(y){d=""+y},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function Gt(n){n._valueTracker||(n._valueTracker=He(n))}function qs(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var a=s.getValue(),d="";return n&&(d=Re(n)?n.checked?"true":"false":n.value),n=d,n!==a?(s.setValue(n),!0):!1}function Se(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function we(n,s){var a=s.checked;return H({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function xe(n,s){var a=s.defaultValue==null?"":s.defaultValue,d=s.checked!=null?s.checked:s.defaultChecked;a=me(s.value!=null?s.value:a),n._wrapperState={initialChecked:d,initialValue:a,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function wt(n,s){s=s.checked,s!=null&&U(n,"checked",s,!1)}function rt(n,s){wt(n,s);var a=me(s.value),d=s.type;if(a!=null)d==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(d==="submit"||d==="reset"){n.removeAttribute("value");return}s.hasOwnProperty("value")?jt(n,s.type,a):s.hasOwnProperty("defaultValue")&&jt(n,s.type,me(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(n.defaultChecked=!!s.defaultChecked)}function tn(n,s,a){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var d=s.type;if(!(d!=="submit"&&d!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+n._wrapperState.initialValue,a||s===n.value||(n.value=s),n.defaultValue=s}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function jt(n,s,a){(s!=="number"||Se(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var $t=Array.isArray;function Dn(n,s,a,d){if(n=n.options,s){s={};for(var p=0;p<a.length;p++)s["$"+a[p]]=!0;for(a=0;a<n.length;a++)p=s.hasOwnProperty("$"+n[a].value),n[a].selected!==p&&(n[a].selected=p),p&&d&&(n[a].defaultSelected=!0)}else{for(a=""+me(a),s=null,p=0;p<n.length;p++){if(n[p].value===a){n[p].selected=!0,d&&(n[p].defaultSelected=!0);return}s!==null||n[p].disabled||(s=n[p])}s!==null&&(s.selected=!0)}}function Ft(n,s){if(s.dangerouslySetInnerHTML!=null)throw Error(t(91));return H({},s,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Mr(n,s){var a=s.value;if(a==null){if(a=s.children,s=s.defaultValue,a!=null){if(s!=null)throw Error(t(92));if($t(a)){if(1<a.length)throw Error(t(93));a=a[0]}s=a}s==null&&(s=""),a=s}n._wrapperState={initialValue:me(a)}}function td(n,s){var a=me(s.value),d=me(s.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),s.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),d!=null&&(n.defaultValue=""+d)}function nd(n){var s=n.textContent;s===n._wrapperState.initialValue&&s!==""&&s!==null&&(n.value=s)}function id(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ma(n,s){return n==null||n==="http://www.w3.org/1999/xhtml"?id(s):n==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Ws,rd=(function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,a,d,p){MSApp.execUnsafeLocalFunction(function(){return n(s,a,d,p)})}:n})(function(n,s){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=s;else{for(Ws=Ws||document.createElement("div"),Ws.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Ws.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;s.firstChild;)n.appendChild(s.firstChild)}});function Lr(n,s){if(s){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=s;return}}n.textContent=s}var Ar={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Rv=["Webkit","ms","Moz","O"];Object.keys(Ar).forEach(function(n){Rv.forEach(function(s){s=s+n.charAt(0).toUpperCase()+n.substring(1),Ar[s]=Ar[n]})});function sd(n,s,a){return s==null||typeof s=="boolean"||s===""?"":a||typeof s!="number"||s===0||Ar.hasOwnProperty(n)&&Ar[n]?(""+s).trim():s+"px"}function od(n,s){n=n.style;for(var a in s)if(s.hasOwnProperty(a)){var d=a.indexOf("--")===0,p=sd(a,s[a],d);a==="float"&&(a="cssFloat"),d?n.setProperty(a,p):n[a]=p}}var _v=H({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function La(n,s){if(s){if(_v[n]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(t(137,n));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(t(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(t(61))}if(s.style!=null&&typeof s.style!="object")throw Error(t(62))}}function Aa(n,s){if(n.indexOf("-")===-1)return typeof s.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ua=null;function ja(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Fa=null,Qi=null,Yi=null;function ad(n){if(n=rs(n)){if(typeof Fa!="function")throw Error(t(280));var s=n.stateNode;s&&(s=po(s),Fa(n.stateNode,n.type,s))}}function ld(n){Qi?Yi?Yi.push(n):Yi=[n]:Qi=n}function cd(){if(Qi){var n=Qi,s=Yi;if(Yi=Qi=null,ad(n),s)for(n=0;n<s.length;n++)ad(s[n])}}function ud(n,s){return n(s)}function dd(){}var Ba=!1;function hd(n,s,a){if(Ba)return n(s,a);Ba=!0;try{return ud(n,s,a)}finally{Ba=!1,(Qi!==null||Yi!==null)&&(dd(),cd())}}function Ur(n,s){var a=n.stateNode;if(a===null)return null;var d=po(a);if(d===null)return null;a=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(t(231,s,typeof a));return a}var Va=!1;if(u)try{var jr={};Object.defineProperty(jr,"passive",{get:function(){Va=!0}}),window.addEventListener("test",jr,jr),window.removeEventListener("test",jr,jr)}catch{Va=!1}function Iv(n,s,a,d,p,g,y,T,E){var j=Array.prototype.slice.call(arguments,3);try{s.apply(a,j)}catch(G){this.onError(G)}}var Fr=!1,Hs=null,Ks=!1,za=null,Nv={onError:function(n){Fr=!0,Hs=n}};function Ov(n,s,a,d,p,g,y,T,E){Fr=!1,Hs=null,Iv.apply(Nv,arguments)}function Dv(n,s,a,d,p,g,y,T,E){if(Ov.apply(this,arguments),Fr){if(Fr){var j=Hs;Fr=!1,Hs=null}else throw Error(t(198));Ks||(Ks=!0,za=j)}}function Pi(n){var s=n,a=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(a=s.return),n=s.return;while(n)}return s.tag===3?a:null}function fd(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function pd(n){if(Pi(n)!==n)throw Error(t(188))}function Mv(n){var s=n.alternate;if(!s){if(s=Pi(n),s===null)throw Error(t(188));return s!==n?null:n}for(var a=n,d=s;;){var p=a.return;if(p===null)break;var g=p.alternate;if(g===null){if(d=p.return,d!==null){a=d;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===a)return pd(p),n;if(g===d)return pd(p),s;g=g.sibling}throw Error(t(188))}if(a.return!==d.return)a=p,d=g;else{for(var y=!1,T=p.child;T;){if(T===a){y=!0,a=p,d=g;break}if(T===d){y=!0,d=p,a=g;break}T=T.sibling}if(!y){for(T=g.child;T;){if(T===a){y=!0,a=g,d=p;break}if(T===d){y=!0,d=g,a=p;break}T=T.sibling}if(!y)throw Error(t(189))}}if(a.alternate!==d)throw Error(t(190))}if(a.tag!==3)throw Error(t(188));return a.stateNode.current===a?n:s}function md(n){return n=Mv(n),n!==null?gd(n):null}function gd(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var s=gd(n);if(s!==null)return s;n=n.sibling}return null}var vd=e.unstable_scheduleCallback,yd=e.unstable_cancelCallback,Lv=e.unstable_shouldYield,Av=e.unstable_requestPaint,tt=e.unstable_now,Uv=e.unstable_getCurrentPriorityLevel,qa=e.unstable_ImmediatePriority,kd=e.unstable_UserBlockingPriority,Gs=e.unstable_NormalPriority,jv=e.unstable_LowPriority,Sd=e.unstable_IdlePriority,$s=null,kn=null;function Fv(n){if(kn&&typeof kn.onCommitFiberRoot=="function")try{kn.onCommitFiberRoot($s,n,void 0,(n.current.flags&128)===128)}catch{}}var nn=Math.clz32?Math.clz32:zv,Bv=Math.log,Vv=Math.LN2;function zv(n){return n>>>=0,n===0?32:31-(Bv(n)/Vv|0)|0}var Js=64,Qs=4194304;function Br(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Ys(n,s){var a=n.pendingLanes;if(a===0)return 0;var d=0,p=n.suspendedLanes,g=n.pingedLanes,y=a&268435455;if(y!==0){var T=y&~p;T!==0?d=Br(T):(g&=y,g!==0&&(d=Br(g)))}else y=a&~p,y!==0?d=Br(y):g!==0&&(d=Br(g));if(d===0)return 0;if(s!==0&&s!==d&&(s&p)===0&&(p=d&-d,g=s&-s,p>=g||p===16&&(g&4194240)!==0))return s;if((d&4)!==0&&(d|=a&16),s=n.entangledLanes,s!==0)for(n=n.entanglements,s&=d;0<s;)a=31-nn(s),p=1<<a,d|=n[a],s&=~p;return d}function qv(n,s){switch(n){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wv(n,s){for(var a=n.suspendedLanes,d=n.pingedLanes,p=n.expirationTimes,g=n.pendingLanes;0<g;){var y=31-nn(g),T=1<<y,E=p[y];E===-1?((T&a)===0||(T&d)!==0)&&(p[y]=qv(T,s)):E<=s&&(n.expiredLanes|=T),g&=~T}}function Wa(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function bd(){var n=Js;return Js<<=1,(Js&4194240)===0&&(Js=64),n}function Ha(n){for(var s=[],a=0;31>a;a++)s.push(n);return s}function Vr(n,s,a){n.pendingLanes|=s,s!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,s=31-nn(s),n[s]=a}function Hv(n,s){var a=n.pendingLanes&~s;n.pendingLanes=s,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=s,n.mutableReadLanes&=s,n.entangledLanes&=s,s=n.entanglements;var d=n.eventTimes;for(n=n.expirationTimes;0<a;){var p=31-nn(a),g=1<<p;s[p]=0,d[p]=-1,n[p]=-1,a&=~g}}function Ka(n,s){var a=n.entangledLanes|=s;for(n=n.entanglements;a;){var d=31-nn(a),p=1<<d;p&s|n[d]&s&&(n[d]|=s),a&=~p}}var Ue=0;function Td(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Cd,Ga,wd,xd,Ed,$a=!1,Xs=[],Qn=null,Yn=null,Xn=null,zr=new Map,qr=new Map,Zn=[],Kv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pd(n,s){switch(n){case"focusin":case"focusout":Qn=null;break;case"dragenter":case"dragleave":Yn=null;break;case"mouseover":case"mouseout":Xn=null;break;case"pointerover":case"pointerout":zr.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":qr.delete(s.pointerId)}}function Wr(n,s,a,d,p,g){return n===null||n.nativeEvent!==g?(n={blockedOn:s,domEventName:a,eventSystemFlags:d,nativeEvent:g,targetContainers:[p]},s!==null&&(s=rs(s),s!==null&&Ga(s)),n):(n.eventSystemFlags|=d,s=n.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),n)}function Gv(n,s,a,d,p){switch(s){case"focusin":return Qn=Wr(Qn,n,s,a,d,p),!0;case"dragenter":return Yn=Wr(Yn,n,s,a,d,p),!0;case"mouseover":return Xn=Wr(Xn,n,s,a,d,p),!0;case"pointerover":var g=p.pointerId;return zr.set(g,Wr(zr.get(g)||null,n,s,a,d,p)),!0;case"gotpointercapture":return g=p.pointerId,qr.set(g,Wr(qr.get(g)||null,n,s,a,d,p)),!0}return!1}function Rd(n){var s=Ri(n.target);if(s!==null){var a=Pi(s);if(a!==null){if(s=a.tag,s===13){if(s=fd(a),s!==null){n.blockedOn=s,Ed(n.priority,function(){wd(a)});return}}else if(s===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Zs(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var a=Qa(n.domEventName,n.eventSystemFlags,s[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var d=new a.constructor(a.type,a);Ua=d,a.target.dispatchEvent(d),Ua=null}else return s=rs(a),s!==null&&Ga(s),n.blockedOn=a,!1;s.shift()}return!0}function _d(n,s,a){Zs(n)&&a.delete(s)}function $v(){$a=!1,Qn!==null&&Zs(Qn)&&(Qn=null),Yn!==null&&Zs(Yn)&&(Yn=null),Xn!==null&&Zs(Xn)&&(Xn=null),zr.forEach(_d),qr.forEach(_d)}function Hr(n,s){n.blockedOn===s&&(n.blockedOn=null,$a||($a=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,$v)))}function Kr(n){function s(p){return Hr(p,n)}if(0<Xs.length){Hr(Xs[0],n);for(var a=1;a<Xs.length;a++){var d=Xs[a];d.blockedOn===n&&(d.blockedOn=null)}}for(Qn!==null&&Hr(Qn,n),Yn!==null&&Hr(Yn,n),Xn!==null&&Hr(Xn,n),zr.forEach(s),qr.forEach(s),a=0;a<Zn.length;a++)d=Zn[a],d.blockedOn===n&&(d.blockedOn=null);for(;0<Zn.length&&(a=Zn[0],a.blockedOn===null);)Rd(a),a.blockedOn===null&&Zn.shift()}var Xi=I.ReactCurrentBatchConfig,eo=!0;function Jv(n,s,a,d){var p=Ue,g=Xi.transition;Xi.transition=null;try{Ue=1,Ja(n,s,a,d)}finally{Ue=p,Xi.transition=g}}function Qv(n,s,a,d){var p=Ue,g=Xi.transition;Xi.transition=null;try{Ue=4,Ja(n,s,a,d)}finally{Ue=p,Xi.transition=g}}function Ja(n,s,a,d){if(eo){var p=Qa(n,s,a,d);if(p===null)fl(n,s,d,to,a),Pd(n,d);else if(Gv(p,n,s,a,d))d.stopPropagation();else if(Pd(n,d),s&4&&-1<Kv.indexOf(n)){for(;p!==null;){var g=rs(p);if(g!==null&&Cd(g),g=Qa(n,s,a,d),g===null&&fl(n,s,d,to,a),g===p)break;p=g}p!==null&&d.stopPropagation()}else fl(n,s,d,null,a)}}var to=null;function Qa(n,s,a,d){if(to=null,n=ja(d),n=Ri(n),n!==null)if(s=Pi(n),s===null)n=null;else if(a=s.tag,a===13){if(n=fd(s),n!==null)return n;n=null}else if(a===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null);return to=n,null}function Id(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Uv()){case qa:return 1;case kd:return 4;case Gs:case jv:return 16;case Sd:return 536870912;default:return 16}default:return 16}}var ei=null,Ya=null,no=null;function Nd(){if(no)return no;var n,s=Ya,a=s.length,d,p="value"in ei?ei.value:ei.textContent,g=p.length;for(n=0;n<a&&s[n]===p[n];n++);var y=a-n;for(d=1;d<=y&&s[a-d]===p[g-d];d++);return no=p.slice(n,1<d?1-d:void 0)}function io(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function ro(){return!0}function Od(){return!1}function Bt(n){function s(a,d,p,g,y){this._reactName=a,this._targetInst=p,this.type=d,this.nativeEvent=g,this.target=y,this.currentTarget=null;for(var T in n)n.hasOwnProperty(T)&&(a=n[T],this[T]=a?a(g):g[T]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?ro:Od,this.isPropagationStopped=Od,this}return H(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=ro)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=ro)},persist:function(){},isPersistent:ro}),s}var Zi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xa=Bt(Zi),Gr=H({},Zi,{view:0,detail:0}),Yv=Bt(Gr),Za,el,$r,so=H({},Gr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nl,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==$r&&($r&&n.type==="mousemove"?(Za=n.screenX-$r.screenX,el=n.screenY-$r.screenY):el=Za=0,$r=n),Za)},movementY:function(n){return"movementY"in n?n.movementY:el}}),Dd=Bt(so),Xv=H({},so,{dataTransfer:0}),Zv=Bt(Xv),ey=H({},Gr,{relatedTarget:0}),tl=Bt(ey),ty=H({},Zi,{animationName:0,elapsedTime:0,pseudoElement:0}),ny=Bt(ty),iy=H({},Zi,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),ry=Bt(iy),sy=H({},Zi,{data:0}),Md=Bt(sy),oy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ay={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ly={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cy(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=ly[n])?!!s[n]:!1}function nl(){return cy}var uy=H({},Gr,{key:function(n){if(n.key){var s=oy[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=io(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?ay[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nl,charCode:function(n){return n.type==="keypress"?io(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?io(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),dy=Bt(uy),hy=H({},so,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ld=Bt(hy),fy=H({},Gr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nl}),py=Bt(fy),my=H({},Zi,{propertyName:0,elapsedTime:0,pseudoElement:0}),gy=Bt(my),vy=H({},so,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),yy=Bt(vy),ky=[9,13,27,32],il=u&&"CompositionEvent"in window,Jr=null;u&&"documentMode"in document&&(Jr=document.documentMode);var Sy=u&&"TextEvent"in window&&!Jr,Ad=u&&(!il||Jr&&8<Jr&&11>=Jr),Ud=" ",jd=!1;function Fd(n,s){switch(n){case"keyup":return ky.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bd(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var er=!1;function by(n,s){switch(n){case"compositionend":return Bd(s);case"keypress":return s.which!==32?null:(jd=!0,Ud);case"textInput":return n=s.data,n===Ud&&jd?null:n;default:return null}}function Ty(n,s){if(er)return n==="compositionend"||!il&&Fd(n,s)?(n=Nd(),no=Ya=ei=null,er=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Ad&&s.locale!=="ko"?null:s.data;default:return null}}var Cy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vd(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Cy[n.type]:s==="textarea"}function zd(n,s,a,d){ld(d),s=uo(s,"onChange"),0<s.length&&(a=new Xa("onChange","change",null,a,d),n.push({event:a,listeners:s}))}var Qr=null,Yr=null;function wy(n){oh(n,0)}function oo(n){var s=sr(n);if(qs(s))return n}function xy(n,s){if(n==="change")return s}var qd=!1;if(u){var rl;if(u){var sl="oninput"in document;if(!sl){var Wd=document.createElement("div");Wd.setAttribute("oninput","return;"),sl=typeof Wd.oninput=="function"}rl=sl}else rl=!1;qd=rl&&(!document.documentMode||9<document.documentMode)}function Hd(){Qr&&(Qr.detachEvent("onpropertychange",Kd),Yr=Qr=null)}function Kd(n){if(n.propertyName==="value"&&oo(Yr)){var s=[];zd(s,Yr,n,ja(n)),hd(wy,s)}}function Ey(n,s,a){n==="focusin"?(Hd(),Qr=s,Yr=a,Qr.attachEvent("onpropertychange",Kd)):n==="focusout"&&Hd()}function Py(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return oo(Yr)}function Ry(n,s){if(n==="click")return oo(s)}function _y(n,s){if(n==="input"||n==="change")return oo(s)}function Iy(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var rn=typeof Object.is=="function"?Object.is:Iy;function Xr(n,s){if(rn(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var a=Object.keys(n),d=Object.keys(s);if(a.length!==d.length)return!1;for(d=0;d<a.length;d++){var p=a[d];if(!h.call(s,p)||!rn(n[p],s[p]))return!1}return!0}function Gd(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function $d(n,s){var a=Gd(n);n=0;for(var d;a;){if(a.nodeType===3){if(d=n+a.textContent.length,n<=s&&d>=s)return{node:a,offset:s-n};n=d}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Gd(a)}}function Jd(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Jd(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function Qd(){for(var n=window,s=Se();s instanceof n.HTMLIFrameElement;){try{var a=typeof s.contentWindow.location.href=="string"}catch{a=!1}if(a)n=s.contentWindow;else break;s=Se(n.document)}return s}function ol(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}function Ny(n){var s=Qd(),a=n.focusedElem,d=n.selectionRange;if(s!==a&&a&&a.ownerDocument&&Jd(a.ownerDocument.documentElement,a)){if(d!==null&&ol(a)){if(s=d.start,n=d.end,n===void 0&&(n=s),"selectionStart"in a)a.selectionStart=s,a.selectionEnd=Math.min(n,a.value.length);else if(n=(s=a.ownerDocument||document)&&s.defaultView||window,n.getSelection){n=n.getSelection();var p=a.textContent.length,g=Math.min(d.start,p);d=d.end===void 0?g:Math.min(d.end,p),!n.extend&&g>d&&(p=d,d=g,g=p),p=$d(a,g);var y=$d(a,d);p&&y&&(n.rangeCount!==1||n.anchorNode!==p.node||n.anchorOffset!==p.offset||n.focusNode!==y.node||n.focusOffset!==y.offset)&&(s=s.createRange(),s.setStart(p.node,p.offset),n.removeAllRanges(),g>d?(n.addRange(s),n.extend(y.node,y.offset)):(s.setEnd(y.node,y.offset),n.addRange(s)))}}for(s=[],n=a;n=n.parentNode;)n.nodeType===1&&s.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<s.length;a++)n=s[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Oy=u&&"documentMode"in document&&11>=document.documentMode,tr=null,al=null,Zr=null,ll=!1;function Yd(n,s,a){var d=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;ll||tr==null||tr!==Se(d)||(d=tr,"selectionStart"in d&&ol(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Zr&&Xr(Zr,d)||(Zr=d,d=uo(al,"onSelect"),0<d.length&&(s=new Xa("onSelect","select",null,s,a),n.push({event:s,listeners:d}),s.target=tr)))}function ao(n,s){var a={};return a[n.toLowerCase()]=s.toLowerCase(),a["Webkit"+n]="webkit"+s,a["Moz"+n]="moz"+s,a}var nr={animationend:ao("Animation","AnimationEnd"),animationiteration:ao("Animation","AnimationIteration"),animationstart:ao("Animation","AnimationStart"),transitionend:ao("Transition","TransitionEnd")},cl={},Xd={};u&&(Xd=document.createElement("div").style,"AnimationEvent"in window||(delete nr.animationend.animation,delete nr.animationiteration.animation,delete nr.animationstart.animation),"TransitionEvent"in window||delete nr.transitionend.transition);function lo(n){if(cl[n])return cl[n];if(!nr[n])return n;var s=nr[n],a;for(a in s)if(s.hasOwnProperty(a)&&a in Xd)return cl[n]=s[a];return n}var Zd=lo("animationend"),eh=lo("animationiteration"),th=lo("animationstart"),nh=lo("transitionend"),ih=new Map,rh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ti(n,s){ih.set(n,s),l(s,[n])}for(var ul=0;ul<rh.length;ul++){var dl=rh[ul],Dy=dl.toLowerCase(),My=dl[0].toUpperCase()+dl.slice(1);ti(Dy,"on"+My)}ti(Zd,"onAnimationEnd"),ti(eh,"onAnimationIteration"),ti(th,"onAnimationStart"),ti("dblclick","onDoubleClick"),ti("focusin","onFocus"),ti("focusout","onBlur"),ti(nh,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var es="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ly=new Set("cancel close invalid load scroll toggle".split(" ").concat(es));function sh(n,s,a){var d=n.type||"unknown-event";n.currentTarget=a,Dv(d,s,void 0,n),n.currentTarget=null}function oh(n,s){s=(s&4)!==0;for(var a=0;a<n.length;a++){var d=n[a],p=d.event;d=d.listeners;e:{var g=void 0;if(s)for(var y=d.length-1;0<=y;y--){var T=d[y],E=T.instance,j=T.currentTarget;if(T=T.listener,E!==g&&p.isPropagationStopped())break e;sh(p,T,j),g=E}else for(y=0;y<d.length;y++){if(T=d[y],E=T.instance,j=T.currentTarget,T=T.listener,E!==g&&p.isPropagationStopped())break e;sh(p,T,j),g=E}}}if(Ks)throw n=za,Ks=!1,za=null,n}function ze(n,s){var a=s[kl];a===void 0&&(a=s[kl]=new Set);var d=n+"__bubble";a.has(d)||(ah(s,n,2,!1),a.add(d))}function hl(n,s,a){var d=0;s&&(d|=4),ah(a,n,d,s)}var co="_reactListening"+Math.random().toString(36).slice(2);function ts(n){if(!n[co]){n[co]=!0,r.forEach(function(a){a!=="selectionchange"&&(Ly.has(a)||hl(a,!1,n),hl(a,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[co]||(s[co]=!0,hl("selectionchange",!1,s))}}function ah(n,s,a,d){switch(Id(s)){case 1:var p=Jv;break;case 4:p=Qv;break;default:p=Ja}a=p.bind(null,s,a,n),p=void 0,!Va||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),d?p!==void 0?n.addEventListener(s,a,{capture:!0,passive:p}):n.addEventListener(s,a,!0):p!==void 0?n.addEventListener(s,a,{passive:p}):n.addEventListener(s,a,!1)}function fl(n,s,a,d,p){var g=d;if((s&1)===0&&(s&2)===0&&d!==null)e:for(;;){if(d===null)return;var y=d.tag;if(y===3||y===4){var T=d.stateNode.containerInfo;if(T===p||T.nodeType===8&&T.parentNode===p)break;if(y===4)for(y=d.return;y!==null;){var E=y.tag;if((E===3||E===4)&&(E=y.stateNode.containerInfo,E===p||E.nodeType===8&&E.parentNode===p))return;y=y.return}for(;T!==null;){if(y=Ri(T),y===null)return;if(E=y.tag,E===5||E===6){d=g=y;continue e}T=T.parentNode}}d=d.return}hd(function(){var j=g,G=ja(a),J=[];e:{var K=ih.get(n);if(K!==void 0){var ce=Xa,he=n;switch(n){case"keypress":if(io(a)===0)break e;case"keydown":case"keyup":ce=dy;break;case"focusin":he="focus",ce=tl;break;case"focusout":he="blur",ce=tl;break;case"beforeblur":case"afterblur":ce=tl;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ce=Dd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ce=Zv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ce=py;break;case Zd:case eh:case th:ce=ny;break;case nh:ce=gy;break;case"scroll":ce=Yv;break;case"wheel":ce=yy;break;case"copy":case"cut":case"paste":ce=ry;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ce=Ld}var pe=(s&4)!==0,nt=!pe&&n==="scroll",O=pe?K!==null?K+"Capture":null:K;pe=[];for(var R=j,L;R!==null;){L=R;var X=L.stateNode;if(L.tag===5&&X!==null&&(L=X,O!==null&&(X=Ur(R,O),X!=null&&pe.push(ns(R,X,L)))),nt)break;R=R.return}0<pe.length&&(K=new ce(K,he,null,a,G),J.push({event:K,listeners:pe}))}}if((s&7)===0){e:{if(K=n==="mouseover"||n==="pointerover",ce=n==="mouseout"||n==="pointerout",K&&a!==Ua&&(he=a.relatedTarget||a.fromElement)&&(Ri(he)||he[Mn]))break e;if((ce||K)&&(K=G.window===G?G:(K=G.ownerDocument)?K.defaultView||K.parentWindow:window,ce?(he=a.relatedTarget||a.toElement,ce=j,he=he?Ri(he):null,he!==null&&(nt=Pi(he),he!==nt||he.tag!==5&&he.tag!==6)&&(he=null)):(ce=null,he=j),ce!==he)){if(pe=Dd,X="onMouseLeave",O="onMouseEnter",R="mouse",(n==="pointerout"||n==="pointerover")&&(pe=Ld,X="onPointerLeave",O="onPointerEnter",R="pointer"),nt=ce==null?K:sr(ce),L=he==null?K:sr(he),K=new pe(X,R+"leave",ce,a,G),K.target=nt,K.relatedTarget=L,X=null,Ri(G)===j&&(pe=new pe(O,R+"enter",he,a,G),pe.target=L,pe.relatedTarget=nt,X=pe),nt=X,ce&&he)t:{for(pe=ce,O=he,R=0,L=pe;L;L=ir(L))R++;for(L=0,X=O;X;X=ir(X))L++;for(;0<R-L;)pe=ir(pe),R--;for(;0<L-R;)O=ir(O),L--;for(;R--;){if(pe===O||O!==null&&pe===O.alternate)break t;pe=ir(pe),O=ir(O)}pe=null}else pe=null;ce!==null&&lh(J,K,ce,pe,!1),he!==null&&nt!==null&&lh(J,nt,he,pe,!0)}}e:{if(K=j?sr(j):window,ce=K.nodeName&&K.nodeName.toLowerCase(),ce==="select"||ce==="input"&&K.type==="file")var ge=xy;else if(Vd(K))if(qd)ge=_y;else{ge=Py;var ye=Ey}else(ce=K.nodeName)&&ce.toLowerCase()==="input"&&(K.type==="checkbox"||K.type==="radio")&&(ge=Ry);if(ge&&(ge=ge(n,j))){zd(J,ge,a,G);break e}ye&&ye(n,K,j),n==="focusout"&&(ye=K._wrapperState)&&ye.controlled&&K.type==="number"&&jt(K,"number",K.value)}switch(ye=j?sr(j):window,n){case"focusin":(Vd(ye)||ye.contentEditable==="true")&&(tr=ye,al=j,Zr=null);break;case"focusout":Zr=al=tr=null;break;case"mousedown":ll=!0;break;case"contextmenu":case"mouseup":case"dragend":ll=!1,Yd(J,a,G);break;case"selectionchange":if(Oy)break;case"keydown":case"keyup":Yd(J,a,G)}var ke;if(il)e:{switch(n){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else er?Fd(n,a)&&(be="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(be="onCompositionStart");be&&(Ad&&a.locale!=="ko"&&(er||be!=="onCompositionStart"?be==="onCompositionEnd"&&er&&(ke=Nd()):(ei=G,Ya="value"in ei?ei.value:ei.textContent,er=!0)),ye=uo(j,be),0<ye.length&&(be=new Md(be,n,null,a,G),J.push({event:be,listeners:ye}),ke?be.data=ke:(ke=Bd(a),ke!==null&&(be.data=ke)))),(ke=Sy?by(n,a):Ty(n,a))&&(j=uo(j,"onBeforeInput"),0<j.length&&(G=new Md("onBeforeInput","beforeinput",null,a,G),J.push({event:G,listeners:j}),G.data=ke))}oh(J,s)})}function ns(n,s,a){return{instance:n,listener:s,currentTarget:a}}function uo(n,s){for(var a=s+"Capture",d=[];n!==null;){var p=n,g=p.stateNode;p.tag===5&&g!==null&&(p=g,g=Ur(n,a),g!=null&&d.unshift(ns(n,g,p)),g=Ur(n,s),g!=null&&d.push(ns(n,g,p))),n=n.return}return d}function ir(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function lh(n,s,a,d,p){for(var g=s._reactName,y=[];a!==null&&a!==d;){var T=a,E=T.alternate,j=T.stateNode;if(E!==null&&E===d)break;T.tag===5&&j!==null&&(T=j,p?(E=Ur(a,g),E!=null&&y.unshift(ns(a,E,T))):p||(E=Ur(a,g),E!=null&&y.push(ns(a,E,T)))),a=a.return}y.length!==0&&n.push({event:s,listeners:y})}var Ay=/\r\n?/g,Uy=/\u0000|\uFFFD/g;function ch(n){return(typeof n=="string"?n:""+n).replace(Ay,`
`).replace(Uy,"")}function ho(n,s,a){if(s=ch(s),ch(n)!==s&&a)throw Error(t(425))}function fo(){}var pl=null,ml=null;function gl(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var vl=typeof setTimeout=="function"?setTimeout:void 0,jy=typeof clearTimeout=="function"?clearTimeout:void 0,uh=typeof Promise=="function"?Promise:void 0,Fy=typeof queueMicrotask=="function"?queueMicrotask:typeof uh<"u"?function(n){return uh.resolve(null).then(n).catch(By)}:vl;function By(n){setTimeout(function(){throw n})}function yl(n,s){var a=s,d=0;do{var p=a.nextSibling;if(n.removeChild(a),p&&p.nodeType===8)if(a=p.data,a==="/$"){if(d===0){n.removeChild(p),Kr(s);return}d--}else a!=="$"&&a!=="$?"&&a!=="$!"||d++;a=p}while(a);Kr(s)}function ni(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return n}function dh(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(s===0)return n;s--}else a==="/$"&&s++}n=n.previousSibling}return null}var rr=Math.random().toString(36).slice(2),Sn="__reactFiber$"+rr,is="__reactProps$"+rr,Mn="__reactContainer$"+rr,kl="__reactEvents$"+rr,Vy="__reactListeners$"+rr,zy="__reactHandles$"+rr;function Ri(n){var s=n[Sn];if(s)return s;for(var a=n.parentNode;a;){if(s=a[Mn]||a[Sn]){if(a=s.alternate,s.child!==null||a!==null&&a.child!==null)for(n=dh(n);n!==null;){if(a=n[Sn])return a;n=dh(n)}return s}n=a,a=n.parentNode}return null}function rs(n){return n=n[Sn]||n[Mn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function sr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(t(33))}function po(n){return n[is]||null}var Sl=[],or=-1;function ii(n){return{current:n}}function qe(n){0>or||(n.current=Sl[or],Sl[or]=null,or--)}function Ve(n,s){or++,Sl[or]=n.current,n.current=s}var ri={},St=ii(ri),Pt=ii(!1),_i=ri;function ar(n,s){var a=n.type.contextTypes;if(!a)return ri;var d=n.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===s)return d.__reactInternalMemoizedMaskedChildContext;var p={},g;for(g in a)p[g]=s[g];return d&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=p),p}function Rt(n){return n=n.childContextTypes,n!=null}function mo(){qe(Pt),qe(St)}function hh(n,s,a){if(St.current!==ri)throw Error(t(168));Ve(St,s),Ve(Pt,a)}function fh(n,s,a){var d=n.stateNode;if(s=s.childContextTypes,typeof d.getChildContext!="function")return a;d=d.getChildContext();for(var p in d)if(!(p in s))throw Error(t(108,fe(n)||"Unknown",p));return H({},a,d)}function go(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ri,_i=St.current,Ve(St,n),Ve(Pt,Pt.current),!0}function ph(n,s,a){var d=n.stateNode;if(!d)throw Error(t(169));a?(n=fh(n,s,_i),d.__reactInternalMemoizedMergedChildContext=n,qe(Pt),qe(St),Ve(St,n)):qe(Pt),Ve(Pt,a)}var Ln=null,vo=!1,bl=!1;function mh(n){Ln===null?Ln=[n]:Ln.push(n)}function qy(n){vo=!0,mh(n)}function si(){if(!bl&&Ln!==null){bl=!0;var n=0,s=Ue;try{var a=Ln;for(Ue=1;n<a.length;n++){var d=a[n];do d=d(!0);while(d!==null)}Ln=null,vo=!1}catch(p){throw Ln!==null&&(Ln=Ln.slice(n+1)),vd(qa,si),p}finally{Ue=s,bl=!1}}return null}var lr=[],cr=0,yo=null,ko=0,Jt=[],Qt=0,Ii=null,An=1,Un="";function Ni(n,s){lr[cr++]=ko,lr[cr++]=yo,yo=n,ko=s}function gh(n,s,a){Jt[Qt++]=An,Jt[Qt++]=Un,Jt[Qt++]=Ii,Ii=n;var d=An;n=Un;var p=32-nn(d)-1;d&=~(1<<p),a+=1;var g=32-nn(s)+p;if(30<g){var y=p-p%5;g=(d&(1<<y)-1).toString(32),d>>=y,p-=y,An=1<<32-nn(s)+p|a<<p|d,Un=g+n}else An=1<<g|a<<p|d,Un=n}function Tl(n){n.return!==null&&(Ni(n,1),gh(n,1,0))}function Cl(n){for(;n===yo;)yo=lr[--cr],lr[cr]=null,ko=lr[--cr],lr[cr]=null;for(;n===Ii;)Ii=Jt[--Qt],Jt[Qt]=null,Un=Jt[--Qt],Jt[Qt]=null,An=Jt[--Qt],Jt[Qt]=null}var Vt=null,zt=null,Ke=!1,sn=null;function vh(n,s){var a=en(5,null,null,0);a.elementType="DELETED",a.stateNode=s,a.return=n,s=n.deletions,s===null?(n.deletions=[a],n.flags|=16):s.push(a)}function yh(n,s){switch(n.tag){case 5:var a=n.type;return s=s.nodeType!==1||a.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(n.stateNode=s,Vt=n,zt=ni(s.firstChild),!0):!1;case 6:return s=n.pendingProps===""||s.nodeType!==3?null:s,s!==null?(n.stateNode=s,Vt=n,zt=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(a=Ii!==null?{id:An,overflow:Un}:null,n.memoizedState={dehydrated:s,treeContext:a,retryLane:1073741824},a=en(18,null,null,0),a.stateNode=s,a.return=n,n.child=a,Vt=n,zt=null,!0):!1;default:return!1}}function wl(n){return(n.mode&1)!==0&&(n.flags&128)===0}function xl(n){if(Ke){var s=zt;if(s){var a=s;if(!yh(n,s)){if(wl(n))throw Error(t(418));s=ni(a.nextSibling);var d=Vt;s&&yh(n,s)?vh(d,a):(n.flags=n.flags&-4097|2,Ke=!1,Vt=n)}}else{if(wl(n))throw Error(t(418));n.flags=n.flags&-4097|2,Ke=!1,Vt=n}}}function kh(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Vt=n}function So(n){if(n!==Vt)return!1;if(!Ke)return kh(n),Ke=!0,!1;var s;if((s=n.tag!==3)&&!(s=n.tag!==5)&&(s=n.type,s=s!=="head"&&s!=="body"&&!gl(n.type,n.memoizedProps)),s&&(s=zt)){if(wl(n))throw Sh(),Error(t(418));for(;s;)vh(n,s),s=ni(s.nextSibling)}if(kh(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(t(317));e:{for(n=n.nextSibling,s=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(s===0){zt=ni(n.nextSibling);break e}s--}else a!=="$"&&a!=="$!"&&a!=="$?"||s++}n=n.nextSibling}zt=null}}else zt=Vt?ni(n.stateNode.nextSibling):null;return!0}function Sh(){for(var n=zt;n;)n=ni(n.nextSibling)}function ur(){zt=Vt=null,Ke=!1}function El(n){sn===null?sn=[n]:sn.push(n)}var Wy=I.ReactCurrentBatchConfig;function ss(n,s,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(t(309));var d=a.stateNode}if(!d)throw Error(t(147,n));var p=d,g=""+n;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===g?s.ref:(s=function(y){var T=p.refs;y===null?delete T[g]:T[g]=y},s._stringRef=g,s)}if(typeof n!="string")throw Error(t(284));if(!a._owner)throw Error(t(290,n))}return n}function bo(n,s){throw n=Object.prototype.toString.call(s),Error(t(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n))}function bh(n){var s=n._init;return s(n._payload)}function Th(n){function s(O,R){if(n){var L=O.deletions;L===null?(O.deletions=[R],O.flags|=16):L.push(R)}}function a(O,R){if(!n)return null;for(;R!==null;)s(O,R),R=R.sibling;return null}function d(O,R){for(O=new Map;R!==null;)R.key!==null?O.set(R.key,R):O.set(R.index,R),R=R.sibling;return O}function p(O,R){return O=fi(O,R),O.index=0,O.sibling=null,O}function g(O,R,L){return O.index=L,n?(L=O.alternate,L!==null?(L=L.index,L<R?(O.flags|=2,R):L):(O.flags|=2,R)):(O.flags|=1048576,R)}function y(O){return n&&O.alternate===null&&(O.flags|=2),O}function T(O,R,L,X){return R===null||R.tag!==6?(R=vc(L,O.mode,X),R.return=O,R):(R=p(R,L),R.return=O,R)}function E(O,R,L,X){var ge=L.type;return ge===$?G(O,R,L.props.children,X,L.key):R!==null&&(R.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===$e&&bh(ge)===R.type)?(X=p(R,L.props),X.ref=ss(O,R,L),X.return=O,X):(X=Ho(L.type,L.key,L.props,null,O.mode,X),X.ref=ss(O,R,L),X.return=O,X)}function j(O,R,L,X){return R===null||R.tag!==4||R.stateNode.containerInfo!==L.containerInfo||R.stateNode.implementation!==L.implementation?(R=yc(L,O.mode,X),R.return=O,R):(R=p(R,L.children||[]),R.return=O,R)}function G(O,R,L,X,ge){return R===null||R.tag!==7?(R=Fi(L,O.mode,X,ge),R.return=O,R):(R=p(R,L),R.return=O,R)}function J(O,R,L){if(typeof R=="string"&&R!==""||typeof R=="number")return R=vc(""+R,O.mode,L),R.return=O,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case A:return L=Ho(R.type,R.key,R.props,null,O.mode,L),L.ref=ss(O,null,R),L.return=O,L;case V:return R=yc(R,O.mode,L),R.return=O,R;case $e:var X=R._init;return J(O,X(R._payload),L)}if($t(R)||te(R))return R=Fi(R,O.mode,L,null),R.return=O,R;bo(O,R)}return null}function K(O,R,L,X){var ge=R!==null?R.key:null;if(typeof L=="string"&&L!==""||typeof L=="number")return ge!==null?null:T(O,R,""+L,X);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case A:return L.key===ge?E(O,R,L,X):null;case V:return L.key===ge?j(O,R,L,X):null;case $e:return ge=L._init,K(O,R,ge(L._payload),X)}if($t(L)||te(L))return ge!==null?null:G(O,R,L,X,null);bo(O,L)}return null}function ce(O,R,L,X,ge){if(typeof X=="string"&&X!==""||typeof X=="number")return O=O.get(L)||null,T(R,O,""+X,ge);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case A:return O=O.get(X.key===null?L:X.key)||null,E(R,O,X,ge);case V:return O=O.get(X.key===null?L:X.key)||null,j(R,O,X,ge);case $e:var ye=X._init;return ce(O,R,L,ye(X._payload),ge)}if($t(X)||te(X))return O=O.get(L)||null,G(R,O,X,ge,null);bo(R,X)}return null}function he(O,R,L,X){for(var ge=null,ye=null,ke=R,be=R=0,pt=null;ke!==null&&be<L.length;be++){ke.index>be?(pt=ke,ke=null):pt=ke.sibling;var Le=K(O,ke,L[be],X);if(Le===null){ke===null&&(ke=pt);break}n&&ke&&Le.alternate===null&&s(O,ke),R=g(Le,R,be),ye===null?ge=Le:ye.sibling=Le,ye=Le,ke=pt}if(be===L.length)return a(O,ke),Ke&&Ni(O,be),ge;if(ke===null){for(;be<L.length;be++)ke=J(O,L[be],X),ke!==null&&(R=g(ke,R,be),ye===null?ge=ke:ye.sibling=ke,ye=ke);return Ke&&Ni(O,be),ge}for(ke=d(O,ke);be<L.length;be++)pt=ce(ke,O,be,L[be],X),pt!==null&&(n&&pt.alternate!==null&&ke.delete(pt.key===null?be:pt.key),R=g(pt,R,be),ye===null?ge=pt:ye.sibling=pt,ye=pt);return n&&ke.forEach(function(pi){return s(O,pi)}),Ke&&Ni(O,be),ge}function pe(O,R,L,X){var ge=te(L);if(typeof ge!="function")throw Error(t(150));if(L=ge.call(L),L==null)throw Error(t(151));for(var ye=ge=null,ke=R,be=R=0,pt=null,Le=L.next();ke!==null&&!Le.done;be++,Le=L.next()){ke.index>be?(pt=ke,ke=null):pt=ke.sibling;var pi=K(O,ke,Le.value,X);if(pi===null){ke===null&&(ke=pt);break}n&&ke&&pi.alternate===null&&s(O,ke),R=g(pi,R,be),ye===null?ge=pi:ye.sibling=pi,ye=pi,ke=pt}if(Le.done)return a(O,ke),Ke&&Ni(O,be),ge;if(ke===null){for(;!Le.done;be++,Le=L.next())Le=J(O,Le.value,X),Le!==null&&(R=g(Le,R,be),ye===null?ge=Le:ye.sibling=Le,ye=Le);return Ke&&Ni(O,be),ge}for(ke=d(O,ke);!Le.done;be++,Le=L.next())Le=ce(ke,O,be,Le.value,X),Le!==null&&(n&&Le.alternate!==null&&ke.delete(Le.key===null?be:Le.key),R=g(Le,R,be),ye===null?ge=Le:ye.sibling=Le,ye=Le);return n&&ke.forEach(function(C0){return s(O,C0)}),Ke&&Ni(O,be),ge}function nt(O,R,L,X){if(typeof L=="object"&&L!==null&&L.type===$&&L.key===null&&(L=L.props.children),typeof L=="object"&&L!==null){switch(L.$$typeof){case A:e:{for(var ge=L.key,ye=R;ye!==null;){if(ye.key===ge){if(ge=L.type,ge===$){if(ye.tag===7){a(O,ye.sibling),R=p(ye,L.props.children),R.return=O,O=R;break e}}else if(ye.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===$e&&bh(ge)===ye.type){a(O,ye.sibling),R=p(ye,L.props),R.ref=ss(O,ye,L),R.return=O,O=R;break e}a(O,ye);break}else s(O,ye);ye=ye.sibling}L.type===$?(R=Fi(L.props.children,O.mode,X,L.key),R.return=O,O=R):(X=Ho(L.type,L.key,L.props,null,O.mode,X),X.ref=ss(O,R,L),X.return=O,O=X)}return y(O);case V:e:{for(ye=L.key;R!==null;){if(R.key===ye)if(R.tag===4&&R.stateNode.containerInfo===L.containerInfo&&R.stateNode.implementation===L.implementation){a(O,R.sibling),R=p(R,L.children||[]),R.return=O,O=R;break e}else{a(O,R);break}else s(O,R);R=R.sibling}R=yc(L,O.mode,X),R.return=O,O=R}return y(O);case $e:return ye=L._init,nt(O,R,ye(L._payload),X)}if($t(L))return he(O,R,L,X);if(te(L))return pe(O,R,L,X);bo(O,L)}return typeof L=="string"&&L!==""||typeof L=="number"?(L=""+L,R!==null&&R.tag===6?(a(O,R.sibling),R=p(R,L),R.return=O,O=R):(a(O,R),R=vc(L,O.mode,X),R.return=O,O=R),y(O)):a(O,R)}return nt}var dr=Th(!0),Ch=Th(!1),To=ii(null),Co=null,hr=null,Pl=null;function Rl(){Pl=hr=Co=null}function _l(n){var s=To.current;qe(To),n._currentValue=s}function Il(n,s,a){for(;n!==null;){var d=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),n===a)break;n=n.return}}function fr(n,s){Co=n,Pl=hr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&s)!==0&&(_t=!0),n.firstContext=null)}function Yt(n){var s=n._currentValue;if(Pl!==n)if(n={context:n,memoizedValue:s,next:null},hr===null){if(Co===null)throw Error(t(308));hr=n,Co.dependencies={lanes:0,firstContext:n}}else hr=hr.next=n;return s}var Oi=null;function Nl(n){Oi===null?Oi=[n]:Oi.push(n)}function wh(n,s,a,d){var p=s.interleaved;return p===null?(a.next=a,Nl(s)):(a.next=p.next,p.next=a),s.interleaved=a,jn(n,d)}function jn(n,s){n.lanes|=s;var a=n.alternate;for(a!==null&&(a.lanes|=s),a=n,n=n.return;n!==null;)n.childLanes|=s,a=n.alternate,a!==null&&(a.childLanes|=s),a=n,n=n.return;return a.tag===3?a.stateNode:null}var oi=!1;function Ol(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xh(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Fn(n,s){return{eventTime:n,lane:s,tag:0,payload:null,callback:null,next:null}}function ai(n,s,a){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(De&2)!==0){var p=d.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),d.pending=s,jn(n,a)}return p=d.interleaved,p===null?(s.next=s,Nl(d)):(s.next=p.next,p.next=s),d.interleaved=s,jn(n,a)}function wo(n,s,a){if(s=s.updateQueue,s!==null&&(s=s.shared,(a&4194240)!==0)){var d=s.lanes;d&=n.pendingLanes,a|=d,s.lanes=a,Ka(n,a)}}function Eh(n,s){var a=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,a===d)){var p=null,g=null;if(a=a.firstBaseUpdate,a!==null){do{var y={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};g===null?p=g=y:g=g.next=y,a=a.next}while(a!==null);g===null?p=g=s:g=g.next=s}else p=g=s;a={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:d.shared,effects:d.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=s:n.next=s,a.lastBaseUpdate=s}function xo(n,s,a,d){var p=n.updateQueue;oi=!1;var g=p.firstBaseUpdate,y=p.lastBaseUpdate,T=p.shared.pending;if(T!==null){p.shared.pending=null;var E=T,j=E.next;E.next=null,y===null?g=j:y.next=j,y=E;var G=n.alternate;G!==null&&(G=G.updateQueue,T=G.lastBaseUpdate,T!==y&&(T===null?G.firstBaseUpdate=j:T.next=j,G.lastBaseUpdate=E))}if(g!==null){var J=p.baseState;y=0,G=j=E=null,T=g;do{var K=T.lane,ce=T.eventTime;if((d&K)===K){G!==null&&(G=G.next={eventTime:ce,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var he=n,pe=T;switch(K=s,ce=a,pe.tag){case 1:if(he=pe.payload,typeof he=="function"){J=he.call(ce,J,K);break e}J=he;break e;case 3:he.flags=he.flags&-65537|128;case 0:if(he=pe.payload,K=typeof he=="function"?he.call(ce,J,K):he,K==null)break e;J=H({},J,K);break e;case 2:oi=!0}}T.callback!==null&&T.lane!==0&&(n.flags|=64,K=p.effects,K===null?p.effects=[T]:K.push(T))}else ce={eventTime:ce,lane:K,tag:T.tag,payload:T.payload,callback:T.callback,next:null},G===null?(j=G=ce,E=J):G=G.next=ce,y|=K;if(T=T.next,T===null){if(T=p.shared.pending,T===null)break;K=T,T=K.next,K.next=null,p.lastBaseUpdate=K,p.shared.pending=null}}while(!0);if(G===null&&(E=J),p.baseState=E,p.firstBaseUpdate=j,p.lastBaseUpdate=G,s=p.shared.interleaved,s!==null){p=s;do y|=p.lane,p=p.next;while(p!==s)}else g===null&&(p.shared.lanes=0);Li|=y,n.lanes=y,n.memoizedState=J}}function Ph(n,s,a){if(n=s.effects,s.effects=null,n!==null)for(s=0;s<n.length;s++){var d=n[s],p=d.callback;if(p!==null){if(d.callback=null,d=a,typeof p!="function")throw Error(t(191,p));p.call(d)}}}var os={},bn=ii(os),as=ii(os),ls=ii(os);function Di(n){if(n===os)throw Error(t(174));return n}function Dl(n,s){switch(Ve(ls,s),Ve(as,n),Ve(bn,os),n=s.nodeType,n){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Ma(null,"");break;default:n=n===8?s.parentNode:s,s=n.namespaceURI||null,n=n.tagName,s=Ma(s,n)}qe(bn),Ve(bn,s)}function pr(){qe(bn),qe(as),qe(ls)}function Rh(n){Di(ls.current);var s=Di(bn.current),a=Ma(s,n.type);s!==a&&(Ve(as,n),Ve(bn,a))}function Ml(n){as.current===n&&(qe(bn),qe(as))}var Je=ii(0);function Eo(n){for(var s=n;s!==null;){if(s.tag===13){var a=s.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ll=[];function Al(){for(var n=0;n<Ll.length;n++)Ll[n]._workInProgressVersionPrimary=null;Ll.length=0}var Po=I.ReactCurrentDispatcher,Ul=I.ReactCurrentBatchConfig,Mi=0,Qe=null,ct=null,ht=null,Ro=!1,cs=!1,us=0,Hy=0;function bt(){throw Error(t(321))}function jl(n,s){if(s===null)return!1;for(var a=0;a<s.length&&a<n.length;a++)if(!rn(n[a],s[a]))return!1;return!0}function Fl(n,s,a,d,p,g){if(Mi=g,Qe=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Po.current=n===null||n.memoizedState===null?Jy:Qy,n=a(d,p),cs){g=0;do{if(cs=!1,us=0,25<=g)throw Error(t(301));g+=1,ht=ct=null,s.updateQueue=null,Po.current=Yy,n=a(d,p)}while(cs)}if(Po.current=No,s=ct!==null&&ct.next!==null,Mi=0,ht=ct=Qe=null,Ro=!1,s)throw Error(t(300));return n}function Bl(){var n=us!==0;return us=0,n}function Tn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ht===null?Qe.memoizedState=ht=n:ht=ht.next=n,ht}function Xt(){if(ct===null){var n=Qe.alternate;n=n!==null?n.memoizedState:null}else n=ct.next;var s=ht===null?Qe.memoizedState:ht.next;if(s!==null)ht=s,ct=n;else{if(n===null)throw Error(t(310));ct=n,n={memoizedState:ct.memoizedState,baseState:ct.baseState,baseQueue:ct.baseQueue,queue:ct.queue,next:null},ht===null?Qe.memoizedState=ht=n:ht=ht.next=n}return ht}function ds(n,s){return typeof s=="function"?s(n):s}function Vl(n){var s=Xt(),a=s.queue;if(a===null)throw Error(t(311));a.lastRenderedReducer=n;var d=ct,p=d.baseQueue,g=a.pending;if(g!==null){if(p!==null){var y=p.next;p.next=g.next,g.next=y}d.baseQueue=p=g,a.pending=null}if(p!==null){g=p.next,d=d.baseState;var T=y=null,E=null,j=g;do{var G=j.lane;if((Mi&G)===G)E!==null&&(E=E.next={lane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),d=j.hasEagerState?j.eagerState:n(d,j.action);else{var J={lane:G,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null};E===null?(T=E=J,y=d):E=E.next=J,Qe.lanes|=G,Li|=G}j=j.next}while(j!==null&&j!==g);E===null?y=d:E.next=T,rn(d,s.memoizedState)||(_t=!0),s.memoizedState=d,s.baseState=y,s.baseQueue=E,a.lastRenderedState=d}if(n=a.interleaved,n!==null){p=n;do g=p.lane,Qe.lanes|=g,Li|=g,p=p.next;while(p!==n)}else p===null&&(a.lanes=0);return[s.memoizedState,a.dispatch]}function zl(n){var s=Xt(),a=s.queue;if(a===null)throw Error(t(311));a.lastRenderedReducer=n;var d=a.dispatch,p=a.pending,g=s.memoizedState;if(p!==null){a.pending=null;var y=p=p.next;do g=n(g,y.action),y=y.next;while(y!==p);rn(g,s.memoizedState)||(_t=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),a.lastRenderedState=g}return[g,d]}function _h(){}function Ih(n,s){var a=Qe,d=Xt(),p=s(),g=!rn(d.memoizedState,p);if(g&&(d.memoizedState=p,_t=!0),d=d.queue,ql(Dh.bind(null,a,d,n),[n]),d.getSnapshot!==s||g||ht!==null&&ht.memoizedState.tag&1){if(a.flags|=2048,hs(9,Oh.bind(null,a,d,p,s),void 0,null),ft===null)throw Error(t(349));(Mi&30)!==0||Nh(a,s,p)}return p}function Nh(n,s,a){n.flags|=16384,n={getSnapshot:s,value:a},s=Qe.updateQueue,s===null?(s={lastEffect:null,stores:null},Qe.updateQueue=s,s.stores=[n]):(a=s.stores,a===null?s.stores=[n]:a.push(n))}function Oh(n,s,a,d){s.value=a,s.getSnapshot=d,Mh(s)&&Lh(n)}function Dh(n,s,a){return a(function(){Mh(s)&&Lh(n)})}function Mh(n){var s=n.getSnapshot;n=n.value;try{var a=s();return!rn(n,a)}catch{return!0}}function Lh(n){var s=jn(n,1);s!==null&&cn(s,n,1,-1)}function Ah(n){var s=Tn();return typeof n=="function"&&(n=n()),s.memoizedState=s.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ds,lastRenderedState:n},s.queue=n,n=n.dispatch=$y.bind(null,Qe,n),[s.memoizedState,n]}function hs(n,s,a,d){return n={tag:n,create:s,destroy:a,deps:d,next:null},s=Qe.updateQueue,s===null?(s={lastEffect:null,stores:null},Qe.updateQueue=s,s.lastEffect=n.next=n):(a=s.lastEffect,a===null?s.lastEffect=n.next=n:(d=a.next,a.next=n,n.next=d,s.lastEffect=n)),n}function Uh(){return Xt().memoizedState}function _o(n,s,a,d){var p=Tn();Qe.flags|=n,p.memoizedState=hs(1|s,a,void 0,d===void 0?null:d)}function Io(n,s,a,d){var p=Xt();d=d===void 0?null:d;var g=void 0;if(ct!==null){var y=ct.memoizedState;if(g=y.destroy,d!==null&&jl(d,y.deps)){p.memoizedState=hs(s,a,g,d);return}}Qe.flags|=n,p.memoizedState=hs(1|s,a,g,d)}function jh(n,s){return _o(8390656,8,n,s)}function ql(n,s){return Io(2048,8,n,s)}function Fh(n,s){return Io(4,2,n,s)}function Bh(n,s){return Io(4,4,n,s)}function Vh(n,s){if(typeof s=="function")return n=n(),s(n),function(){s(null)};if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function zh(n,s,a){return a=a!=null?a.concat([n]):null,Io(4,4,Vh.bind(null,s,n),a)}function Wl(){}function qh(n,s){var a=Xt();s=s===void 0?null:s;var d=a.memoizedState;return d!==null&&s!==null&&jl(s,d[1])?d[0]:(a.memoizedState=[n,s],n)}function Wh(n,s){var a=Xt();s=s===void 0?null:s;var d=a.memoizedState;return d!==null&&s!==null&&jl(s,d[1])?d[0]:(n=n(),a.memoizedState=[n,s],n)}function Hh(n,s,a){return(Mi&21)===0?(n.baseState&&(n.baseState=!1,_t=!0),n.memoizedState=a):(rn(a,s)||(a=bd(),Qe.lanes|=a,Li|=a,n.baseState=!0),s)}function Ky(n,s){var a=Ue;Ue=a!==0&&4>a?a:4,n(!0);var d=Ul.transition;Ul.transition={};try{n(!1),s()}finally{Ue=a,Ul.transition=d}}function Kh(){return Xt().memoizedState}function Gy(n,s,a){var d=di(n);if(a={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null},Gh(n))$h(s,a);else if(a=wh(n,s,a,d),a!==null){var p=Et();cn(a,n,d,p),Jh(a,s,d)}}function $y(n,s,a){var d=di(n),p={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null};if(Gh(n))$h(s,p);else{var g=n.alternate;if(n.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var y=s.lastRenderedState,T=g(y,a);if(p.hasEagerState=!0,p.eagerState=T,rn(T,y)){var E=s.interleaved;E===null?(p.next=p,Nl(s)):(p.next=E.next,E.next=p),s.interleaved=p;return}}catch{}finally{}a=wh(n,s,p,d),a!==null&&(p=Et(),cn(a,n,d,p),Jh(a,s,d))}}function Gh(n){var s=n.alternate;return n===Qe||s!==null&&s===Qe}function $h(n,s){cs=Ro=!0;var a=n.pending;a===null?s.next=s:(s.next=a.next,a.next=s),n.pending=s}function Jh(n,s,a){if((a&4194240)!==0){var d=s.lanes;d&=n.pendingLanes,a|=d,s.lanes=a,Ka(n,a)}}var No={readContext:Yt,useCallback:bt,useContext:bt,useEffect:bt,useImperativeHandle:bt,useInsertionEffect:bt,useLayoutEffect:bt,useMemo:bt,useReducer:bt,useRef:bt,useState:bt,useDebugValue:bt,useDeferredValue:bt,useTransition:bt,useMutableSource:bt,useSyncExternalStore:bt,useId:bt,unstable_isNewReconciler:!1},Jy={readContext:Yt,useCallback:function(n,s){return Tn().memoizedState=[n,s===void 0?null:s],n},useContext:Yt,useEffect:jh,useImperativeHandle:function(n,s,a){return a=a!=null?a.concat([n]):null,_o(4194308,4,Vh.bind(null,s,n),a)},useLayoutEffect:function(n,s){return _o(4194308,4,n,s)},useInsertionEffect:function(n,s){return _o(4,2,n,s)},useMemo:function(n,s){var a=Tn();return s=s===void 0?null:s,n=n(),a.memoizedState=[n,s],n},useReducer:function(n,s,a){var d=Tn();return s=a!==void 0?a(s):s,d.memoizedState=d.baseState=s,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:s},d.queue=n,n=n.dispatch=Gy.bind(null,Qe,n),[d.memoizedState,n]},useRef:function(n){var s=Tn();return n={current:n},s.memoizedState=n},useState:Ah,useDebugValue:Wl,useDeferredValue:function(n){return Tn().memoizedState=n},useTransition:function(){var n=Ah(!1),s=n[0];return n=Ky.bind(null,n[1]),Tn().memoizedState=n,[s,n]},useMutableSource:function(){},useSyncExternalStore:function(n,s,a){var d=Qe,p=Tn();if(Ke){if(a===void 0)throw Error(t(407));a=a()}else{if(a=s(),ft===null)throw Error(t(349));(Mi&30)!==0||Nh(d,s,a)}p.memoizedState=a;var g={value:a,getSnapshot:s};return p.queue=g,jh(Dh.bind(null,d,g,n),[n]),d.flags|=2048,hs(9,Oh.bind(null,d,g,a,s),void 0,null),a},useId:function(){var n=Tn(),s=ft.identifierPrefix;if(Ke){var a=Un,d=An;a=(d&~(1<<32-nn(d)-1)).toString(32)+a,s=":"+s+"R"+a,a=us++,0<a&&(s+="H"+a.toString(32)),s+=":"}else a=Hy++,s=":"+s+"r"+a.toString(32)+":";return n.memoizedState=s},unstable_isNewReconciler:!1},Qy={readContext:Yt,useCallback:qh,useContext:Yt,useEffect:ql,useImperativeHandle:zh,useInsertionEffect:Fh,useLayoutEffect:Bh,useMemo:Wh,useReducer:Vl,useRef:Uh,useState:function(){return Vl(ds)},useDebugValue:Wl,useDeferredValue:function(n){var s=Xt();return Hh(s,ct.memoizedState,n)},useTransition:function(){var n=Vl(ds)[0],s=Xt().memoizedState;return[n,s]},useMutableSource:_h,useSyncExternalStore:Ih,useId:Kh,unstable_isNewReconciler:!1},Yy={readContext:Yt,useCallback:qh,useContext:Yt,useEffect:ql,useImperativeHandle:zh,useInsertionEffect:Fh,useLayoutEffect:Bh,useMemo:Wh,useReducer:zl,useRef:Uh,useState:function(){return zl(ds)},useDebugValue:Wl,useDeferredValue:function(n){var s=Xt();return ct===null?s.memoizedState=n:Hh(s,ct.memoizedState,n)},useTransition:function(){var n=zl(ds)[0],s=Xt().memoizedState;return[n,s]},useMutableSource:_h,useSyncExternalStore:Ih,useId:Kh,unstable_isNewReconciler:!1};function on(n,s){if(n&&n.defaultProps){s=H({},s),n=n.defaultProps;for(var a in n)s[a]===void 0&&(s[a]=n[a]);return s}return s}function Hl(n,s,a,d){s=n.memoizedState,a=a(d,s),a=a==null?s:H({},s,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var Oo={isMounted:function(n){return(n=n._reactInternals)?Pi(n)===n:!1},enqueueSetState:function(n,s,a){n=n._reactInternals;var d=Et(),p=di(n),g=Fn(d,p);g.payload=s,a!=null&&(g.callback=a),s=ai(n,g,p),s!==null&&(cn(s,n,p,d),wo(s,n,p))},enqueueReplaceState:function(n,s,a){n=n._reactInternals;var d=Et(),p=di(n),g=Fn(d,p);g.tag=1,g.payload=s,a!=null&&(g.callback=a),s=ai(n,g,p),s!==null&&(cn(s,n,p,d),wo(s,n,p))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var a=Et(),d=di(n),p=Fn(a,d);p.tag=2,s!=null&&(p.callback=s),s=ai(n,p,d),s!==null&&(cn(s,n,d,a),wo(s,n,d))}};function Qh(n,s,a,d,p,g,y){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,g,y):s.prototype&&s.prototype.isPureReactComponent?!Xr(a,d)||!Xr(p,g):!0}function Yh(n,s,a){var d=!1,p=ri,g=s.contextType;return typeof g=="object"&&g!==null?g=Yt(g):(p=Rt(s)?_i:St.current,d=s.contextTypes,g=(d=d!=null)?ar(n,p):ri),s=new s(a,g),n.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=Oo,n.stateNode=s,s._reactInternals=n,d&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=p,n.__reactInternalMemoizedMaskedChildContext=g),s}function Xh(n,s,a,d){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(a,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(a,d),s.state!==n&&Oo.enqueueReplaceState(s,s.state,null)}function Kl(n,s,a,d){var p=n.stateNode;p.props=a,p.state=n.memoizedState,p.refs={},Ol(n);var g=s.contextType;typeof g=="object"&&g!==null?p.context=Yt(g):(g=Rt(s)?_i:St.current,p.context=ar(n,g)),p.state=n.memoizedState,g=s.getDerivedStateFromProps,typeof g=="function"&&(Hl(n,s,g,a),p.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(s=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),s!==p.state&&Oo.enqueueReplaceState(p,p.state,null),xo(n,a,p,d),p.state=n.memoizedState),typeof p.componentDidMount=="function"&&(n.flags|=4194308)}function mr(n,s){try{var a="",d=s;do a+=se(d),d=d.return;while(d);var p=a}catch(g){p=`
Error generating stack: `+g.message+`
`+g.stack}return{value:n,source:s,stack:p,digest:null}}function Gl(n,s,a){return{value:n,source:null,stack:a??null,digest:s??null}}function $l(n,s){try{console.error(s.value)}catch(a){setTimeout(function(){throw a})}}var Xy=typeof WeakMap=="function"?WeakMap:Map;function Zh(n,s,a){a=Fn(-1,a),a.tag=3,a.payload={element:null};var d=s.value;return a.callback=function(){Fo||(Fo=!0,cc=d),$l(n,s)},a}function ef(n,s,a){a=Fn(-1,a),a.tag=3;var d=n.type.getDerivedStateFromError;if(typeof d=="function"){var p=s.value;a.payload=function(){return d(p)},a.callback=function(){$l(n,s)}}var g=n.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(a.callback=function(){$l(n,s),typeof d!="function"&&(ci===null?ci=new Set([this]):ci.add(this));var y=s.stack;this.componentDidCatch(s.value,{componentStack:y!==null?y:""})}),a}function tf(n,s,a){var d=n.pingCache;if(d===null){d=n.pingCache=new Xy;var p=new Set;d.set(s,p)}else p=d.get(s),p===void 0&&(p=new Set,d.set(s,p));p.has(a)||(p.add(a),n=h0.bind(null,n,s,a),s.then(n,n))}function nf(n){do{var s;if((s=n.tag===13)&&(s=n.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return n;n=n.return}while(n!==null);return null}function rf(n,s,a,d,p){return(n.mode&1)===0?(n===s?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(s=Fn(-1,1),s.tag=2,ai(a,s,1))),a.lanes|=1),n):(n.flags|=65536,n.lanes=p,n)}var Zy=I.ReactCurrentOwner,_t=!1;function xt(n,s,a,d){s.child=n===null?Ch(s,null,a,d):dr(s,n.child,a,d)}function sf(n,s,a,d,p){a=a.render;var g=s.ref;return fr(s,p),d=Fl(n,s,a,d,g,p),a=Bl(),n!==null&&!_t?(s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~p,Bn(n,s,p)):(Ke&&a&&Tl(s),s.flags|=1,xt(n,s,d,p),s.child)}function of(n,s,a,d,p){if(n===null){var g=a.type;return typeof g=="function"&&!gc(g)&&g.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(s.tag=15,s.type=g,af(n,s,g,d,p)):(n=Ho(a.type,null,d,s,s.mode,p),n.ref=s.ref,n.return=s,s.child=n)}if(g=n.child,(n.lanes&p)===0){var y=g.memoizedProps;if(a=a.compare,a=a!==null?a:Xr,a(y,d)&&n.ref===s.ref)return Bn(n,s,p)}return s.flags|=1,n=fi(g,d),n.ref=s.ref,n.return=s,s.child=n}function af(n,s,a,d,p){if(n!==null){var g=n.memoizedProps;if(Xr(g,d)&&n.ref===s.ref)if(_t=!1,s.pendingProps=d=g,(n.lanes&p)!==0)(n.flags&131072)!==0&&(_t=!0);else return s.lanes=n.lanes,Bn(n,s,p)}return Jl(n,s,a,d,p)}function lf(n,s,a){var d=s.pendingProps,p=d.children,g=n!==null?n.memoizedState:null;if(d.mode==="hidden")if((s.mode&1)===0)s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ve(vr,qt),qt|=a;else{if((a&1073741824)===0)return n=g!==null?g.baseLanes|a:a,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:n,cachePool:null,transitions:null},s.updateQueue=null,Ve(vr,qt),qt|=n,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=g!==null?g.baseLanes:a,Ve(vr,qt),qt|=d}else g!==null?(d=g.baseLanes|a,s.memoizedState=null):d=a,Ve(vr,qt),qt|=d;return xt(n,s,p,a),s.child}function cf(n,s){var a=s.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(s.flags|=512,s.flags|=2097152)}function Jl(n,s,a,d,p){var g=Rt(a)?_i:St.current;return g=ar(s,g),fr(s,p),a=Fl(n,s,a,d,g,p),d=Bl(),n!==null&&!_t?(s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~p,Bn(n,s,p)):(Ke&&d&&Tl(s),s.flags|=1,xt(n,s,a,p),s.child)}function uf(n,s,a,d,p){if(Rt(a)){var g=!0;go(s)}else g=!1;if(fr(s,p),s.stateNode===null)Mo(n,s),Yh(s,a,d),Kl(s,a,d,p),d=!0;else if(n===null){var y=s.stateNode,T=s.memoizedProps;y.props=T;var E=y.context,j=a.contextType;typeof j=="object"&&j!==null?j=Yt(j):(j=Rt(a)?_i:St.current,j=ar(s,j));var G=a.getDerivedStateFromProps,J=typeof G=="function"||typeof y.getSnapshotBeforeUpdate=="function";J||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==d||E!==j)&&Xh(s,y,d,j),oi=!1;var K=s.memoizedState;y.state=K,xo(s,d,y,p),E=s.memoizedState,T!==d||K!==E||Pt.current||oi?(typeof G=="function"&&(Hl(s,a,G,d),E=s.memoizedState),(T=oi||Qh(s,a,T,d,K,E,j))?(J||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(s.flags|=4194308)):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=E),y.props=d,y.state=E,y.context=j,d=T):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{y=s.stateNode,xh(n,s),T=s.memoizedProps,j=s.type===s.elementType?T:on(s.type,T),y.props=j,J=s.pendingProps,K=y.context,E=a.contextType,typeof E=="object"&&E!==null?E=Yt(E):(E=Rt(a)?_i:St.current,E=ar(s,E));var ce=a.getDerivedStateFromProps;(G=typeof ce=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==J||K!==E)&&Xh(s,y,d,E),oi=!1,K=s.memoizedState,y.state=K,xo(s,d,y,p);var he=s.memoizedState;T!==J||K!==he||Pt.current||oi?(typeof ce=="function"&&(Hl(s,a,ce,d),he=s.memoizedState),(j=oi||Qh(s,a,j,d,K,he,E)||!1)?(G||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,he,E),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,he,E)),typeof y.componentDidUpdate=="function"&&(s.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===n.memoizedProps&&K===n.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===n.memoizedProps&&K===n.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=he),y.props=d,y.state=he,y.context=E,d=j):(typeof y.componentDidUpdate!="function"||T===n.memoizedProps&&K===n.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===n.memoizedProps&&K===n.memoizedState||(s.flags|=1024),d=!1)}return Ql(n,s,a,d,g,p)}function Ql(n,s,a,d,p,g){cf(n,s);var y=(s.flags&128)!==0;if(!d&&!y)return p&&ph(s,a,!1),Bn(n,s,g);d=s.stateNode,Zy.current=s;var T=y&&typeof a.getDerivedStateFromError!="function"?null:d.render();return s.flags|=1,n!==null&&y?(s.child=dr(s,n.child,null,g),s.child=dr(s,null,T,g)):xt(n,s,T,g),s.memoizedState=d.state,p&&ph(s,a,!0),s.child}function df(n){var s=n.stateNode;s.pendingContext?hh(n,s.pendingContext,s.pendingContext!==s.context):s.context&&hh(n,s.context,!1),Dl(n,s.containerInfo)}function hf(n,s,a,d,p){return ur(),El(p),s.flags|=256,xt(n,s,a,d),s.child}var Yl={dehydrated:null,treeContext:null,retryLane:0};function Xl(n){return{baseLanes:n,cachePool:null,transitions:null}}function ff(n,s,a){var d=s.pendingProps,p=Je.current,g=!1,y=(s.flags&128)!==0,T;if((T=y)||(T=n!==null&&n.memoizedState===null?!1:(p&2)!==0),T?(g=!0,s.flags&=-129):(n===null||n.memoizedState!==null)&&(p|=1),Ve(Je,p&1),n===null)return xl(s),n=s.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((s.mode&1)===0?s.lanes=1:n.data==="$!"?s.lanes=8:s.lanes=1073741824,null):(y=d.children,n=d.fallback,g?(d=s.mode,g=s.child,y={mode:"hidden",children:y},(d&1)===0&&g!==null?(g.childLanes=0,g.pendingProps=y):g=Ko(y,d,0,null),n=Fi(n,d,a,null),g.return=s,n.return=s,g.sibling=n,s.child=g,s.child.memoizedState=Xl(a),s.memoizedState=Yl,n):Zl(s,y));if(p=n.memoizedState,p!==null&&(T=p.dehydrated,T!==null))return e0(n,s,y,d,T,p,a);if(g){g=d.fallback,y=s.mode,p=n.child,T=p.sibling;var E={mode:"hidden",children:d.children};return(y&1)===0&&s.child!==p?(d=s.child,d.childLanes=0,d.pendingProps=E,s.deletions=null):(d=fi(p,E),d.subtreeFlags=p.subtreeFlags&14680064),T!==null?g=fi(T,g):(g=Fi(g,y,a,null),g.flags|=2),g.return=s,d.return=s,d.sibling=g,s.child=d,d=g,g=s.child,y=n.child.memoizedState,y=y===null?Xl(a):{baseLanes:y.baseLanes|a,cachePool:null,transitions:y.transitions},g.memoizedState=y,g.childLanes=n.childLanes&~a,s.memoizedState=Yl,d}return g=n.child,n=g.sibling,d=fi(g,{mode:"visible",children:d.children}),(s.mode&1)===0&&(d.lanes=a),d.return=s,d.sibling=null,n!==null&&(a=s.deletions,a===null?(s.deletions=[n],s.flags|=16):a.push(n)),s.child=d,s.memoizedState=null,d}function Zl(n,s){return s=Ko({mode:"visible",children:s},n.mode,0,null),s.return=n,n.child=s}function Do(n,s,a,d){return d!==null&&El(d),dr(s,n.child,null,a),n=Zl(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function e0(n,s,a,d,p,g,y){if(a)return s.flags&256?(s.flags&=-257,d=Gl(Error(t(422))),Do(n,s,y,d)):s.memoizedState!==null?(s.child=n.child,s.flags|=128,null):(g=d.fallback,p=s.mode,d=Ko({mode:"visible",children:d.children},p,0,null),g=Fi(g,p,y,null),g.flags|=2,d.return=s,g.return=s,d.sibling=g,s.child=d,(s.mode&1)!==0&&dr(s,n.child,null,y),s.child.memoizedState=Xl(y),s.memoizedState=Yl,g);if((s.mode&1)===0)return Do(n,s,y,null);if(p.data==="$!"){if(d=p.nextSibling&&p.nextSibling.dataset,d)var T=d.dgst;return d=T,g=Error(t(419)),d=Gl(g,d,void 0),Do(n,s,y,d)}if(T=(y&n.childLanes)!==0,_t||T){if(d=ft,d!==null){switch(y&-y){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(d.suspendedLanes|y))!==0?0:p,p!==0&&p!==g.retryLane&&(g.retryLane=p,jn(n,p),cn(d,n,p,-1))}return mc(),d=Gl(Error(t(421))),Do(n,s,y,d)}return p.data==="$?"?(s.flags|=128,s.child=n.child,s=f0.bind(null,n),p._reactRetry=s,null):(n=g.treeContext,zt=ni(p.nextSibling),Vt=s,Ke=!0,sn=null,n!==null&&(Jt[Qt++]=An,Jt[Qt++]=Un,Jt[Qt++]=Ii,An=n.id,Un=n.overflow,Ii=s),s=Zl(s,d.children),s.flags|=4096,s)}function pf(n,s,a){n.lanes|=s;var d=n.alternate;d!==null&&(d.lanes|=s),Il(n.return,s,a)}function ec(n,s,a,d,p){var g=n.memoizedState;g===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:a,tailMode:p}:(g.isBackwards=s,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=a,g.tailMode=p)}function mf(n,s,a){var d=s.pendingProps,p=d.revealOrder,g=d.tail;if(xt(n,s,d.children,a),d=Je.current,(d&2)!==0)d=d&1|2,s.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&pf(n,a,s);else if(n.tag===19)pf(n,a,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}d&=1}if(Ve(Je,d),(s.mode&1)===0)s.memoizedState=null;else switch(p){case"forwards":for(a=s.child,p=null;a!==null;)n=a.alternate,n!==null&&Eo(n)===null&&(p=a),a=a.sibling;a=p,a===null?(p=s.child,s.child=null):(p=a.sibling,a.sibling=null),ec(s,!1,p,a,g);break;case"backwards":for(a=null,p=s.child,s.child=null;p!==null;){if(n=p.alternate,n!==null&&Eo(n)===null){s.child=p;break}n=p.sibling,p.sibling=a,a=p,p=n}ec(s,!0,a,null,g);break;case"together":ec(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Mo(n,s){(s.mode&1)===0&&n!==null&&(n.alternate=null,s.alternate=null,s.flags|=2)}function Bn(n,s,a){if(n!==null&&(s.dependencies=n.dependencies),Li|=s.lanes,(a&s.childLanes)===0)return null;if(n!==null&&s.child!==n.child)throw Error(t(153));if(s.child!==null){for(n=s.child,a=fi(n,n.pendingProps),s.child=a,a.return=s;n.sibling!==null;)n=n.sibling,a=a.sibling=fi(n,n.pendingProps),a.return=s;a.sibling=null}return s.child}function t0(n,s,a){switch(s.tag){case 3:df(s),ur();break;case 5:Rh(s);break;case 1:Rt(s.type)&&go(s);break;case 4:Dl(s,s.stateNode.containerInfo);break;case 10:var d=s.type._context,p=s.memoizedProps.value;Ve(To,d._currentValue),d._currentValue=p;break;case 13:if(d=s.memoizedState,d!==null)return d.dehydrated!==null?(Ve(Je,Je.current&1),s.flags|=128,null):(a&s.child.childLanes)!==0?ff(n,s,a):(Ve(Je,Je.current&1),n=Bn(n,s,a),n!==null?n.sibling:null);Ve(Je,Je.current&1);break;case 19:if(d=(a&s.childLanes)!==0,(n.flags&128)!==0){if(d)return mf(n,s,a);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Ve(Je,Je.current),d)break;return null;case 22:case 23:return s.lanes=0,lf(n,s,a)}return Bn(n,s,a)}var gf,tc,vf,yf;gf=function(n,s){for(var a=s.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return;a=a.return}a.sibling.return=a.return,a=a.sibling}},tc=function(){},vf=function(n,s,a,d){var p=n.memoizedProps;if(p!==d){n=s.stateNode,Di(bn.current);var g=null;switch(a){case"input":p=we(n,p),d=we(n,d),g=[];break;case"select":p=H({},p,{value:void 0}),d=H({},d,{value:void 0}),g=[];break;case"textarea":p=Ft(n,p),d=Ft(n,d),g=[];break;default:typeof p.onClick!="function"&&typeof d.onClick=="function"&&(n.onclick=fo)}La(a,d);var y;a=null;for(j in p)if(!d.hasOwnProperty(j)&&p.hasOwnProperty(j)&&p[j]!=null)if(j==="style"){var T=p[j];for(y in T)T.hasOwnProperty(y)&&(a||(a={}),a[y]="")}else j!=="dangerouslySetInnerHTML"&&j!=="children"&&j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(o.hasOwnProperty(j)?g||(g=[]):(g=g||[]).push(j,null));for(j in d){var E=d[j];if(T=p!=null?p[j]:void 0,d.hasOwnProperty(j)&&E!==T&&(E!=null||T!=null))if(j==="style")if(T){for(y in T)!T.hasOwnProperty(y)||E&&E.hasOwnProperty(y)||(a||(a={}),a[y]="");for(y in E)E.hasOwnProperty(y)&&T[y]!==E[y]&&(a||(a={}),a[y]=E[y])}else a||(g||(g=[]),g.push(j,a)),a=E;else j==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,T=T?T.__html:void 0,E!=null&&T!==E&&(g=g||[]).push(j,E)):j==="children"?typeof E!="string"&&typeof E!="number"||(g=g||[]).push(j,""+E):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&(o.hasOwnProperty(j)?(E!=null&&j==="onScroll"&&ze("scroll",n),g||T===E||(g=[])):(g=g||[]).push(j,E))}a&&(g=g||[]).push("style",a);var j=g;(s.updateQueue=j)&&(s.flags|=4)}},yf=function(n,s,a,d){a!==d&&(s.flags|=4)};function fs(n,s){if(!Ke)switch(n.tailMode){case"hidden":s=n.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function Tt(n){var s=n.alternate!==null&&n.alternate.child===n.child,a=0,d=0;if(s)for(var p=n.child;p!==null;)a|=p.lanes|p.childLanes,d|=p.subtreeFlags&14680064,d|=p.flags&14680064,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)a|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=d,n.childLanes=a,s}function n0(n,s,a){var d=s.pendingProps;switch(Cl(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tt(s),null;case 1:return Rt(s.type)&&mo(),Tt(s),null;case 3:return d=s.stateNode,pr(),qe(Pt),qe(St),Al(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(n===null||n.child===null)&&(So(s)?s.flags|=4:n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,sn!==null&&(hc(sn),sn=null))),tc(n,s),Tt(s),null;case 5:Ml(s);var p=Di(ls.current);if(a=s.type,n!==null&&s.stateNode!=null)vf(n,s,a,d,p),n.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!d){if(s.stateNode===null)throw Error(t(166));return Tt(s),null}if(n=Di(bn.current),So(s)){d=s.stateNode,a=s.type;var g=s.memoizedProps;switch(d[Sn]=s,d[is]=g,n=(s.mode&1)!==0,a){case"dialog":ze("cancel",d),ze("close",d);break;case"iframe":case"object":case"embed":ze("load",d);break;case"video":case"audio":for(p=0;p<es.length;p++)ze(es[p],d);break;case"source":ze("error",d);break;case"img":case"image":case"link":ze("error",d),ze("load",d);break;case"details":ze("toggle",d);break;case"input":xe(d,g),ze("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!g.multiple},ze("invalid",d);break;case"textarea":Mr(d,g),ze("invalid",d)}La(a,g),p=null;for(var y in g)if(g.hasOwnProperty(y)){var T=g[y];y==="children"?typeof T=="string"?d.textContent!==T&&(g.suppressHydrationWarning!==!0&&ho(d.textContent,T,n),p=["children",T]):typeof T=="number"&&d.textContent!==""+T&&(g.suppressHydrationWarning!==!0&&ho(d.textContent,T,n),p=["children",""+T]):o.hasOwnProperty(y)&&T!=null&&y==="onScroll"&&ze("scroll",d)}switch(a){case"input":Gt(d),tn(d,g,!0);break;case"textarea":Gt(d),nd(d);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(d.onclick=fo)}d=p,s.updateQueue=d,d!==null&&(s.flags|=4)}else{y=p.nodeType===9?p:p.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=id(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=y.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof d.is=="string"?n=y.createElement(a,{is:d.is}):(n=y.createElement(a),a==="select"&&(y=n,d.multiple?y.multiple=!0:d.size&&(y.size=d.size))):n=y.createElementNS(n,a),n[Sn]=s,n[is]=d,gf(n,s,!1,!1),s.stateNode=n;e:{switch(y=Aa(a,d),a){case"dialog":ze("cancel",n),ze("close",n),p=d;break;case"iframe":case"object":case"embed":ze("load",n),p=d;break;case"video":case"audio":for(p=0;p<es.length;p++)ze(es[p],n);p=d;break;case"source":ze("error",n),p=d;break;case"img":case"image":case"link":ze("error",n),ze("load",n),p=d;break;case"details":ze("toggle",n),p=d;break;case"input":xe(n,d),p=we(n,d),ze("invalid",n);break;case"option":p=d;break;case"select":n._wrapperState={wasMultiple:!!d.multiple},p=H({},d,{value:void 0}),ze("invalid",n);break;case"textarea":Mr(n,d),p=Ft(n,d),ze("invalid",n);break;default:p=d}La(a,p),T=p;for(g in T)if(T.hasOwnProperty(g)){var E=T[g];g==="style"?od(n,E):g==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,E!=null&&rd(n,E)):g==="children"?typeof E=="string"?(a!=="textarea"||E!=="")&&Lr(n,E):typeof E=="number"&&Lr(n,""+E):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(o.hasOwnProperty(g)?E!=null&&g==="onScroll"&&ze("scroll",n):E!=null&&U(n,g,E,y))}switch(a){case"input":Gt(n),tn(n,d,!1);break;case"textarea":Gt(n),nd(n);break;case"option":d.value!=null&&n.setAttribute("value",""+me(d.value));break;case"select":n.multiple=!!d.multiple,g=d.value,g!=null?Dn(n,!!d.multiple,g,!1):d.defaultValue!=null&&Dn(n,!!d.multiple,d.defaultValue,!0);break;default:typeof p.onClick=="function"&&(n.onclick=fo)}switch(a){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Tt(s),null;case 6:if(n&&s.stateNode!=null)yf(n,s,n.memoizedProps,d);else{if(typeof d!="string"&&s.stateNode===null)throw Error(t(166));if(a=Di(ls.current),Di(bn.current),So(s)){if(d=s.stateNode,a=s.memoizedProps,d[Sn]=s,(g=d.nodeValue!==a)&&(n=Vt,n!==null))switch(n.tag){case 3:ho(d.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ho(d.nodeValue,a,(n.mode&1)!==0)}g&&(s.flags|=4)}else d=(a.nodeType===9?a:a.ownerDocument).createTextNode(d),d[Sn]=s,s.stateNode=d}return Tt(s),null;case 13:if(qe(Je),d=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ke&&zt!==null&&(s.mode&1)!==0&&(s.flags&128)===0)Sh(),ur(),s.flags|=98560,g=!1;else if(g=So(s),d!==null&&d.dehydrated!==null){if(n===null){if(!g)throw Error(t(318));if(g=s.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(t(317));g[Sn]=s}else ur(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Tt(s),g=!1}else sn!==null&&(hc(sn),sn=null),g=!0;if(!g)return s.flags&65536?s:null}return(s.flags&128)!==0?(s.lanes=a,s):(d=d!==null,d!==(n!==null&&n.memoizedState!==null)&&d&&(s.child.flags|=8192,(s.mode&1)!==0&&(n===null||(Je.current&1)!==0?ut===0&&(ut=3):mc())),s.updateQueue!==null&&(s.flags|=4),Tt(s),null);case 4:return pr(),tc(n,s),n===null&&ts(s.stateNode.containerInfo),Tt(s),null;case 10:return _l(s.type._context),Tt(s),null;case 17:return Rt(s.type)&&mo(),Tt(s),null;case 19:if(qe(Je),g=s.memoizedState,g===null)return Tt(s),null;if(d=(s.flags&128)!==0,y=g.rendering,y===null)if(d)fs(g,!1);else{if(ut!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(y=Eo(n),y!==null){for(s.flags|=128,fs(g,!1),d=y.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),s.subtreeFlags=0,d=a,a=s.child;a!==null;)g=a,n=d,g.flags&=14680066,y=g.alternate,y===null?(g.childLanes=0,g.lanes=n,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=y.childLanes,g.lanes=y.lanes,g.child=y.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=y.memoizedProps,g.memoizedState=y.memoizedState,g.updateQueue=y.updateQueue,g.type=y.type,n=y.dependencies,g.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return Ve(Je,Je.current&1|2),s.child}n=n.sibling}g.tail!==null&&tt()>yr&&(s.flags|=128,d=!0,fs(g,!1),s.lanes=4194304)}else{if(!d)if(n=Eo(y),n!==null){if(s.flags|=128,d=!0,a=n.updateQueue,a!==null&&(s.updateQueue=a,s.flags|=4),fs(g,!0),g.tail===null&&g.tailMode==="hidden"&&!y.alternate&&!Ke)return Tt(s),null}else 2*tt()-g.renderingStartTime>yr&&a!==1073741824&&(s.flags|=128,d=!0,fs(g,!1),s.lanes=4194304);g.isBackwards?(y.sibling=s.child,s.child=y):(a=g.last,a!==null?a.sibling=y:s.child=y,g.last=y)}return g.tail!==null?(s=g.tail,g.rendering=s,g.tail=s.sibling,g.renderingStartTime=tt(),s.sibling=null,a=Je.current,Ve(Je,d?a&1|2:a&1),s):(Tt(s),null);case 22:case 23:return pc(),d=s.memoizedState!==null,n!==null&&n.memoizedState!==null!==d&&(s.flags|=8192),d&&(s.mode&1)!==0?(qt&1073741824)!==0&&(Tt(s),s.subtreeFlags&6&&(s.flags|=8192)):Tt(s),null;case 24:return null;case 25:return null}throw Error(t(156,s.tag))}function i0(n,s){switch(Cl(s),s.tag){case 1:return Rt(s.type)&&mo(),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return pr(),qe(Pt),qe(St),Al(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 5:return Ml(s),null;case 13:if(qe(Je),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(t(340));ur()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return qe(Je),null;case 4:return pr(),null;case 10:return _l(s.type._context),null;case 22:case 23:return pc(),null;case 24:return null;default:return null}}var Lo=!1,Ct=!1,r0=typeof WeakSet=="function"?WeakSet:Set,de=null;function gr(n,s){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(d){Ye(n,s,d)}else a.current=null}function nc(n,s,a){try{a()}catch(d){Ye(n,s,d)}}var kf=!1;function s0(n,s){if(pl=eo,n=Qd(),ol(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var d=a.getSelection&&a.getSelection();if(d&&d.rangeCount!==0){a=d.anchorNode;var p=d.anchorOffset,g=d.focusNode;d=d.focusOffset;try{a.nodeType,g.nodeType}catch{a=null;break e}var y=0,T=-1,E=-1,j=0,G=0,J=n,K=null;t:for(;;){for(var ce;J!==a||p!==0&&J.nodeType!==3||(T=y+p),J!==g||d!==0&&J.nodeType!==3||(E=y+d),J.nodeType===3&&(y+=J.nodeValue.length),(ce=J.firstChild)!==null;)K=J,J=ce;for(;;){if(J===n)break t;if(K===a&&++j===p&&(T=y),K===g&&++G===d&&(E=y),(ce=J.nextSibling)!==null)break;J=K,K=J.parentNode}J=ce}a=T===-1||E===-1?null:{start:T,end:E}}else a=null}a=a||{start:0,end:0}}else a=null;for(ml={focusedElem:n,selectionRange:a},eo=!1,de=s;de!==null;)if(s=de,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,de=n;else for(;de!==null;){s=de;try{var he=s.alternate;if((s.flags&1024)!==0)switch(s.tag){case 0:case 11:case 15:break;case 1:if(he!==null){var pe=he.memoizedProps,nt=he.memoizedState,O=s.stateNode,R=O.getSnapshotBeforeUpdate(s.elementType===s.type?pe:on(s.type,pe),nt);O.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var L=s.stateNode.containerInfo;L.nodeType===1?L.textContent="":L.nodeType===9&&L.documentElement&&L.removeChild(L.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(X){Ye(s,s.return,X)}if(n=s.sibling,n!==null){n.return=s.return,de=n;break}de=s.return}return he=kf,kf=!1,he}function ps(n,s,a){var d=s.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var p=d=d.next;do{if((p.tag&n)===n){var g=p.destroy;p.destroy=void 0,g!==void 0&&nc(s,a,g)}p=p.next}while(p!==d)}}function Ao(n,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var a=s=s.next;do{if((a.tag&n)===n){var d=a.create;a.destroy=d()}a=a.next}while(a!==s)}}function ic(n){var s=n.ref;if(s!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof s=="function"?s(n):s.current=n}}function Sf(n){var s=n.alternate;s!==null&&(n.alternate=null,Sf(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&(delete s[Sn],delete s[is],delete s[kl],delete s[Vy],delete s[zy])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function bf(n){return n.tag===5||n.tag===3||n.tag===4}function Tf(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||bf(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function rc(n,s,a){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?a.nodeType===8?a.parentNode.insertBefore(n,s):a.insertBefore(n,s):(a.nodeType===8?(s=a.parentNode,s.insertBefore(n,a)):(s=a,s.appendChild(n)),a=a._reactRootContainer,a!=null||s.onclick!==null||(s.onclick=fo));else if(d!==4&&(n=n.child,n!==null))for(rc(n,s,a),n=n.sibling;n!==null;)rc(n,s,a),n=n.sibling}function sc(n,s,a){var d=n.tag;if(d===5||d===6)n=n.stateNode,s?a.insertBefore(n,s):a.appendChild(n);else if(d!==4&&(n=n.child,n!==null))for(sc(n,s,a),n=n.sibling;n!==null;)sc(n,s,a),n=n.sibling}var vt=null,an=!1;function li(n,s,a){for(a=a.child;a!==null;)Cf(n,s,a),a=a.sibling}function Cf(n,s,a){if(kn&&typeof kn.onCommitFiberUnmount=="function")try{kn.onCommitFiberUnmount($s,a)}catch{}switch(a.tag){case 5:Ct||gr(a,s);case 6:var d=vt,p=an;vt=null,li(n,s,a),vt=d,an=p,vt!==null&&(an?(n=vt,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):vt.removeChild(a.stateNode));break;case 18:vt!==null&&(an?(n=vt,a=a.stateNode,n.nodeType===8?yl(n.parentNode,a):n.nodeType===1&&yl(n,a),Kr(n)):yl(vt,a.stateNode));break;case 4:d=vt,p=an,vt=a.stateNode.containerInfo,an=!0,li(n,s,a),vt=d,an=p;break;case 0:case 11:case 14:case 15:if(!Ct&&(d=a.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){p=d=d.next;do{var g=p,y=g.destroy;g=g.tag,y!==void 0&&((g&2)!==0||(g&4)!==0)&&nc(a,s,y),p=p.next}while(p!==d)}li(n,s,a);break;case 1:if(!Ct&&(gr(a,s),d=a.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=a.memoizedProps,d.state=a.memoizedState,d.componentWillUnmount()}catch(T){Ye(a,s,T)}li(n,s,a);break;case 21:li(n,s,a);break;case 22:a.mode&1?(Ct=(d=Ct)||a.memoizedState!==null,li(n,s,a),Ct=d):li(n,s,a);break;default:li(n,s,a)}}function wf(n){var s=n.updateQueue;if(s!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new r0),s.forEach(function(d){var p=p0.bind(null,n,d);a.has(d)||(a.add(d),d.then(p,p))})}}function ln(n,s){var a=s.deletions;if(a!==null)for(var d=0;d<a.length;d++){var p=a[d];try{var g=n,y=s,T=y;e:for(;T!==null;){switch(T.tag){case 5:vt=T.stateNode,an=!1;break e;case 3:vt=T.stateNode.containerInfo,an=!0;break e;case 4:vt=T.stateNode.containerInfo,an=!0;break e}T=T.return}if(vt===null)throw Error(t(160));Cf(g,y,p),vt=null,an=!1;var E=p.alternate;E!==null&&(E.return=null),p.return=null}catch(j){Ye(p,s,j)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)xf(s,n),s=s.sibling}function xf(n,s){var a=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ln(s,n),Cn(n),d&4){try{ps(3,n,n.return),Ao(3,n)}catch(pe){Ye(n,n.return,pe)}try{ps(5,n,n.return)}catch(pe){Ye(n,n.return,pe)}}break;case 1:ln(s,n),Cn(n),d&512&&a!==null&&gr(a,a.return);break;case 5:if(ln(s,n),Cn(n),d&512&&a!==null&&gr(a,a.return),n.flags&32){var p=n.stateNode;try{Lr(p,"")}catch(pe){Ye(n,n.return,pe)}}if(d&4&&(p=n.stateNode,p!=null)){var g=n.memoizedProps,y=a!==null?a.memoizedProps:g,T=n.type,E=n.updateQueue;if(n.updateQueue=null,E!==null)try{T==="input"&&g.type==="radio"&&g.name!=null&&wt(p,g),Aa(T,y);var j=Aa(T,g);for(y=0;y<E.length;y+=2){var G=E[y],J=E[y+1];G==="style"?od(p,J):G==="dangerouslySetInnerHTML"?rd(p,J):G==="children"?Lr(p,J):U(p,G,J,j)}switch(T){case"input":rt(p,g);break;case"textarea":td(p,g);break;case"select":var K=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!g.multiple;var ce=g.value;ce!=null?Dn(p,!!g.multiple,ce,!1):K!==!!g.multiple&&(g.defaultValue!=null?Dn(p,!!g.multiple,g.defaultValue,!0):Dn(p,!!g.multiple,g.multiple?[]:"",!1))}p[is]=g}catch(pe){Ye(n,n.return,pe)}}break;case 6:if(ln(s,n),Cn(n),d&4){if(n.stateNode===null)throw Error(t(162));p=n.stateNode,g=n.memoizedProps;try{p.nodeValue=g}catch(pe){Ye(n,n.return,pe)}}break;case 3:if(ln(s,n),Cn(n),d&4&&a!==null&&a.memoizedState.isDehydrated)try{Kr(s.containerInfo)}catch(pe){Ye(n,n.return,pe)}break;case 4:ln(s,n),Cn(n);break;case 13:ln(s,n),Cn(n),p=n.child,p.flags&8192&&(g=p.memoizedState!==null,p.stateNode.isHidden=g,!g||p.alternate!==null&&p.alternate.memoizedState!==null||(lc=tt())),d&4&&wf(n);break;case 22:if(G=a!==null&&a.memoizedState!==null,n.mode&1?(Ct=(j=Ct)||G,ln(s,n),Ct=j):ln(s,n),Cn(n),d&8192){if(j=n.memoizedState!==null,(n.stateNode.isHidden=j)&&!G&&(n.mode&1)!==0)for(de=n,G=n.child;G!==null;){for(J=de=G;de!==null;){switch(K=de,ce=K.child,K.tag){case 0:case 11:case 14:case 15:ps(4,K,K.return);break;case 1:gr(K,K.return);var he=K.stateNode;if(typeof he.componentWillUnmount=="function"){d=K,a=K.return;try{s=d,he.props=s.memoizedProps,he.state=s.memoizedState,he.componentWillUnmount()}catch(pe){Ye(d,a,pe)}}break;case 5:gr(K,K.return);break;case 22:if(K.memoizedState!==null){Rf(J);continue}}ce!==null?(ce.return=K,de=ce):Rf(J)}G=G.sibling}e:for(G=null,J=n;;){if(J.tag===5){if(G===null){G=J;try{p=J.stateNode,j?(g=p.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(T=J.stateNode,E=J.memoizedProps.style,y=E!=null&&E.hasOwnProperty("display")?E.display:null,T.style.display=sd("display",y))}catch(pe){Ye(n,n.return,pe)}}}else if(J.tag===6){if(G===null)try{J.stateNode.nodeValue=j?"":J.memoizedProps}catch(pe){Ye(n,n.return,pe)}}else if((J.tag!==22&&J.tag!==23||J.memoizedState===null||J===n)&&J.child!==null){J.child.return=J,J=J.child;continue}if(J===n)break e;for(;J.sibling===null;){if(J.return===null||J.return===n)break e;G===J&&(G=null),J=J.return}G===J&&(G=null),J.sibling.return=J.return,J=J.sibling}}break;case 19:ln(s,n),Cn(n),d&4&&wf(n);break;case 21:break;default:ln(s,n),Cn(n)}}function Cn(n){var s=n.flags;if(s&2){try{e:{for(var a=n.return;a!==null;){if(bf(a)){var d=a;break e}a=a.return}throw Error(t(160))}switch(d.tag){case 5:var p=d.stateNode;d.flags&32&&(Lr(p,""),d.flags&=-33);var g=Tf(n);sc(n,g,p);break;case 3:case 4:var y=d.stateNode.containerInfo,T=Tf(n);rc(n,T,y);break;default:throw Error(t(161))}}catch(E){Ye(n,n.return,E)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function o0(n,s,a){de=n,Ef(n)}function Ef(n,s,a){for(var d=(n.mode&1)!==0;de!==null;){var p=de,g=p.child;if(p.tag===22&&d){var y=p.memoizedState!==null||Lo;if(!y){var T=p.alternate,E=T!==null&&T.memoizedState!==null||Ct;T=Lo;var j=Ct;if(Lo=y,(Ct=E)&&!j)for(de=p;de!==null;)y=de,E=y.child,y.tag===22&&y.memoizedState!==null?_f(p):E!==null?(E.return=y,de=E):_f(p);for(;g!==null;)de=g,Ef(g),g=g.sibling;de=p,Lo=T,Ct=j}Pf(n)}else(p.subtreeFlags&8772)!==0&&g!==null?(g.return=p,de=g):Pf(n)}}function Pf(n){for(;de!==null;){var s=de;if((s.flags&8772)!==0){var a=s.alternate;try{if((s.flags&8772)!==0)switch(s.tag){case 0:case 11:case 15:Ct||Ao(5,s);break;case 1:var d=s.stateNode;if(s.flags&4&&!Ct)if(a===null)d.componentDidMount();else{var p=s.elementType===s.type?a.memoizedProps:on(s.type,a.memoizedProps);d.componentDidUpdate(p,a.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var g=s.updateQueue;g!==null&&Ph(s,g,d);break;case 3:var y=s.updateQueue;if(y!==null){if(a=null,s.child!==null)switch(s.child.tag){case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}Ph(s,y,a)}break;case 5:var T=s.stateNode;if(a===null&&s.flags&4){a=T;var E=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":E.autoFocus&&a.focus();break;case"img":E.src&&(a.src=E.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var j=s.alternate;if(j!==null){var G=j.memoizedState;if(G!==null){var J=G.dehydrated;J!==null&&Kr(J)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Ct||s.flags&512&&ic(s)}catch(K){Ye(s,s.return,K)}}if(s===n){de=null;break}if(a=s.sibling,a!==null){a.return=s.return,de=a;break}de=s.return}}function Rf(n){for(;de!==null;){var s=de;if(s===n){de=null;break}var a=s.sibling;if(a!==null){a.return=s.return,de=a;break}de=s.return}}function _f(n){for(;de!==null;){var s=de;try{switch(s.tag){case 0:case 11:case 15:var a=s.return;try{Ao(4,s)}catch(E){Ye(s,a,E)}break;case 1:var d=s.stateNode;if(typeof d.componentDidMount=="function"){var p=s.return;try{d.componentDidMount()}catch(E){Ye(s,p,E)}}var g=s.return;try{ic(s)}catch(E){Ye(s,g,E)}break;case 5:var y=s.return;try{ic(s)}catch(E){Ye(s,y,E)}}}catch(E){Ye(s,s.return,E)}if(s===n){de=null;break}var T=s.sibling;if(T!==null){T.return=s.return,de=T;break}de=s.return}}var a0=Math.ceil,Uo=I.ReactCurrentDispatcher,oc=I.ReactCurrentOwner,Zt=I.ReactCurrentBatchConfig,De=0,ft=null,st=null,yt=0,qt=0,vr=ii(0),ut=0,ms=null,Li=0,jo=0,ac=0,gs=null,It=null,lc=0,yr=1/0,Vn=null,Fo=!1,cc=null,ci=null,Bo=!1,ui=null,Vo=0,vs=0,uc=null,zo=-1,qo=0;function Et(){return(De&6)!==0?tt():zo!==-1?zo:zo=tt()}function di(n){return(n.mode&1)===0?1:(De&2)!==0&&yt!==0?yt&-yt:Wy.transition!==null?(qo===0&&(qo=bd()),qo):(n=Ue,n!==0||(n=window.event,n=n===void 0?16:Id(n.type)),n)}function cn(n,s,a,d){if(50<vs)throw vs=0,uc=null,Error(t(185));Vr(n,a,d),((De&2)===0||n!==ft)&&(n===ft&&((De&2)===0&&(jo|=a),ut===4&&hi(n,yt)),Nt(n,d),a===1&&De===0&&(s.mode&1)===0&&(yr=tt()+500,vo&&si()))}function Nt(n,s){var a=n.callbackNode;Wv(n,s);var d=Ys(n,n===ft?yt:0);if(d===0)a!==null&&yd(a),n.callbackNode=null,n.callbackPriority=0;else if(s=d&-d,n.callbackPriority!==s){if(a!=null&&yd(a),s===1)n.tag===0?qy(Nf.bind(null,n)):mh(Nf.bind(null,n)),Fy(function(){(De&6)===0&&si()}),a=null;else{switch(Td(d)){case 1:a=qa;break;case 4:a=kd;break;case 16:a=Gs;break;case 536870912:a=Sd;break;default:a=Gs}a=Ff(a,If.bind(null,n))}n.callbackPriority=s,n.callbackNode=a}}function If(n,s){if(zo=-1,qo=0,(De&6)!==0)throw Error(t(327));var a=n.callbackNode;if(kr()&&n.callbackNode!==a)return null;var d=Ys(n,n===ft?yt:0);if(d===0)return null;if((d&30)!==0||(d&n.expiredLanes)!==0||s)s=Wo(n,d);else{s=d;var p=De;De|=2;var g=Df();(ft!==n||yt!==s)&&(Vn=null,yr=tt()+500,Ui(n,s));do try{u0();break}catch(T){Of(n,T)}while(!0);Rl(),Uo.current=g,De=p,st!==null?s=0:(ft=null,yt=0,s=ut)}if(s!==0){if(s===2&&(p=Wa(n),p!==0&&(d=p,s=dc(n,p))),s===1)throw a=ms,Ui(n,0),hi(n,d),Nt(n,tt()),a;if(s===6)hi(n,d);else{if(p=n.current.alternate,(d&30)===0&&!l0(p)&&(s=Wo(n,d),s===2&&(g=Wa(n),g!==0&&(d=g,s=dc(n,g))),s===1))throw a=ms,Ui(n,0),hi(n,d),Nt(n,tt()),a;switch(n.finishedWork=p,n.finishedLanes=d,s){case 0:case 1:throw Error(t(345));case 2:ji(n,It,Vn);break;case 3:if(hi(n,d),(d&130023424)===d&&(s=lc+500-tt(),10<s)){if(Ys(n,0)!==0)break;if(p=n.suspendedLanes,(p&d)!==d){Et(),n.pingedLanes|=n.suspendedLanes&p;break}n.timeoutHandle=vl(ji.bind(null,n,It,Vn),s);break}ji(n,It,Vn);break;case 4:if(hi(n,d),(d&4194240)===d)break;for(s=n.eventTimes,p=-1;0<d;){var y=31-nn(d);g=1<<y,y=s[y],y>p&&(p=y),d&=~g}if(d=p,d=tt()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*a0(d/1960))-d,10<d){n.timeoutHandle=vl(ji.bind(null,n,It,Vn),d);break}ji(n,It,Vn);break;case 5:ji(n,It,Vn);break;default:throw Error(t(329))}}}return Nt(n,tt()),n.callbackNode===a?If.bind(null,n):null}function dc(n,s){var a=gs;return n.current.memoizedState.isDehydrated&&(Ui(n,s).flags|=256),n=Wo(n,s),n!==2&&(s=It,It=a,s!==null&&hc(s)),n}function hc(n){It===null?It=n:It.push.apply(It,n)}function l0(n){for(var s=n;;){if(s.flags&16384){var a=s.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var d=0;d<a.length;d++){var p=a[d],g=p.getSnapshot;p=p.value;try{if(!rn(g(),p))return!1}catch{return!1}}}if(a=s.child,s.subtreeFlags&16384&&a!==null)a.return=s,s=a;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function hi(n,s){for(s&=~ac,s&=~jo,n.suspendedLanes|=s,n.pingedLanes&=~s,n=n.expirationTimes;0<s;){var a=31-nn(s),d=1<<a;n[a]=-1,s&=~d}}function Nf(n){if((De&6)!==0)throw Error(t(327));kr();var s=Ys(n,0);if((s&1)===0)return Nt(n,tt()),null;var a=Wo(n,s);if(n.tag!==0&&a===2){var d=Wa(n);d!==0&&(s=d,a=dc(n,d))}if(a===1)throw a=ms,Ui(n,0),hi(n,s),Nt(n,tt()),a;if(a===6)throw Error(t(345));return n.finishedWork=n.current.alternate,n.finishedLanes=s,ji(n,It,Vn),Nt(n,tt()),null}function fc(n,s){var a=De;De|=1;try{return n(s)}finally{De=a,De===0&&(yr=tt()+500,vo&&si())}}function Ai(n){ui!==null&&ui.tag===0&&(De&6)===0&&kr();var s=De;De|=1;var a=Zt.transition,d=Ue;try{if(Zt.transition=null,Ue=1,n)return n()}finally{Ue=d,Zt.transition=a,De=s,(De&6)===0&&si()}}function pc(){qt=vr.current,qe(vr)}function Ui(n,s){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,jy(a)),st!==null)for(a=st.return;a!==null;){var d=a;switch(Cl(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&mo();break;case 3:pr(),qe(Pt),qe(St),Al();break;case 5:Ml(d);break;case 4:pr();break;case 13:qe(Je);break;case 19:qe(Je);break;case 10:_l(d.type._context);break;case 22:case 23:pc()}a=a.return}if(ft=n,st=n=fi(n.current,null),yt=qt=s,ut=0,ms=null,ac=jo=Li=0,It=gs=null,Oi!==null){for(s=0;s<Oi.length;s++)if(a=Oi[s],d=a.interleaved,d!==null){a.interleaved=null;var p=d.next,g=a.pending;if(g!==null){var y=g.next;g.next=p,d.next=y}a.pending=d}Oi=null}return n}function Of(n,s){do{var a=st;try{if(Rl(),Po.current=No,Ro){for(var d=Qe.memoizedState;d!==null;){var p=d.queue;p!==null&&(p.pending=null),d=d.next}Ro=!1}if(Mi=0,ht=ct=Qe=null,cs=!1,us=0,oc.current=null,a===null||a.return===null){ut=1,ms=s,st=null;break}e:{var g=n,y=a.return,T=a,E=s;if(s=yt,T.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){var j=E,G=T,J=G.tag;if((G.mode&1)===0&&(J===0||J===11||J===15)){var K=G.alternate;K?(G.updateQueue=K.updateQueue,G.memoizedState=K.memoizedState,G.lanes=K.lanes):(G.updateQueue=null,G.memoizedState=null)}var ce=nf(y);if(ce!==null){ce.flags&=-257,rf(ce,y,T,g,s),ce.mode&1&&tf(g,j,s),s=ce,E=j;var he=s.updateQueue;if(he===null){var pe=new Set;pe.add(E),s.updateQueue=pe}else he.add(E);break e}else{if((s&1)===0){tf(g,j,s),mc();break e}E=Error(t(426))}}else if(Ke&&T.mode&1){var nt=nf(y);if(nt!==null){(nt.flags&65536)===0&&(nt.flags|=256),rf(nt,y,T,g,s),El(mr(E,T));break e}}g=E=mr(E,T),ut!==4&&(ut=2),gs===null?gs=[g]:gs.push(g),g=y;do{switch(g.tag){case 3:g.flags|=65536,s&=-s,g.lanes|=s;var O=Zh(g,E,s);Eh(g,O);break e;case 1:T=E;var R=g.type,L=g.stateNode;if((g.flags&128)===0&&(typeof R.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(ci===null||!ci.has(L)))){g.flags|=65536,s&=-s,g.lanes|=s;var X=ef(g,T,s);Eh(g,X);break e}}g=g.return}while(g!==null)}Lf(a)}catch(ge){s=ge,st===a&&a!==null&&(st=a=a.return);continue}break}while(!0)}function Df(){var n=Uo.current;return Uo.current=No,n===null?No:n}function mc(){(ut===0||ut===3||ut===2)&&(ut=4),ft===null||(Li&268435455)===0&&(jo&268435455)===0||hi(ft,yt)}function Wo(n,s){var a=De;De|=2;var d=Df();(ft!==n||yt!==s)&&(Vn=null,Ui(n,s));do try{c0();break}catch(p){Of(n,p)}while(!0);if(Rl(),De=a,Uo.current=d,st!==null)throw Error(t(261));return ft=null,yt=0,ut}function c0(){for(;st!==null;)Mf(st)}function u0(){for(;st!==null&&!Lv();)Mf(st)}function Mf(n){var s=jf(n.alternate,n,qt);n.memoizedProps=n.pendingProps,s===null?Lf(n):st=s,oc.current=null}function Lf(n){var s=n;do{var a=s.alternate;if(n=s.return,(s.flags&32768)===0){if(a=n0(a,s,qt),a!==null){st=a;return}}else{if(a=i0(a,s),a!==null){a.flags&=32767,st=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ut=6,st=null;return}}if(s=s.sibling,s!==null){st=s;return}st=s=n}while(s!==null);ut===0&&(ut=5)}function ji(n,s,a){var d=Ue,p=Zt.transition;try{Zt.transition=null,Ue=1,d0(n,s,a,d)}finally{Zt.transition=p,Ue=d}return null}function d0(n,s,a,d){do kr();while(ui!==null);if((De&6)!==0)throw Error(t(327));a=n.finishedWork;var p=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(t(177));n.callbackNode=null,n.callbackPriority=0;var g=a.lanes|a.childLanes;if(Hv(n,g),n===ft&&(st=ft=null,yt=0),(a.subtreeFlags&2064)===0&&(a.flags&2064)===0||Bo||(Bo=!0,Ff(Gs,function(){return kr(),null})),g=(a.flags&15990)!==0,(a.subtreeFlags&15990)!==0||g){g=Zt.transition,Zt.transition=null;var y=Ue;Ue=1;var T=De;De|=4,oc.current=null,s0(n,a),xf(a,n),Ny(ml),eo=!!pl,ml=pl=null,n.current=a,o0(a),Av(),De=T,Ue=y,Zt.transition=g}else n.current=a;if(Bo&&(Bo=!1,ui=n,Vo=p),g=n.pendingLanes,g===0&&(ci=null),Fv(a.stateNode),Nt(n,tt()),s!==null)for(d=n.onRecoverableError,a=0;a<s.length;a++)p=s[a],d(p.value,{componentStack:p.stack,digest:p.digest});if(Fo)throw Fo=!1,n=cc,cc=null,n;return(Vo&1)!==0&&n.tag!==0&&kr(),g=n.pendingLanes,(g&1)!==0?n===uc?vs++:(vs=0,uc=n):vs=0,si(),null}function kr(){if(ui!==null){var n=Td(Vo),s=Zt.transition,a=Ue;try{if(Zt.transition=null,Ue=16>n?16:n,ui===null)var d=!1;else{if(n=ui,ui=null,Vo=0,(De&6)!==0)throw Error(t(331));var p=De;for(De|=4,de=n.current;de!==null;){var g=de,y=g.child;if((de.flags&16)!==0){var T=g.deletions;if(T!==null){for(var E=0;E<T.length;E++){var j=T[E];for(de=j;de!==null;){var G=de;switch(G.tag){case 0:case 11:case 15:ps(8,G,g)}var J=G.child;if(J!==null)J.return=G,de=J;else for(;de!==null;){G=de;var K=G.sibling,ce=G.return;if(Sf(G),G===j){de=null;break}if(K!==null){K.return=ce,de=K;break}de=ce}}}var he=g.alternate;if(he!==null){var pe=he.child;if(pe!==null){he.child=null;do{var nt=pe.sibling;pe.sibling=null,pe=nt}while(pe!==null)}}de=g}}if((g.subtreeFlags&2064)!==0&&y!==null)y.return=g,de=y;else e:for(;de!==null;){if(g=de,(g.flags&2048)!==0)switch(g.tag){case 0:case 11:case 15:ps(9,g,g.return)}var O=g.sibling;if(O!==null){O.return=g.return,de=O;break e}de=g.return}}var R=n.current;for(de=R;de!==null;){y=de;var L=y.child;if((y.subtreeFlags&2064)!==0&&L!==null)L.return=y,de=L;else e:for(y=R;de!==null;){if(T=de,(T.flags&2048)!==0)try{switch(T.tag){case 0:case 11:case 15:Ao(9,T)}}catch(ge){Ye(T,T.return,ge)}if(T===y){de=null;break e}var X=T.sibling;if(X!==null){X.return=T.return,de=X;break e}de=T.return}}if(De=p,si(),kn&&typeof kn.onPostCommitFiberRoot=="function")try{kn.onPostCommitFiberRoot($s,n)}catch{}d=!0}return d}finally{Ue=a,Zt.transition=s}}return!1}function Af(n,s,a){s=mr(a,s),s=Zh(n,s,1),n=ai(n,s,1),s=Et(),n!==null&&(Vr(n,1,s),Nt(n,s))}function Ye(n,s,a){if(n.tag===3)Af(n,n,a);else for(;s!==null;){if(s.tag===3){Af(s,n,a);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(ci===null||!ci.has(d))){n=mr(a,n),n=ef(s,n,1),s=ai(s,n,1),n=Et(),s!==null&&(Vr(s,1,n),Nt(s,n));break}}s=s.return}}function h0(n,s,a){var d=n.pingCache;d!==null&&d.delete(s),s=Et(),n.pingedLanes|=n.suspendedLanes&a,ft===n&&(yt&a)===a&&(ut===4||ut===3&&(yt&130023424)===yt&&500>tt()-lc?Ui(n,0):ac|=a),Nt(n,s)}function Uf(n,s){s===0&&((n.mode&1)===0?s=1:(s=Qs,Qs<<=1,(Qs&130023424)===0&&(Qs=4194304)));var a=Et();n=jn(n,s),n!==null&&(Vr(n,s,a),Nt(n,a))}function f0(n){var s=n.memoizedState,a=0;s!==null&&(a=s.retryLane),Uf(n,a)}function p0(n,s){var a=0;switch(n.tag){case 13:var d=n.stateNode,p=n.memoizedState;p!==null&&(a=p.retryLane);break;case 19:d=n.stateNode;break;default:throw Error(t(314))}d!==null&&d.delete(s),Uf(n,a)}var jf;jf=function(n,s,a){if(n!==null)if(n.memoizedProps!==s.pendingProps||Pt.current)_t=!0;else{if((n.lanes&a)===0&&(s.flags&128)===0)return _t=!1,t0(n,s,a);_t=(n.flags&131072)!==0}else _t=!1,Ke&&(s.flags&1048576)!==0&&gh(s,ko,s.index);switch(s.lanes=0,s.tag){case 2:var d=s.type;Mo(n,s),n=s.pendingProps;var p=ar(s,St.current);fr(s,a),p=Fl(null,s,d,n,p,a);var g=Bl();return s.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Rt(d)?(g=!0,go(s)):g=!1,s.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,Ol(s),p.updater=Oo,s.stateNode=p,p._reactInternals=s,Kl(s,d,n,a),s=Ql(null,s,d,!0,g,a)):(s.tag=0,Ke&&g&&Tl(s),xt(null,s,p,a),s=s.child),s;case 16:d=s.elementType;e:{switch(Mo(n,s),n=s.pendingProps,p=d._init,d=p(d._payload),s.type=d,p=s.tag=g0(d),n=on(d,n),p){case 0:s=Jl(null,s,d,n,a);break e;case 1:s=uf(null,s,d,n,a);break e;case 11:s=sf(null,s,d,n,a);break e;case 14:s=of(null,s,d,on(d.type,n),a);break e}throw Error(t(306,d,""))}return s;case 0:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:on(d,p),Jl(n,s,d,p,a);case 1:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:on(d,p),uf(n,s,d,p,a);case 3:e:{if(df(s),n===null)throw Error(t(387));d=s.pendingProps,g=s.memoizedState,p=g.element,xh(n,s),xo(s,d,null,a);var y=s.memoizedState;if(d=y.element,g.isDehydrated)if(g={element:d,isDehydrated:!1,cache:y.cache,pendingSuspenseBoundaries:y.pendingSuspenseBoundaries,transitions:y.transitions},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){p=mr(Error(t(423)),s),s=hf(n,s,d,a,p);break e}else if(d!==p){p=mr(Error(t(424)),s),s=hf(n,s,d,a,p);break e}else for(zt=ni(s.stateNode.containerInfo.firstChild),Vt=s,Ke=!0,sn=null,a=Ch(s,null,d,a),s.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(ur(),d===p){s=Bn(n,s,a);break e}xt(n,s,d,a)}s=s.child}return s;case 5:return Rh(s),n===null&&xl(s),d=s.type,p=s.pendingProps,g=n!==null?n.memoizedProps:null,y=p.children,gl(d,p)?y=null:g!==null&&gl(d,g)&&(s.flags|=32),cf(n,s),xt(n,s,y,a),s.child;case 6:return n===null&&xl(s),null;case 13:return ff(n,s,a);case 4:return Dl(s,s.stateNode.containerInfo),d=s.pendingProps,n===null?s.child=dr(s,null,d,a):xt(n,s,d,a),s.child;case 11:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:on(d,p),sf(n,s,d,p,a);case 7:return xt(n,s,s.pendingProps,a),s.child;case 8:return xt(n,s,s.pendingProps.children,a),s.child;case 12:return xt(n,s,s.pendingProps.children,a),s.child;case 10:e:{if(d=s.type._context,p=s.pendingProps,g=s.memoizedProps,y=p.value,Ve(To,d._currentValue),d._currentValue=y,g!==null)if(rn(g.value,y)){if(g.children===p.children&&!Pt.current){s=Bn(n,s,a);break e}}else for(g=s.child,g!==null&&(g.return=s);g!==null;){var T=g.dependencies;if(T!==null){y=g.child;for(var E=T.firstContext;E!==null;){if(E.context===d){if(g.tag===1){E=Fn(-1,a&-a),E.tag=2;var j=g.updateQueue;if(j!==null){j=j.shared;var G=j.pending;G===null?E.next=E:(E.next=G.next,G.next=E),j.pending=E}}g.lanes|=a,E=g.alternate,E!==null&&(E.lanes|=a),Il(g.return,a,s),T.lanes|=a;break}E=E.next}}else if(g.tag===10)y=g.type===s.type?null:g.child;else if(g.tag===18){if(y=g.return,y===null)throw Error(t(341));y.lanes|=a,T=y.alternate,T!==null&&(T.lanes|=a),Il(y,a,s),y=g.sibling}else y=g.child;if(y!==null)y.return=g;else for(y=g;y!==null;){if(y===s){y=null;break}if(g=y.sibling,g!==null){g.return=y.return,y=g;break}y=y.return}g=y}xt(n,s,p.children,a),s=s.child}return s;case 9:return p=s.type,d=s.pendingProps.children,fr(s,a),p=Yt(p),d=d(p),s.flags|=1,xt(n,s,d,a),s.child;case 14:return d=s.type,p=on(d,s.pendingProps),p=on(d.type,p),of(n,s,d,p,a);case 15:return af(n,s,s.type,s.pendingProps,a);case 17:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:on(d,p),Mo(n,s),s.tag=1,Rt(d)?(n=!0,go(s)):n=!1,fr(s,a),Yh(s,d,p),Kl(s,d,p,a),Ql(null,s,d,!0,n,a);case 19:return mf(n,s,a);case 22:return lf(n,s,a)}throw Error(t(156,s.tag))};function Ff(n,s){return vd(n,s)}function m0(n,s,a,d){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function en(n,s,a,d){return new m0(n,s,a,d)}function gc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function g0(n){if(typeof n=="function")return gc(n)?1:0;if(n!=null){if(n=n.$$typeof,n===ve)return 11;if(n===Me)return 14}return 2}function fi(n,s){var a=n.alternate;return a===null?(a=en(n.tag,s,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=s,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,s=n.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function Ho(n,s,a,d,p,g){var y=2;if(d=n,typeof n=="function")gc(n)&&(y=1);else if(typeof n=="string")y=5;else e:switch(n){case $:return Fi(a.children,p,g,s);case Y:y=8,p|=8;break;case B:return n=en(12,a,s,p|2),n.elementType=B,n.lanes=g,n;case Pe:return n=en(13,a,s,p),n.elementType=Pe,n.lanes=g,n;case je:return n=en(19,a,s,p),n.elementType=je,n.lanes=g,n;case Ie:return Ko(a,p,g,s);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case ee:y=10;break e;case ne:y=9;break e;case ve:y=11;break e;case Me:y=14;break e;case $e:y=16,d=null;break e}throw Error(t(130,n==null?n:typeof n,""))}return s=en(y,a,s,p),s.elementType=n,s.type=d,s.lanes=g,s}function Fi(n,s,a,d){return n=en(7,n,d,s),n.lanes=a,n}function Ko(n,s,a,d){return n=en(22,n,d,s),n.elementType=Ie,n.lanes=a,n.stateNode={isHidden:!1},n}function vc(n,s,a){return n=en(6,n,null,s),n.lanes=a,n}function yc(n,s,a){return s=en(4,n.children!==null?n.children:[],n.key,s),s.lanes=a,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}function v0(n,s,a,d,p){this.tag=s,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ha(0),this.expirationTimes=Ha(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ha(0),this.identifierPrefix=d,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function kc(n,s,a,d,p,g,y,T,E){return n=new v0(n,s,a,T,E),s===1?(s=1,g===!0&&(s|=8)):s=0,g=en(3,null,null,s),n.current=g,g.stateNode=n,g.memoizedState={element:d,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ol(g),n}function y0(n,s,a){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:d==null?null:""+d,children:n,containerInfo:s,implementation:a}}function Bf(n){if(!n)return ri;n=n._reactInternals;e:{if(Pi(n)!==n||n.tag!==1)throw Error(t(170));var s=n;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Rt(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(t(171))}if(n.tag===1){var a=n.type;if(Rt(a))return fh(n,a,s)}return s}function Vf(n,s,a,d,p,g,y,T,E){return n=kc(a,d,!0,n,p,g,y,T,E),n.context=Bf(null),a=n.current,d=Et(),p=di(a),g=Fn(d,p),g.callback=s??null,ai(a,g,p),n.current.lanes=p,Vr(n,p,d),Nt(n,d),n}function Go(n,s,a,d){var p=s.current,g=Et(),y=di(p);return a=Bf(a),s.context===null?s.context=a:s.pendingContext=a,s=Fn(g,y),s.payload={element:n},d=d===void 0?null:d,d!==null&&(s.callback=d),n=ai(p,s,y),n!==null&&(cn(n,p,y,g),wo(n,p,y)),y}function $o(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function zf(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<s?a:s}}function Sc(n,s){zf(n,s),(n=n.alternate)&&zf(n,s)}function k0(){return null}var qf=typeof reportError=="function"?reportError:function(n){console.error(n)};function bc(n){this._internalRoot=n}Jo.prototype.render=bc.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(t(409));Go(n,s,null,null)},Jo.prototype.unmount=bc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;Ai(function(){Go(null,n,null,null)}),s[Mn]=null}};function Jo(n){this._internalRoot=n}Jo.prototype.unstable_scheduleHydration=function(n){if(n){var s=xd();n={blockedOn:null,target:n,priority:s};for(var a=0;a<Zn.length&&s!==0&&s<Zn[a].priority;a++);Zn.splice(a,0,n),a===0&&Rd(n)}};function Tc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Qo(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Wf(){}function S0(n,s,a,d,p){if(p){if(typeof d=="function"){var g=d;d=function(){var j=$o(y);g.call(j)}}var y=Vf(s,d,n,0,null,!1,!1,"",Wf);return n._reactRootContainer=y,n[Mn]=y.current,ts(n.nodeType===8?n.parentNode:n),Ai(),y}for(;p=n.lastChild;)n.removeChild(p);if(typeof d=="function"){var T=d;d=function(){var j=$o(E);T.call(j)}}var E=kc(n,0,!1,null,null,!1,!1,"",Wf);return n._reactRootContainer=E,n[Mn]=E.current,ts(n.nodeType===8?n.parentNode:n),Ai(function(){Go(s,E,a,d)}),E}function Yo(n,s,a,d,p){var g=a._reactRootContainer;if(g){var y=g;if(typeof p=="function"){var T=p;p=function(){var E=$o(y);T.call(E)}}Go(s,y,n,p)}else y=S0(a,s,n,p,d);return $o(y)}Cd=function(n){switch(n.tag){case 3:var s=n.stateNode;if(s.current.memoizedState.isDehydrated){var a=Br(s.pendingLanes);a!==0&&(Ka(s,a|1),Nt(s,tt()),(De&6)===0&&(yr=tt()+500,si()))}break;case 13:Ai(function(){var d=jn(n,1);if(d!==null){var p=Et();cn(d,n,1,p)}}),Sc(n,1)}},Ga=function(n){if(n.tag===13){var s=jn(n,134217728);if(s!==null){var a=Et();cn(s,n,134217728,a)}Sc(n,134217728)}},wd=function(n){if(n.tag===13){var s=di(n),a=jn(n,s);if(a!==null){var d=Et();cn(a,n,s,d)}Sc(n,s)}},xd=function(){return Ue},Ed=function(n,s){var a=Ue;try{return Ue=n,s()}finally{Ue=a}},Fa=function(n,s,a){switch(s){case"input":if(rt(n,a),s=a.name,a.type==="radio"&&s!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<a.length;s++){var d=a[s];if(d!==n&&d.form===n.form){var p=po(d);if(!p)throw Error(t(90));qs(d),rt(d,p)}}}break;case"textarea":td(n,a);break;case"select":s=a.value,s!=null&&Dn(n,!!a.multiple,s,!1)}},ud=fc,dd=Ai;var b0={usingClientEntryPoint:!1,Events:[rs,sr,po,ld,cd,fc]},ys={findFiberByHostInstance:Ri,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},T0={bundleType:ys.bundleType,version:ys.version,rendererPackageName:ys.rendererPackageName,rendererConfig:ys.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=md(n),n===null?null:n.stateNode},findFiberByHostInstance:ys.findFiberByHostInstance||k0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xo.isDisabled&&Xo.supportsFiber)try{$s=Xo.inject(T0),kn=Xo}catch{}}return Ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b0,Ot.createPortal=function(n,s){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tc(s))throw Error(t(200));return y0(n,s,null,a)},Ot.createRoot=function(n,s){if(!Tc(n))throw Error(t(299));var a=!1,d="",p=qf;return s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(p=s.onRecoverableError)),s=kc(n,1,!1,null,null,a,!1,d,p),n[Mn]=s.current,ts(n.nodeType===8?n.parentNode:n),new bc(s)},Ot.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(t(188)):(n=Object.keys(n).join(","),Error(t(268,n)));return n=md(s),n=n===null?null:n.stateNode,n},Ot.flushSync=function(n){return Ai(n)},Ot.hydrate=function(n,s,a){if(!Qo(s))throw Error(t(200));return Yo(null,n,s,!0,a)},Ot.hydrateRoot=function(n,s,a){if(!Tc(n))throw Error(t(405));var d=a!=null&&a.hydratedSources||null,p=!1,g="",y=qf;if(a!=null&&(a.unstable_strictMode===!0&&(p=!0),a.identifierPrefix!==void 0&&(g=a.identifierPrefix),a.onRecoverableError!==void 0&&(y=a.onRecoverableError)),s=Vf(s,null,n,1,a??null,p,!1,g,y),n[Mn]=s.current,ts(n),d)for(n=0;n<d.length;n++)a=d[n],p=a._getVersion,p=p(a._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[a,p]:s.mutableSourceEagerHydrationData.push(a,p);return new Jo(s)},Ot.render=function(n,s,a){if(!Qo(s))throw Error(t(200));return Yo(null,n,s,!1,a)},Ot.unmountComponentAtNode=function(n){if(!Qo(n))throw Error(t(40));return n._reactRootContainer?(Ai(function(){Yo(null,null,n,!1,function(){n._reactRootContainer=null,n[Mn]=null})}),!0):!1},Ot.unstable_batchedUpdates=fc,Ot.unstable_renderSubtreeIntoContainer=function(n,s,a,d){if(!Qo(a))throw Error(t(200));if(n==null||n._reactInternals===void 0)throw Error(t(38));return Yo(n,s,a,!1,d)},Ot.version="18.3.1-next-f1338f8080-20240426",Ot}var Xf;function ym(){if(Xf)return xc.exports;Xf=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),xc.exports=D0(),xc.exports}var Zf;function M0(){if(Zf)return Zo;Zf=1;var i=ym();return Zo.createRoot=i.createRoot,Zo.hydrateRoot=i.hydrateRoot,Zo}var L0=M0();const A0=gm(L0);ym();/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ls(){return Ls=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},Ls.apply(this,arguments)}var Si;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Si||(Si={}));const ep="popstate";function U0(i){i===void 0&&(i={});function e(r,o){let{pathname:l,search:c,hash:u}=r.location;return $c("",{pathname:l,search:c,hash:u},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function t(r,o){return typeof o=="string"?o:km(o)}return F0(e,t,null,i)}function lt(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function Ou(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function j0(){return Math.random().toString(36).substr(2,8)}function tp(i,e){return{usr:i.state,key:i.key,idx:e}}function $c(i,e,t,r){return t===void 0&&(t=null),Ls({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof e=="string"?Dr(e):e,{state:t,key:e&&e.key||r||j0()})}function km(i){let{pathname:e="/",search:t="",hash:r=""}=i;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Dr(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substr(t),i=i.substr(0,t));let r=i.indexOf("?");r>=0&&(e.search=i.substr(r),i=i.substr(0,r)),i&&(e.pathname=i)}return e}function F0(i,e,t,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:l=!1}=r,c=o.history,u=Si.Pop,h=null,f=m();f==null&&(f=0,c.replaceState(Ls({},c.state,{idx:f}),""));function m(){return(c.state||{idx:null}).idx}function v(){u=Si.Pop;let _=m(),M=_==null?null:_-f;f=_,h&&h({action:u,location:w.location,delta:M})}function k(_,M){u=Si.Push;let z=$c(w.location,_,M);f=m()+1;let U=tp(z,f),I=w.createHref(z);try{c.pushState(U,"",I)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;o.location.assign(I)}l&&h&&h({action:u,location:w.location,delta:1})}function b(_,M){u=Si.Replace;let z=$c(w.location,_,M);f=m();let U=tp(z,f),I=w.createHref(z);c.replaceState(U,"",I),l&&h&&h({action:u,location:w.location,delta:0})}function P(_){let M=o.location.origin!=="null"?o.location.origin:o.location.href,z=typeof _=="string"?_:km(_);return z=z.replace(/ $/,"%20"),lt(M,"No window.location.(origin|href) available to create URL for href: "+z),new URL(z,M)}let w={get action(){return u},get location(){return i(o,c)},listen(_){if(h)throw new Error("A history only accepts one active listener");return o.addEventListener(ep,v),h=_,()=>{o.removeEventListener(ep,v),h=null}},createHref(_){return e(o,_)},createURL:P,encodeLocation(_){let M=P(_);return{pathname:M.pathname,search:M.search,hash:M.hash}},push:k,replace:b,go(_){return c.go(_)}};return w}var np;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(np||(np={}));function B0(i,e,t){return t===void 0&&(t="/"),V0(i,e,t)}function V0(i,e,t,r){let o=typeof e=="string"?Dr(e):e,l=Tm(o.pathname||"/",t);if(l==null)return null;let c=Sm(i);z0(c);let u=null;for(let h=0;u==null&&h<c.length;++h){let f=ek(l);u=Y0(c[h],f)}return u}function Sm(i,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let o=(l,c,u)=>{let h={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};h.relativePath.startsWith("/")&&(lt(h.relativePath.startsWith(r),'Absolute route path "'+h.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),h.relativePath=h.relativePath.slice(r.length));let f=Vi([r,h.relativePath]),m=t.concat(h);l.children&&l.children.length>0&&(lt(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),Sm(l.children,e,m,f)),!(l.path==null&&!l.index)&&e.push({path:f,score:J0(f,l.index),routesMeta:m})};return i.forEach((l,c)=>{var u;if(l.path===""||!((u=l.path)!=null&&u.includes("?")))o(l,c);else for(let h of bm(l.path))o(l,c,h)}),e}function bm(i){let e=i.split("/");if(e.length===0)return[];let[t,...r]=e,o=t.endsWith("?"),l=t.replace(/\?$/,"");if(r.length===0)return o?[l,""]:[l];let c=bm(r.join("/")),u=[];return u.push(...c.map(h=>h===""?l:[l,h].join("/"))),o&&u.push(...c),u.map(h=>i.startsWith("/")&&h===""?"/":h)}function z0(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:Q0(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const q0=/^:[\w-]+$/,W0=3,H0=2,K0=1,G0=10,$0=-2,ip=i=>i==="*";function J0(i,e){let t=i.split("/"),r=t.length;return t.some(ip)&&(r+=$0),e&&(r+=H0),t.filter(o=>!ip(o)).reduce((o,l)=>o+(q0.test(l)?W0:l===""?K0:G0),r)}function Q0(i,e){return i.length===e.length&&i.slice(0,-1).every((r,o)=>r===e[o])?i[i.length-1]-e[e.length-1]:0}function Y0(i,e,t){let{routesMeta:r}=i,o={},l="/",c=[];for(let u=0;u<r.length;++u){let h=r[u],f=u===r.length-1,m=l==="/"?e:e.slice(l.length)||"/",v=X0({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},m),k=h.route;if(!v)return null;Object.assign(o,v.params),c.push({params:o,pathname:Vi([l,v.pathname]),pathnameBase:sk(Vi([l,v.pathnameBase])),route:k}),v.pathnameBase!=="/"&&(l=Vi([l,v.pathnameBase]))}return c}function X0(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,r]=Z0(i.path,i.caseSensitive,i.end),o=e.match(t);if(!o)return null;let l=o[0],c=l.replace(/(.)\/+$/,"$1"),u=o.slice(1);return{params:r.reduce((f,m,v)=>{let{paramName:k,isOptional:b}=m;if(k==="*"){let w=u[v]||"";c=l.slice(0,l.length-w.length).replace(/(.)\/+$/,"$1")}const P=u[v];return b&&!P?f[k]=void 0:f[k]=(P||"").replace(/%2F/g,"/"),f},{}),pathname:l,pathnameBase:c,pattern:i}}function Z0(i,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Ou(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let r=[],o="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,h)=>(r.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(r.push({paramName:"*"}),o+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?o+="\\/*$":i!==""&&i!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),r]}function ek(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ou(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),i}}function Tm(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=i.charAt(t);return r&&r!=="/"?null:i.slice(t)||"/"}const tk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,nk=i=>tk.test(i);function ik(i,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:o=""}=typeof i=="string"?Dr(i):i,l;if(t)if(nk(t))l=t;else{if(t.includes("//")){let c=t;t=t.replace(/\/\/+/g,"/"),Ou(!1,"Pathnames cannot have embedded double slashes - normalizing "+(c+" -> "+t))}t.startsWith("/")?l=rp(t.substring(1),"/"):l=rp(t,e)}else l=e;return{pathname:l,search:ok(r),hash:ak(o)}}function rp(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(o=>{o===".."?t.length>1&&t.pop():o!=="."&&t.push(o)}),t.length>1?t.join("/"):"/"}function Rc(i,e,t,r){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function rk(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Cm(i,e){let t=rk(i);return e?t.map((r,o)=>o===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function wm(i,e,t,r){r===void 0&&(r=!1);let o;typeof i=="string"?o=Dr(i):(o=Ls({},i),lt(!o.pathname||!o.pathname.includes("?"),Rc("?","pathname","search",o)),lt(!o.pathname||!o.pathname.includes("#"),Rc("#","pathname","hash",o)),lt(!o.search||!o.search.includes("#"),Rc("#","search","hash",o)));let l=i===""||o.pathname==="",c=l?"/":o.pathname,u;if(c==null)u=t;else{let v=e.length-1;if(!r&&c.startsWith("..")){let k=c.split("/");for(;k[0]==="..";)k.shift(),v-=1;o.pathname=k.join("/")}u=v>=0?e[v]:"/"}let h=ik(o,u),f=c&&c!=="/"&&c.endsWith("/"),m=(l||c===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(f||m)&&(h.pathname+="/"),h}const Vi=i=>i.join("/").replace(/\/\/+/g,"/"),sk=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),ok=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,ak=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function lk(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const xm=["post","put","patch","delete"];new Set(xm);const ck=["get",...xm];new Set(ck);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function As(){return As=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},As.apply(this,arguments)}const Du=N.createContext(null),uk=N.createContext(null),Vs=N.createContext(null),xa=N.createContext(null),$i=N.createContext({outlet:null,matches:[],isDataRoute:!1}),Em=N.createContext(null);function zs(){return N.useContext(xa)!=null}function Mu(){return zs()||lt(!1),N.useContext(xa).location}function Pm(i){N.useContext(Vs).static||N.useLayoutEffect(i)}function dk(){let{isDataRoute:i}=N.useContext($i);return i?wk():hk()}function hk(){zs()||lt(!1);let i=N.useContext(Du),{basename:e,future:t,navigator:r}=N.useContext(Vs),{matches:o}=N.useContext($i),{pathname:l}=Mu(),c=JSON.stringify(Cm(o,t.v7_relativeSplatPath)),u=N.useRef(!1);return Pm(()=>{u.current=!0}),N.useCallback(function(f,m){if(m===void 0&&(m={}),!u.current)return;if(typeof f=="number"){r.go(f);return}let v=wm(f,JSON.parse(c),l,m.relative==="path");i==null&&e!=="/"&&(v.pathname=v.pathname==="/"?e:Vi([e,v.pathname])),(m.replace?r.replace:r.push)(v,m.state,m)},[e,r,c,l,i])}function fk(i,e){return pk(i,e)}function pk(i,e,t,r){zs()||lt(!1);let{navigator:o}=N.useContext(Vs),{matches:l}=N.useContext($i),c=l[l.length-1],u=c?c.params:{};c&&c.pathname;let h=c?c.pathnameBase:"/";c&&c.route;let f=Mu(),m;if(e){var v;let _=typeof e=="string"?Dr(e):e;h==="/"||(v=_.pathname)!=null&&v.startsWith(h)||lt(!1),m=_}else m=f;let k=m.pathname||"/",b=k;if(h!=="/"){let _=h.replace(/^\//,"").split("/");b="/"+k.replace(/^\//,"").split("/").slice(_.length).join("/")}let P=B0(i,{pathname:b}),w=kk(P&&P.map(_=>Object.assign({},_,{params:Object.assign({},u,_.params),pathname:Vi([h,o.encodeLocation?o.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?h:Vi([h,o.encodeLocation?o.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),l,t,r);return e&&w?N.createElement(xa.Provider,{value:{location:As({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:Si.Pop}},w):w}function mk(){let i=Ck(),e=lk(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return N.createElement(N.Fragment,null,N.createElement("h2",null,"Unexpected Application Error!"),N.createElement("h3",{style:{fontStyle:"italic"}},e),t?N.createElement("pre",{style:o},t):null,null)}const gk=N.createElement(mk,null);class vk extends N.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?N.createElement($i.Provider,{value:this.props.routeContext},N.createElement(Em.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function yk(i){let{routeContext:e,match:t,children:r}=i,o=N.useContext(Du);return o&&o.static&&o.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=t.route.id),N.createElement($i.Provider,{value:e},r)}function kk(i,e,t,r){var o;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),i==null){var l;if(!t)return null;if(t.errors)i=t.matches;else if((l=r)!=null&&l.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let c=i,u=(o=t)==null?void 0:o.errors;if(u!=null){let m=c.findIndex(v=>v.route.id&&(u==null?void 0:u[v.route.id])!==void 0);m>=0||lt(!1),c=c.slice(0,Math.min(c.length,m+1))}let h=!1,f=-1;if(t&&r&&r.v7_partialHydration)for(let m=0;m<c.length;m++){let v=c[m];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(f=m),v.route.id){let{loaderData:k,errors:b}=t,P=v.route.loader&&k[v.route.id]===void 0&&(!b||b[v.route.id]===void 0);if(v.route.lazy||P){h=!0,f>=0?c=c.slice(0,f+1):c=[c[0]];break}}}return c.reduceRight((m,v,k)=>{let b,P=!1,w=null,_=null;t&&(b=u&&v.route.id?u[v.route.id]:void 0,w=v.route.errorElement||gk,h&&(f<0&&k===0?(xk("route-fallback"),P=!0,_=null):f===k&&(P=!0,_=v.route.hydrateFallbackElement||null)));let M=e.concat(c.slice(0,k+1)),z=()=>{let U;return b?U=w:P?U=_:v.route.Component?U=N.createElement(v.route.Component,null):v.route.element?U=v.route.element:U=m,N.createElement(yk,{match:v,routeContext:{outlet:m,matches:M,isDataRoute:t!=null},children:U})};return t&&(v.route.ErrorBoundary||v.route.errorElement||k===0)?N.createElement(vk,{location:t.location,revalidation:t.revalidation,component:w,error:b,children:z(),routeContext:{outlet:null,matches:M,isDataRoute:!0}}):z()},null)}var Rm=(function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i})(Rm||{}),_m=(function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i})(_m||{});function Sk(i){let e=N.useContext(Du);return e||lt(!1),e}function bk(i){let e=N.useContext(uk);return e||lt(!1),e}function Tk(i){let e=N.useContext($i);return e||lt(!1),e}function Im(i){let e=Tk(),t=e.matches[e.matches.length-1];return t.route.id||lt(!1),t.route.id}function Ck(){var i;let e=N.useContext(Em),t=bk(),r=Im();return e!==void 0?e:(i=t.errors)==null?void 0:i[r]}function wk(){let{router:i}=Sk(Rm.UseNavigateStable),e=Im(_m.UseNavigateStable),t=N.useRef(!1);return Pm(()=>{t.current=!0}),N.useCallback(function(o,l){l===void 0&&(l={}),t.current&&(typeof o=="number"?i.navigate(o):i.navigate(o,As({fromRouteId:e},l)))},[i,e])}const sp={};function xk(i,e,t){sp[i]||(sp[i]=!0)}function Ek(i,e){i==null||i.v7_startTransition,i==null||i.v7_relativeSplatPath}function Pk(i){let{to:e,replace:t,state:r,relative:o}=i;zs()||lt(!1);let{future:l,static:c}=N.useContext(Vs),{matches:u}=N.useContext($i),{pathname:h}=Mu(),f=dk(),m=wm(e,Cm(u,l.v7_relativeSplatPath),h,o==="path"),v=JSON.stringify(m);return N.useEffect(()=>f(JSON.parse(v),{replace:t,state:r,relative:o}),[f,v,o,t,r]),null}function Cr(i){lt(!1)}function Rk(i){let{basename:e="/",children:t=null,location:r,navigationType:o=Si.Pop,navigator:l,static:c=!1,future:u}=i;zs()&&lt(!1);let h=e.replace(/^\/*/,"/"),f=N.useMemo(()=>({basename:h,navigator:l,static:c,future:As({v7_relativeSplatPath:!1},u)}),[h,u,l,c]);typeof r=="string"&&(r=Dr(r));let{pathname:m="/",search:v="",hash:k="",state:b=null,key:P="default"}=r,w=N.useMemo(()=>{let _=Tm(m,h);return _==null?null:{location:{pathname:_,search:v,hash:k,state:b,key:P},navigationType:o}},[h,m,v,k,b,P,o]);return w==null?null:N.createElement(Vs.Provider,{value:f},N.createElement(xa.Provider,{children:t,value:w}))}function _k(i){let{children:e,location:t}=i;return fk(Jc(e),t)}new Promise(()=>{});function Jc(i,e){e===void 0&&(e=[]);let t=[];return N.Children.forEach(i,(r,o)=>{if(!N.isValidElement(r))return;let l=[...e,o];if(r.type===N.Fragment){t.push.apply(t,Jc(r.props.children,l));return}r.type!==Cr&&lt(!1),!r.props.index||!r.props.children||lt(!1);let c={id:r.props.id||l.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(c.children=Jc(r.props.children,l)),t.push(c)}),t}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Ik="6";try{window.__reactRouterVersion=Ik}catch{}const Nk="startTransition",op=I0[Nk];function Ok(i){let{basename:e,children:t,future:r,window:o}=i,l=N.useRef();l.current==null&&(l.current=U0({window:o,v5Compat:!0}));let c=l.current,[u,h]=N.useState({action:c.action,location:c.location}),{v7_startTransition:f}=r||{},m=N.useCallback(v=>{f&&op?op(()=>h(v)):h(v)},[h,f]);return N.useLayoutEffect(()=>c.listen(m),[c,m]),N.useEffect(()=>Ek(r),[r]),N.createElement(Rk,{basename:e,children:t,location:u.location,navigationType:u.action,navigator:c,future:r})}var ap;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(ap||(ap={}));var lp;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(lp||(lp={}));const Dk=[{id:"judge",label:"Judge Mode"},{id:"debug",label:"Debug Mode"},{id:"liveExercise",label:"Live Exercise"},{id:"patientHome",label:"Patient Home Page"},{id:"doctorView",label:"Doctor View"}];function Mk({mode:i,setMode:e,onOpenSettings:t,children:r}){return S.jsxs("div",{className:"flex min-h-screen bg-slate-950 text-white",children:[S.jsxs("aside",{className:"flex w-56 flex-shrink-0 flex-col border-r border-slate-800 bg-slate-900/90",children:[S.jsx("div",{className:"p-4",children:S.jsx("h1",{className:"text-lg font-bold text-white",children:"SmartWalker"})}),S.jsx("nav",{className:"flex-1 space-y-0.5 p-2",children:Dk.map(o=>S.jsx("button",{type:"button",onClick:()=>e(o.id),className:`w-full rounded-xl px-3 py-2.5 text-left text-sm font-semibold transition ${i===o.id?"bg-sky-600 text-white":"text-slate-300 hover:bg-slate-800 hover:text-white"}`,children:o.label},o.id))}),S.jsx("div",{className:"border-t border-slate-800 p-2",children:S.jsx("button",{type:"button",onClick:t,className:"w-full rounded-xl px-3 py-2.5 text-left text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white",children:"Settings"})})]}),S.jsx("main",{className:"min-w-0 flex-1 p-4 sm:p-5 md:p-6",children:r})]})}class Ea extends Error{constructor(t){super(t.message);ot(this,"status");ot(this,"details");this.name="ApiError",this.status=t.status,this.details=t.details}}function Qc(i){return i instanceof Ea&&[404,405,501].includes(i.status)}function ea(i){return i instanceof Error&&i.name==="TypeError"}function Lk(i){if(!i||typeof i!="object")return null;const e=i,t=e.reportId||e.report_id||e.id;return typeof t=="string"?t:null}class Nm{constructor(e){this.baseUrl=e}async request(e,t){let r;try{r=await fetch(`${this.baseUrl}${e}`,{...t,headers:{...(t==null?void 0:t.body)instanceof FormData?{}:{"Content-Type":"application/json"},...(t==null?void 0:t.headers)||{}}})}catch(c){throw c}const o=await r.text(),l=o?Ak(o):null;if(!r.ok){let c=r.statusText||"Request failed";if(l&&typeof l=="object"&&"detail"in l){const u=l.detail;u!=null&&String(u).trim()&&(c=String(u))}throw new Ea({status:r.status,message:c,details:l})}return l??{}}health(){return this.request("/health",{method:"GET"})}getState(e){return this.request(`/api/state/${encodeURIComponent(e)}`,{method:"GET"})}postWalker(e){return this.request("/api/walker",{method:"POST",body:JSON.stringify(e)})}postVision(e){return this.request("/api/vision",{method:"POST",body:JSON.stringify(e)})}listResidents(){return this.request("/api/residents",{method:"GET"})}createResident(e){return this.request("/api/residents",{method:"POST",body:JSON.stringify(e)})}getResident(e){return this.request(`/api/residents/${encodeURIComponent(e)}`,{method:"GET"})}listDocuments(e){return this.request(`/api/residents/${encodeURIComponent(e)}/documents`,{method:"GET"})}uploadDocument(e,t){const r=new FormData;return r.append("file",t),this.request(`/api/residents/${encodeURIComponent(e)}/documents`,{method:"POST",body:r})}getDocument(e){return this.request(`/api/documents/${encodeURIComponent(e)}`,{method:"GET"})}async generateDailyReport(e,t){const r=await this.request(`/api/reports/daily/generate?residentId=${encodeURIComponent(e)}&date=${encodeURIComponent(t)}`,{method:"POST"});return Lk(r)}getDailyReportDownloadUrl(e){return`${this.baseUrl}/api/reports/daily/${encodeURIComponent(e)}/download`}getReportStats(e,t=7){const r=new URLSearchParams({residentId:e,days:String(t)});return this.request(`/api/reports/stats?${r}`,{method:"GET"})}getExerciseSuggestions(e,t=7){const r=new URLSearchParams({residentId:e,days:String(t)});return this.request(`/api/suggestions/exercise-regimen?${r}`,{method:"GET"})}getExerciseContextWindow(e,t){const r=new URLSearchParams({residentId:e});return(t==null?void 0:t.maxSamples)!=null&&r.set("maxSamples",String(t.maxSamples)),(t==null?void 0:t.stepWindow)!=null&&r.set("stepWindow",String(t.stepWindow)),this.request(`/api/exercise-metrics/context-window?${r}`,{method:"GET"})}getExerciseQnaContext(e,t,r){const o=new URLSearchParams({residentId:e,question:t});return(r==null?void 0:r.maxSamples)!=null&&o.set("maxSamples",String(r.maxSamples)),this.request(`/api/exercise-metrics/qna-context?${o}`,{method:"GET"})}askAgent(e){return this.request("/api/agent/ask",{method:"POST",body:JSON.stringify(e)})}generateCoachScript(e){return this.request("/api/coach/script",{method:"POST",body:JSON.stringify(e)})}heygenSpeak(e){return this.request("/api/heygen/speak",{method:"POST",body:JSON.stringify(e)})}createLiveAgentSessionToken(e){return this.request("/api/liveagent/session/token",{method:"POST",body:JSON.stringify(e)})}startLiveAgentSession(e){return this.request("/api/liveagent/session/start",{method:"POST",body:JSON.stringify(e)})}bootstrapLiveAgentSession(e){return this.request("/api/liveagent/session/bootstrap",{method:"POST",body:JSON.stringify(e)})}sendLiveAgentSessionEvent(e){return this.request("/api/liveagent/session/event",{method:"POST",body:JSON.stringify(e)})}requestZoomInvite(e){return this.request("/api/carrier/zoom-invite",{method:"POST",body:JSON.stringify(e)})}createLiveAvatarLiteSession(e){return this.request("/api/liveavatar/lite/create",{method:"POST",body:JSON.stringify(e)})}startLiveAvatarLiteSession(e){return this.request("/api/liveavatar/lite/start",{method:"POST",body:JSON.stringify(e)})}createLiveAvatarSession(e){return this.request("/api/liveavatar/session",{method:"POST",body:JSON.stringify(e)})}createAndStartLiveAvatarLiteSession(e){return this.request("/api/liveavatar/lite/new",{method:"POST",body:JSON.stringify(e)})}stopLiveAvatarLiteSession(e){return this.request("/api/liveavatar/lite/stop",{method:"POST",body:JSON.stringify(e)})}getLiveAvatarLiteStatus(e){return this.request(`/api/liveavatar/lite/status/${encodeURIComponent(e)}`,{method:"GET"})}sendLiveAvatarLiteInterrupt(e){return this.request("/api/liveavatar/lite/interrupt",{method:"POST",body:JSON.stringify(e)})}sendLiveAvatarLiteTestTone(e){return this.request("/api/liveavatar/lite/test-tone",{method:"POST",body:JSON.stringify(e)})}sendLiveAvatarLiteSpeakText(e){return this.request("/api/liveavatar/lite/speak-text",{method:"POST",body:JSON.stringify(e)})}}function Ak(i){try{return JSON.parse(i)}catch{return{detail:i}}}const Uk="smartwalker.apiBaseUrl";function Om(){const i="".trim();return i||(typeof window<"u"&&["localhost","127.0.0.1"].includes(window.location.hostname)?"http://localhost:8000":"https://smartwalker-back.onrender.com")}function Dm(){const i=localStorage.getItem(Uk),e=Om();return!i||jk(i,e)?e:i}function Ss(i){return i.trim().replace(/\/+$/,"")}function Mm(i){return i.startsWith("https://")?i.replace("https://","wss://"):i.startsWith("http://")?i.replace("http://","ws://"):i}function jk(i,e){try{const t=new URL(i),r=new URL(e),o=t.hostname==="localhost"||t.hostname==="127.0.0.1",l=typeof window<"u"&&!["localhost","127.0.0.1"].includes(window.location.hostname),c=typeof window<"u"&&window.location.protocol==="https:"&&t.protocol!=="https:";return!!(l&&o||c||l&&r.hostname.endsWith(".onrender.com")&&t.hostname.endsWith(".onrender.com")&&t.hostname!==r.hostname)}catch{return!0}}class Lm{constructor(e){ot(this,"socket",null);ot(this,"reconnectTimer",null);ot(this,"retryCount",0);ot(this,"closedByUser",!1);this.options=e}connect(){this.closedByUser=!1,this.openSocket()}close(){this.closedByUser=!0,this.reconnectTimer&&(window.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.socket&&(this.socket.close(),this.socket=null),this.options.onStatus("disconnected")}openSocket(){const e=Mm(this.options.baseUrl),t=this.options.residentId?`?residentId=${encodeURIComponent(this.options.residentId)}`:"",r=`${e}/ws${t}`;this.options.onStatus(this.retryCount===0?"connecting":"reconnecting"),this.socket=new WebSocket(r),this.socket.onopen=()=>{this.retryCount=0,this.options.onStatus("connected")},this.socket.onmessage=o=>{const l=Fk(o.data);this.options.onMessage(l)},this.socket.onerror=()=>{this.closedByUser||this.options.onStatus("disconnected")},this.socket.onclose=()=>{this.socket=null,this.closedByUser||this.scheduleReconnect()}}scheduleReconnect(){const e=Math.min(1e3*Math.pow(2,this.retryCount),15e3);this.retryCount+=1,this.options.onStatus("reconnecting"),this.reconnectTimer=window.setTimeout(()=>this.openSocket(),e)}}function Fk(i){try{return JSON.parse(i)}catch{return{type:"unknown",raw:i}}}const Am=N.createContext(null),cp="r1";function Bk({children:i}){const[e,t]=N.useState(()=>Ss(Dm())),[r,o]=N.useState("offline"),[l,c]=N.useState("disconnected"),[u,h]=N.useState("judge"),[f,m]=N.useState(!1),[v,k]=N.useState(cp),[b,P]=N.useState(cp),[w,_]=N.useState([]),[M,z]=N.useState(!0),[U,I]=N.useState({}),[A,V]=N.useState({}),[$,Y]=N.useState({}),[B,ee]=N.useState({}),[ne,ve]=N.useState({}),[Pe,je]=N.useState([]),[Me,$e]=N.useState(!1),[Ie,ie]=N.useState([]),te=N.useRef(null),H=N.useRef({}),x=N.useRef(()=>{}),D=N.useMemo(()=>new Nm(e),[e]),re=N.useCallback((Se,we="info")=>{const xe=`${Date.now()}-${Math.random().toString(36).slice(2,8)}`;ie(wt=>[{id:xe,level:we,message:Se},...wt].slice(0,5))},[]),ue=N.useCallback(Se=>{ie(we=>we.filter(xe=>xe.id!==Se))},[]),se=N.useCallback(Se=>{const we={...Se,id:`${Date.now()}-${Math.random().toString(36).slice(2,7)}`,time:new Date().toLocaleTimeString()};je(xe=>[we,...xe].slice(0,80))},[]),le=N.useCallback((Se,we)=>{var $t,Dn;const xe=Se.residentId,wt=H.current[xe],rt=Vk(wt,Se);I(Ft=>{const Mr={...Ft,[xe]:Se};return H.current=Mr,Mr}),V(Ft=>({...Ft,[xe]:Date.now()})),ve(Ft=>({...Ft,[xe]:Number(Se.ts||0)}));const tn=Number((($t=Se.walker)==null?void 0:$t.ts)||0),jt=Number(((Dn=Se.vision)==null?void 0:Dn.ts)||0);tn&&Y(Ft=>({...Ft,[xe]:tn})),jt&&ee(Ft=>({...Ft,[xe]:jt})),se({residentId:xe,source:we,changedFields:rt.length?rt:["(no delta)"]})},[se]),fe=N.useCallback(()=>{const Se=v,we=H.current[Se],xe=Number((we==null?void 0:we.metrics.steps)||0)+1+Math.floor(Math.random()*3),wt=Me?67:3+Math.random()*6,rt=Me||wt>=60,tn=15+Math.floor(Math.random()*15),jt=15+Math.floor(Math.random()*15),$t=Math.floor(Date.now()/1e3);le({residentId:Se,ts:$t,walker:{residentId:Se,ts:$t,fsrLeft:tn,fsrRight:jt,tiltDeg:wt,steps:xe},vision:{residentId:Se,ts:$t,cadenceSpm:85+Math.random()*15,stepVar:6+Math.random()*6,fallSuspected:rt},metrics:{steps:xe,tiltDeg:wt,reliance:tn+jt,balance:(tn-jt)/Math.max(tn+jt,1),fallSuspected:rt}},"mock")},[v,Me,le]),me=N.useCallback(async Se=>{const we=Se||v;try{const xe=await D.getState(we);if(!xe||xe.error)return;o("connected"),m(!1),le(xe,"manual_refresh")}catch(xe){if(ea(xe)){o("offline"),m(!0),re("API unreachable. Mock mode enabled for demo continuity.","warn"),fe();return}if(Qc(xe)){o("degraded"),re("State endpoint is not implemented yet.","warn");return}re(xe instanceof Error?xe.message:"Failed to refresh state.","error")}},[v,re,D,fe,le]),Re=N.useCallback(async()=>{const Se=v,we=H.current[Se],xe=Number((we==null?void 0:we.metrics.steps)||0)+2,wt={residentId:Se,fsrLeft:19+Math.floor(Math.random()*10),fsrRight:18+Math.floor(Math.random()*10),tiltDeg:Me?65:4+Math.random()*5,steps:xe};try{await D.postWalker(wt),se({residentId:Se,source:"test_walker",changedFields:["walker payload sent"]}),o("connected"),me(Se)}catch(rt){re("Failed to send walker test packet. Using mock fallback update.","warn"),fe(),ea(rt)&&(o("offline"),m(!0))}},[v,re,D,fe,se,me,Me]),He=N.useCallback(async()=>{const Se=v,we={residentId:Se,fallSuspected:Me,cadenceSpm:88+Math.random()*10,stepVar:7+Math.random()*5};try{await D.postVision(we),se({residentId:Se,source:"test_vision",changedFields:["vision payload sent"]}),o("connected"),me(Se)}catch(xe){re("Failed to send vision test packet. Using mock fallback update.","warn"),fe(),ea(xe)&&(o("offline"),m(!0))}},[v,re,D,fe,se,me,Me]);N.useEffect(()=>{localStorage.setItem("smartwalker.apiBaseUrl",Ss(e))},[e]),N.useEffect(()=>{H.current=U},[U]),N.useEffect(()=>{x.current=fe},[fe]),N.useEffect(()=>{(async()=>{try{(await D.health()).ok?(o("connected"),m(!1)):o("degraded")}catch(we){if(ea(we)){const xe=Ss(Om());if(Ss(e)!==xe){t(xe),re("Saved API URL was unreachable. Reset to the deployed backend URL.","warn");return}o("offline"),m(!0),re("Backend unreachable. Running in mock mode.","warn"),x.current();return}o("degraded")}})()},[re,e,D]),N.useEffect(()=>{(async()=>{try{const we=await D.listResidents();_(we),z(!0)}catch(we){if(Qc(we)){z(!1);return}}})()},[D]),N.useEffect(()=>{var wt;(wt=te.current)==null||wt.close();const Se=new Lm({baseUrl:e,onStatus:c,onMessage:rt=>{if(rt.type==="snapshot"&&Array.isArray(rt.data)){rt.data.forEach(jt=>le(jt,"snapshot"));return}rt.type==="merged_update"&&rt.data&&typeof rt.data=="object"&&"residentId"in rt.data&&le(rt.data,"merged_update")}});let we=!1;const xe=window.setTimeout(()=>{we||(Se.connect(),te.current=Se)},0);return()=>{we=!0,window.clearTimeout(xe),Se.close()}},[e,le]),N.useEffect(()=>{me(v)},[v,me]),N.useEffect(()=>{const Se=Object.keys(U);if(!Se.length||Se.includes(v))return;const we=Se[0];k(we),P(we),re(`Switched resident to ${we} (latest stream with data).`,"info")},[v,re,U]),N.useEffect(()=>{if(!f)return;const Se=window.setInterval(()=>fe(),2200);return()=>window.clearInterval(Se)},[fe,f]);const Gt=N.useCallback(Se=>{t(Ss(Se)),m(!1)},[]),qs=N.useMemo(()=>({apiBaseUrl:e,setApiBaseUrl:Gt,apiStatus:r,wsStatus:l,mode:u,setMode:h,mockMode:f,activeResidentId:v,setActiveResidentId:k,residentInput:b,setResidentInput:P,residents:w,residentsSupported:M,latestMergedByResidentId:U,lastUpdatedByResidentId:A,lastWalkerTsByResidentId:$,lastVisionTsByResidentId:B,lastMergedTsByResidentId:ne,eventLog:Pe,simulateFall:Me,setSimulateFall:$e,toasts:Ie,dismissToast:ue,notify:re,refreshResidentState:me,sendTestWalkerPacket:Re,sendTestVisionPacket:He,apiClient:D}),[v,e,D,r,ue,Pe,ne,A,B,$,U,f,u,me,b,w,M,He,Re,re,Gt,Me,Ie,l]);return S.jsx(Am.Provider,{value:qs,children:i})}function yn(){const i=N.useContext(Am);if(!i)throw new Error("useRealtimeState must be used inside RealtimeStateProvider");return i}function Vk(i,e){if(!i)return["initial snapshot"];const t=["steps","tiltDeg","reliance","balance","fallSuspected","cadenceSpm","stepVar"],r=[],o=i.vision,l=e.vision;return t.forEach(c=>{const u=i.metrics[c]??(o==null?void 0:o[c]),h=e.metrics[c]??(l==null?void 0:l[c]);String(u)!==String(h)&&r.push(c)}),r}function zk({open:i,onClose:e}){const{apiBaseUrl:t,setApiBaseUrl:r}=yn(),[o,l]=N.useState(t);return i?S.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/60 p-4",children:S.jsxs("div",{className:"w-full max-w-xl rounded-2xl border border-slate-700 bg-slate-900 p-5",children:[S.jsx("h2",{className:"text-xl font-bold text-white",children:"Settings"}),S.jsx("p",{className:"mt-1 text-sm text-slate-300",children:"Override API base URL at runtime. Saved in localStorage."}),S.jsxs("label",{className:"mt-4 block text-sm text-slate-200",children:["API Base URL",S.jsx("input",{value:o,onChange:c=>l(c.target.value),className:"mt-1 w-full rounded-lg border border-slate-600 bg-slate-950 px-3 py-2 text-base text-white",placeholder:"https://smartwalker-back.onrender.com"})]}),S.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[S.jsx("button",{type:"button",onClick:e,className:"rounded-lg border border-slate-600 px-4 py-2 text-sm font-semibold text-slate-200",children:"Cancel"}),S.jsx("button",{type:"button",onClick:()=>{r(o),e()},className:"rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white",children:"Save"})]})]})}):null}function qk(){const{toasts:i,dismissToast:e}=yn();return N.useEffect(()=>{if(!i.length)return;const t=window.setTimeout(()=>e(i[i.length-1].id),3500);return()=>window.clearTimeout(t)},[e,i]),S.jsx("div",{className:"pointer-events-none fixed right-4 top-4 z-50 flex max-w-md flex-col gap-2",children:i.map(t=>S.jsx("div",{className:`pointer-events-auto rounded-xl px-4 py-3 text-sm font-medium shadow-lg ${t.level==="error"?"bg-rose-700 text-rose-50":t.level==="warn"?"bg-amber-600 text-amber-50":"bg-slate-800 text-slate-50"}`,children:t.message},t.id))})}const Wk={normal:"border-slate-700",good:"border-emerald-500",warn:"border-amber-500",danger:"border-rose-500"};function Ne({label:i,value:e,subtitle:t,accent:r="normal"}){return S.jsxs("div",{className:`rounded-xl border-2 ${Wk[r]} bg-slate-900 p-4 shadow-md`,children:[S.jsx("p",{className:"text-sm font-semibold uppercase tracking-wider text-slate-300",children:i}),S.jsx("p",{className:"mt-2 text-4xl font-extrabold text-white",children:e}),t?S.jsx("p",{className:"mt-1 text-sm text-slate-400",children:t}):null]})}function Hk({mergedState:i}){const{activeResidentId:e,eventLog:t,lastUpdatedByResidentId:r,lastWalkerTsByResidentId:o,lastVisionTsByResidentId:l,lastMergedTsByResidentId:c}=yn(),[u,h]=N.useState(!0),f=(i==null?void 0:i.walker)||{},m=(i==null?void 0:i.vision)||{},v=(i==null?void 0:i.metrics)||{},k=Math.floor((Date.now()-(r[e]||0))/1e3),b=k>5,P=N.useMemo(()=>JSON.stringify(i||{},null,2),[i]),w=N.useMemo(()=>JSON.stringify(f||{},null,2),[f]),_=N.useMemo(()=>JSON.stringify(m||{},null,2),[m]);return S.jsxs("section",{className:"space-y-4 pb-28",children:[S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4",children:[S.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[S.jsx("h3",{className:"text-lg font-bold text-white",children:"Debug Dashboard (Separated Streams)"}),S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${b?"bg-amber-700 text-white":"bg-emerald-700 text-white"}`,children:b?`Stale (${k}s)`:"Fresh"}),S.jsx("button",{type:"button",onClick:()=>window.open(`/cv?residentId=${encodeURIComponent(e)}`,"cvWindow","width=1100,height=800"),className:"rounded-lg bg-sky-600 px-3 py-2 text-sm font-bold text-white",children:"Open CV Window"})]})]}),S.jsxs("div",{className:"mt-3 rounded-xl bg-slate-950 p-3 text-xs text-slate-300",children:[S.jsxs("p",{children:["Last walker ts: ",_c(o[e])]}),S.jsxs("p",{children:["Last vision ts: ",_c(l[e])]}),S.jsxs("p",{children:["Last merged ts: ",_c(c[e])]})]})]}),S.jsxs("div",{className:"grid gap-4 xl:grid-cols-2",children:[S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4",children:[S.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("h3",{className:"text-lg font-bold text-white",children:"Sensor Data (Walker)"}),S.jsxs("p",{className:"mt-1 text-xs text-slate-400",children:["Last update: ",up(i==null?void 0:i.ts)]})]}),S.jsx("span",{className:"rounded-full bg-indigo-700 px-3 py-1 text-xs font-semibold text-white",children:"Pipeline A"})]}),S.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[S.jsx(Ne,{label:"FSR Left",value:wn(f.fsrLeft)}),S.jsx(Ne,{label:"FSR Right",value:wn(f.fsrRight)}),S.jsx(Ne,{label:"Steps (Camera)",value:wn(m.stepCount??v.steps??f.steps),accent:"good"}),S.jsx(Ne,{label:"Tilt Deg",value:wn(f.tiltDeg??v.tiltDeg),accent:Number(f.tiltDeg??v.tiltDeg??0)>25?"warn":"normal"}),S.jsx(Ne,{label:"Reliance (Load)",value:wn(v.reliance)}),S.jsx(Ne,{label:"Balance (L/R)",value:Gk(f.fsrLeft,f.fsrRight)}),S.jsx(Ne,{label:"Step Source",value:$k(m,f)}),S.jsx(Ne,{label:"Motion (IMU)",value:Jk(f)})]}),S.jsx("pre",{className:"mt-3 max-h-[240px] overflow-auto rounded-lg bg-slate-950 p-3 text-xs text-slate-200",children:w})]}),S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4",children:[S.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[S.jsxs("div",{children:[S.jsx("h3",{className:"text-lg font-bold text-white",children:"Computer Vision Data"}),S.jsxs("p",{className:"mt-1 text-xs text-slate-400",children:["Last update: ",up(i==null?void 0:i.ts)]})]}),S.jsx("span",{className:"rounded-full bg-teal-700 px-3 py-1 text-xs font-semibold text-white",children:"Pipeline B"})]}),S.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[S.jsx(Ne,{label:"Fall Suspected",value:m.fallSuspected??v.fallSuspected?"YES":"NO",accent:m.fallSuspected??v.fallSuspected?"danger":"good"}),S.jsx(Ne,{label:"Cadence SPM",value:wn(m.cadenceSpm)}),S.jsx(Ne,{label:"Step Var",value:wn(m.stepVar)}),S.jsx(Ne,{label:"Confidence",value:wn(m.confidence)}),S.jsx(Ne,{label:"Person Detected",value:m.personDetected===void 0?"-":m.personDetected?"YES":"NO",accent:m.personDetected?"good":"normal"}),S.jsx(Ne,{label:"Step Count (Vision)",value:wn(m.stepCount)}),S.jsx(Ne,{label:"Inference Latency",value:Qk(m.inferenceMs)}),S.jsx(Ne,{label:"Camera FPS",value:Yk(m.sourceFps)}),S.jsx(Ne,{label:"Vision TS",value:wn(m.ts)}),S.jsx(Ne,{label:"Resident",value:String(m.residentId||e)}),S.jsx(Ne,{label:"Source Camera",value:String(m.cameraId||"-")})]}),S.jsx("pre",{className:"mt-3 max-h-[240px] overflow-auto rounded-lg bg-slate-950 p-3 text-xs text-slate-200",children:_})]})]}),S.jsxs("div",{className:"grid gap-4 xl:grid-cols-2",children:[S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4",children:[S.jsx("h3",{className:"text-lg font-bold text-white",children:"Event Log"}),S.jsx("div",{className:"mt-3 max-h-[340px] overflow-auto rounded-lg bg-slate-950",children:S.jsxs("table",{className:"w-full text-left text-xs text-slate-200",children:[S.jsx("thead",{className:"sticky top-0 bg-slate-800 text-slate-100",children:S.jsxs("tr",{children:[S.jsx("th",{className:"px-3 py-2",children:"Time"}),S.jsx("th",{className:"px-3 py-2",children:"Source"}),S.jsx("th",{className:"px-3 py-2",children:"Changed fields"})]})}),S.jsx("tbody",{children:t.filter(M=>M.residentId===e).map(M=>S.jsxs("tr",{className:"border-t border-slate-800",children:[S.jsx("td",{className:"px-3 py-2",children:M.time}),S.jsx("td",{className:"px-3 py-2",children:M.source}),S.jsx("td",{className:"px-3 py-2",children:M.changedFields.join(", ")})]},M.id))})]})})]}),S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("h3",{className:"text-lg font-bold text-white",children:"Raw JSON (Merged State)"}),S.jsx("button",{type:"button",onClick:()=>navigator.clipboard.writeText(P),className:"rounded-lg bg-slate-700 px-3 py-2 text-xs font-bold text-white",children:"Copy"})]}),S.jsx("pre",{className:"mt-3 max-h-[340px] overflow-auto rounded-lg bg-slate-950 p-3 text-xs text-slate-200",children:P})]})]}),S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4",children:[S.jsxs("button",{type:"button",onClick:()=>h(M=>!M),className:"rounded-lg bg-slate-800 px-3 py-2 text-sm font-bold text-white",children:[u?"Hide":"Show"," Clinician Panel (optional)"]}),u?S.jsx(Kk,{}):null]})]})}function Kk(){const{activeResidentId:i,apiClient:e,notify:t}=yn(),[r,o]=N.useState([]),[l,c]=N.useState(""),[u,h]=N.useState(new Date().toISOString().slice(0,10)),[f,m]=N.useState(!0),[v,k]=N.useState(null),[b,P]=N.useState(""),w=async()=>{try{const U=await e.listDocuments(i);o(U)}catch{t("Document endpoints not implemented yet.","warn"),P("Document endpoints not implemented yet.")}},_=async U=>{if(U)try{await e.uploadDocument(i,U),w()}catch{t("Document upload unavailable.","warn"),P("Document upload endpoint not implemented yet.")}},M=async U=>{try{const I=await e.getDocument(U);c(I.textPreview||"")}catch{t("Document preview unavailable.","warn"),P("Document preview endpoint not implemented yet.")}},z=async()=>{try{const U=await e.generateDailyReport(i,u);if(U){const I=`ts=${Date.now()}`;k(`${e.getDailyReportDownloadUrl(U)}?${I}`)}else t("Reports endpoint responded without report id.","warn")}catch{t("Reports endpoint not implemented yet.","warn"),P("Reports endpoints not implemented yet.")}};return S.jsxs("div",{className:"mt-4 grid gap-4 lg:grid-cols-2",children:[S.jsxs("div",{className:"space-y-3 rounded-xl bg-slate-950 p-3",children:[S.jsx("h4",{className:"text-sm font-bold uppercase tracking-wide text-slate-300",children:"Documents"}),b?S.jsx("p",{className:"rounded-lg bg-amber-900/40 p-2 text-xs text-amber-200",children:b}):null,S.jsx("input",{type:"file",accept:"application/pdf",onChange:U=>{var I;return _(((I=U.target.files)==null?void 0:I[0])||null)},className:"w-full text-sm text-slate-100"}),S.jsx("button",{type:"button",onClick:w,className:"rounded-lg bg-slate-700 px-3 py-2 text-xs font-bold text-white",children:"Refresh Docs"}),S.jsx("div",{className:"max-h-40 space-y-2 overflow-auto",children:r.map(U=>S.jsx("button",{type:"button",onClick:()=>M(U.docId),className:"block w-full rounded-lg bg-slate-800 px-3 py-2 text-left text-xs text-white",children:U.filename},U.docId))})]}),S.jsxs("div",{className:"space-y-3 rounded-xl bg-slate-950 p-3",children:[S.jsx("h4",{className:"text-sm font-bold uppercase tracking-wide text-slate-300",children:"Reports + Preview"}),S.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-200",children:[S.jsx("input",{type:"checkbox",checked:f,onChange:U=>m(U.target.checked)}),"Use placeholder values for testing"]}),S.jsxs("div",{className:"flex items-end gap-2",children:[S.jsx("input",{type:"date",value:u,onChange:U=>h(U.target.value),className:"rounded-lg bg-slate-900 px-3 py-2 text-sm text-white"}),S.jsx("button",{type:"button",onClick:z,className:"rounded-lg bg-indigo-600 px-3 py-2 text-xs font-bold text-white",children:"Generate"}),v?S.jsx("a",{href:v,target:"_blank",rel:"noreferrer",className:"rounded-lg bg-emerald-600 px-3 py-2 text-xs font-bold text-white",children:"Download"}):null]}),S.jsx("pre",{className:"max-h-40 overflow-auto rounded-lg bg-slate-900 p-3 text-xs text-slate-200",children:l||"No preview loaded."})]})]})}function wn(i){const e=Number(i);return Number.isFinite(e)?String(Math.round(e*100)/100):"-"}function _c(i){return i?new Date(i*1e3).toLocaleTimeString():"-"}function up(i){if(!i)return"";const e=Math.floor(Date.now()/1e3-i);if(e<0)return"now";if(e<60)return`${e}s ago`;const t=Math.floor(e/60);return t<60?`${t}m ago`:`${Math.floor(t/60)}h ago`}function Gk(i,e){const t=Number(i)||0,r=Number(e)||0,o=t+r;if(o===0)return"";const l=Math.round(t/o*100),c=Math.round(r/o*100);return`${l}% / ${c}%`}function $k(i,e){const t=i.stepCount,r=i.personDetected;return t!=null&&r===!0?"VISION":e.steps!==void 0&&e.steps!==null?"WALKER":""}function Jk(i){const e=i.accelX!==void 0||i.accelY!==void 0||i.accelZ!==void 0,t=i.gyroX!==void 0||i.gyroY!==void 0||i.gyroZ!==void 0;if(e||t){const r=Number(i.accelX)||0,o=Number(i.accelY)||0,l=Number(i.accelZ)||0;return e&&(r!==0||o!==0||l!==0)?`IMU OK (${Math.sqrt(r*r+o*o+l*l).toFixed(1)})`:"IMU OK"}return""}function Qk(i){const e=Number(i);return Number.isFinite(e)?`${Math.round(e)}ms`:""}function Yk(i){const e=Number(i);return Number.isFinite(e)?`${e.toFixed(1)} fps`:""}function Xk(){var Y;const{apiClient:i,residents:e,notify:t}=yn(),[r,o]=N.useState(""),[l,c]=N.useState(()=>new Date().toISOString().slice(0,10)),[u,h]=N.useState(!1),[f,m]=N.useState(null),[v,k]=N.useState(!1),[b,P]=N.useState([]),[w,_]=N.useState(!1),[M,z]=N.useState(null),U=r||(((Y=e[0])==null?void 0:Y.residentId)??"");N.useEffect(()=>{e.length&&!r&&o(e[0].residentId)},[e,r]);const I=N.useCallback(async()=>{if(U){k(!0);try{const B=await i.getReportStats(U,7);m(B)}catch(B){t(B instanceof Error?B.message:"Failed to load health stats","error"),m(null)}finally{k(!1)}}},[i,U,t]);N.useEffect(()=>{U&&I()},[U,I]);const A=N.useCallback(async()=>{if(U){_(!0);try{const B=await i.getExerciseSuggestions(U,7);P(B.suggestions)}catch(B){t(B instanceof Error?B.message:"Failed to load AI suggestions","error"),P([])}finally{_(!1)}}},[i,U,t]);N.useEffect(()=>{U&&A()},[U,A]);const V=async()=>{if(U){h(!0);try{const B=await i.generateDailyReport(U,l);if(B){const ee=i.getDailyReportDownloadUrl(B);window.open(ee,"_blank"),t("Report generated. Download opened.","info")}else t("Report generation did not return an ID.","warn")}catch(B){t(B instanceof Error?B.message:"Failed to generate report","error")}finally{h(!1)}}},$=B=>{z(B);const ee=`Zoom my ${B}`;i.requestZoomInvite({phrase:ee}).then(ne=>{t(`Sent Zoom link to ${ne.sentTo}.`,"info")}).catch(ne=>{const ve=ne instanceof Ea&&typeof ne.details=="object"&&ne.details&&"detail"in ne.details?String(ne.details.detail):ne instanceof Error?ne.message:"Failed to send Zoom invite.";t(ve,"error")}).finally(()=>z(null))};return S.jsxs("div",{className:"mx-auto max-w-5xl space-y-6 pb-10",children:[S.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-5",children:[S.jsx("h3",{className:"text-lg font-semibold text-white",children:"Patient selection"}),S.jsxs("select",{value:r,onChange:B=>o(B.target.value),className:"mt-2 w-full max-w-xs rounded-xl border border-slate-600 bg-slate-950 px-3 py-2 text-white",children:[e.length===0&&S.jsx("option",{value:"",children:"No residents"}),e.map(B=>S.jsx("option",{value:B.residentId,children:B.name??B.residentId},B.residentId))]})]}),S.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-5",children:[S.jsx("h3",{className:"text-lg font-semibold text-white",children:"Generate report"}),S.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Create a PDF of the patients daily report."}),S.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[S.jsx("input",{type:"date",value:l,onChange:B=>c(B.target.value),className:"rounded-xl border border-slate-600 bg-slate-950 px-3 py-2 text-white"}),S.jsx("button",{type:"button",disabled:u||!U,onClick:()=>void V(),className:"rounded-xl bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-500 disabled:opacity-50",children:u?"Generating":"Generate report"})]})]}),S.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-5",children:[S.jsx("h3",{className:"text-lg font-semibold text-white",children:"Health stats"}),S.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Summary of recent exercises and progress (last 7 days)."}),v?S.jsx("p",{className:"mt-4 text-slate-400",children:"Loading"}):f?S.jsxs("div",{className:"mt-4 space-y-2",children:[f.daily.length===0?S.jsx("p",{className:"text-slate-400",children:"No daily rollup data for this period."}):S.jsx("ul",{className:"space-y-2",children:f.daily.map(B=>S.jsxs("li",{className:"rounded-xl border border-slate-700 bg-slate-950/80 p-3 text-sm",children:[S.jsx("span",{className:"font-medium text-white",children:B.date}),S.jsxs("span",{className:"text-slate-400",children:[" "," ",B.samples," samples  ",B.steps," steps max",B.fallSuspected_count>0&&`  ${B.fallSuspected_count} fall-suspected`,B.tilt_spikes>0&&`  ${B.tilt_spikes} tilt spikes`]})]},B.date))}),S.jsx("button",{type:"button",onClick:()=>void I(),className:"mt-2 rounded-lg border border-slate-600 px-3 py-1.5 text-sm text-slate-300 hover:bg-slate-800",children:"Refresh"})]}):S.jsx("p",{className:"mt-4 text-slate-400",children:"Select a patient to load stats."})]}),S.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-5",children:[S.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI suggestions"}),S.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Exercise regimen suggestions from historical stats (Gemini)."}),w?S.jsx("p",{className:"mt-4 text-slate-400",children:"Loading"}):b.length>0?S.jsx("ul",{className:"mt-4 list-disc space-y-1 pl-5 text-slate-200",children:b.map((B,ee)=>S.jsx("li",{children:B},ee))}):S.jsx("p",{className:"mt-4 text-slate-400",children:"No suggestions yet. Select a patient or refresh."}),S.jsx("button",{type:"button",disabled:w||!U,onClick:()=>void A(),className:"mt-3 rounded-lg border border-slate-600 px-3 py-1.5 text-sm text-slate-300 hover:bg-slate-800 disabled:opacity-50",children:"Refresh suggestions"})]}),S.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-5",children:[S.jsx("h3",{className:"text-lg font-semibold text-white",children:"Check up + Zoom"}),S.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Send a Zoom invite to the patients physical therapist or family."}),S.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[S.jsx("button",{type:"button",disabled:M!==null,onClick:()=>$("physical therapist"),className:"rounded-xl bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-500 disabled:opacity-50",children:M==="physical therapist"?"Sending":"Zoom physical therapist"}),S.jsx("button",{type:"button",disabled:M!==null,onClick:()=>$("daughter"),className:"rounded-xl bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-500 disabled:opacity-50",children:M==="daughter"?"Sending":"Zoom family (daughter)"})]})]})]})}var dp={};function Zk(i,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in i)){var o=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,o.get?o:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(i)}var eS=Object.defineProperty,tS=(i,e,t)=>e in i?eS(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,hp=(i,e,t)=>tS(i,typeof e!="symbol"?e+"":e,t);class At{constructor(){hp(this,"_locking"),hp(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(o=>e=()=>{this._locks-=1,o()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),r}}function Ze(i,e){if(!i)throw new Error(e)}const nS=34028234663852886e22,iS=-34028234663852886e22,rS=4294967295,sS=2147483647,oS=-2147483648;function ra(i){if(typeof i!="number")throw new Error("invalid int 32: "+typeof i);if(!Number.isInteger(i)||i>sS||i<oS)throw new Error("invalid int 32: "+i)}function Yc(i){if(typeof i!="number")throw new Error("invalid uint 32: "+typeof i);if(!Number.isInteger(i)||i>rS||i<0)throw new Error("invalid uint 32: "+i)}function Um(i){if(typeof i!="number")throw new Error("invalid float 32: "+typeof i);if(Number.isFinite(i)&&(i>nS||i<iS))throw new Error("invalid float 32: "+i)}const jm=Symbol("@bufbuild/protobuf/enum-type");function aS(i){const e=i[jm];return Ze(e,"missing enum type on enum object"),e}function Fm(i,e,t,r){i[jm]=Bm(e,t.map(o=>({no:o.no,name:o.name,localName:i[o.no]})))}function Bm(i,e,t){const r=Object.create(null),o=Object.create(null),l=[];for(const c of e){const u=Vm(c);l.push(u),r[c.name]=u,o[c.no]=u}return{typeName:i,values:l,findName(c){return r[c]},findNumber(c){return o[c]}}}function lS(i,e,t){const r={};for(const o of e){const l=Vm(o);r[l.localName]=l.no,r[l.no]=l.localName}return Fm(r,i,e),r}function Vm(i){return"localName"in i?i:Object.assign(Object.assign({},i),{localName:i.name})}class Lu{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const r=this.getType(),o=r.runtime.bin,l=o.makeReadOptions(t);return o.readMessage(this,l.readerFactory(e),e.byteLength,l),this}fromJson(e,t){const r=this.getType(),o=r.runtime.json,l=o.makeReadOptions(t);return o.readMessage(r,e,l,this),this}fromJsonString(e,t){let r;try{r=JSON.parse(e)}catch(o){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(o instanceof Error?o.message:String(o)))}return this.fromJson(r,t)}toBinary(e){const t=this.getType(),r=t.runtime.bin,o=r.makeWriteOptions(e),l=o.writerFactory();return r.writeMessage(this,l,o),l.finish()}toJson(e){const t=this.getType(),r=t.runtime.json,o=r.makeWriteOptions(e);return r.writeMessage(this,o)}toJsonString(e){var t;const r=this.toJson(e);return JSON.stringify(r,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function cS(i,e,t,r){var o;const l=(o=r==null?void 0:r.localName)!==null&&o!==void 0?o:e.substring(e.lastIndexOf(".")+1),c={[l]:function(u){i.util.initFields(this),i.util.initPartial(u,this)}}[l];return Object.setPrototypeOf(c.prototype,new Lu),Object.assign(c,{runtime:i,typeName:e,fields:i.util.newFieldList(t),fromBinary(u,h){return new c().fromBinary(u,h)},fromJson(u,h){return new c().fromJson(u,h)},fromJsonString(u,h){return new c().fromJsonString(u,h)},equals(u,h){return i.util.equals(c,u,h)}}),c}function uS(){let i=0,e=0;for(let r=0;r<28;r+=7){let o=this.buf[this.pos++];if(i|=(o&127)<<r,(o&128)==0)return this.assertBounds(),[i,e]}let t=this.buf[this.pos++];if(i|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[i,e];for(let r=3;r<=31;r+=7){let o=this.buf[this.pos++];if(e|=(o&127)<<r,(o&128)==0)return this.assertBounds(),[i,e]}throw new Error("invalid varint")}function Ic(i,e,t){for(let l=0;l<28;l=l+7){const c=i>>>l,u=!(!(c>>>7)&&e==0),h=(u?c|128:c)&255;if(t.push(h),!u)return}const r=i>>>28&15|(e&7)<<4,o=e>>3!=0;if(t.push((o?r|128:r)&255),!!o){for(let l=3;l<31;l=l+7){const c=e>>>l,u=!!(c>>>7),h=(u?c|128:c)&255;if(t.push(h),!u)return}t.push(e>>>31&1)}}const sa=4294967296;function fp(i){const e=i[0]==="-";e&&(i=i.slice(1));const t=1e6;let r=0,o=0;function l(c,u){const h=Number(i.slice(c,u));o*=t,r=r*t+h,r>=sa&&(o=o+(r/sa|0),r=r%sa)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),e?qm(r,o):Au(r,o)}function dS(i,e){let t=Au(i,e);const r=t.hi&2147483648;r&&(t=qm(t.lo,t.hi));const o=zm(t.lo,t.hi);return r?"-"+o:o}function zm(i,e){if({lo:i,hi:e}=hS(i,e),e<=2097151)return String(sa*e+i);const t=i&16777215,r=(i>>>24|e<<8)&16777215,o=e>>16&65535;let l=t+r*6777216+o*6710656,c=r+o*8147497,u=o*2;const h=1e7;return l>=h&&(c+=Math.floor(l/h),l%=h),c>=h&&(u+=Math.floor(c/h),c%=h),u.toString()+pp(c)+pp(l)}function hS(i,e){return{lo:i>>>0,hi:e>>>0}}function Au(i,e){return{lo:i|0,hi:e|0}}function qm(i,e){return e=~e,i?i=~i+1:e+=1,Au(i,e)}const pp=i=>{const e=String(i);return"0000000".slice(e.length)+e};function mp(i,e){if(i>=0){for(;i>127;)e.push(i&127|128),i=i>>>7;e.push(i)}else{for(let t=0;t<9;t++)e.push(i&127|128),i=i>>7;e.push(1)}}function fS(){let i=this.buf[this.pos++],e=i&127;if((i&128)==0)return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<7,(i&128)==0)return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<14,(i&128)==0)return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<21,(i&128)==0)return this.assertBounds(),e;i=this.buf[this.pos++],e|=(i&15)<<28;for(let t=5;(i&128)!==0&&t<10;t++)i=this.buf[this.pos++];if((i&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function pS(){const i=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof i.getBigInt64=="function"&&typeof i.getBigUint64=="function"&&typeof i.setBigInt64=="function"&&typeof i.setBigUint64=="function"&&(typeof process!="object"||typeof dp!="object"||dp.BUF_BIGINT_DISABLE!=="1")){const o=BigInt("-9223372036854775808"),l=BigInt("9223372036854775807"),c=BigInt("0"),u=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>l||f<o)throw new Error("int64 invalid: ".concat(h));return f},uParse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>u||f<c)throw new Error("uint64 invalid: ".concat(h));return f},enc(h){return i.setBigInt64(0,this.parse(h),!0),{lo:i.getInt32(0,!0),hi:i.getInt32(4,!0)}},uEnc(h){return i.setBigInt64(0,this.uParse(h),!0),{lo:i.getInt32(0,!0),hi:i.getInt32(4,!0)}},dec(h,f){return i.setInt32(0,h,!0),i.setInt32(4,f,!0),i.getBigInt64(0,!0)},uDec(h,f){return i.setInt32(0,h,!0),i.setInt32(4,f,!0),i.getBigUint64(0,!0)}}}const t=o=>Ze(/^-?[0-9]+$/.test(o),"int64 invalid: ".concat(o)),r=o=>Ze(/^[0-9]+$/.test(o),"uint64 invalid: ".concat(o));return{zero:"0",supported:!1,parse(o){return typeof o!="string"&&(o=o.toString()),t(o),o},uParse(o){return typeof o!="string"&&(o=o.toString()),r(o),o},enc(o){return typeof o!="string"&&(o=o.toString()),t(o),fp(o)},uEnc(o){return typeof o!="string"&&(o=o.toString()),r(o),fp(o)},dec(o,l){return dS(o,l)},uDec(o,l){return zm(o,l)}}}const Ge=pS();var W;(function(i){i[i.DOUBLE=1]="DOUBLE",i[i.FLOAT=2]="FLOAT",i[i.INT64=3]="INT64",i[i.UINT64=4]="UINT64",i[i.INT32=5]="INT32",i[i.FIXED64=6]="FIXED64",i[i.FIXED32=7]="FIXED32",i[i.BOOL=8]="BOOL",i[i.STRING=9]="STRING",i[i.BYTES=12]="BYTES",i[i.UINT32=13]="UINT32",i[i.SFIXED32=15]="SFIXED32",i[i.SFIXED64=16]="SFIXED64",i[i.SINT32=17]="SINT32",i[i.SINT64=18]="SINT64"})(W||(W={}));var wi;(function(i){i[i.BIGINT=0]="BIGINT",i[i.STRING=1]="STRING"})(wi||(wi={}));function mi(i,e,t){if(e===t)return!0;if(i==W.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}switch(i){case W.UINT64:case W.FIXED64:case W.INT64:case W.SFIXED64:case W.SINT64:return e==t}return!1}function Or(i,e){switch(i){case W.BOOL:return!1;case W.UINT64:case W.FIXED64:case W.INT64:case W.SFIXED64:case W.SINT64:return e==0?Ge.zero:"0";case W.DOUBLE:case W.FLOAT:return 0;case W.BYTES:return new Uint8Array(0);case W.STRING:return"";default:return 0}}function Wm(i,e){switch(i){case W.BOOL:return e===!1;case W.STRING:return e==="";case W.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var it;(function(i){i[i.Varint=0]="Varint",i[i.Bit64=1]="Bit64",i[i.LengthDelimited=2]="LengthDelimited",i[i.StartGroup=3]="StartGroup",i[i.EndGroup=4]="EndGroup",i[i.Bit32=5]="Bit32"})(it||(it={}));class mS{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let o=0;o<this.chunks.length;o++)e+=this.chunks[o].length;let t=new Uint8Array(e),r=0;for(let o=0;o<this.chunks.length;o++)t.set(this.chunks[o],r),r+=this.chunks[o].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Yc(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ra(e),mp(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Um(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Yc(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){ra(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return ra(e),e=(e<<1^e>>31)>>>0,mp(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),o=Ge.enc(e);return r.setInt32(0,o.lo,!0),r.setInt32(4,o.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),o=Ge.uEnc(e);return r.setInt32(0,o.lo,!0),r.setInt32(4,o.hi,!0),this.raw(t)}int64(e){let t=Ge.enc(e);return Ic(t.lo,t.hi,this.buf),this}sint64(e){let t=Ge.enc(e),r=t.hi>>31,o=t.lo<<1^r,l=(t.hi<<1|t.lo>>>31)^r;return Ic(o,l,this.buf),this}uint64(e){let t=Ge.uEnc(e);return Ic(t.lo,t.hi,this.buf),this}}class gS{constructor(e,t){this.varint64=uS,this.uint32=fS,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e,t){let r=this.pos;switch(e){case it.Varint:for(;this.buf[this.pos++]&128;);break;case it.Bit64:this.pos+=4;case it.Bit32:this.pos+=4;break;case it.LengthDelimited:let o=this.uint32();this.pos+=o;break;case it.StartGroup:for(;;){const[l,c]=this.tag();if(c===it.EndGroup){if(t!==void 0&&l!==t)throw new Error("invalid end group tag");break}this.skip(c,l)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Ge.dec(...this.varint64())}uint64(){return Ge.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,Ge.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Ge.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Ge.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function vS(i,e,t,r){let o;return{typeName:e,extendee:t,get field(){if(!o){const l=typeof r=="function"?r():r;l.name=e.split(".").pop(),l.jsonName="[".concat(e,"]"),o=i.util.newFieldList([l]).list()[0]}return o},runtime:i}}function Hm(i){const e=i.field.localName,t=Object.create(null);return t[e]=yS(i),[t,()=>t[e]]}function yS(i){const e=i.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Or(e.T,e.L);case"message":const t=e.T,r=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function kS(i,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=i.length-1;t>=0;--t)if(i[t].no==e.no)return[i[t]];return[]}return i.filter(t=>t.no===e.no)}let Wn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Pa=[];for(let i=0;i<Wn.length;i++)Pa[Wn[i].charCodeAt(0)]=i;Pa[45]=Wn.indexOf("+");Pa[95]=Wn.indexOf("/");const Km={dec(i){let e=i.length*3/4;i[i.length-2]=="="?e-=2:i[i.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,o=0,l,c=0;for(let u=0;u<i.length;u++){if(l=Pa[i.charCodeAt(u)],l===void 0)switch(i[u]){case"=":o=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:c=l,o=1;break;case 1:t[r++]=c<<2|(l&48)>>4,c=l,o=2;break;case 2:t[r++]=(c&15)<<4|(l&60)>>2,c=l,o=3;break;case 3:t[r++]=(c&3)<<6|l,o=0;break}}if(o==1)throw Error("invalid base64 string.");return t.subarray(0,r)},enc(i){let e="",t=0,r,o=0;for(let l=0;l<i.length;l++)switch(r=i[l],t){case 0:e+=Wn[r>>2],o=(r&3)<<4,t=1;break;case 1:e+=Wn[o|r>>4],o=(r&15)<<2,t=2;break;case 2:e+=Wn[o|r>>6],e+=Wn[r&63],t=0;break}return t&&(e+=Wn[o],e+="=",t==1&&(e+="=")),e}};function SS(i,e,t){$m(e,i);const r=e.runtime.bin.makeReadOptions(t),o=kS(i.getType().runtime.bin.listUnknownFields(i),e.field),[l,c]=Hm(e);for(const u of o)e.runtime.bin.readField(l,r.readerFactory(u.data),e.field,u.wireType,r);return c()}function bS(i,e,t,r){$m(e,i);const o=e.runtime.bin.makeReadOptions(r),l=e.runtime.bin.makeWriteOptions(r);if(Gm(i,e)){const f=i.getType().runtime.bin.listUnknownFields(i).filter(m=>m.no!=e.field.no);i.getType().runtime.bin.discardUnknownFields(i);for(const m of f)i.getType().runtime.bin.onUnknownField(i,m.no,m.wireType,m.data)}const c=l.writerFactory();let u=e.field;!u.opt&&!u.repeated&&(u.kind=="enum"||u.kind=="scalar")&&(u=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(u,t,c,l);const h=o.readerFactory(c.finish());for(;h.pos<h.len;){const[f,m]=h.tag(),v=h.skip(m,f);i.getType().runtime.bin.onUnknownField(i,f,m,v)}}function Gm(i,e){const t=i.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(i).find(r=>r.no==e.field.no)}function $m(i,e){Ze(i.extendee.typeName==e.getType().typeName,"extension ".concat(i.typeName," can only be applied to message ").concat(i.extendee.typeName))}function Jm(i,e){const t=i.localName;if(i.repeated)return e[t].length>0;if(i.oneof)return e[i.oneof.localName].case===t;switch(i.kind){case"enum":case"scalar":return i.opt||i.req?e[t]!==void 0:i.kind=="enum"?e[t]!==i.T.values[0].no:!Wm(i.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function gp(i,e){const t=i.localName,r=!i.opt&&!i.req;if(i.repeated)e[t]=[];else if(i.oneof)e[i.oneof.localName]={case:void 0};else switch(i.kind){case"map":e[t]={};break;case"enum":e[t]=r?i.T.values[0].no:void 0;break;case"scalar":e[t]=r?Or(i.T,i.L):void 0;break;case"message":e[t]=void 0;break}}function Hn(i,e){if(i===null||typeof i!="object"||!Object.getOwnPropertyNames(Lu.prototype).every(r=>r in i&&typeof i[r]=="function"))return!1;const t=i.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function Qm(i,e){return Hn(e)||!i.fieldWrapper?e:i.fieldWrapper.wrapField(e)}W.DOUBLE,W.FLOAT,W.INT64,W.UINT64,W.INT32,W.UINT32,W.BOOL,W.STRING,W.BYTES;const vp={ignoreUnknownFields:!1},yp={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function TS(i){return i?Object.assign(Object.assign({},vp),i):vp}function CS(i){return i?Object.assign(Object.assign({},yp),i):yp}const va=Symbol(),oa=Symbol();function wS(){return{makeReadOptions:TS,makeWriteOptions:CS,readMessage(i,e,t,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(i.typeName," from JSON: ").concat(En(e)));r=r??new i;const o=new Map,l=t.typeRegistry;for(const[c,u]of Object.entries(e)){const h=i.fields.findJsonName(c);if(h){if(h.oneof){if(u===null&&h.kind=="scalar")continue;const f=o.get(h.oneof);if(f!==void 0)throw new Error("cannot decode message ".concat(i.typeName,' from JSON: multiple keys for oneof "').concat(h.oneof.name,'" present: "').concat(f,'", "').concat(c,'"'));o.set(h.oneof,c)}kp(r,u,h,t,i)}else{let f=!1;if(l!=null&&l.findExtension&&c.startsWith("[")&&c.endsWith("]")){const m=l.findExtension(c.substring(1,c.length-1));if(m&&m.extendee.typeName==i.typeName){f=!0;const[v,k]=Hm(m);kp(v,u,m.field,t,m),bS(r,m,k(),t)}}if(!f&&!t.ignoreUnknownFields)throw new Error("cannot decode message ".concat(i.typeName,' from JSON: key "').concat(c,'" is unknown'))}}return r},writeMessage(i,e){const t=i.getType(),r={};let o;try{for(o of t.fields.byNumber()){if(!Jm(o,i)){if(o.req)throw"required field not set";if(!e.emitDefaultValues||!ES(o))continue}const c=o.oneof?i[o.oneof.localName].value:i[o.localName],u=Sp(o,c,e);u!==void 0&&(r[e.useProtoFieldName?o.name:o.jsonName]=u)}const l=e.typeRegistry;if(l!=null&&l.findExtensionFor)for(const c of t.runtime.bin.listUnknownFields(i)){const u=l.findExtensionFor(t.typeName,c.no);if(u&&Gm(i,u)){const h=SS(i,u,e),f=Sp(u.field,h,e);f!==void 0&&(r[u.field.jsonName]=f)}}}catch(l){const c=o?"cannot encode field ".concat(t.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(t.typeName," to JSON"),u=l instanceof Error?l.message:String(l);throw new Error(c+(u.length>0?": ".concat(u):""))}return r},readScalar(i,e,t){return Ns(i,e,t??wi.BIGINT,!0)},writeScalar(i,e,t){if(e!==void 0&&(t||Wm(i,e)))return aa(i,e)},debug:En}}function En(i){if(i===null)return"null";switch(typeof i){case"object":return Array.isArray(i)?"array":"object";case"string":return i.length>100?"string":'"'.concat(i.split('"').join('\\"'),'"');default:return String(i)}}function kp(i,e,t,r,o){let l=t.localName;if(t.repeated){if(Ze(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(o.typeName,".").concat(t.name," from JSON: ").concat(En(e)));const c=i[l];for(const u of e){if(u===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(t.name," from JSON: ").concat(En(u)));switch(t.kind){case"message":c.push(t.T.fromJson(u,r));break;case"enum":const h=Nc(t.T,u,r.ignoreUnknownFields,!0);h!==oa&&c.push(h);break;case"scalar":try{c.push(Ns(t.T,u,t.L,!0))}catch(f){let m="cannot decode field ".concat(o.typeName,".").concat(t.name," from JSON: ").concat(En(u));throw f instanceof Error&&f.message.length>0&&(m+=": ".concat(f.message)),new Error(m)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(o.typeName,".").concat(t.name," from JSON: ").concat(En(e)));const c=i[l];for(const[u,h]of Object.entries(e)){if(h===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(t.name," from JSON: map value null"));let f;try{f=xS(t.K,u)}catch(m){let v="cannot decode map key for field ".concat(o.typeName,".").concat(t.name," from JSON: ").concat(En(e));throw m instanceof Error&&m.message.length>0&&(v+=": ".concat(m.message)),new Error(v)}switch(t.V.kind){case"message":c[f]=t.V.T.fromJson(h,r);break;case"enum":const m=Nc(t.V.T,h,r.ignoreUnknownFields,!0);m!==oa&&(c[f]=m);break;case"scalar":try{c[f]=Ns(t.V.T,h,wi.BIGINT,!0)}catch(v){let k="cannot decode map value for field ".concat(o.typeName,".").concat(t.name," from JSON: ").concat(En(e));throw v instanceof Error&&v.message.length>0&&(k+=": ".concat(v.message)),new Error(k)}break}}}else switch(t.oneof&&(i=i[t.oneof.localName]={case:l},l="value"),t.kind){case"message":const c=t.T;if(e===null&&c.typeName!="google.protobuf.Value")return;let u=i[l];Hn(u)?u.fromJson(e,r):(i[l]=u=c.fromJson(e,r),c.fieldWrapper&&!t.oneof&&(i[l]=c.fieldWrapper.unwrapField(u)));break;case"enum":const h=Nc(t.T,e,r.ignoreUnknownFields,!1);switch(h){case va:gp(t,i);break;case oa:break;default:i[l]=h;break}break;case"scalar":try{const f=Ns(t.T,e,t.L,!1);switch(f){case va:gp(t,i);break;default:i[l]=f;break}}catch(f){let m="cannot decode field ".concat(o.typeName,".").concat(t.name," from JSON: ").concat(En(e));throw f instanceof Error&&f.message.length>0&&(m+=": ".concat(f.message)),new Error(m)}break}}function xS(i,e){if(i===W.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ns(i,e,wi.BIGINT,!0).toString()}function Ns(i,e,t,r){if(e===null)return r?Or(i,t):va;switch(i){case W.DOUBLE:case W.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const o=Number(e);if(Number.isNaN(o)||!Number.isFinite(o))break;return i==W.FLOAT&&Um(o),o;case W.INT32:case W.FIXED32:case W.SFIXED32:case W.SINT32:case W.UINT32:let l;if(typeof e=="number"?l=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(l=Number(e)),l===void 0)break;return i==W.UINT32||i==W.FIXED32?Yc(l):ra(l),l;case W.INT64:case W.SFIXED64:case W.SINT64:if(typeof e!="number"&&typeof e!="string")break;const c=Ge.parse(e);return t?c.toString():c;case W.FIXED64:case W.UINT64:if(typeof e!="number"&&typeof e!="string")break;const u=Ge.uParse(e);return t?u.toString():u;case W.BOOL:if(typeof e!="boolean")break;return e;case W.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case W.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Km.dec(e)}throw new Error}function Nc(i,e,t,r){if(e===null)return i.typeName=="google.protobuf.NullValue"?0:r?i.values[0].no:va;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const o=i.findName(e);if(o!==void 0)return o.no;if(t)return oa;break}throw new Error("cannot decode enum ".concat(i.typeName," from JSON: ").concat(En(e)))}function ES(i){return i.repeated||i.kind=="map"?!0:!(i.oneof||i.kind=="message"||i.opt||i.req)}function Sp(i,e,t){if(i.kind=="map"){Ze(typeof e=="object"&&e!=null);const r={},o=Object.entries(e);switch(i.V.kind){case"scalar":for(const[c,u]of o)r[c.toString()]=aa(i.V.T,u);break;case"message":for(const[c,u]of o)r[c.toString()]=u.toJson(t);break;case"enum":const l=i.V.T;for(const[c,u]of o)r[c.toString()]=Oc(l,u,t.enumAsInteger);break}return t.emitDefaultValues||o.length>0?r:void 0}if(i.repeated){Ze(Array.isArray(e));const r=[];switch(i.kind){case"scalar":for(let o=0;o<e.length;o++)r.push(aa(i.T,e[o]));break;case"enum":for(let o=0;o<e.length;o++)r.push(Oc(i.T,e[o],t.enumAsInteger));break;case"message":for(let o=0;o<e.length;o++)r.push(e[o].toJson(t));break}return t.emitDefaultValues||r.length>0?r:void 0}switch(i.kind){case"scalar":return aa(i.T,e);case"enum":return Oc(i.T,e,t.enumAsInteger);case"message":return Qm(i.T,e).toJson(t)}}function Oc(i,e,t){var r;if(Ze(typeof e=="number"),i.typeName=="google.protobuf.NullValue")return null;if(t)return e;const o=i.findNumber(e);return(r=o==null?void 0:o.name)!==null&&r!==void 0?r:e}function aa(i,e){switch(i){case W.INT32:case W.SFIXED32:case W.SINT32:case W.FIXED32:case W.UINT32:return Ze(typeof e=="number"),e;case W.FLOAT:case W.DOUBLE:return Ze(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case W.STRING:return Ze(typeof e=="string"),e;case W.BOOL:return Ze(typeof e=="boolean"),e;case W.UINT64:case W.FIXED64:case W.INT64:case W.SFIXED64:case W.SINT64:return Ze(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case W.BYTES:return Ze(e instanceof Uint8Array),Km.enc(e)}}const Sr=Symbol("@bufbuild/protobuf/unknown-fields"),bp={readUnknownFields:!0,readerFactory:i=>new gS(i)},Tp={writeUnknownFields:!0,writerFactory:()=>new mS};function PS(i){return i?Object.assign(Object.assign({},bp),i):bp}function RS(i){return i?Object.assign(Object.assign({},Tp),i):Tp}function _S(){return{makeReadOptions:PS,makeWriteOptions:RS,listUnknownFields(i){var e;return(e=i[Sr])!==null&&e!==void 0?e:[]},discardUnknownFields(i){delete i[Sr]},writeUnknownFields(i,e){const r=i[Sr];if(r)for(const o of r)e.tag(o.no,o.wireType).raw(o.data)},onUnknownField(i,e,t,r){const o=i;Array.isArray(o[Sr])||(o[Sr]=[]),o[Sr].push({no:e,wireType:t,data:r})},readMessage(i,e,t,r,o){const l=i.getType(),c=o?e.len:e.pos+t;let u,h;for(;e.pos<c&&([u,h]=e.tag(),!(o===!0&&h==it.EndGroup));){const f=l.fields.find(u);if(!f){const m=e.skip(h,u);r.readUnknownFields&&this.onUnknownField(i,u,h,m);continue}Cp(i,e,f,h,r)}if(o&&(h!=it.EndGroup||u!==t))throw new Error("invalid end group tag")},readField:Cp,writeMessage(i,e,t){const r=i.getType();for(const o of r.fields.byNumber()){if(!Jm(o,i)){if(o.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(o.name," to binary: required field not set"));continue}const l=o.oneof?i[o.oneof.localName].value:i[o.localName];wp(o,l,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(i,e),e},writeField(i,e,t,r){e!==void 0&&wp(i,e,t,r)}}}function Cp(i,e,t,r,o){let{repeated:l,localName:c}=t;switch(t.oneof&&(i=i[t.oneof.localName],i.case!=c&&delete i.value,i.case=c,c="value"),t.kind){case"scalar":case"enum":const u=t.kind=="enum"?W.INT32:t.T;let h=ya;if(t.kind=="scalar"&&t.L>0&&(h=NS),l){let k=i[c];if(r==it.LengthDelimited&&u!=W.STRING&&u!=W.BYTES){let P=e.uint32()+e.pos;for(;e.pos<P;)k.push(h(e,u))}else k.push(h(e,u))}else i[c]=h(e,u);break;case"message":const f=t.T;l?i[c].push(la(e,new f,o,t)):Hn(i[c])?la(e,i[c],o,t):(i[c]=la(e,new f,o,t),f.fieldWrapper&&!t.oneof&&!t.repeated&&(i[c]=f.fieldWrapper.unwrapField(i[c])));break;case"map":let[m,v]=IS(t,e,o);i[c][m]=v;break}}function la(i,e,t,r){const o=e.getType().runtime.bin,l=r==null?void 0:r.delimited;return o.readMessage(e,i,l?r.no:i.uint32(),t,l),e}function IS(i,e,t){const r=e.uint32(),o=e.pos+r;let l,c;for(;e.pos<o;){const[u]=e.tag();switch(u){case 1:l=ya(e,i.K);break;case 2:switch(i.V.kind){case"scalar":c=ya(e,i.V.T);break;case"enum":c=e.int32();break;case"message":c=la(e,new i.V.T,t,void 0);break}break}}if(l===void 0&&(l=Or(i.K,wi.BIGINT)),typeof l!="string"&&typeof l!="number"&&(l=l.toString()),c===void 0)switch(i.V.kind){case"scalar":c=Or(i.V.T,wi.BIGINT);break;case"enum":c=i.V.T.values[0].no;break;case"message":c=new i.V.T;break}return[l,c]}function NS(i,e){const t=ya(i,e);return typeof t=="bigint"?t.toString():t}function ya(i,e){switch(e){case W.STRING:return i.string();case W.BOOL:return i.bool();case W.DOUBLE:return i.double();case W.FLOAT:return i.float();case W.INT32:return i.int32();case W.INT64:return i.int64();case W.UINT64:return i.uint64();case W.FIXED64:return i.fixed64();case W.BYTES:return i.bytes();case W.FIXED32:return i.fixed32();case W.SFIXED32:return i.sfixed32();case W.SFIXED64:return i.sfixed64();case W.SINT64:return i.sint64();case W.UINT32:return i.uint32();case W.SINT32:return i.sint32()}}function wp(i,e,t,r){Ze(e!==void 0);const o=i.repeated;switch(i.kind){case"scalar":case"enum":let l=i.kind=="enum"?W.INT32:i.T;if(o)if(Ze(Array.isArray(e)),i.packed)DS(t,l,i.no,e);else for(const c of e)Os(t,l,i.no,c);else Os(t,l,i.no,e);break;case"message":if(o){Ze(Array.isArray(e));for(const c of e)xp(t,r,i,c)}else xp(t,r,i,e);break;case"map":Ze(typeof e=="object"&&e!=null);for(const[c,u]of Object.entries(e))OS(t,r,i,c,u);break}}function OS(i,e,t,r,o){i.tag(t.no,it.LengthDelimited),i.fork();let l=r;switch(t.K){case W.INT32:case W.FIXED32:case W.UINT32:case W.SFIXED32:case W.SINT32:l=Number.parseInt(r);break;case W.BOOL:Ze(r=="true"||r=="false"),l=r=="true";break}switch(Os(i,t.K,1,l),t.V.kind){case"scalar":Os(i,t.V.T,2,o);break;case"enum":Os(i,W.INT32,2,o);break;case"message":Ze(o!==void 0),i.tag(2,it.LengthDelimited).bytes(o.toBinary(e));break}i.join()}function xp(i,e,t,r){const o=Qm(t.T,r);t.delimited?i.tag(t.no,it.StartGroup).raw(o.toBinary(e)).tag(t.no,it.EndGroup):i.tag(t.no,it.LengthDelimited).bytes(o.toBinary(e))}function Os(i,e,t,r){Ze(r!==void 0);let[o,l]=Ym(e);i.tag(t,o)[l](r)}function DS(i,e,t,r){if(!r.length)return;i.tag(t,it.LengthDelimited).fork();let[,o]=Ym(e);for(let l=0;l<r.length;l++)i[o](r[l]);i.join()}function Ym(i){let e=it.Varint;switch(i){case W.BYTES:case W.STRING:e=it.LengthDelimited;break;case W.DOUBLE:case W.FIXED64:case W.SFIXED64:e=it.Bit64;break;case W.FIXED32:case W.SFIXED32:case W.FLOAT:e=it.Bit32;break}const t=W[i].toLowerCase();return[e,t]}function MS(){return{setEnumType:Fm,initPartial(i,e){if(i===void 0)return;const t=e.getType();for(const r of t.fields.byMember()){const o=r.localName,l=e,c=i;if(c[o]!=null)switch(r.kind){case"oneof":const u=c[o].case;if(u===void 0)continue;const h=r.findField(u);let f=c[o].value;h&&h.kind=="message"&&!Hn(f,h.T)?f=new h.T(f):h&&h.kind==="scalar"&&h.T===W.BYTES&&(f=bs(f)),l[o]={case:u,value:f};break;case"scalar":case"enum":let m=c[o];r.T===W.BYTES&&(m=r.repeated?m.map(bs):bs(m)),l[o]=m;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===W.BYTES)for(const[b,P]of Object.entries(c[o]))l[o][b]=bs(P);else Object.assign(l[o],c[o]);break;case"message":const k=r.V.T;for(const b of Object.keys(c[o])){let P=c[o][b];k.fieldWrapper||(P=new k(P)),l[o][b]=P}break}break;case"message":const v=r.T;if(r.repeated)l[o]=c[o].map(k=>Hn(k,v)?k:new v(k));else{const k=c[o];v.fieldWrapper?v.typeName==="google.protobuf.BytesValue"?l[o]=bs(k):l[o]=k:l[o]=Hn(k,v)?k:new v(k)}break}}},equals(i,e,t){return e===t?!0:!e||!t?!1:i.fields.byMember().every(r=>{const o=e[r.localName],l=t[r.localName];if(r.repeated){if(o.length!==l.length)return!1;switch(r.kind){case"message":return o.every((c,u)=>r.T.equals(c,l[u]));case"scalar":return o.every((c,u)=>mi(r.T,c,l[u]));case"enum":return o.every((c,u)=>mi(W.INT32,c,l[u]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":let c=o,u=l;return r.T.fieldWrapper&&(c!==void 0&&!Hn(c)&&(c=r.T.fieldWrapper.wrapField(c)),u!==void 0&&!Hn(u)&&(u=r.T.fieldWrapper.wrapField(u))),r.T.equals(c,u);case"enum":return mi(W.INT32,o,l);case"scalar":return mi(r.T,o,l);case"oneof":if(o.case!==l.case)return!1;const h=r.findField(o.case);if(h===void 0)return!0;switch(h.kind){case"message":return h.T.equals(o.value,l.value);case"enum":return mi(W.INT32,o.value,l.value);case"scalar":return mi(h.T,o.value,l.value)}throw new Error("oneof cannot contain ".concat(h.kind));case"map":const f=Object.keys(o).concat(Object.keys(l));switch(r.V.kind){case"message":const m=r.V.T;return f.every(k=>m.equals(o[k],l[k]));case"enum":return f.every(k=>mi(W.INT32,o[k],l[k]));case"scalar":const v=r.V.T;return f.every(k=>mi(v,o[k],l[k]))}break}})},clone(i){const e=i.getType(),t=new e,r=t;for(const o of e.fields.byMember()){const l=i[o.localName];let c;if(o.repeated)c=l.map(ta);else if(o.kind=="map"){c=r[o.localName];for(const[u,h]of Object.entries(l))c[u]=ta(h)}else o.kind=="oneof"?c=o.findField(l.case)?{case:l.case,value:ta(l.value)}:{case:void 0}:c=ta(l);r[o.localName]=c}for(const o of e.runtime.bin.listUnknownFields(i))e.runtime.bin.onUnknownField(r,o.no,o.wireType,o.data);return t}}}function ta(i){if(i===void 0)return i;if(Hn(i))return i.clone();if(i instanceof Uint8Array){const e=new Uint8Array(i.byteLength);return e.set(i),e}return i}function bs(i){return i instanceof Uint8Array?i:new Uint8Array(i)}function LS(i,e,t){return{syntax:i,json:wS(),bin:_S(),util:Object.assign(Object.assign({},MS()),{newFieldList:e,initFields:t}),makeMessageType(r,o,l){return cS(this,r,o,l)},makeEnum:lS,makeEnumType:Bm,getEnumType:aS,makeExtension(r,o,l){return vS(this,r,o,l)}}}class AS{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const r of this.list())t[r.jsonName]=t[r.name]=r;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const r of this.list())t[r.no]=r;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const r of this.list())r.oneof?r.oneof!==t&&(t=r.oneof,e.push(t)):e.push(r)}return this.members}}function Xm(i,e){const t=Zm(i);return e?t:zS(VS(t))}function US(i){return Xm(i,!1)}const jS=Zm;function Zm(i){let e=!1;const t=[];for(let r=0;r<i.length;r++){let o=i.charAt(r);switch(o){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(o),e=!1;break;default:e&&(e=!1,o=o.toUpperCase()),t.push(o);break}}return t.join("")}const FS=new Set(["constructor","toString","toJSON","valueOf"]),BS=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),eg=i=>"".concat(i,"$"),VS=i=>BS.has(i)?eg(i):i,zS=i=>FS.has(i)?eg(i):i;class qS{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=US(e)}addField(e){Ze(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function WS(i,e){var t,r,o,l,c,u;const h=[];let f;for(const m of typeof i=="function"?i():i){const v=m;if(v.localName=Xm(m.name,m.oneof!==void 0),v.jsonName=(t=m.jsonName)!==null&&t!==void 0?t:jS(m.name),v.repeated=(r=m.repeated)!==null&&r!==void 0?r:!1,m.kind=="scalar"&&(v.L=(o=m.L)!==null&&o!==void 0?o:wi.BIGINT),v.delimited=(l=m.delimited)!==null&&l!==void 0?l:!1,v.req=(c=m.req)!==null&&c!==void 0?c:!1,v.opt=(u=m.opt)!==null&&u!==void 0?u:!1,m.packed===void 0&&(v.packed=m.kind=="enum"||m.kind=="scalar"&&m.T!=W.BYTES&&m.T!=W.STRING),m.oneof!==void 0){const k=typeof m.oneof=="string"?m.oneof:m.oneof.name;(!f||f.name!=k)&&(f=new qS(k)),v.oneof=f,f.addField(v)}h.push(v)}return h}const F=LS("proto3",i=>new AS(i,e=>WS(e)),i=>{for(const e of i.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,r=i;if(e.repeated){r[t]=[];continue}switch(e.kind){case"oneof":r[t]={case:void 0};break;case"enum":r[t]=0;break;case"map":r[t]={};break;case"scalar":r[t]=Or(e.T,e.L);break}}});class Dt extends Lu{constructor(e){super(),this.seconds=Ge.zero,this.nanos=0,F.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(F.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const o=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(o))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(o<Date.parse("0001-01-01T00:00:00Z")||o>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Ge.parse(o/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const o=(this.nanos+1e9).toString().substring(1);o.substring(3)==="000000"?r="."+o.substring(0,3)+"Z":o.substring(6)==="000"?r="."+o.substring(0,6)+"Z":r="."+o+"Z"}return new Date(t).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Dt.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Dt({seconds:Ge.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new Dt().fromBinary(e,t)}static fromJson(e,t){return new Dt().fromJson(e,t)}static fromJsonString(e,t){return new Dt().fromJsonString(e,t)}static equals(e,t){return F.util.equals(Dt,e,t)}}Dt.runtime=F;Dt.typeName="google.protobuf.Timestamp";Dt.fields=F.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const HS=F.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Dt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:KS,repeated:!0},{no:5,name:"events",kind:"message",T:$S,repeated:!0}]),KS=F.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:GS,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),GS=F.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Dt},{no:3,name:"value",kind:"scalar",T:2}]),$S=F.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Dt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Dt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),tg=F.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),fn=F.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),at=F.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Uu=F.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),_s=F.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Us=F.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),gn=F.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),br=F.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),JS=F.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),mt=F.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Ra=F.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ka,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:pg}]),ka=F.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),QS=F.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:F.getEnumType(at),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),qi=F.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:F.getEnumType(Er)},{no:4,name:"tracks",kind:"message",T:wr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:QS},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:F.getEnumType(js)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:F.getEnumType(gn)},{no:18,name:"kind_details",kind:"enum",T:F.getEnumType(YS),repeated:!0}]),Er=F.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),js=F.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),YS=F.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Wt=F.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),XS=F.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:zi,repeated:!0}]),wr=F.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:F.getEnumType(fn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:F.getEnumType(at)},{no:10,name:"layers",kind:"message",T:zi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:XS,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:F.getEnumType(Wt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:pg},{no:19,name:"audio_features",kind:"enum",T:F.getEnumType(mt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:F.getEnumType(tg)}]),zi=F.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:F.getEnumType(Uu)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Mt=F.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:F.getEnumType(Te)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:ig,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ZS,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:rg,oneof:"value"},{no:7,name:"transcription",kind:"message",T:eb,oneof:"value"},{no:8,name:"metrics",kind:"message",T:HS,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Xc,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:sg,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:og,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:ag,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:eu,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:tu,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:nu,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Te=F.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ZS=F.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:ng,repeated:!0}]),ng=F.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),ig=F.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),rg=F.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),eb=F.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:tb,repeated:!0}]),tb=F.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Xc=F.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),sg=F.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),og=F.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),ag=F.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:lg,oneof:"value"}]),lg=F.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),cg=F.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),ug=F.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:F.getEnumType(dg)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),dg=F.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),nb=F.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:F.getEnumType(hg)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),hg=F.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),fg=F.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Ep},{no:2,name:"screen",kind:"message",T:Ep},{no:3,name:"resume_connection",kind:"enum",T:F.getEnumType(Us)},{no:4,name:"disabled_codecs",kind:"message",T:ib},{no:5,name:"force_relay",kind:"enum",T:F.getEnumType(Us)}]),Ep=F.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:F.getEnumType(Us)}]),ib=F.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:ka,repeated:!0},{no:2,name:"publish",kind:"message",T:ka,repeated:!0}]),pg=F.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Zc=F.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),mg=F.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:F.getEnumType(Zc)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),gg=F.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),eu=F.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:F.getEnumType(Wt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:mg,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:gg,oneof:"content_header"}],{localName:"DataStream_Header"}),tu=F.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),nu=F.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),pn=F.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),iu=F.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),rb=F.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),sb=F.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Wi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Wi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:ju,oneof:"message"},{no:4,name:"add_track",kind:"message",T:su,oneof:"message"},{no:5,name:"mute",kind:"message",T:Fu,oneof:"message"},{no:6,name:"subscription",kind:"message",T:_a,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:vg,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ia,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:kg,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Cg,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:wg,oneof:"message"},{no:13,name:"simulate",kind:"message",T:xn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Sg,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Pg,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:yg,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:ub,oneof:"message"}]),Pp=F.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:ob,oneof:"message"},{no:2,name:"answer",kind:"message",T:Wi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Wi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:ju,oneof:"message"},{no:5,name:"update",kind:"message",T:cb,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Bu,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ia,oneof:"message"},{no:9,name:"mute",kind:"message",T:Fu,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:db,oneof:"message"},{no:11,name:"room_update",kind:"message",T:hb,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:pb,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:gb,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:yb,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:kb,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:lb,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ab,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:bb,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:wb,oneof:"message"},{no:22,name:"request_response",kind:"message",T:xb,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Eb,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Sb,oneof:"message"}]),ru=F.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),su=F.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:F.getEnumType(fn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:F.getEnumType(at)},{no:9,name:"layers",kind:"message",T:zi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:ru,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:F.getEnumType(Wt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:F.getEnumType(tg)},{no:17,name:"audio_features",kind:"enum",T:F.getEnumType(mt),repeated:!0}]),ju=F.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:F.getEnumType(pn)},{no:3,name:"final",kind:"scalar",T:8}]),Fu=F.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),ob=F.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Ra},{no:2,name:"participant",kind:"message",T:qi},{no:3,name:"other_participants",kind:"message",T:qi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:bg,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:fg},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:ug},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ka,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),ab=F.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:bg,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:fg},{no:3,name:"server_info",kind:"message",T:ug},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Bu=F.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:wr}]),lb=F.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Wi=F.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),cb=F.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:qi,repeated:!0}]),_a=F.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:cg,repeated:!0}]),vg=F.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:F.getEnumType(Uu)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),yg=F.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:F.getEnumType(mt),repeated:!0}]),ub=F.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Ia=F.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:F.getEnumType(gn)},{no:3,name:"action",kind:"enum",T:F.getEnumType(Pr)},{no:4,name:"regions",kind:"message",T:Tb}]),Pr=F.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),kg=F.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:zi,repeated:!0}]),Sg=F.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),bg=F.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),db=F.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:ng,repeated:!0}]),hb=F.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Ra}]),fb=F.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:F.getEnumType(_s)},{no:3,name:"score",kind:"scalar",T:2}]),pb=F.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:fb,repeated:!0}]),mb=F.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:F.getEnumType(iu)}]),gb=F.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:mb,repeated:!0}]),Vu=F.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:F.getEnumType(Uu)},{no:2,name:"enabled",kind:"scalar",T:8}]),vb=F.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Vu,repeated:!0}]),yb=F.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Vu,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:vb,repeated:!0}]),Tg=F.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Cg=F.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Tg,repeated:!0}]),kb=F.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Sb=F.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Ra},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:qi},{no:4,name:"other_participants",kind:"message",T:qi,repeated:!0}]),wg=F.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Wi},{no:2,name:"subscription",kind:"message",T:_a},{no:3,name:"publish_tracks",kind:"message",T:Bu,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Eg,repeated:!0},{no:5,name:"offer",kind:"message",T:Wi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:xg,repeated:!0}]),xg=F.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Eg=F.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:F.getEnumType(pn)}]),xn=F.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:F.getEnumType(rb),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Pg=F.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),bb=F.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Tb=F.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Cb,repeated:!0}]),Cb=F.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),wb=F.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:F.getEnumType(JS)}]),xb=F.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:F.getEnumType(zu)},{no:3,name:"message",kind:"scalar",T:9}]),zu=F.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Eb=F.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function Pb(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ca={exports:{}},Rb=ca.exports,Rp;function _b(){return Rp||(Rp=1,(function(i){(function(e,t){i.exports?i.exports=t():e.log=t()})(Rb,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},c=null;function u(w,_){var M=w[_];if(typeof M.bind=="function")return M.bind(w);try{return Function.prototype.bind.call(M,w)}catch{return function(){return Function.prototype.apply.apply(M,[w,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(w){return w==="debug"&&(w="log"),typeof console===t?!1:w==="trace"&&r?h:console[w]!==void 0?u(console,w):console.log!==void 0?u(console,"log"):e}function m(){for(var w=this.getLevel(),_=0;_<o.length;_++){var M=o[_];this[M]=_<w?e:this.methodFactory(M,w,this.name)}if(this.log=this.debug,typeof console===t&&w<this.levels.SILENT)return"No console available for logging"}function v(w){return function(){typeof console!==t&&(m.call(this),this[w].apply(this,arguments))}}function k(w,_,M){return f(w)||v.apply(this,arguments)}function b(w,_){var M=this,z,U,I,A="loglevel";typeof w=="string"?A+=":"+w:typeof w=="symbol"&&(A=void 0);function V(ne){var ve=(o[ne]||"silent").toUpperCase();if(!(typeof window===t||!A)){try{window.localStorage[A]=ve;return}catch{}try{window.document.cookie=encodeURIComponent(A)+"="+ve+";"}catch{}}}function $(){var ne;if(!(typeof window===t||!A)){try{ne=window.localStorage[A]}catch{}if(typeof ne===t)try{var ve=window.document.cookie,Pe=encodeURIComponent(A),je=ve.indexOf(Pe+"=");je!==-1&&(ne=/^([^;]+)/.exec(ve.slice(je+Pe.length+1))[1])}catch{}return M.levels[ne]===void 0&&(ne=void 0),ne}}function Y(){if(!(typeof window===t||!A)){try{window.localStorage.removeItem(A)}catch{}try{window.document.cookie=encodeURIComponent(A)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function B(ne){var ve=ne;if(typeof ve=="string"&&M.levels[ve.toUpperCase()]!==void 0&&(ve=M.levels[ve.toUpperCase()]),typeof ve=="number"&&ve>=0&&ve<=M.levels.SILENT)return ve;throw new TypeError("log.setLevel() called with invalid level: "+ne)}M.name=w,M.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},M.methodFactory=_||k,M.getLevel=function(){return I??U??z},M.setLevel=function(ne,ve){return I=B(ne),ve!==!1&&V(I),m.call(M)},M.setDefaultLevel=function(ne){U=B(ne),$()||M.setLevel(ne,!1)},M.resetLevel=function(){I=null,Y(),m.call(M)},M.enableAll=function(ne){M.setLevel(M.levels.TRACE,ne)},M.disableAll=function(ne){M.setLevel(M.levels.SILENT,ne)},M.rebuild=function(){if(c!==M&&(z=B(c.getLevel())),m.call(M),c===M)for(var ne in l)l[ne].rebuild()},z=B(c?c.getLevel():"WARN");var ee=$();ee!=null&&(I=B(ee)),m.call(M)}c=new b,c.getLogger=function(_){if(typeof _!="symbol"&&typeof _!="string"||_==="")throw new TypeError("You must supply a name when creating a logger.");var M=l[_];return M||(M=l[_]=new b(_,c.methodFactory)),M};var P=typeof window!==t?window.log:void 0;return c.noConflict=function(){return typeof window!==t&&window.log===c&&(window.log=P),c},c.getLoggers=function(){return l},c.default=c,c})})(ca)),ca.exports}var Na=_b(),ou;(function(i){i[i.trace=0]="trace",i[i.debug=1]="debug",i[i.info=2]="info",i[i.warn=3]="warn",i[i.error=4]="error",i[i.silent=5]="silent"})(ou||(ou={}));var vn;(function(i){i.Default="livekit",i.Room="livekit-room",i.Participant="livekit-participant",i.Track="livekit-track",i.Publication="livekit-track-publication",i.Engine="livekit-engine",i.Signal="livekit-signal",i.PCManager="livekit-pc-manager",i.PCTransport="livekit-pc-transport",i.E2EE="lk-e2ee"})(vn||(vn={}));let _e=Na.getLogger("livekit");Object.values(vn).map(i=>Na.getLogger(i));_e.setDefaultLevel(ou.info);function $n(i){const e=Na.getLogger(i);return e.setDefaultLevel(_e.getLevel()),e}const Ib=Na.getLogger("lk-e2ee"),Ts=7e3,Nb=[0,300,4*300,9*300,16*300,Ts,Ts,Ts,Ts,Ts];class Ob{constructor(e){this._retryDelays=e!==void 0?[...e]:Nb}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function Db(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(i);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(i,r[o])&&(t[r[o]]=i[r[o]]);return t}function C(i,e,t,r){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function u(m){try{f(r.next(m))}catch(v){c(v)}}function h(m){try{f(r.throw(m))}catch(v){c(v)}}function f(m){m.done?l(m.value):o(m.value).then(u,h)}f((r=r.apply(i,e||[])).next())})}function _p(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kn(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof _p=="function"?_p(i):i[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(l){t[l]=i[l]&&function(c){return new Promise(function(u,h){c=i[l](c),o(u,h,c.done,c.value)})}}function o(l,c,u,h){Promise.resolve(h).then(function(f){l({value:f,done:u})},c)}}var na={exports:{}},Ip;function Mb(){if(Ip)return na.exports;Ip=1;var i=typeof Reflect=="object"?Reflect:null,e=i&&typeof i.apply=="function"?i.apply:function(A,V,$){return Function.prototype.apply.call(A,V,$)},t;i&&typeof i.ownKeys=="function"?t=i.ownKeys:Object.getOwnPropertySymbols?t=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:t=function(A){return Object.getOwnPropertyNames(A)};function r(I){console&&console.warn&&console.warn(I)}var o=Number.isNaN||function(A){return A!==A};function l(){l.init.call(this)}na.exports=l,na.exports.once=M,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var c=10;function u(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(I){if(typeof I!="number"||I<0||o(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");c=I}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||o(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function h(I){return I._maxListeners===void 0?l.defaultMaxListeners:I._maxListeners}l.prototype.getMaxListeners=function(){return h(this)},l.prototype.emit=function(A){for(var V=[],$=1;$<arguments.length;$++)V.push(arguments[$]);var Y=A==="error",B=this._events;if(B!==void 0)Y=Y&&B.error===void 0;else if(!Y)return!1;if(Y){var ee;if(V.length>0&&(ee=V[0]),ee instanceof Error)throw ee;var ne=new Error("Unhandled error."+(ee?" ("+ee.message+")":""));throw ne.context=ee,ne}var ve=B[A];if(ve===void 0)return!1;if(typeof ve=="function")e(ve,this,V);else for(var Pe=ve.length,je=P(ve,Pe),$=0;$<Pe;++$)e(je[$],this,V);return!0};function f(I,A,V,$){var Y,B,ee;if(u(V),B=I._events,B===void 0?(B=I._events=Object.create(null),I._eventsCount=0):(B.newListener!==void 0&&(I.emit("newListener",A,V.listener?V.listener:V),B=I._events),ee=B[A]),ee===void 0)ee=B[A]=V,++I._eventsCount;else if(typeof ee=="function"?ee=B[A]=$?[V,ee]:[ee,V]:$?ee.unshift(V):ee.push(V),Y=h(I),Y>0&&ee.length>Y&&!ee.warned){ee.warned=!0;var ne=new Error("Possible EventEmitter memory leak detected. "+ee.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");ne.name="MaxListenersExceededWarning",ne.emitter=I,ne.type=A,ne.count=ee.length,r(ne)}return I}l.prototype.addListener=function(A,V){return f(this,A,V,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(A,V){return f(this,A,V,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(I,A,V){var $={fired:!1,wrapFn:void 0,target:I,type:A,listener:V},Y=m.bind($);return Y.listener=V,$.wrapFn=Y,Y}l.prototype.once=function(A,V){return u(V),this.on(A,v(this,A,V)),this},l.prototype.prependOnceListener=function(A,V){return u(V),this.prependListener(A,v(this,A,V)),this},l.prototype.removeListener=function(A,V){var $,Y,B,ee,ne;if(u(V),Y=this._events,Y===void 0)return this;if($=Y[A],$===void 0)return this;if($===V||$.listener===V)--this._eventsCount===0?this._events=Object.create(null):(delete Y[A],Y.removeListener&&this.emit("removeListener",A,$.listener||V));else if(typeof $!="function"){for(B=-1,ee=$.length-1;ee>=0;ee--)if($[ee]===V||$[ee].listener===V){ne=$[ee].listener,B=ee;break}if(B<0)return this;B===0?$.shift():w($,B),$.length===1&&(Y[A]=$[0]),Y.removeListener!==void 0&&this.emit("removeListener",A,ne||V)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(A){var V,$,Y;if($=this._events,$===void 0)return this;if($.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):$[A]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete $[A]),this;if(arguments.length===0){var B=Object.keys($),ee;for(Y=0;Y<B.length;++Y)ee=B[Y],ee!=="removeListener"&&this.removeAllListeners(ee);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(V=$[A],typeof V=="function")this.removeListener(A,V);else if(V!==void 0)for(Y=V.length-1;Y>=0;Y--)this.removeListener(A,V[Y]);return this};function k(I,A,V){var $=I._events;if($===void 0)return[];var Y=$[A];return Y===void 0?[]:typeof Y=="function"?V?[Y.listener||Y]:[Y]:V?_(Y):P(Y,Y.length)}l.prototype.listeners=function(A){return k(this,A,!0)},l.prototype.rawListeners=function(A){return k(this,A,!1)},l.listenerCount=function(I,A){return typeof I.listenerCount=="function"?I.listenerCount(A):b.call(I,A)},l.prototype.listenerCount=b;function b(I){var A=this._events;if(A!==void 0){var V=A[I];if(typeof V=="function")return 1;if(V!==void 0)return V.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function P(I,A){for(var V=new Array(A),$=0;$<A;++$)V[$]=I[$];return V}function w(I,A){for(;A+1<I.length;A++)I[A]=I[A+1];I.pop()}function _(I){for(var A=new Array(I.length),V=0;V<A.length;++V)A[V]=I[V].listener||I[V];return A}function M(I,A){return new Promise(function(V,$){function Y(ee){I.removeListener(A,B),$(ee)}function B(){typeof I.removeListener=="function"&&I.removeListener("error",Y),V([].slice.call(arguments))}U(I,A,B,{once:!0}),A!=="error"&&z(I,Y,{once:!0})})}function z(I,A,V){typeof I.on=="function"&&U(I,"error",A,V)}function U(I,A,V,$){if(typeof I.on=="function")$.once?I.once(A,V):I.on(A,V);else if(typeof I.addEventListener=="function")I.addEventListener(A,function Y(B){$.once&&I.removeEventListener(A,Y),V(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}return na.exports}var On=Mb();let Rg=!0,_g=!0;function Is(i,e,t){const r=i.match(e);return r&&r.length>=t&&parseFloat(r[t],10)}function Ji(i,e,t){if(!i.RTCPeerConnection)return;const r=i.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(c,u){if(c!==e)return o.apply(this,arguments);const h=f=>{const m=t(f);m&&(u.handleEvent?u.handleEvent(m):u(m))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(u,h),o.apply(this,[c,h])};const l=r.removeEventListener;r.removeEventListener=function(c,u){if(c!==e||!this._eventMap||!this._eventMap[e])return l.apply(this,arguments);if(!this._eventMap[e].has(u))return l.apply(this,arguments);const h=this._eventMap[e].get(u);return this._eventMap[e].delete(u),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[c,h])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function Lb(i){return typeof i!="boolean"?new Error("Argument type: "+typeof i+". Please use a boolean."):(Rg=i,i?"adapter.js logging disabled":"adapter.js logging enabled")}function Ab(i){return typeof i!="boolean"?new Error("Argument type: "+typeof i+". Please use a boolean."):(_g=!i,"adapter.js deprecation warnings "+(i?"disabled":"enabled"))}function Ig(){if(typeof window=="object"){if(Rg)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function qu(i,e){_g&&console.warn(i+" is deprecated, please use "+e+" instead.")}function Ub(i){const e={browser:null,version:null};if(typeof i>"u"||!i.navigator||!i.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=i;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(o=>o.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Is(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||i.isSecureContext===!1&&i.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Is(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(i.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Is(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=i.RTCRtpTransceiver&&"currentDirection"in i.RTCRtpTransceiver.prototype,e._safariVersion=Is(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Np(i){return Object.prototype.toString.call(i)==="[object Object]"}function Ng(i){return Np(i)?Object.keys(i).reduce(function(e,t){const r=Np(i[t]),o=r?Ng(i[t]):i[t],l=r&&!Object.keys(o).length;return o===void 0||l?e:Object.assign(e,{[t]:o})},{}):i}function au(i,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?au(i,i.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(o=>{au(i,i.get(o),t)})}))}function Op(i,e,t){const r=t?"outbound-rtp":"inbound-rtp",o=new Map;if(e===null)return o;const l=[];return i.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&l.push(c)}),l.forEach(c=>{i.forEach(u=>{u.type===r&&u.trackId===c.id&&au(i,u,o)})}),o}const Dp=Ig;function Og(i,e){const t=i&&i.navigator;if(!t.mediaDevices)return;const r=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const h={};return Object.keys(u).forEach(f=>{if(f==="require"||f==="advanced"||f==="mediaSource")return;const m=typeof u[f]=="object"?u[f]:{ideal:u[f]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const v=function(k,b){return k?k+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(m.ideal!==void 0){h.optional=h.optional||[];let k={};typeof m.ideal=="number"?(k[v("min",f)]=m.ideal,h.optional.push(k),k={},k[v("max",f)]=m.ideal,h.optional.push(k)):(k[v("",f)]=m.ideal,h.optional.push(k))}m.exact!==void 0&&typeof m.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[v("",f)]=m.exact):["min","max"].forEach(k=>{m[k]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[v(k,f)]=m[k])})}),u.advanced&&(h.optional=(h.optional||[]).concat(u.advanced)),h},o=function(u,h){if(e.version>=61)return h(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const f=function(m,v,k){v in m&&!(k in m)&&(m[k]=m[v],delete m[v])};u=JSON.parse(JSON.stringify(u)),f(u.audio,"autoGainControl","googAutoGainControl"),f(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=r(u.audio)}if(u&&typeof u.video=="object"){let f=u.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});const m=e.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete u.video.facingMode;let v;if(f.exact==="environment"||f.ideal==="environment"?v=["back","rear"]:(f.exact==="user"||f.ideal==="user")&&(v=["front"]),v)return t.mediaDevices.enumerateDevices().then(k=>{k=k.filter(P=>P.kind==="videoinput");let b=k.find(P=>v.some(w=>P.label.toLowerCase().includes(w)));return!b&&k.length&&v.includes("back")&&(b=k[k.length-1]),b&&(u.video.deviceId=f.exact?{exact:b.deviceId}:{ideal:b.deviceId}),u.video=r(u.video),Dp("chrome: "+JSON.stringify(u)),h(u)})}u.video=r(u.video)}return Dp("chrome: "+JSON.stringify(u)),h(u)},l=function(u){return e.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(u,h,f){o(u,m=>{t.webkitGetUserMedia(m,h,v=>{f&&f(l(v))})})};if(t.getUserMedia=c.bind(t),t.mediaDevices.getUserMedia){const u=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(h){return o(h,f=>u(f).then(m=>{if(f.audio&&!m.getAudioTracks().length||f.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return m},m=>Promise.reject(l(m))))}}}function Dg(i){i.MediaStream=i.MediaStream||i.webkitMediaStream}function Mg(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("ontrack"in i.RTCPeerConnection.prototype)){Object.defineProperty(i.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",o=>{let l;i.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===o.track.id):l={track:o.track};const c=new Event("track");c.track=o.track,c.receiver=l,c.transceiver={receiver:l},c.streams=[r.stream],this.dispatchEvent(c)}),r.stream.getTracks().forEach(o=>{let l;i.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===o.id):l={track:o};const c=new Event("track");c.track=o,c.receiver=l,c.transceiver={receiver:l},c.streams=[r.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Ji(i,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Lg(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("getSenders"in i.RTCPeerConnection.prototype)&&"createDTMFSender"in i.RTCPeerConnection.prototype){const e=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!i.RTCPeerConnection.prototype.getSenders){i.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(u,h){let f=o.apply(this,arguments);return f||(f=e(this,u),this._senders.push(f)),f};const l=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const h=this._senders.indexOf(u);h!==-1&&this._senders.splice(h,1)}}const t=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],t.apply(this,[l]),l.getTracks().forEach(c=>{this._senders.push(e(this,c))})};const r=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],r.apply(this,[l]),l.getTracks().forEach(c=>{const u=this._senders.find(h=>h.track===c);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof i=="object"&&i.RTCPeerConnection&&"getSenders"in i.RTCPeerConnection.prototype&&"createDTMFSender"in i.RTCPeerConnection.prototype&&i.RTCRtpSender&&!("dtmf"in i.RTCRtpSender.prototype)){const e=i.RTCPeerConnection.prototype.getSenders;i.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r},Object.defineProperty(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ag(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&i.RTCRtpReceiver))return;if(!("getStats"in i.RTCRtpSender.prototype)){const t=i.RTCPeerConnection.prototype.getSenders;t&&(i.RTCPeerConnection.prototype.getSenders=function(){const l=t.apply(this,[]);return l.forEach(c=>c._pc=this),l});const r=i.RTCPeerConnection.prototype.addTrack;r&&(i.RTCPeerConnection.prototype.addTrack=function(){const l=r.apply(this,arguments);return l._pc=this,l}),i.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(c=>Op(c,l.track,!0))}}if(!("getStats"in i.RTCRtpReceiver.prototype)){const t=i.RTCPeerConnection.prototype.getReceivers;t&&(i.RTCPeerConnection.prototype.getReceivers=function(){const o=t.apply(this,[]);return o.forEach(l=>l._pc=this),o}),Ji(i,"track",r=>(r.receiver._pc=r.srcElement,r)),i.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>Op(l,o.track,!1))}}if(!("getStats"in i.RTCRtpSender.prototype&&"getStats"in i.RTCRtpReceiver.prototype))return;const e=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof i.MediaStreamTrack){const r=arguments[0];let o,l,c;return this.getSenders().forEach(u=>{u.track===r&&(o?c=!0:o=u)}),this.getReceivers().forEach(u=>(u.track===r&&(l?c=!0:l=u),u.track===r)),c||o&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Ug(i){i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const e=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(c,u){if(!u)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=e.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(h)===-1&&this._shimmedLocalStreams[u.id].push(h):this._shimmedLocalStreams[u.id]=[u,h],h};const t=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(f=>{if(this.getSenders().find(v=>v.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();t.apply(this,arguments);const h=this.getSenders().filter(f=>u.indexOf(f)===-1);this._shimmedLocalStreams[c.id]=[c].concat(h)};const r=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],r.apply(this,arguments)};const o=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const h=this._shimmedLocalStreams[u].indexOf(c);h!==-1&&this._shimmedLocalStreams[u].splice(h,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),o.apply(this,arguments)}}function jg(i,e){if(!i.RTCPeerConnection)return;if(i.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Ug(i);const t=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){const m=t.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(v=>this._reverseStreams[v.id])};const r=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(v=>{if(this.getSenders().find(b=>b.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const v=new i.MediaStream(m.getTracks());this._streams[m.id]=v,this._reverseStreams[v.id]=m,m=v}r.apply(this,[m])};const o=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},i.RTCPeerConnection.prototype.addTrack=function(m,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const k=[].slice.call(arguments,1);if(k.length!==1||!k[0].getTracks().find(w=>w===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const w=new i.MediaStream([m]);this._streams[v.id]=w,this._reverseStreams[w.id]=v,this.addStream(w)}return this.getSenders().find(w=>w.track===m)};function l(f,m){let v=m.sdp;return Object.keys(f._reverseStreams||[]).forEach(k=>{const b=f._reverseStreams[k],P=f._streams[b.id];v=v.replace(new RegExp(P.id,"g"),b.id)}),new RTCSessionDescription({type:m.type,sdp:v})}function c(f,m){let v=m.sdp;return Object.keys(f._reverseStreams||[]).forEach(k=>{const b=f._reverseStreams[k],P=f._streams[b.id];v=v.replace(new RegExp(b.id,"g"),P.id)}),new RTCSessionDescription({type:m.type,sdp:v})}["createOffer","createAnswer"].forEach(function(f){const m=i.RTCPeerConnection.prototype[f],v={[f](){const k=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[P=>{const w=l(this,P);k[0].apply(null,[w])},P=>{k[1]&&k[1].apply(null,P)},arguments[2]]):m.apply(this,arguments).then(P=>l(this,P))}};i.RTCPeerConnection.prototype[f]=v[f]});const u=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=c(this,arguments[0]),u.apply(this,arguments))};const h=Object.getOwnPropertyDescriptor(i.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(i.RTCPeerConnection.prototype,"localDescription",{get(){const f=h.get.apply(this);return f.type===""?f:l(this,f)}}),i.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(m._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let k;Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(w=>m.track===w)&&(k=this._streams[b])}),k&&(k.getTracks().length===1?this.removeStream(this._reverseStreams[k.id]):k.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function lu(i,e){!i.RTCPeerConnection&&i.webkitRTCPeerConnection&&(i.RTCPeerConnection=i.webkitRTCPeerConnection),i.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=i.RTCPeerConnection.prototype[t],o={[t](){return arguments[0]=new(t==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};i.RTCPeerConnection.prototype[t]=o[t]})}function Fg(i,e){Ji(i,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}var Mp=Object.freeze({__proto__:null,fixNegotiationNeeded:Fg,shimAddTrackRemoveTrack:jg,shimAddTrackRemoveTrackWithNative:Ug,shimGetSendersWithDtmf:Lg,shimGetUserMedia:Og,shimMediaStream:Dg,shimOnTrack:Mg,shimPeerConnection:lu,shimSenderReceiverGetStats:Ag});function Bg(i,e){const t=i&&i.navigator,r=i&&i.MediaStreamTrack;if(t.getUserMedia=function(o,l,c){qu("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(o).then(l,c)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const o=function(c,u,h){u in c&&!(h in c)&&(c[h]=c[u],delete c[u])},l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),o(c.audio,"autoGainControl","mozAutoGainControl"),o(c.audio,"noiseSuppression","mozNoiseSuppression")),l(c)},r&&r.prototype.getSettings){const c=r.prototype.getSettings;r.prototype.getSettings=function(){const u=c.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(r&&r.prototype.applyConstraints){const c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[u])}}}}function jb(i,e){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,i.navigator.mediaDevices.getUserMedia(r)})}function Vg(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cu(i,e){if(typeof i!="object"||!(i.RTCPeerConnection||i.mozRTCPeerConnection))return;!i.RTCPeerConnection&&i.mozRTCPeerConnection&&(i.RTCPeerConnection=i.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=i.RTCPeerConnection.prototype[o],c={[o](){return arguments[0]=new(o==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};i.RTCPeerConnection.prototype[o]=c[o]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){const[l,c,u]=arguments;return r.apply(this,[l||null]).then(h=>{if(e.version<53&&!c)try{h.forEach(f=>{f.type=t[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;h.forEach((m,v)=>{h.set(v,Object.assign({},m,{type:t[m.type]||m.type}))})}return h}).then(c,u)}}function zg(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender)||i.RTCRtpSender&&"getStats"in i.RTCRtpSender.prototype)return;const e=i.RTCPeerConnection.prototype.getSenders;e&&(i.RTCPeerConnection.prototype.getSenders=function(){const o=e.apply(this,[]);return o.forEach(l=>l._pc=this),o});const t=i.RTCPeerConnection.prototype.addTrack;t&&(i.RTCPeerConnection.prototype.addTrack=function(){const o=t.apply(this,arguments);return o._pc=this,o}),i.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function qg(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender)||i.RTCRtpSender&&"getStats"in i.RTCRtpReceiver.prototype)return;const e=i.RTCPeerConnection.prototype.getReceivers;e&&(i.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Ji(i,"track",t=>(t.receiver._pc=t.srcElement,t)),i.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Wg(i){!i.RTCPeerConnection||"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(t){qu("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Hg(i){i.DataChannel&&!i.RTCDataChannel&&(i.RTCDataChannel=i.DataChannel)}function Kg(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.addTransceiver;e&&(i.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const o=r.length>0;o&&r.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=e.apply(this,arguments);if(o){const{sender:c}=l,u=c.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=r,c.sendEncodings=r,this.setParametersPromises.push(c.setParameters(u).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return l})}function Gg(i){if(!(typeof i=="object"&&i.RTCRtpSender))return;const e=i.RTCRtpSender.prototype.getParameters;e&&(i.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function $g(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Jg(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.createAnswer;i.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Lp=Object.freeze({__proto__:null,shimAddTransceiver:Kg,shimCreateAnswer:Jg,shimCreateOffer:$g,shimGetDisplayMedia:jb,shimGetParameters:Gg,shimGetUserMedia:Bg,shimOnTrack:Vg,shimPeerConnection:cu,shimRTCDataChannel:Hg,shimReceiverGetStats:qg,shimRemoveStream:Wg,shimSenderGetStats:zg});function Qg(i){if(!(typeof i!="object"||!i.RTCPeerConnection)){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){const e=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(o=>e.call(this,o,r)),r.getVideoTracks().forEach(o=>e.call(this,o,r))},i.RTCPeerConnection.prototype.addTrack=function(r){for(var o=arguments.length,l=new Array(o>1?o-1:0),c=1;c<o;c++)l[c-1]=arguments[c];return l&&l.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),e.apply(this,arguments)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const o=t.getTracks();this.getSenders().forEach(l=>{o.includes(l.track)&&this.removeTrack(l)})})}}function Yg(i){if(!(typeof i!="object"||!i.RTCPeerConnection)&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){Object.defineProperty(i.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(l=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(l)>=0)return;r._remoteStreams.push(l);const c=new Event("addstream");c.stream=l,r.dispatchEvent(c)})}),e.apply(r,arguments)}}}function Xg(i){if(typeof i!="object"||!i.RTCPeerConnection)return;const e=i.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,o=e.setLocalDescription,l=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(f,m){const v=arguments.length>=2?arguments[2]:arguments[0],k=t.apply(this,[v]);return m?(k.then(f,m),Promise.resolve()):k},e.createAnswer=function(f,m){const v=arguments.length>=2?arguments[2]:arguments[0],k=r.apply(this,[v]);return m?(k.then(f,m),Promise.resolve()):k};let u=function(h,f,m){const v=o.apply(this,[h]);return m?(v.then(f,m),Promise.resolve()):v};e.setLocalDescription=u,u=function(h,f,m){const v=l.apply(this,[h]);return m?(v.then(f,m),Promise.resolve()):v},e.setRemoteDescription=u,u=function(h,f,m){const v=c.apply(this,[h]);return m?(v.then(f,m),Promise.resolve()):v},e.addIceCandidate=u}function Zg(i){const e=i&&i.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=o=>r(ev(o))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,o,l){e.mediaDevices.getUserMedia(r).then(o,l)}).bind(e))}function ev(i){return i&&i.video!==void 0?Object.assign({},i,{video:Ng(i.video)}):i}function tv(i){if(!i.RTCPeerConnection)return;const e=i.RTCPeerConnection;i.RTCPeerConnection=function(r,o){if(r&&r.iceServers){const l=[];for(let c=0;c<r.iceServers.length;c++){let u=r.iceServers[c];u.urls===void 0&&u.url?(qu("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,l.push(u)):l.push(r.iceServers[c])}r.iceServers=l}return new e(r,o)},i.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function nv(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function iv(i){const e=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const o=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const l=this.getTransceivers().find(c=>c.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):r.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function rv(i){typeof i!="object"||i.AudioContext||(i.AudioContext=i.webkitAudioContext)}var Ap=Object.freeze({__proto__:null,shimAudioContext:rv,shimCallbacksAPI:Xg,shimConstraints:ev,shimCreateOfferLegacy:iv,shimGetUserMedia:Zg,shimLocalStreamsAPI:Qg,shimRTCIceServerUrls:tv,shimRemoteStreamsAPI:Yg,shimTrackEventTransceiver:nv}),Dc={exports:{}},Up;function Fb(){return Up||(Up=1,(function(i){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((o,l)=>(l>0?"m="+o:o).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(o=>o.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let l=8;l<r.length;l+=2)switch(r[l]){case"raddr":o.relatedAddress=r[l+1];break;case"rport":o.relatedPort=parseInt(r[l+1],10);break;case"tcptype":o.tcpType=r[l+1];break;case"ufrag":o.ufrag=r[l+1],o.usernameFragment=r[l+1];break;default:o[r[l]]===void 0&&(o[r[l]]=r[l+1]);break}return o},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const o=t.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const l=t.type;return r.push("typ"),r.push(l),l!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const o=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(o!==1?"/"+o:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let o;const l=t.substring(t.indexOf(" ")+1).split(";");for(let c=0;c<l.length;c++)o=l[c].trim().split("="),r[o[0].trim()]=o[1];return r},e.writeFmtp=function(t){let r="",o=t.payloadType;if(t.preferredPayloadType!==void 0&&(o=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const l=[];Object.keys(t.parameters).forEach(c=>{t.parameters[c]!==void 0?l.push(c+"="+t.parameters[c]):l.push(c)}),r+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",o=t.payloadType;return t.preferredPayloadType!==void 0&&(o=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(l=>{r+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),o={ssrc:parseInt(t.substring(7,r),10)},l=t.indexOf(":",r);return l>-1?(o.attribute=t.substring(r+1,l),o.value=t.substring(l+1)):o.attribute=t.substring(r+1),o},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let o="a=setup:"+r+`\r
`;return t.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const o=e.matchPrefix(t+r,"a=ice-ufrag:")[0],l=e.matchPrefix(t+r,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=e.splitLines(t)[0].split(" ");r.profile=l[2];for(let u=3;u<l.length;u++){const h=l[u],f=e.matchPrefix(t,"a=rtpmap:"+h+" ")[0];if(f){const m=e.parseRtpMap(f),v=e.matchPrefix(t,"a=fmtp:"+h+" ");switch(m.parameters=v.length?e.parseFmtp(v[0]):{},m.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+h+" ").map(e.parseRtcpFb),r.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(m.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(u=>{r.headerExtensions.push(e.parseExtmap(u))});const c=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(u=>{c.forEach(h=>{u.rtcpFeedback.find(m=>m.type===h.type&&m.parameter===h.parameter)||u.rtcpFeedback.push(h)})}),r},e.writeRtpDescription=function(t,r){let o="";o+="m="+t+" ",o+=r.codecs.length>0?"9":"0",o+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{o+=e.writeRtpMap(c),o+=e.writeFmtp(c),o+=e.writeRtcpFb(c)});let l=0;return r.codecs.forEach(c=>{c.maxptime>l&&(l=c.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{o+=e.writeExtmap(c)}),o},e.parseRtpEncodingParameters=function(t){const r=[],o=e.parseRtpParameters(t),l=o.fecMechanisms.indexOf("RED")!==-1,c=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=e.matchPrefix(t,"a=ssrc:").map(k=>e.parseSsrcMedia(k)).filter(k=>k.attribute==="cname"),h=u.length>0&&u[0].ssrc;let f;const m=e.matchPrefix(t,"a=ssrc-group:FID").map(k=>k.substring(17).split(" ").map(P=>parseInt(P,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(f=m[0][1]),o.codecs.forEach(k=>{if(k.name.toUpperCase()==="RTX"&&k.parameters.apt){let b={ssrc:h,codecPayloadType:parseInt(k.parameters.apt,10)};h&&f&&(b.rtx={ssrc:f}),r.push(b),l&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:h,mechanism:c?"red+ulpfec":"red"},r.push(b))}}),r.length===0&&h&&r.push({ssrc:h});let v=e.matchPrefix(t,"b=");return v.length&&(v[0].indexOf("b=TIAS:")===0?v=parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?v=parseInt(v[0].substring(5),10)*1e3*.95-2e3*8:v=void 0,r.forEach(k=>{k.maxBitrate=v})),r},e.parseRtcpParameters=function(t){const r={},o=e.matchPrefix(t,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);const l=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=l.length>0,r.compound=l.length===0;const c=e.matchPrefix(t,"a=rtcp-mux");return r.mux=c.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const o=e.matchPrefix(t,"a=msid:");if(o.length===1)return r=o[0].substring(7).split(" "),{stream:r[0],track:r[1]};const l=e.matchPrefix(t,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(l.length>0)return r=l[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),o=e.matchPrefix(t,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const c=e.matchPrefix(t,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:l};const u=e.matchPrefix(t,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:l}}},e.writeSctpDescription=function(t,r){let o=[];return t.protocol!=="DTLS/SCTP"?o=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:o=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,o){let l;const c=r!==void 0?r:2;return t?l=t:l=e.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const o=e.splitLines(t);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const o=e.splitLines(t)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},e.parseOLine=function(t){const o=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},i.exports=e})(Dc)),Dc.exports}var sv=Fb(),Rr=Pb(sv),Bb=Zk({__proto__:null,default:Rr},[sv]);function ua(i){if(!i.RTCIceCandidate||i.RTCIceCandidate&&"foundation"in i.RTCIceCandidate.prototype)return;const e=i.RTCIceCandidate;i.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const o=new e(r),l=Rr.parseCandidate(r.candidate);for(const c in l)c in o||Object.defineProperty(o,c,{value:l[c]});return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(r)},i.RTCIceCandidate.prototype=e.prototype,Ji(i,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new i.RTCIceCandidate(t.candidate),writable:"false"}),t))}function uu(i){!i.RTCIceCandidate||i.RTCIceCandidate&&"relayProtocol"in i.RTCIceCandidate.prototype||Ji(i,"icecandidate",e=>{if(e.candidate){const t=Rr.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function da(i,e){if(!i.RTCPeerConnection)return;"sctp"in i.RTCPeerConnection.prototype||Object.defineProperty(i.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(u){if(!u||!u.sdp)return!1;const h=Rr.splitSections(u.sdp);return h.shift(),h.some(f=>{const m=Rr.parseMLine(f);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},r=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!==f?-1:f},o=function(u){let h=65536;return e.browser==="firefox"&&(e.version<57?u===-1?h=16384:h=2147483637:e.version<60?h=e.version===57?65535:65536:h=2147483637),h},l=function(u,h){let f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);const m=Rr.matchPrefix(u.sdp,"a=max-message-size:");return m.length>0?f=parseInt(m[0].substring(19),10):e.browser==="firefox"&&h!==-1&&(f=2147483637),f},c=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const h=r(arguments[0]),f=o(h),m=l(arguments[0],h);let v;f===0&&m===0?v=Number.POSITIVE_INFINITY:f===0||m===0?v=Math.max(f,m):v=Math.min(f,m);const k={};Object.defineProperty(k,"maxMessageSize",{get(){return v}}),this._sctp=k}return c.apply(this,arguments)}}function ha(i){if(!(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype))return;function e(r,o){const l=r.send;r.send=function(){const u=arguments[0],h=u.length||u.size||u.byteLength;if(r.readyState==="open"&&o.sctp&&h>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(r,arguments)}}const t=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){const o=t.apply(this,arguments);return e(o,this),o},Ji(i,"datachannel",r=>(e(r.channel,r.target),r))}function du(i){if(!i.RTCPeerConnection||"connectionState"in i.RTCPeerConnection.prototype)return;const e=i.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const c=new Event("connectionstatechange",o);l.dispatchEvent(c)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function hu(i,e){if(!i.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=o.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);i.RTCSessionDescription&&o instanceof i.RTCSessionDescription?arguments[0]=new i.RTCSessionDescription({type:o.type,sdp:l}):o.sdp=l}return t.apply(this,arguments)}}function fa(i,e){if(!(i.RTCPeerConnection&&i.RTCPeerConnection.prototype))return;const t=i.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function pa(i,e){if(!(i.RTCPeerConnection&&i.RTCPeerConnection.prototype))return;const t=i.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(i.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return t.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?t.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>t.apply(this,[c]))})}var Vb=Object.freeze({__proto__:null,removeExtmapAllowMixed:hu,shimAddIceCandidateNullOrEmpty:fa,shimConnectionState:du,shimMaxMessageSize:da,shimParameterlessSetLocalDescription:pa,shimRTCIceCandidate:ua,shimRTCIceCandidateRelayProtocol:uu,shimSendThrowTypeError:ha});function zb(){let{window:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=Ig,r=Ub(i),o={browserDetails:r,commonShim:Vb,extractVersion:Is,disableLog:Lb,disableWarnings:Ab,sdp:Bb};switch(r.browser){case"chrome":if(!Mp||!lu||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),o;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),o;t("adapter.js shimming chrome."),o.browserShim=Mp,fa(i,r),pa(i),Og(i,r),Dg(i),lu(i,r),Mg(i),jg(i,r),Lg(i),Ag(i),Fg(i,r),ua(i),uu(i),du(i),da(i,r),ha(i),hu(i,r);break;case"firefox":if(!Lp||!cu||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),o;t("adapter.js shimming firefox."),o.browserShim=Lp,fa(i,r),pa(i),Bg(i,r),cu(i,r),Vg(i),Wg(i),zg(i),qg(i),Hg(i),Kg(i),Gg(i),$g(i),Jg(i),ua(i),du(i),da(i,r),ha(i);break;case"safari":if(!Ap||!e.shimSafari)return t("Safari shim is not included in this adapter release."),o;t("adapter.js shimming safari."),o.browserShim=Ap,fa(i,r),pa(i),tv(i),iv(i),Xg(i),Qg(i),Yg(i),nv(i),Zg(i),rv(i),ua(i),uu(i),da(i,r),ha(i),hu(i,r);break;default:t("Unsupported browser!");break}return o}zb({window:typeof window>"u"?void 0:window});const qb=10,Cs="lk_e2ee",Wb="LKFrameEncryptionKey",Hb={sharedKey:!1,ratchetSalt:Wb,ratchetWindowSize:8,failureTolerance:qb,keyringSize:16};var Ti;(function(i){i.SetKey="setKey",i.RatchetRequest="ratchetRequest",i.KeyRatcheted="keyRatcheted"})(Ti||(Ti={}));var jp;(function(i){i.KeyRatcheted="keyRatcheted"})(jp||(jp={}));var bi;(function(i){i.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",i.EncryptionError="encryptionError"})(bi||(bi={}));var Fp;(function(i){i.Error="cryptorError"})(Fp||(Fp={}));function Kb(){return Gb()||fu()}function fu(){return typeof window.RTCRtpScriptTransform<"u"}function Gb(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class ew extends On.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,r,o)=>{_e.debug("key ratcheted event received",{ratchetResult:t,participantId:r,keyIndex:o})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Hb),e),this.on(Ti.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,r){const o={key:e,participantIdentity:t,keyIndex:r};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(r??0),o),this.emit(Ti.SetKey,o)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(Ti.RatchetRequest,e,t)}}class Jn extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var Oe;(function(i){i[i.NotAllowed=0]="NotAllowed",i[i.ServerUnreachable=1]="ServerUnreachable",i[i.InternalError=2]="InternalError",i[i.Cancelled=3]="Cancelled",i[i.LeaveRequest=4]="LeaveRequest",i[i.Timeout=5]="Timeout"})(Oe||(Oe={}));class Be extends Jn{constructor(e,t,r,o){super(1,e),this.name="ConnectionError",this.status=r,this.reason=t,this.context=o,this.reasonName=Oe[t]}}class Wu extends Jn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Gn extends Jn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class $b extends Jn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class dt extends Jn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class pu extends Jn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Bp extends Jn{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class Vp extends Jn{constructor(e,t){super(15,e),this.reason=t,this.reasonName=typeof t=="string"?t:zu[t]}}var mn;(function(i){i[i.AlreadyOpened=0]="AlreadyOpened",i[i.AbnormalEnd=1]="AbnormalEnd",i[i.DecodeFailed=2]="DecodeFailed",i[i.LengthExceeded=3]="LengthExceeded",i[i.Incomplete=4]="Incomplete",i[i.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered"})(mn||(mn={}));class yi extends Jn{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=mn[t]}}var Sa;(function(i){i.PermissionDenied="PermissionDenied",i.NotFound="NotFound",i.DeviceInUse="DeviceInUse",i.Other="Other"})(Sa||(Sa={}));(function(i){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?i.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?i.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?i.DeviceInUse:i.Other}i.getFailure=e})(Sa||(Sa={}));var zp;(function(i){i[i.InvalidKey=0]="InvalidKey",i[i.MissingKey=1]="MissingKey",i[i.InternalError=2]="InternalError"})(zp||(zp={}));var Q;(function(i){i.Connected="connected",i.Reconnecting="reconnecting",i.SignalReconnecting="signalReconnecting",i.Reconnected="reconnected",i.Disconnected="disconnected",i.ConnectionStateChanged="connectionStateChanged",i.Moved="moved",i.MediaDevicesChanged="mediaDevicesChanged",i.ParticipantConnected="participantConnected",i.ParticipantDisconnected="participantDisconnected",i.TrackPublished="trackPublished",i.TrackSubscribed="trackSubscribed",i.TrackSubscriptionFailed="trackSubscriptionFailed",i.TrackUnpublished="trackUnpublished",i.TrackUnsubscribed="trackUnsubscribed",i.TrackMuted="trackMuted",i.TrackUnmuted="trackUnmuted",i.LocalTrackPublished="localTrackPublished",i.LocalTrackUnpublished="localTrackUnpublished",i.LocalAudioSilenceDetected="localAudioSilenceDetected",i.ActiveSpeakersChanged="activeSpeakersChanged",i.ParticipantMetadataChanged="participantMetadataChanged",i.ParticipantNameChanged="participantNameChanged",i.ParticipantAttributesChanged="participantAttributesChanged",i.ParticipantActive="participantActive",i.RoomMetadataChanged="roomMetadataChanged",i.DataReceived="dataReceived",i.SipDTMFReceived="sipDTMFReceived",i.TranscriptionReceived="transcriptionReceived",i.ConnectionQualityChanged="connectionQualityChanged",i.TrackStreamStateChanged="trackStreamStateChanged",i.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",i.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",i.AudioPlaybackStatusChanged="audioPlaybackChanged",i.VideoPlaybackStatusChanged="videoPlaybackChanged",i.MediaDevicesError="mediaDevicesError",i.ParticipantPermissionsChanged="participantPermissionsChanged",i.SignalConnected="signalConnected",i.RecordingStatusChanged="recordingStatusChanged",i.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",i.EncryptionError="encryptionError",i.DCBufferStatusChanged="dcBufferStatusChanged",i.ActiveDeviceChanged="activeDeviceChanged",i.ChatMessage="chatMessage",i.LocalTrackSubscribed="localTrackSubscribed",i.MetricsReceived="metricsReceived"})(Q||(Q={}));var ae;(function(i){i.TrackPublished="trackPublished",i.TrackSubscribed="trackSubscribed",i.TrackSubscriptionFailed="trackSubscriptionFailed",i.TrackUnpublished="trackUnpublished",i.TrackUnsubscribed="trackUnsubscribed",i.TrackMuted="trackMuted",i.TrackUnmuted="trackUnmuted",i.LocalTrackPublished="localTrackPublished",i.LocalTrackUnpublished="localTrackUnpublished",i.LocalTrackCpuConstrained="localTrackCpuConstrained",i.LocalSenderCreated="localSenderCreated",i.ParticipantMetadataChanged="participantMetadataChanged",i.ParticipantNameChanged="participantNameChanged",i.DataReceived="dataReceived",i.SipDTMFReceived="sipDTMFReceived",i.TranscriptionReceived="transcriptionReceived",i.IsSpeakingChanged="isSpeakingChanged",i.ConnectionQualityChanged="connectionQualityChanged",i.TrackStreamStateChanged="trackStreamStateChanged",i.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",i.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",i.TrackCpuConstrained="trackCpuConstrained",i.MediaDevicesError="mediaDevicesError",i.AudioStreamAcquired="audioStreamAcquired",i.ParticipantPermissionsChanged="participantPermissionsChanged",i.PCTrackAdded="pcTrackAdded",i.AttributesChanged="attributesChanged",i.LocalTrackSubscribed="localTrackSubscribed",i.ChatMessage="chatMessage",i.Active="active"})(ae||(ae={}));var oe;(function(i){i.TransportsCreated="transportsCreated",i.Connected="connected",i.Disconnected="disconnected",i.Resuming="resuming",i.Resumed="resumed",i.Restarting="restarting",i.Restarted="restarted",i.SignalResumed="signalResumed",i.SignalRestarted="signalRestarted",i.Closing="closing",i.MediaTrackAdded="mediaTrackAdded",i.ActiveSpeakersUpdate="activeSpeakersUpdate",i.DataPacketReceived="dataPacketReceived",i.RTPVideoMapUpdate="rtpVideoMapUpdate",i.DCBufferStatusChanged="dcBufferStatusChanged",i.ParticipantUpdate="participantUpdate",i.RoomUpdate="roomUpdate",i.SpeakersChanged="speakersChanged",i.StreamStateChanged="streamStateChanged",i.ConnectionQualityUpdate="connectionQualityUpdate",i.SubscriptionError="subscriptionError",i.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",i.RemoteMute="remoteMute",i.SubscribedQualityUpdate="subscribedQualityUpdate",i.LocalTrackUnpublished="localTrackUnpublished",i.LocalTrackSubscribed="localTrackSubscribed",i.Offline="offline",i.SignalRequestResponse="signalRequestResponse",i.SignalConnected="signalConnected",i.RoomMoved="roomMoved"})(oe||(oe={}));var Z;(function(i){i.Message="message",i.Muted="muted",i.Unmuted="unmuted",i.Restarted="restarted",i.Ended="ended",i.Subscribed="subscribed",i.Unsubscribed="unsubscribed",i.CpuConstrained="cpuConstrained",i.UpdateSettings="updateSettings",i.UpdateSubscription="updateSubscription",i.AudioPlaybackStarted="audioPlaybackStarted",i.AudioPlaybackFailed="audioPlaybackFailed",i.AudioSilenceDetected="audioSilenceDetected",i.VisibilityChanged="visibilityChanged",i.VideoDimensionsChanged="videoDimensionsChanged",i.VideoPlaybackStarted="videoPlaybackStarted",i.VideoPlaybackFailed="videoPlaybackFailed",i.ElementAttached="elementAttached",i.ElementDetached="elementDetached",i.UpstreamPaused="upstreamPaused",i.UpstreamResumed="upstreamResumed",i.SubscriptionPermissionChanged="subscriptionPermissionChanged",i.SubscriptionStatusChanged="subscriptionStatusChanged",i.SubscriptionFailed="subscriptionFailed",i.TrackProcessorUpdate="trackProcessorUpdate",i.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",i.TranscriptionReceived="transcriptionReceived",i.TimeSyncUpdate="timeSyncUpdate",i.PreConnectBufferFlushed="preConnectBufferFlushed"})(Z||(Z={}));function Jb(i){return typeof i>"u"?i:typeof structuredClone=="function"?typeof i=="object"&&i!==null?structuredClone(Object.assign({},i)):structuredClone(i):JSON.parse(JSON.stringify(i))}const Qb=/version\/(\d+(\.?_?\d+)+)/i;let Mc;function Kt(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const t=navigator.userAgent.toLowerCase();if(Mc===void 0||e){const r=Yb.find(o=>{let{test:l}=o;return l.test(t)});Mc=r==null?void 0:r.describe(t)}return Mc}const Yb=[{test:/firefox|iceweasel|fxios/i,describe(i){return{name:"Firefox",version:ma(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,i),os:i.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Lc(i)}}},{test:/chrom|crios|crmo/i,describe(i){return{name:"Chrome",version:ma(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,i),os:i.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Lc(i)}}},{test:/safari|applewebkit/i,describe(i){return{name:"Safari",version:ma(Qb,i),os:i.includes("mobile/")?"iOS":"macOS",osVersion:Lc(i)}}}];function ma(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(i);return r&&r.length>=t&&r[t]||""}function Lc(i){return i.includes("mac os")?ma(/\(.+?(\d+_\d+(:?_\d+)?)/,i,1).replace(/_/g,"."):void 0}var Xb="2.15.7";const Zb=Xb,eT=16;class kt{}kt.setTimeout=function(){return setTimeout(...arguments)};kt.setInterval=function(){return setInterval(...arguments)};kt.clearTimeout=function(){return clearTimeout(...arguments)};kt.clearInterval=function(){return clearInterval(...arguments)};const tT=5e3,ws=[];var Ht;(function(i){i[i.LOW=0]="LOW",i[i.MEDIUM=1]="MEDIUM",i[i.HIGH=2]="HIGH"})(Ht||(Ht={}));class q extends On.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var o;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=q.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=_e,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),tT):this.handleAppVisibilityChanged()},this.log=$n((o=r.loggerName)!==null&&o!==void 0?o:vn.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=q.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ee(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===q.Kind.Video&&(t="video"),this.attachedElements.length===0&&this.kind===q.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(ws.forEach(l=>{l.parentElement===null&&!e&&(e=l)}),e&&ws.splice(ws.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),xr(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),o=r.some(l=>l.kind==="audio");return e.play().then(()=>{this.emit(o?Z.AudioPlaybackStarted:Z.VideoPlaybackStarted)}).catch(l=>{l.name==="NotAllowedError"?this.emit(o?Z.AudioPlaybackFailed:Z.VideoPlaybackFailed,l):l.name==="AbortError"?_e.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):_e.warn("could not playback ".concat(o?"audio":"video"),l),o&&e&&r.some(c=>c.kind==="video")&&l.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Z.ElementAttached,e),e}detach(e){try{if(e){_r(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(Z.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(r=>{_r(this.mediaStreamTrack,r),t.push(r),this.recycleElement(r),this.emit(Z.ElementDetached,r)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=$n(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),ws.forEach(r=>{r.parentElement||(t=!1)}),t&&ws.push(e)}}handleAppVisibilityChanged(){return C(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===q.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Lt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Lt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function xr(i,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let r;i.kind==="audio"?r=t.getAudioTracks():r=t.getVideoTracks(),r.includes(i)||(r.forEach(o=>{t.removeTrack(o)}),t.addTrack(i)),(!Ki()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(Ki()||Hi())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function _r(i,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(i),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(i){let e;(function(f){f.Audio="audio",f.Video="video",f.Unknown="unknown"})(e=i.Kind||(i.Kind={}));let t;(function(f){f.Camera="camera",f.Microphone="microphone",f.ScreenShare="screen_share",f.ScreenShareAudio="screen_share_audio",f.Unknown="unknown"})(t=i.Source||(i.Source={}));let r;(function(f){f.Active="active",f.Paused="paused",f.Unknown="unknown"})(r=i.StreamState||(i.StreamState={}));function o(f){switch(f){case e.Audio:return fn.AUDIO;case e.Video:return fn.VIDEO;default:return fn.DATA}}i.kindToProto=o;function l(f){switch(f){case fn.AUDIO:return e.Audio;case fn.VIDEO:return e.Video;default:return e.Unknown}}i.kindFromProto=l;function c(f){switch(f){case t.Camera:return at.CAMERA;case t.Microphone:return at.MICROPHONE;case t.ScreenShare:return at.SCREEN_SHARE;case t.ScreenShareAudio:return at.SCREEN_SHARE_AUDIO;default:return at.UNKNOWN}}i.sourceToProto=c;function u(f){switch(f){case at.CAMERA:return t.Camera;case at.MICROPHONE:return t.Microphone;case at.SCREEN_SHARE:return t.ScreenShare;case at.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}i.sourceFromProto=u;function h(f){switch(f){case iu.ACTIVE:return r.Active;case iu.PAUSED:return r.Paused;default:return r.Unknown}}i.streamStateFromProto=h})(q||(q={}));class Fe{constructor(e,t,r,o,l){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(t!==void 0&&r!==void 0)this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:r,maxFramerate:o,priority:l};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const nT=["vp8","h264"],iT=["vp8","h264","vp9","av1","h265"];function rT(i){return!!nT.find(e=>e===i)}var qp;(function(i){i[i.PREFER_REGRESSION=0]="PREFER_REGRESSION",i[i.SIMULCAST=1]="SIMULCAST",i[i.REGRESSION=2]="REGRESSION"})(qp||(qp={}));var mu;(function(i){i.telephone={maxBitrate:12e3},i.speech={maxBitrate:24e3},i.music={maxBitrate:48e3},i.musicStereo={maxBitrate:64e3},i.musicHighQuality={maxBitrate:96e3},i.musicHighQualityStereo={maxBitrate:128e3}})(mu||(mu={}));const Fs={h90:new Fe(160,90,9e4,20),h180:new Fe(320,180,16e4,20),h216:new Fe(384,216,18e4,20),h360:new Fe(640,360,45e4,20),h540:new Fe(960,540,8e5,25),h720:new Fe(1280,720,17e5,30),h1080:new Fe(1920,1080,3e6,30),h1440:new Fe(2560,1440,5e6,30),h2160:new Fe(3840,2160,8e6,30)},gu={h120:new Fe(160,120,7e4,20),h180:new Fe(240,180,125e3,20),h240:new Fe(320,240,14e4,20),h360:new Fe(480,360,33e4,20),h480:new Fe(640,480,5e5,20),h540:new Fe(720,540,6e5,25),h720:new Fe(960,720,13e5,30),h1080:new Fe(1440,1080,23e5,30),h1440:new Fe(1920,1440,38e5,30)},Hu={h360fps3:new Fe(640,360,2e5,3,"medium"),h360fps15:new Fe(640,360,4e5,15,"medium"),h720fps5:new Fe(1280,720,8e5,5,"medium"),h720fps15:new Fe(1280,720,15e5,15,"medium"),h720fps30:new Fe(1280,720,2e6,30,"medium"),h1080fps15:new Fe(1920,1080,25e5,15,"medium"),h1080fps30:new Fe(1920,1080,5e6,30,"medium"),original:new Fe(0,0,7e6,30,"medium")},sT="|",Wp="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function oT(i){const e=i.split(sT);return e.length>1?[e[0],i.substr(e[0].length+1)]:[i,""]}function Ut(i){return C(this,void 0,void 0,function*(){return new Promise(e=>kt.setTimeout(e,i))})}function vu(){return"addTransceiver"in RTCPeerConnection.prototype}function yu(){return"addTrack"in RTCPeerConnection.prototype}function aT(){if(!("getCapabilities"in RTCRtpSender)||Ki()||Hi())return!1;const i=RTCRtpSender.getCapabilities("video");let e=!1;if(i){for(const t of i.codecs)if(t.mimeType==="video/AV1"){e=!0;break}}return e}function lT(){if(!("getCapabilities"in RTCRtpSender)||Hi())return!1;if(Ki()){const t=Kt();if(t!=null&&t.version&&Nn(t.version,"16")<0||(t==null?void 0:t.os)==="iOS"&&(t!=null&&t.osVersion)&&Nn(t.osVersion,"16")<0)return!1}const i=RTCRtpSender.getCapabilities("video");let e=!1;if(i){for(const t of i.codecs)if(t.mimeType==="video/VP9"){e=!0;break}}return e}function Pn(i){return i==="av1"||i==="vp9"}function ku(i){return!document||Bs()?!1:(i||(i=document.createElement("audio")),"setSinkId"in i)}function cT(){return typeof RTCPeerConnection>"u"?!1:vu()||yu()}function Hi(){var i;return((i=Kt())===null||i===void 0?void 0:i.name)==="Firefox"}function Ki(){var i;return((i=Kt())===null||i===void 0?void 0:i.name)==="Safari"}function Bs(){const i=Kt();return(i==null?void 0:i.name)==="Safari"||(i==null?void 0:i.os)==="iOS"}function uT(){const i=Kt();return(i==null?void 0:i.name)==="Safari"&&i.version.startsWith("17.")||(i==null?void 0:i.os)==="iOS"&&!!(i!=null&&i.osVersion)&&Nn(i.osVersion,"17")>=0}function dT(i){return i||(i=Kt()),(i==null?void 0:i.name)==="Safari"&&Nn(i.version,"18.3")>0||(i==null?void 0:i.os)==="iOS"&&!!(i!=null&&i.osVersion)&&Nn(i.osVersion,"18.3")>0}function ov(){var i,e;return Lt()?(e=(i=navigator.userAgentData)===null||i===void 0?void 0:i.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function hT(){const i=Kt(),e="17.2";if(i)return i.name!=="Safari"&&i.os!=="iOS"||i.os==="iOS"&&i.osVersion&&Nn(i.osVersion,e)>=0?!0:i.name==="Safari"&&Nn(i.version,e)>=0}function Lt(){return typeof document<"u"}function In(){return navigator.product=="ReactNative"}function Su(i){return i.hostname.endsWith(".livekit.cloud")||i.hostname.endsWith(".livekit.run")}function av(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function lv(){if(!In())return;let i=av();if(i)return i.platform}function Hp(){if(Lt())return window.devicePixelRatio;if(In()){let i=av();if(i)return i.devicePixelRatio}return 1}function Nn(i,e){const t=i.split("."),r=e.split("."),o=Math.min(t.length,r.length);for(let l=0;l<o;++l){const c=parseInt(t[l],10),u=parseInt(r[l],10);if(c>u)return 1;if(c<u)return-1;if(l===o-1&&c===u)return 0}return i===""&&e!==""?-1:e===""?1:t.length==r.length?0:t.length<r.length?-1:1}function fT(i){for(const e of i)e.target.handleResize(e)}function pT(i){for(const e of i)e.target.handleVisibilityChanged(e)}let Ac=null;const Kp=()=>(Ac||(Ac=new ResizeObserver(fT)),Ac);let Uc=null;const Gp=()=>(Uc||(Uc=new IntersectionObserver(pT,{root:null,rootMargin:"0px"})),Uc);function mT(){var i;const e=new nb({sdk:hg.JS,protocol:eT,version:Zb});return In()&&(e.os=(i=lv())!==null&&i!==void 0?i:""),e}function $p(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=document.createElement("canvas");o.width=i,o.height=e;const l=o.getContext("2d");l==null||l.fillRect(0,0,o.width,o.height),r&&l&&(l.beginPath(),l.arc(i/2,e/2,50,0,Math.PI*2,!0),l.closePath(),l.fillStyle="grey",l.fill());const c=o.captureStream(),[u]=c.getTracks();if(!u)throw Error("Could not get empty media stream video track");return u.enabled=t,u}let xs;function jc(){if(!xs){const i=new AudioContext,e=i.createOscillator(),t=i.createGain();t.gain.setValueAtTime(0,0);const r=i.createMediaStreamDestination();if(e.connect(t),t.connect(r),e.start(),[xs]=r.stream.getAudioTracks(),!xs)throw Error("Could not get empty media stream audio track");xs.enabled=!1}return xs.clone()}class Rn{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((r,o)=>C(this,void 0,void 0,function*(){this.resolve=r,this.reject=o,e&&(yield e(r,o))})).finally(()=>{var r;this._isResolved=!0,(r=this.onFinally)===null||r===void 0||r.call(this)})}}function gT(i){return iT.includes(i)}function Ci(i){if(typeof i=="string"||typeof i=="number")return i;if(Array.isArray(i))return i[0];if(i.exact!==void 0)return Array.isArray(i.exact)?i.exact[0]:i.exact;if(i.ideal!==void 0)return Array.isArray(i.ideal)?i.ideal[0]:i.ideal;throw Error("could not unwrap constraint")}function vT(i){return i.startsWith("http")?i.replace(/^(http)/,"ws"):i}function bu(i){return i.startsWith("ws")?i.replace(/^(ws)/,"http"):i}function yT(i,e){return i.segments.map(t=>{let{id:r,text:o,language:l,startTime:c,endTime:u,final:h}=t;var f;const m=(f=e.get(r))!==null&&f!==void 0?f:Date.now(),v=Date.now();return h?e.delete(r):e.set(r,m),{id:r,text:o,startTime:Number.parseInt(c.toString()),endTime:Number.parseInt(u.toString()),final:h,language:l,firstReceivedTime:m,lastReceivedTime:v}})}function kT(i){const{id:e,timestamp:t,message:r,editTimestamp:o}=i;return{id:e,timestamp:Number.parseInt(t.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:r}}function Jp(i){switch(i.reason){case Oe.LeaveRequest:return i.context;case Oe.Cancelled:return gn.CLIENT_INITIATED;case Oe.NotAllowed:return gn.USER_REJECTED;case Oe.ServerUnreachable:return gn.JOIN_FAILURE;default:return gn.UNKNOWN_REASON}}function ga(i){return i!==void 0?Number(i):void 0}function Bi(i){return i!==void 0?BigInt(i):void 0}function Ir(i){return!!i&&!(i instanceof MediaStreamTrack)&&i.isLocal}function _n(i){return!!i&&i.kind==q.Kind.Audio}function xi(i){return!!i&&i.kind==q.Kind.Video}function gi(i){return Ir(i)&&xi(i)}function zn(i){return Ir(i)&&_n(i)}function Tu(i){return!!i&&!i.isLocal}function ST(i){return!!i&&!i.isLocal}function Fc(i){return Tu(i)&&xi(i)}function bT(i){return i.isLocal}function TT(i,e){const t=[];let r=new TextEncoder().encode(i);for(;r.length>e;){let o=e;for(;o>0;){const l=r[o];if(l!==void 0&&(l&192)!==128)break;o--}t.push(r.slice(0,o)),r=r.slice(o)}return r.length>0&&t.push(r),t}function cv(i,e,t){var r,o,l,c;const{optionsWithoutProcessor:u,audioProcessor:h,videoProcessor:f}=hv(i??{}),m=e==null?void 0:e.processor,v=t==null?void 0:t.processor,k=u??{};return k.audio===!0&&(k.audio={}),k.video===!0&&(k.video={}),k.audio&&(Cu(k.audio,e),(r=(l=k.audio).deviceId)!==null&&r!==void 0||(l.deviceId={ideal:"default"}),(h||m)&&(k.audio.processor=h??m)),k.video&&(Cu(k.video,t),(o=(c=k.video).deviceId)!==null&&o!==void 0||(c.deviceId={ideal:"default"}),(f||v)&&(k.video.processor=f??v)),k}function Cu(i,e){return Object.keys(e).forEach(t=>{i[t]===void 0&&(i[t]=e[t])}),i}function Ku(i){var e,t,r,o;const l={};if(i.video)if(typeof i.video=="object"){const c={},u=c,h=i.video;Object.keys(h).forEach(f=>{switch(f){case"resolution":Cu(u,h.resolution);break;default:u[f]=h[f]}}),l.video=c,(e=(r=l.video).deviceId)!==null&&e!==void 0||(r.deviceId={ideal:"default"})}else l.video=i.video?{deviceId:{ideal:"default"}}:!1;else l.video=!1;return i.audio?typeof i.audio=="object"?(l.audio=i.audio,(t=(o=l.audio).deviceId)!==null&&t!==void 0||(o.deviceId={ideal:"default"})):l.audio={deviceId:{ideal:"default"}}:l.audio=!1,l}function uv(i){return C(this,arguments,void 0,function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const r=dv();if(r){const o=r.createAnalyser();o.fftSize=2048;const l=o.frequencyBinCount,c=new Uint8Array(l);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(o),yield Ut(t),o.getByteTimeDomainData(c);const h=c.some(f=>f!==128&&f!==0);return r.close(),!h}return!1})()})}function dv(){var i;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const t=new e({latencyHint:"interactive"});if(t.state==="suspended"&&typeof window<"u"&&(!((i=window.document)===null||i===void 0)&&i.body)){const r=()=>C(this,void 0,void 0,function*(){var o;try{t.state==="suspended"&&(yield t.resume())}catch(l){console.warn("Error trying to auto-resume audio context",l)}(o=window.document.body)===null||o===void 0||o.removeEventListener("click",r)});window.document.body.addEventListener("click",r)}return t}}function CT(i){return i==="audioinput"?q.Source.Microphone:i==="videoinput"?q.Source.Camera:q.Source.Unknown}function wu(i){return i===q.Source.Microphone?"audioinput":i===q.Source.Camera?"videoinput":void 0}function wT(i){var e,t;let r=(e=i.video)!==null&&e!==void 0?e:!0;return i.resolution&&i.resolution.width>0&&i.resolution.height>0&&(r=typeof r=="boolean"?{}:r,Ki()?r=Object.assign(Object.assign({},r),{width:{max:i.resolution.width},height:{max:i.resolution.height},frameRate:i.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:i.resolution.width},height:{ideal:i.resolution.height},frameRate:i.resolution.frameRate})),{audio:(t=i.audio)!==null&&t!==void 0?t:!1,video:r,controller:i.controller,selfBrowserSurface:i.selfBrowserSurface,surfaceSwitching:i.surfaceSwitching,systemAudio:i.systemAudio,preferCurrentTab:i.preferCurrentTab}}function Ds(i){return i.split("/")[1].toLowerCase()}function xT(i){const e=[];return i.forEach(t=>{t.track!==void 0&&e.push(new Bu({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function Ee(i){return"mediaStreamTrack"in i?{trackID:i.sid,source:i.source,muted:i.isMuted,enabled:i.mediaStreamTrack.enabled,kind:i.kind,streamID:i.mediaStreamID,streamTrackID:i.mediaStreamTrack.id}:{trackID:i.trackSid,enabled:i.isEnabled,muted:i.isMuted,trackInfo:Object.assign({mimeType:i.mimeType,name:i.trackName,encrypted:i.isEncrypted,kind:i.kind,source:i.source},i.track?Ee(i.track):{})}}function ET(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function PT(i,e){var t;i===void 0&&(i={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(i)],o={};for(const l of r)i[l]!==e[l]&&(o[l]=(t=e[l])!==null&&t!==void 0?t:"");return o}function hv(i){const e=Object.assign({},i);let t,r;return typeof e.audio=="object"&&e.audio.processor&&(t=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:t,videoProcessor:r,optionsWithoutProcessor:Jb(e)}}function RT(i){switch(i){case at.CAMERA:return q.Source.Camera;case at.MICROPHONE:return q.Source.Microphone;case at.SCREEN_SHARE:return q.Source.ScreenShare;case at.SCREEN_SHARE_AUDIO:return q.Source.ScreenShareAudio;default:return q.Source.Unknown}}function Qp(i,e){return i.width*i.height<e.width*e.height}function _T(i,e){var t;return(t=i.layers)===null||t===void 0?void 0:t.find(r=>r.quality===e)}class IT extends On.EventEmitter{constructor(e){super(),this.onWorkerMessage=t=>{var r,o;const{kind:l,data:c}=t.data;switch(l){case"error":_e.error(c.error.message),this.emit(bi.EncryptionError,c.error);break;case"initAck":c.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(c.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==c.enabled&&c.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(bi.ParticipantEncryptionStatusChanged,c.enabled,this.room.localParticipant),this.encryptionEnabled=c.enabled;else if(c.participantIdentity){const u=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(c.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(c.participantIdentity));this.emit(bi.ParticipantEncryptionStatusChanged,c.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(Ti.KeyRatcheted,c.ratchetResult,c.participantIdentity,c.keyIndex);break}},this.onWorkerError=t=>{_e.error("e2ee worker encountered an error:",{error:t.error}),this.emit(bi.EncryptionError,t.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!Kb())throw new Wu("tried to setup end-to-end encryption on an unsupported browser");if(_e.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Ib.getLevel()}};this.worker&&(_e.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){_e.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?_e.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(oe.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(Q.TrackPublished,(r,o)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==Wt.NONE,o.identity)),e.on(Q.ConnectionStateChanged,r=>{r===Ae.Connected&&e.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{this.setParticipantCryptorEnabled(l.trackInfo.encryption!==Wt.NONE,o.identity)})})}).on(Q.TrackUnsubscribed,(r,o,l)=>{var c;const u={kind:"removeTransform",data:{participantIdentity:l.identity,trackId:r.mediaStreamID}};(c=this.worker)===null||c===void 0||c.postMessage(u)}).on(Q.TrackSubscribed,(r,o,l)=>{this.setupE2EEReceiver(r,l.identity,o.trackInfo)}).on(Q.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ae.LocalSenderCreated,(r,o)=>C(this,void 0,void 0,function*(){this.setupE2EESender(o,r)})),e.localParticipant.on(ae.LocalTrackPublished,r=>{if(!xi(r.track)||!Bs())return;const o={kind:"updateCodec",data:{trackId:r.track.mediaStreamID,codec:Ds(r.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o)}),t.on(Ti.SetKey,r=>this.postKey(r)).on(Ti.RatchetRequest,(r,o)=>this.postRatchetRequest(r,o))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(r)}postKey(e){let{key:t,participantIdentity:r,keyIndex:o}=e;var l;if(!this.worker)throw Error("could not set key, worker is missing");const c={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((l=this.room)===null||l===void 0?void 0:l.localParticipant.identity),key:t,keyIndex:o}};this.worker.postMessage(c)}postEnable(e,t){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?Ds(r.mimeType):void 0)}}setupE2EESender(e,t){if(!Ir(e)||!t){t||_e.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,r,o){return C(this,void 0,void 0,function*(){if(this.worker){if(fu()){const l={kind:"decode",participantIdentity:r,trackId:t,codec:o};e.transform=new RTCRtpScriptTransform(this.worker,l)}else{if(Cs in e&&o){const h={kind:"updateCodec",data:{trackId:t,codec:o,participantIdentity:r}};this.worker.postMessage(h);return}let l=e.writableStream,c=e.readableStream;if(!l||!c){const h=e.createEncodedStreams();e.writableStream=h.writable,l=h.writable,e.readableStream=h.readable,c=h.readable}const u={kind:"decode",data:{readableStream:c,writableStream:l,trackId:t,codec:o,participantIdentity:r,isReuse:Cs in e}};this.worker.postMessage(u,[c,l])}e[Cs]=!0}})}handleSender(e,t,r){var o;if(!(Cs in e||!this.worker)){if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(fu()){_e.info("initialize script transform");const l={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,l)}else{_e.info("initialize encoded streams");const l=e.createEncodedStreams(),c={kind:"encode",data:{readableStream:l.readable,writableStream:l.writable,codec:r,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(c,[l.readable,l.writable])}e[Cs]=!0}}}const Bc="default";class gt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new gt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return C(this,arguments,void 0,function(t){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;if(((l=gt.userMediaPromiseMap)===null||l===void 0?void 0:l.size)>0){_e.debug("awaiting getUserMedia promise");try{t?yield gt.userMediaPromiseMap.get(t):yield Promise.all(gt.userMediaPromiseMap.values())}catch{_e.warn("error waiting for media permissons")}}let c=yield navigator.mediaDevices.enumerateDevices();if(o&&!(Ki()&&r.hasDeviceInUse(t))&&(c.filter(h=>h.kind===t).length===0||c.some(h=>{const f=h.label==="",m=t?h.kind===t:!0;return f&&m}))){const h={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"&&{deviceId:{ideal:"default"}}},f=yield navigator.mediaDevices.getUserMedia(h);c=yield navigator.mediaDevices.enumerateDevices(),f.getTracks().forEach(m=>{m.stop()})}return r._previousDevices=c,t&&(c=c.filter(u=>u.kind===t)),c})()})}normalizeDeviceId(e,t,r){return C(this,void 0,void 0,function*(){if(t!==Bc)return t;const o=yield this.getDevices(e),l=o.find(u=>u.deviceId===Bc);if(!l){_e.warn("could not reliably determine default device");return}const c=o.find(u=>u.deviceId!==Bc&&u.groupId===(r??l.groupId));if(!c){_e.warn("could not reliably determine default device");return}return c==null?void 0:c.deviceId})}hasDeviceInUse(e){return e?gt.userMediaPromiseMap.has(e):gt.userMediaPromiseMap.size>0}}gt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];gt.userMediaPromiseMap=new Map;var Ms;(function(i){i[i.WAITING=0]="WAITING",i[i.RUNNING=1]="RUNNING",i[i.COMPLETED=2]="COMPLETED"})(Ms||(Ms={}));class NT{constructor(){this.pendingTasks=new Map,this.taskMutex=new At,this.nextTaskIndex=0}run(e){return C(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ms.WAITING};this.pendingTasks.set(t.id,t);const r=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Ms.RUNNING,yield e()}finally{t.status=Ms.COMPLETED,this.pendingTasks.delete(t.id),r()}})}flush(){return C(this,void 0,void 0,function*(){return this.run(()=>C(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function OT(i,e){const t=new URL(vT(i));return e.forEach((r,o)=>{t.searchParams.set(o,r)}),fv(t,"rtc")}function DT(i){const e=new URL(bu(i));return fv(e,"validate")}function MT(i){return i.endsWith("/")?i:"".concat(i,"/")}function fv(i,e){return i.pathname="".concat(MT(i.pathname)).concat(e),i.toString()}const LT=["syncState","trickle","offer","answer","simulate","leave"];function AT(i){const e=LT.indexOf(i.case)>=0;return _e.trace("request allowed to bypass queue:",{canPass:e,req:i}),e}var We;(function(i){i[i.CONNECTING=0]="CONNECTING",i[i.CONNECTED=1]="CONNECTED",i[i.RECONNECTING=2]="RECONNECTING",i[i.DISCONNECTING=3]="DISCONNECTING",i[i.DISCONNECTED=4]="DISCONNECTED"})(We||(We={}));class Gu{get currentState(){return this.state}get isDisconnected(){return this.state===We.DISCONNECTING||this.state===We.DISCONNECTED}get isEstablishingConnection(){return this.state===We.CONNECTING||this.state===We.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=We.DISCONNECTED,this.log=_e,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=$n((r=t.loggerName)!==null&&r!==void 0?r:vn.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new NT,this.queuedRequests=[],this.closingLock=new At,this.connectionLock=new At,this.state=We.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,r,o){return C(this,void 0,void 0,function*(){return this.state=We.CONNECTING,this.options=r,yield this.connect(e,t,r,o)})}reconnect(e,t,r,o){return C(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=We.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:o}))})}connect(e,t,r,o){this.connectOptions=r;const l=mT(),c=UT(t,l,r),u=OT(e,c),h=DT(u);return new Promise((f,m)=>C(this,void 0,void 0,function*(){const v=yield this.connectionLock.lock();try{const k=()=>C(this,void 0,void 0,function*(){this.close(),clearTimeout(b),m(new Be("room connection has been cancelled (signal)",Oe.Cancelled))}),b=setTimeout(()=>{this.close(),m(new Be("room connection has timed out (signal)",Oe.ServerUnreachable))},r.websocketTimeout);o!=null&&o.aborted&&k(),o==null||o.addEventListener("abort",k);const P=new URL(u);P.searchParams.has("access_token")&&P.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(P),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(u),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(b)},this.ws.onerror=w=>C(this,void 0,void 0,function*(){if(this.state!==We.CONNECTED){this.state=We.DISCONNECTED,clearTimeout(b);try{const _=yield fetch(h);if(_.status.toFixed(0).startsWith("4")){const M=yield _.text();m(new Be(M,Oe.NotAllowed,_.status))}else m(new Be("Encountered unknown websocket error during connection: ".concat(w.toString()),Oe.InternalError,_.status))}catch(_){m(new Be(_ instanceof Error?_.message:"server was not reachable",Oe.ServerUnreachable))}return}this.handleWSError(w)}),this.ws.onmessage=w=>C(this,void 0,void 0,function*(){var _,M,z;let U;if(typeof w.data=="string"){const I=JSON.parse(w.data);U=Pp.fromJson(I,{ignoreUnknownFields:!0})}else if(w.data instanceof ArrayBuffer)U=Pp.fromBinary(new Uint8Array(w.data));else{this.log.error("could not decode websocket message: ".concat(typeof w.data),this.logContext);return}if(this.state!==We.CONNECTED){let I=!1;if(((_=U.message)===null||_===void 0?void 0:_.case)==="join"?(this.state=We.CONNECTED,o==null||o.removeEventListener("abort",k),this.pingTimeoutDuration=U.message.value.pingTimeout,this.pingIntervalDuration=U.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),f(U.message.value)):this.state===We.RECONNECTING&&U.message.case!=="leave"?(this.state=We.CONNECTED,o==null||o.removeEventListener("abort",k),this.startPingInterval(),((M=U.message)===null||M===void 0?void 0:M.case)==="reconnect"?f(U.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),f(void 0),I=!0)):this.isEstablishingConnection&&U.message.case==="leave"?m(new Be("Received leave request while trying to (re)connect",Oe.LeaveRequest,void 0,U.message.value.reason)):r.reconnect||m(new Be("did not receive join response, got ".concat((z=U.message)===null||z===void 0?void 0:z.case," instead"),Oe.InternalError)),!I)return}this.signalLatency&&(yield Ut(this.signalLatency)),this.handleSignalResponse(U)}),this.ws.onclose=w=>{this.isEstablishingConnection&&m(new Be("Websocket got closed during a (re)connection attempt",Oe.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:w.reason,code:w.code,wasClean:w.wasClean,state:this.state})),this.handleOnClose(w.reason)}}finally{v()}}))}close(){return C(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=We.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const o=new Promise(l=>{e.ws?e.ws.onclose=()=>{l()}:l()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([o,Ut(250)])),e.ws=void 0}}finally{t&&(e.state=We.DISCONNECTED),r()}})()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ba(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ba(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new ju({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new Fu({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return C(this,arguments,void 0,function(r,o){var l=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const u=l.getNextRequestId();return yield l.sendRequest({case:"updateMetadata",value:new Sg({requestId:u,metadata:r,name:o,attributes:c})}),u})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new kg({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Cg({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Ge.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Pg({timestamp:Ge.parse(Date.now()),rtt:Ge.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new yg({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new Ia({reason:gn.CLIENT_INITIATED,action:Pr.DISCONNECT})})}sendRequest(e){return C(this,arguments,void 0,function(t){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!o&&!AT(t)&&r.state===We.RECONNECTING){r.queuedRequests.push(()=>C(r,void 0,void 0,function*(){yield this.sendRequest(t,!0)}));return}if(o||(yield r.requestQueue.flush()),r.signalLatency&&(yield Ut(r.signalLatency)),r.isDisconnected){r.log.debug("skipping signal request (type: ".concat(t.case,") - SignalClient disconnected"));return}if(!r.ws||r.ws.readyState!==r.ws.OPEN){r.log.error("cannot send signal request before connected, type: ".concat(t==null?void 0:t.case),r.logContext);return}const c=new sb({message:t});try{r.useJSON?r.ws.send(c.toJsonString()):r.ws.send(c.toBinary())}catch(u){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:u}))}})()})}handleSignalResponse(e){var t,r;const o=e.message;if(o==null){this.log.debug("received unsupported message",this.logContext);return}let l=!1;if(o.case==="answer"){const c=Yp(o.value);this.onAnswer&&this.onAnswer(c,o.value.id)}else if(o.case==="offer"){const c=Yp(o.value);this.onOffer&&this.onOffer(c,o.value.id)}else if(o.case==="trickle"){const c=JSON.parse(o.value.candidateInit);this.onTrickle&&this.onTrickle(c,o.value.target)}else o.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=o.value.participants)!==null&&t!==void 0?t:[]):o.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(o.value):o.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=o.value.speakers)!==null&&r!==void 0?r:[]):o.case==="leave"?this.onLeave&&this.onLeave(o.value):o.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(o.value.sid,o.value.muted):o.case==="roomUpdate"?this.onRoomUpdate&&o.value.room&&this.onRoomUpdate(o.value.room):o.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(o.value):o.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(o.value):o.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(o.value):o.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(o.value):o.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(o.value):o.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(o.value):o.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(o.value):o.case==="pong"||(o.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(o.value.lastPingTimestamp.toString()),this.resetPingTimeout(),l=!0):o.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(o.value):o.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(o.value.trackSid):o.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(o.value.token),this.onRoomMoved&&this.onRoomMoved(o.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:o.case})));l||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return C(this,void 0,void 0,function*(){if(this.state===We.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=kt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&kt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=kt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&kt.clearInterval(this.pingInterval)}}function Yp(i){const e={type:"offer",sdp:i.sdp};switch(i.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=i.type;break}return e}function ba(i,e){return new Wi({sdp:i.sdp,type:i.type,id:e})}function UT(i,e,t){var r;const o=new URLSearchParams;return o.set("access_token",i),t.reconnect&&(o.set("reconnect","1"),t.sid&&o.set("sid",t.sid)),o.set("auto_subscribe",t.autoSubscribe?"1":"0"),o.set("sdk",In()?"reactnative":"js"),o.set("version",e.version),o.set("protocol",e.protocol.toString()),e.deviceModel&&o.set("device_model",e.deviceModel),e.os&&o.set("os",e.os),e.osVersion&&o.set("os_version",e.osVersion),e.browser&&o.set("browser",e.browser),e.browserVersion&&o.set("browser_version",e.browserVersion),t.adaptiveStream&&o.set("adaptive_stream","1"),t.reconnectReason&&o.set("reconnect_reason",t.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&o.set("network",navigator.connection.type),o}class Xp{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class jT{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const r=Date.now();r-this._lastCleanup>this.ttl/2&&this.cleanup();const o=r+this.ttl;return this._map.set(e,{value:t,expiresAt:o}),this}get(e){const t=this._map.get(e);if(t){if(t.expiresAt<Date.now()){this._map.delete(e);return}return t.value}}has(e){const t=this._map.get(e);return t?t.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,r]of this._map.entries())r.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,r]of this._map.entries())r.expiresAt>=Date.now()&&e(r.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],r=this.asValueMap();for(const[o,l]of r.entries())t.push(e(l,o,r));return t}asValueMap(){const e=new Map;for(const[t,r]of this._map.entries())r.expiresAt>=Date.now()&&e.set(t,r.value);return e}}var un={},Vc={},zc={exports:{}},Zp;function $u(){if(Zp)return zc.exports;Zp=1;var i=zc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(i).forEach(function(e){var t=i[e];t.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),zc.exports}var em;function FT(){return em||(em=1,(function(i){var e=function(u){return String(Number(u))===u?Number(u):u},t=function(u,h,f,m){if(m&&!f)h[m]=e(u[1]);else for(var v=0;v<f.length;v+=1)u[v+1]!=null&&(h[f[v]]=e(u[v+1]))},r=function(u,h,f){var m=u.name&&u.names;u.push&&!h[u.push]?h[u.push]=[]:m&&!h[u.name]&&(h[u.name]={});var v=u.push?{}:m?h[u.name]:h;t(f.match(u.reg),v,u.names,u.name),u.push&&h[u.push].push(v)},o=$u(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);i.parse=function(u){var h={},f=[],m=h;return u.split(/(\r\n|\r|\n)/).filter(l).forEach(function(v){var k=v[0],b=v.slice(2);k==="m"&&(f.push({rtp:[],fmtp:[]}),m=f[f.length-1]);for(var P=0;P<(o[k]||[]).length;P+=1){var w=o[k][P];if(w.reg.test(b))return r(w,m,b)}}),h.media=f,h};var c=function(u,h){var f=h.split(/=(.+)/,2);return f.length===2?u[f[0]]=e(f[1]):f.length===1&&h.length>1&&(u[f[0]]=void 0),u};i.parseParams=function(u){return u.split(/;\s?/).reduce(c,{})},i.parseFmtpConfig=i.parseParams,i.parsePayloads=function(u){return u.toString().split(" ").map(Number)},i.parseRemoteCandidates=function(u){for(var h=[],f=u.split(" ").map(e),m=0;m<f.length;m+=3)h.push({component:f[m],ip:f[m+1],port:f[m+2]});return h},i.parseImageAttributes=function(u){return u.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(c,{})})},i.parseSimulcastStreamList=function(u){return u.split(";").map(function(h){return h.split(",").map(function(f){var m,v=!1;return f[0]!=="~"?m=e(f):(m=e(f.substring(1,f.length)),v=!0),{scid:m,paused:v}})})}})(Vc)),Vc}var qc,tm;function BT(){if(tm)return qc;tm=1;var i=$u(),e=/%[sdv%]/g,t=function(c){var u=1,h=arguments,f=h.length;return c.replace(e,function(m){if(u>=f)return m;var v=h[u];switch(u+=1,m){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},r=function(c,u,h){var f=u.format instanceof Function?u.format(u.push?h:h[u.name]):u.format,m=[c+"="+f];if(u.names)for(var v=0;v<u.names.length;v+=1){var k=u.names[v];u.name?m.push(h[u.name][k]):m.push(h[u.names[v]])}else m.push(h[u.name]);return t.apply(null,m)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];return qc=function(c,u){u=u||{},c.version==null&&(c.version=0),c.name==null&&(c.name=" "),c.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var h=u.outerOrder||o,f=u.innerOrder||l,m=[];return h.forEach(function(v){i[v].forEach(function(k){k.name in c&&c[k.name]!=null?m.push(r(v,k,c)):k.push in c&&c[k.push]!=null&&c[k.push].forEach(function(b){m.push(r(v,k,b))})})}),c.media.forEach(function(v){m.push(r("m",i.m[0],v)),f.forEach(function(k){i[k].forEach(function(b){b.name in v&&v[b.name]!=null?m.push(r(k,b,v)):b.push in v&&v[b.push]!=null&&v[b.push].forEach(function(P){m.push(r(k,b,P))})})})}),m.join(`\r
`)+`\r
`},qc}var nm;function VT(){if(nm)return un;nm=1;var i=FT(),e=BT(),t=$u();return un.grammar=t,un.write=e,un.parse=i.parse,un.parseParams=i.parseParams,un.parseFmtpConfig=i.parseFmtpConfig,un.parsePayloads=i.parsePayloads,un.parseRemoteCandidates=i.parseRemoteCandidates,un.parseImageAttributes=i.parseImageAttributes,un.parseSimulcastStreamList=i.parseSimulcastStreamList,un}var vi=VT();function Ju(i,e,t){var r,o,l;e===void 0&&(e=50),t===void 0&&(t={});var c=(r=t.isImmediate)!=null&&r,u=(o=t.callback)!=null&&o,h=t.maxWait,f=Date.now(),m=[];function v(){if(h!==void 0){var b=Date.now()-f;if(b+e>=h)return h-b}return e}var k=function(){var b=[].slice.call(arguments),P=this;return new Promise(function(w,_){var M=c&&l===void 0;if(l!==void 0&&clearTimeout(l),l=setTimeout(function(){if(l=void 0,f=Date.now(),!c){var U=i.apply(P,b);u&&u(U),m.forEach(function(I){return(0,I.resolve)(U)}),m=[]}},v()),M){var z=i.apply(P,b);return u&&u(z),w(z)}m.push({resolve:w,reject:_})})};return k.cancel=function(b){l!==void 0&&clearTimeout(l),m.forEach(function(P){return(0,P.reject)(b)}),m=[]},k}const zT=.7,qT=20,Nr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class im extends On.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=_e,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Ju(o=>C(this,void 0,void 0,function*(){this.emit(Nr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(l){if(o)o(l);else throw l}}),qT),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=$n((r=t.loggerName)!==null&&r!==void 0?r:vn.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new At}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var r;t.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,t.candidate))},e.onicecandidateerror=t=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,t)},e.ontrack=t=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return C(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return C(this,void 0,void 0,function*(){var r;if(e.type==="answer"&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let o;if(e.type==="offer"){let{stereoMids:l,nackMids:c}=WT(e);this.remoteStereoMids=l,this.remoteNackMids=c}else if(e.type==="answer"){const l=vi.parse((r=e.sdp)!==null&&r!==void 0?r:"");l.media.forEach(c=>{const u=Qu(c.mid);c.type==="audio"&&this.trackBitrates.some(h=>{if(!h.transceiver||u!=h.transceiver.mid)return!1;let f=0;if(c.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(f=v.payload,!0):!1),f===0)return!0;let m=!1;for(const v of c.fmtp)if(v.payload===f){v.config=v.config.split(";").filter(k=>!k.includes("maxaveragebitrate")).join(";"),h.maxbr>0&&(v.config+=";maxaveragebitrate=".concat(h.maxbr*1e3)),m=!0;break}return m||h.maxbr>0&&c.fmtp.push({payload:f,config:"maxaveragebitrate=".concat(h.maxbr*1e3)}),!0})}),o=vi.write(l)}return yield this.setMungedSDP(e,o,!0),this.pendingCandidates.forEach(l=>{this.pc.addIceCandidate(l)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Nr.NegotiationComplete),e.sdp&&vi.parse(e.sdp).media.forEach(c=>{c.type==="video"&&this.emit(Nr.RTPVideoPayloadTypes,c.rtp)})),!0})}createAndSendOffer(e){return C(this,void 0,void 0,function*(){var t;const r=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const u=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&u)yield this._pc.setRemoteDescription(u);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const o=this.latestOfferId+1;this.latestOfferId=o;const l=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:l.sdp},this.logContext));const c=vi.parse((t=l.sdp)!==null&&t!==void 0?t:"");if(c.media.forEach(u=>{sm(u),u.type==="audio"?rm(u,[],[]):u.type==="video"&&this.trackBitrates.some(h=>{if(!u.msid||!h.cid||!u.msid.includes(h.cid))return!1;let f=0;if(u.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(f=v.payload,!0):!1),f===0||(Pn(h.codec)&&!Ki()&&this.ensureVideoDDExtensionForSVC(u,c),h.codec!=="av1"))return!0;const m=Math.round(h.maxbr*zT);for(const v of u.fmtp)if(v.payload===f){v.config.includes("x-google-start-bitrate")||(v.config+=";x-google-start-bitrate=".concat(m));break}return!0})}),this.latestOfferId>o){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:o}));return}yield this.setMungedSDP(l,vi.write(c)),this.onOffer(l,this.latestOfferId)}finally{r()}})}createAndSetAnswer(){return C(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),r=vi.parse((e=t.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(o=>{sm(o),o.type==="audio"&&rm(o,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,vi.write(r)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new dt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new dt("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return C(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const r=new Map,o=new Map;if((yield this._pc.getStats()).forEach(u=>{switch(u.type){case"transport":t=u.selectedCandidatePairId;break;case"candidate-pair":t===""&&u.selected&&(t=u.id),r.set(u.id,u);break;case"remote-candidate":o.set(u.id,"".concat(u.address,":").concat(u.port));break}}),t==="")return;const c=(e=r.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(c!==void 0)return o.get(c)})}setMungedSDP(e,t,r){return C(this,void 0,void 0,function*(){if(t){const o=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(l){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:t})),e.sdp=o}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(o){let l="unknown error";o instanceof Error?l=o.message:typeof o=="string"&&(l=o);const c={error:l,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(c.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:c})),new pu(l)}})}ensureVideoDDExtensionForSVC(e,t){var r,o;if(!((r=e.ext)===null||r===void 0?void 0:r.some(c=>c.uri===Wp))){if(this.ddExtID===0){let c=0;t.media.forEach(u=>{var h;u.type==="video"&&((h=u.ext)===null||h===void 0||h.forEach(f=>{f.value>c&&(c=f.value)}))}),this.ddExtID=c+1}(o=e.ext)===null||o===void 0||o.push({value:this.ddExtID,uri:Wp})}}}function rm(i,e,t){const r=Qu(i.mid);let o=0;i.rtp.some(l=>l.codec==="opus"?(o=l.payload,!0):!1),o>0&&(i.rtcpFb||(i.rtcpFb=[]),t.includes(r)&&!i.rtcpFb.some(l=>l.payload===o&&l.type==="nack")&&i.rtcpFb.push({payload:o,type:"nack"}),e.includes(r)&&i.fmtp.some(l=>l.payload===o?(l.config.includes("stereo=1")||(l.config+=";stereo=1"),!0):!1))}function WT(i){var e;const t=[],r=[],o=vi.parse((e=i.sdp)!==null&&e!==void 0?e:"");let l=0;return o.media.forEach(c=>{var u;const h=Qu(c.mid);c.type==="audio"&&(c.rtp.some(f=>f.codec==="opus"?(l=f.payload,!0):!1),!((u=c.rtcpFb)===null||u===void 0)&&u.some(f=>f.payload===l&&f.type==="nack")&&r.push(h),c.fmtp.some(f=>f.payload===l?(f.config.includes("sprop-stereo=1")&&t.push(h),!0):!1))}),{stereoMids:t,nackMids:r}}function sm(i){if(i.connection){const e=i.connection.ip.indexOf(":")>=0;(i.connection.version===4&&e||i.connection.version===6&&!e)&&(i.connection.ip="0.0.0.0",i.connection.version=4)}}function Qu(i){return typeof i=="number"?i.toFixed(0):i}const xu="vp8",HT={audioPreset:mu.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Hu.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:xu,backupCodec:!0,preConnectBuffer:!1},pv={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},mv={deviceId:{ideal:"default"},resolution:Fs.h720.resolution},KT={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Ob,disconnectOnPageLeave:!0,webAudioMix:!1},Yu={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Xe;(function(i){i[i.NEW=0]="NEW",i[i.CONNECTING=1]="CONNECTING",i[i.CONNECTED=2]="CONNECTED",i[i.FAILED=3]="FAILED",i[i.CLOSING=4]="CLOSING",i[i.CLOSED=5]="CLOSED"})(Xe||(Xe={}));class GT{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,r){var o;this.peerConnectionTimeout=Yu.peerConnectionTimeout,this.log=_e,this.updateState=()=>{var l;const c=this.state,u=this.requiredTransports.map(h=>h.getConnectionState());u.every(h=>h==="connected")?this.state=Xe.CONNECTED:u.some(h=>h==="failed")?this.state=Xe.FAILED:u.some(h=>h==="connecting")?this.state=Xe.CONNECTING:u.every(h=>h==="closed")?this.state=Xe.CLOSED:u.some(h=>h==="closed")?this.state=Xe.CLOSING:u.every(h=>h==="new")&&(this.state=Xe.NEW),c!==this.state&&(this.log.debug("pc state change: from ".concat(Xe[c]," to ").concat(Xe[this.state]),this.logContext),(l=this.onStateChange)===null||l===void 0||l.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=$n((o=r.loggerName)!==null&&o!==void 0?o:vn.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new im(e,r),this.subscriber=new im(e,r),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=l=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,l,pn.PUBLISHER)},this.subscriber.onIceCandidate=l=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,l,pn.SUBSCRIBER)},this.subscriber.onDataChannel=l=>{var c;(c=this.onDataChannel)===null||c===void 0||c.call(this,l)},this.subscriber.onTrack=l=>{var c;(c=this.onTrack)===null||c===void 0||c.call(this,l)},this.publisher.onOffer=(l,c)=>{var u;(u=this.onPublisherOffer)===null||u===void 0||u.call(this,l,c)},this.state=Xe.NEW,this.connectionLock=new At,this.remoteOfferLock=new At}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return C(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return C(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return C(this,void 0,void 0,function*(){t===pn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return C(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const r=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,t))?yield this.subscriber.createAndSetAnswer():void 0}finally{r()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return C(this,void 0,void 0,function*(){var r;const o=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(l=>this.ensureTransportConnected(l,e,t)))}finally{o()}})}negotiate(e){return C(this,void 0,void 0,function*(){return new Promise((t,r)=>C(this,void 0,void 0,function*(){const o=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),l=()=>{clearTimeout(o),r("negotiation aborted")};e.signal.addEventListener("abort",l),this.publisher.once(Nr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Nr.NegotiationComplete,()=>{clearTimeout(o),t()})}),yield this.publisher.negotiate(c=>{clearTimeout(o),r(c)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===pn.PUBLISHER?this.publisher.getConnectedAddress():e===pn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return C(this,arguments,void 0,function(r,o){var l=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(r.getConnectionState()!=="connected")return new Promise((h,f)=>C(l,void 0,void 0,function*(){const m=()=>{this.log.warn("abort transport connection",this.logContext),kt.clearTimeout(v),f(new Be("room connection has been cancelled",Oe.Cancelled))};o!=null&&o.signal.aborted&&m(),o==null||o.signal.addEventListener("abort",m);const v=kt.setTimeout(()=>{o==null||o.signal.removeEventListener("abort",m),f(new Be("could not establish pc connection",Oe.InternalError))},c);for(;this.state!==Xe.CONNECTED;)if(yield Ut(50),o!=null&&o.signal.aborted){f(new Be("room connection has been cancelled",Oe.Cancelled));return}kt.clearTimeout(v),o==null||o.signal.removeEventListener("abort",m),h()}))})()})}}class et extends Error{constructor(e,t,r){super(t),this.code=e,this.message=om(t,et.MAX_MESSAGE_BYTES),this.data=r?om(r,et.MAX_DATA_BYTES):void 0}static fromProto(e){return new et(e.code,e.message,e.data)}toProto(){return new lg({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new et(et.ErrorCode[e],et.ErrorMessage[e],t)}}et.MAX_MESSAGE_BYTES=256;et.MAX_DATA_BYTES=15360;et.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};et.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const gv=15360;function Xu(i){return new TextEncoder().encode(i).length}function om(i,e){if(Xu(i)<=e)return i;let t=0,r=i.length;const o=new TextEncoder;for(;t<r;){const l=Math.floor((t+r+1)/2);o.encode(i.slice(0,l)).length<=e?t=l:r=l-1}return i.slice(0,t)}const Zu=2e3;function Oa(i,e){if(!e)return 0;let t,r;return"bytesReceived"in i?(t=i.bytesReceived,r=e.bytesReceived):"bytesSent"in i&&(t=i.bytesSent,r=e.bytesSent),t===void 0||r===void 0||i.timestamp===void 0||e.timestamp===void 0?0:(t-r)*8*1e3/(i.timestamp-e.timestamp)}const ed=typeof MediaRecorder<"u";class $T{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const JT=ed?MediaRecorder:$T;class QT extends JT{constructor(e,t){if(!ed)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),t);let r,o;const l=()=>o===void 0,c=()=>{this.removeEventListener("dataavailable",r),this.removeEventListener("stop",c),this.removeEventListener("error",u),o==null||o.close(),o=void 0},u=h=>{o==null||o.error(h),this.removeEventListener("dataavailable",r),this.removeEventListener("stop",c),this.removeEventListener("error",u),o=void 0};this.byteStream=new ReadableStream({start:h=>{o=h,r=f=>C(this,void 0,void 0,function*(){let m;if(f.data.arrayBuffer){const v=yield f.data.arrayBuffer();m=new Uint8Array(v)}else if(f.data.byteArray)m=f.data.byteArray;else throw new Error("no data available!");l()||h.enqueue(m)}),this.addEventListener("dataavailable",r)},cancel:()=>{c()}}),this.addEventListener("stop",c),this.addEventListener("error",u)}}function YT(){return ed}const XT=1e3,ZT=1e4;class vv extends q{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4?arguments[4]:void 0;super(e,t,l),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Ju(()=>C(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>C(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Z.Ended,this)},this.reacquireTrack=!1,this.providedByUser=o,this.muteLock=new At,this.pauseUpstreamLock=new At,this.trackChangeLock=new At,this.trackChangeLock.lock().then(c=>C(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{c()}})),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==q.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return C(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(l=>{_r(this._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let o;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(xr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),o=this.processor.processedTrack}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(o??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(l=>{xr(o??e,l)}))})}waitForDimensions(){return C(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:XT;return(function*(){var r;if(e.kind===q.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=Kt())===null||r===void 0?void 0:r.os)==="iOS"&&(yield Ut(10));const o=Date.now();for(;Date.now()-o<t;){const l=e.dimensions;if(l)return l;yield Ut(50)}throw new Gn("unable to get track dimensions after timeout")})()})}setDeviceId(e){return C(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ci(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Ci(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return C(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===q.Source.ScreenShare)return;const{deviceId:r,groupId:o}=e._mediaStreamTrack.getSettings(),l=e.kind===q.Kind.Audio?"audioinput":"videoinput";return t?gt.getInstance().normalizeDeviceId(l,r,o):r})()})}mute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return C(this,void 0,void 0,function*(){const r=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Gn("unable to replace an unpublished track");let o,l;return typeof t=="boolean"?o=t:t!==void 0&&(o=t.userProvidedTrack,l=t.stopProcessor),this.providedByUser=o??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),l&&this.processor&&(yield this.internalStopProcessor()),this}finally{r()}})}restart(e){return C(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:o}=e,l=Db(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const c={audio:!1,video:!1};this.kind===q.Kind.Video?c.video=r||o?{deviceId:r,facingMode:o}:!0:c.audio=r?Object.assign({deviceId:r},l):!0,this.attachedElements.forEach(f=>{_r(this.mediaStreamTrack,f)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const h=(yield navigator.mediaDevices.getUserMedia(c)).getTracks()[0];return this.kind===q.Kind.Video&&(yield h.applyConstraints(l)),h.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(h),this._constraints=e,this.emit(Z.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Z.Muted:Z.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),ov()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Z.UpstreamPaused,this);const r=Kt();if((r==null?void 0:r.name)==="Safari"&&Nn(r.version,"12.0")<0)throw new Wu("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Z.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return C(this,arguments,void 0,function(t){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;const c=yield r.trackChangeLock.lock();try{r.log.debug("setting up processor",r.logContext);const u=document.createElement(r.kind),h={kind:r.kind,track:r._mediaStreamTrack,element:u,audioContext:r.audioContext};if(yield t.init(h),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.internalStopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(xr(r._mediaStreamTrack,u),u.muted=!0,u.play().catch(f=>{f instanceof DOMException&&f.name==="AbortError"?(r.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},r.logContext),{error:f})),setTimeout(()=>{u.play().catch(m=>{r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{err:m}))})},100)):r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:f}))}),r.processor=t,r.processorElement=u,r.processor.processedTrack){for(const f of r.attachedElements)f!==r.processorElement&&o&&(_r(r._mediaStreamTrack,f),xr(r.processor.processedTrack,f));yield(l=r.sender)===null||l===void 0?void 0:l.replaceTrack(r.processor.processedTrack)}r.emit(Z.TrackProcessorUpdate,r.processor)}finally{c()}})()})}getProcessor(){return this.processor}stopProcessor(){return C(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const r=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{r()}})()})}internalStopProcessor(){return C(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var r,o;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,t||((o=e.processorElement)===null||o===void 0||o.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Z.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!YT()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let t="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(t)||(t="video/mp4"),this.localTrackRecorder=new QT(this,{mimeType:t})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},ZT)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Ta extends vv{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;super(e,q.Kind.Audio,t,r,l),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(u){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:u}));return}c&&this.prevStats&&(this._currentBitrate=Oa(c,this.prevStats)),this.prevStats=c}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Z.AudioTrackFeatureUpdate,this,mt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Z.AudioTrackFeatureUpdate,this,mt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=o,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===q.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ci(this._constraints.deviceId);return this.source===q.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return C(this,void 0,void 0,function*(){let t;if(e){const r=Ku({audio:e});typeof r.audio!="boolean"&&(t=r.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return C(this,void 0,void 0,function*(){const r=yield t.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){Lt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Zu)))}setProcessor(e){return C(this,void 0,void 0,function*(){var t;const r=yield this.trackChangeLock.lock();try{if(!In()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(o),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Z.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let r;return t.forEach(o=>{o.type==="outbound-rtp"&&(r={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),r})}checkForSilence(){return C(this,void 0,void 0,function*(){const e=yield uv(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Z.AudioSilenceDetected)),e})}}function eC(i,e,t){switch(i.kind){case"audio":return new Ta(i,e,!1,void 0,t);case"video":return new Ca(i,e,!1,t);default:throw new Gn("unsupported track type: ".concat(i.kind))}}const tC=Object.values(Fs),nC=Object.values(gu),iC=Object.values(Hu),rC=[Fs.h180,Fs.h360],sC=[gu.h180,gu.h360],oC=i=>[{scaleResolutionDownBy:2,fps:i.encoding.maxFramerate}].map(t=>{var r,o;return new Fe(Math.floor(i.width/t.scaleResolutionDownBy),Math.floor(i.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(i.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((r=i.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((o=t.fps)!==null&&o!==void 0?o:30))))),t.fps,i.encoding.priority)}),Eu=["q","h","f"];function Pu(i,e,t,r){var o,l;let c=r==null?void 0:r.videoEncoding;i&&(c=r==null?void 0:r.screenShareEncoding);const u=r==null?void 0:r.simulcast,h=r==null?void 0:r.scalabilityMode,f=r==null?void 0:r.videoCodec;if(!c&&!u&&!h||!e||!t)return[{}];c||(c=lC(i,e,t,f),_e.debug("using video encoding",c));const m=c.maxFramerate,v=new Fe(e,t,c.maxBitrate,c.maxFramerate,c.priority);if(h&&Pn(f)){const P=new yv(h),w=[];if(P.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(h));const _=Kt();if(Bs()||In()||(_==null?void 0:_.name)==="Chrome"&&Nn(_==null?void 0:_.version,"113")<0){const M=P.suffix=="h"?2:3,z=dT(_);for(let U=0;U<P.spatial;U+=1)w.push({rid:Eu[2-U],maxBitrate:c.maxBitrate/Math.pow(M,U),maxFramerate:v.encoding.maxFramerate,scaleResolutionDownBy:z?Math.pow(2,U):void 0});w[0].scalabilityMode=h}else w.push({maxBitrate:c.maxBitrate,maxFramerate:v.encoding.maxFramerate,scalabilityMode:h});return v.encoding.priority&&(w[0].priority=v.encoding.priority,w[0].networkPriority=v.encoding.priority),_e.debug("using svc encoding",{encodings:w}),w}if(!u)return[c];let k=[];i?k=(o=lm(r==null?void 0:r.screenShareSimulcastLayers))!==null&&o!==void 0?o:am(i,v):k=(l=lm(r==null?void 0:r.videoSimulcastLayers))!==null&&l!==void 0?l:am(i,v);let b;if(k.length>0){const P=k[0];k.length>1&&([,b]=k);const w=Math.max(e,t);if(w>=960&&b)return Wc(e,t,[P,b,v],m);if(w>=480)return Wc(e,t,[P,v],m)}return Wc(e,t,[v])}function aC(i,e,t){var r,o,l,c;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&_e.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const u=i.mediaStreamTrack.getSettings(),h=(r=u.width)!==null&&r!==void 0?r:(o=i.dimensions)===null||o===void 0?void 0:o.width,f=(l=u.height)!==null&&l!==void 0?l:(c=i.dimensions)===null||c===void 0?void 0:c.height;return i.source===q.Source.ScreenShare&&t.simulcast&&(t.simulcast=!1),Pu(i.source===q.Source.ScreenShare,h,f,t)}function lC(i,e,t,r){const o=cC(i,e,t);let{encoding:l}=o[0];const c=Math.max(e,t);for(let u=0;u<o.length;u+=1){const h=o[u];if(l=h.encoding,h.width>=c)break}if(r)switch(r){case"av1":case"h265":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.7;break;case"vp9":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.85;break}return l}function cC(i,e,t){if(i)return iC;const r=e>t?e/t:t/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?tC:nC}function am(i,e){if(i)return oC(e);const{width:t,height:r}=e,o=t>r?t/r:r/t;return Math.abs(o-16/9)<Math.abs(o-4/3)?rC:sC}function Wc(i,e,t,r){const o=[];if(t.forEach((l,c)=>{if(c>=Eu.length)return;const u=Math.min(i,e),f={rid:Eu[c],scaleResolutionDownBy:Math.max(1,u/Math.min(l.width,l.height)),maxBitrate:l.encoding.maxBitrate},m=r&&l.encoding.maxFramerate?Math.min(r,l.encoding.maxFramerate):l.encoding.maxFramerate;m&&(f.maxFramerate=m);const v=Hi()||c===0;l.encoding.priority&&v&&(f.priority=l.encoding.priority,f.networkPriority=l.encoding.priority),o.push(f)}),In()&&lv()==="ios"){let l;o.forEach(u=>{l?u.maxFramerate&&u.maxFramerate>l&&(l=u.maxFramerate):l=u.maxFramerate});let c=!0;o.forEach(u=>{var h;u.maxFramerate!=l&&(c&&(c=!1,_e.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),_e.info('Setting framerate of encoding "'.concat((h=u.rid)!==null&&h!==void 0?h:"",'" to ').concat(l)),u.maxFramerate=l)})}return o}function lm(i){if(i)return i.sort((e,t)=>{const{encoding:r}=e,{encoding:o}=t;return r.maxBitrate>o.maxBitrate?1:r.maxBitrate<o.maxBitrate?-1:r.maxBitrate===o.maxBitrate&&r.maxFramerate&&o.maxFramerate?r.maxFramerate>o.maxFramerate?1:-1:0})}class yv{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function uC(i){return i.source===q.Source.ScreenShare||i.constraints.height&&Ci(i.constraints.height)>=1080?"maintain-resolution":"balanced"}const dC=5e3;class Ca extends vv{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0;super(e,q.Kind.Video,t,r,o),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(h){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:h}));return}const c=new Map(l.map(h=>[h.rid,h])),u=l.some(h=>h.qualityLimitationReason==="cpu");if(u!==this.isCpuConstrained&&(this.isCpuConstrained=u,this.isCpuConstrained&&this.emit(Z.CpuConstrained)),this.prevStats){let h=0;c.forEach((f,m)=>{var v;const k=(v=this.prevStats)===null||v===void 0?void 0:v.get(m);h+=Oa(f,k)}),this._currentBitrate=h}this.prevStats=c}),this.senderLock=new At}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Lt())return;const r=(t=this.sender)===null||t===void 0?void 0:t.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Zu))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return C(this,void 0,void 0,function*(){var t,r,o,l,c;yield e.pauseUpstream.call(this);try{for(var u=!0,h=Kn(this.simulcastCodecs.values()),f;f=yield h.next(),t=f.done,!t;u=!0)l=f.value,u=!1,yield(c=l.sender)===null||c===void 0?void 0:c.replaceTrack(null)}catch(m){r={error:m}}finally{try{!u&&!t&&(o=h.return)&&(yield o.call(h))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return C(this,void 0,void 0,function*(){var t,r,o,l,c;yield e.resumeUpstream.call(this);try{for(var u=!0,h=Kn(this.simulcastCodecs.values()),f;f=yield h.next(),t=f.done,!t;u=!0){l=f.value,u=!1;const m=l;yield(c=m.sender)===null||c===void 0?void 0:c.replaceTrack(m.mediaStreamTrack)}}catch(m){r={error:m}}finally{try{!u&&!t&&(o=h.return)&&(yield o.call(h))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===q.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===q.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],r=yield this.sender.getStats();return r.forEach(o=>{var l;if(o.type==="outbound-rtp"){const c={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(l=o.rid)!==null&&l!==void 0?l:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},u=r.get(o.remoteId);u&&(c.jitter=u.jitter,c.packetsLost=u.packetsLost,c.roundTripTime=u.roundTripTime),t.push(c)}}),t.sort((o,l)=>{var c,u;return((c=l.frameWidth)!==null&&c!==void 0?c:0)-((u=o.frameWidth)!==null&&u!==void 0?u:0)}),t})}setPublishingQuality(e){const t=[];for(let r=Ht.LOW;r<=Ht.HIGH;r+=1)t.push(new Vu({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Pn(this.codec),t)}restartTrack(e){return C(this,void 0,void 0,function*(){var t,r,o,l,c;let u;if(e){const v=Ku({video:e});typeof v.video!="boolean"&&(u=v.video)}yield this.restart(u),this.isCpuConstrained=!1;try{for(var h=!0,f=Kn(this.simulcastCodecs.values()),m;m=yield f.next(),t=m.done,!t;h=!0){l=m.value,h=!1;const v=l;v.sender&&((c=v.sender.transport)===null||c===void 0?void 0:c.state)!=="closed"&&(v.mediaStreamTrack=this.mediaStreamTrack.clone(),yield v.sender.replaceTrack(v.mediaStreamTrack))}}catch(v){r={error:v}}finally{try{!h&&!t&&(o=f.return)&&(yield o.call(f))}finally{if(r)throw r.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return C(this,arguments,void 0,function(r){var o=this;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var c,u,h,f,m,v;if(yield t.setProcessor.call(o,r,l),!((m=o.processor)===null||m===void 0)&&m.processedTrack)try{for(var k=!0,b=Kn(o.simulcastCodecs.values()),P;P=yield b.next(),c=P.done,!c;k=!0)f=P.value,k=!1,yield(v=f.sender)===null||v===void 0?void 0:v.replaceTrack(o.processor.processedTrack)}catch(w){u={error:w}}finally{try{!k&&!c&&(h=b.return)&&(yield h.call(b))}finally{if(u)throw u.error}}})()})}setDegradationPreference(e){return C(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,t){const r=this.simulcastCodecs.get(e);r&&(r.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},dC))}setPublishingCodecs(e){return C(this,void 0,void 0,function*(){var t,r,o,l,c,u,h;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Pn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const f=[];try{for(t=!0,r=Kn(e);o=yield r.next(),l=o.done,!l;t=!0){h=o.value,t=!1;const m=h;if(!this.codec||this.codec===m.codec)yield this.setPublishingLayers(Pn(m.codec),m.qualities);else{const v=this.simulcastCodecs.get(m.codec);if(this.log.debug("try setPublishingCodec for ".concat(m.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:v})),!v||!v.sender){for(const k of m.qualities)if(k.enabled){f.push(m.codec);break}}else v.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(m.codec),this.logContext),yield cm(v.sender,v.encodings,m.qualities,this.senderLock,Pn(m.codec),this.log,this.logContext))}}}catch(m){c={error:m}}finally{try{!t&&!l&&(u=r.return)&&(yield u.call(r))}finally{if(c)throw c.error}}return f})}setPublishingLayers(e,t){return C(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield cm(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return C(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const t=this.sender.getParameters();t.encodings=t.encodings.map((r,o)=>{var l;return Object.assign(Object.assign({},r),{active:o===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((l=this.mediaStreamTrack.getSettings().height)!==null&&l!==void 0?l:360)/360)),scalabilityMode:o===0&&Pn(this.codec)?"L1T3":void 0,maxFramerate:o===0?15:0,maxBitrate:o===0?r.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:t.encodings})),this.encodings=t.encodings,yield this.sender.setParameters(t)}catch(t){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:t})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),ov()&&this.isInBackground&&this.source===q.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function cm(i,e,t,r,o,l,c){return C(this,void 0,void 0,function*(){const u=yield r.lock();l.debug("setPublishingLayersForSender",Object.assign(Object.assign({},c),{sender:i,qualities:t,senderEncodings:e}));try{const h=i.getParameters(),{encodings:f}=h;if(!f)return;if(f.length!==e.length){l.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},c),{encodings:f,senderEncodings:e}));return}let m=!1;!1&&f[0].scalabilityMode||(o&&t.some(b=>b.enabled)&&t.forEach(b=>b.enabled=!0),f.forEach((k,b)=>{var P;let w=(P=k.rid)!==null&&P!==void 0?P:"";w===""&&(w="q");const _=kv(w),M=t.find(z=>z.quality===_);M&&k.active!==M.enabled&&(m=!0,k.active=M.enabled,l.debug("setting layer ".concat(M.quality," to ").concat(k.active?"enabled":"disabled"),c),Hi()&&(M.enabled?(k.scaleResolutionDownBy=e[b].scaleResolutionDownBy,k.maxBitrate=e[b].maxBitrate,k.maxFrameRate=e[b].maxFrameRate):(k.scaleResolutionDownBy=4,k.maxBitrate=10,k.maxFrameRate=2)))})),m&&(h.encodings=f,l.debug("setting encodings",Object.assign(Object.assign({},c),{encodings:h.encodings})),yield i.setParameters(h))}finally{u()}})}function kv(i){switch(i){case"f":return Ht.HIGH;case"h":return Ht.MEDIUM;case"q":return Ht.LOW;default:return Ht.HIGH}}function um(i,e,t,r){if(!t)return[new zi({quality:Ht.HIGH,width:i,height:e,bitrate:0,ssrc:0})];if(r){const o=t[0].scalabilityMode,l=new yv(o),c=[],u=l.suffix=="h"?1.5:2,h=l.suffix=="h"?2:3;for(let f=0;f<l.spatial;f+=1)c.push(new zi({quality:Math.min(Ht.HIGH,l.spatial-1)-f,width:Math.ceil(i/Math.pow(u,f)),height:Math.ceil(e/Math.pow(u,f)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(h,f)):0,ssrc:0}));return c}return t.map(o=>{var l,c,u;const h=(l=o.scaleResolutionDownBy)!==null&&l!==void 0?l:1;let f=kv((c=o.rid)!==null&&c!==void 0?c:"");return new zi({quality:f,width:Math.ceil(i/h),height:Math.ceil(e/h),bitrate:(u=o.maxBitrate)!==null&&u!==void 0?u:0,ssrc:0})})}const dm="_lossy",hm="_reliable",hC=2*1e3,Hc="leave-reconnect",fC=3e4;var dn;(function(i){i[i.New=0]="New",i[i.Connected=1]="Connected",i[i.Disconnected=2]="Disconnected",i[i.Reconnecting=3]="Reconnecting",i[i.Closed=4]="Closed"})(dn||(dn={}));class pC extends On.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Yu.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=dn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=_e,this.reliableDataSequence=1,this.reliableMessageBuffer=new Xp,this.reliableReceivedState=new jT(fC),this.handleDataChannel=r=>C(this,[r],void 0,function(o){var l=this;let{channel:c}=o;return(function*(){if(c){if(c.label===hm)l.reliableDCSub=c;else if(c.label===dm)l.lossyDCSub=c;else return;l.log.debug("on data channel ".concat(c.id,", ").concat(c.label),l.logContext),c.onmessage=l.handleDataMessage}})()}),this.handleDataMessage=r=>C(this,void 0,void 0,function*(){var o,l;const c=yield this.dataProcessLock.lock();try{let u;if(r.data instanceof ArrayBuffer)u=r.data;else if(r.data instanceof Blob)u=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const h=Mt.fromBinary(new Uint8Array(u));if(h.sequence>0&&h.participantSid!==""){const f=this.reliableReceivedState.get(h.participantSid);if(f&&h.sequence<=f)return;this.reliableReceivedState.set(h.participantSid,h.sequence)}((o=h.value)===null||o===void 0?void 0:o.case)==="speaker"?this.emit(oe.ActiveSpeakersUpdate,h.value.value.speakers):(((l=h.value)===null||l===void 0?void 0:l.case)==="user"&&gC(h,h.value.value),this.emit(oe.DataPacketReceived,h))}finally{c()}}),this.handleDataError=r=>{const l=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:c}=r.error;this.log.error("DataChannel error on ".concat(l,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:c}))}else this.log.error("Unknown DataChannel error on ".concat(l),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const l=r.currentTarget.maxRetransmits===0?Te.LOSSY:Te.RELIABLE;this.updateAndEmitDCBufferStatus(l)},this.handleDisconnect=(r,o)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const l=h=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(h,"ms. giving up"),this.logContext),this.emit(oe.Disconnected),this.close()},c=Date.now()-this.reconnectStart;let u=this.getNextRetryDelay({elapsedMs:c,retryCount:this.reconnectAttempts});if(u===null){l(c);return}r===Hc&&(u=0),this.log.debug("reconnecting in ".concat(u,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=kt.setTimeout(()=>this.attemptReconnect(o).finally(()=>this.reconnectTimeout=void 0),u)},this.waitForRestarted=()=>new Promise((r,o)=>{this.pcState===dn.Connected&&r();const l=()=>{this.off(oe.Disconnected,c),r()},c=()=>{this.off(oe.Restarted,l),o()};this.once(oe.Restarted,l),this.once(oe.Disconnected,c)}),this.updateAndEmitDCBufferStatus=r=>{const o=this.isBufferStatusLow(r);typeof o<"u"&&o!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,o),this.emit(oe.DCBufferStatusChanged,o,r))},this.isBufferStatusLow=r=>{const o=this.dataChannelForKind(r);if(o)return r===Te.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount),o.bufferedAmount<=o.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===We.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(br.RR_SIGNAL_DISCONNECTED))},this.log=$n((t=e.loggerName)!==null&&t!==void 0?t:vn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Gu(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new At,this.dataProcessLock=new At,this.dcBufferStatus=new Map([[Te.LOSSY,!0],[Te.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(oe.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(oe.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(oe.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(oe.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(oe.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(oe.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(oe.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(oe.SignalRequestResponse,r)}get logContext(){var e,t,r,o,l,c;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomID:(o=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||o===void 0?void 0:o.sid,participant:(c=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||c===void 0?void 0:c.identity,pID:this.participantSid}}join(e,t,r,o){return C(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const l=yield this.client.join(e,t,r,o);return this._isClosed=!1,this.latestJoinResponse=l,this.subscriberPrimary=l.subscriberPrimary,this.pcManager||(yield this.configure(l)),(!this.subscriberPrimary||l.fastPublish)&&this.negotiate(),this.clientConfiguration=l.clientConfiguration,this.emit(oe.SignalConnected,l),l}catch(l){if(l instanceof Be&&l.reason===Oe.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,r,o);throw l}})}close(){return C(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(oe.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return C(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Xp,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return C(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Gn("a track with the same ID has already been published");return new Promise((t,r)=>{const o=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new Be("publication of local track timed out, no response from server",Oe.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:l=>{clearTimeout(o),t(l)},reject:()=>{clearTimeout(o),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return C(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return C(this,void 0,void 0,function*(){var t,r;if(this.pcManager&&this.pcManager.currentState!==Xe.NEW)return;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid;const o=this.makeRTCConfiguration(e);this.pcManager=new GT(o,e.subscriberPrimary,this.loggerOptions),this.emit(oe.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(l,c)=>{this.client.sendIceCandidate(l,c)},this.pcManager.onPublisherOffer=(l,c)=>{this.client.sendOffer(l,c)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(l,c,u)=>C(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(c)&&(this.publisherConnectionPromise=void 0),l===Xe.CONNECTED){const m=this.pcState===dn.New;this.pcState=dn.Connected,m&&this.emit(oe.Connected,e)}else l===Xe.FAILED&&this.pcState===dn.Connected&&(this.pcState=dn.Disconnected,this.handleDisconnect("peerconnection failed",u==="failed"?br.RR_SUBSCRIBER_FAILED:br.RR_PUBLISHER_FAILED));const h=this.client.isDisconnected||this.client.currentState===We.RECONNECTING,f=[Xe.FAILED,Xe.CLOSING,Xe.CLOSED].includes(l);h&&f&&!this._isClosed&&this.emit(oe.Offline)}),this.pcManager.onTrack=l=>{this.emit(oe.MediaTrackAdded,l.track,l.streams[0],l.receiver)},mC((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t)=>C(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t)=>C(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);r&&this.client.sendAnswer(r,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(oe.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(oe.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(oe.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(oe.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(oe.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",br.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Pr.DISCONNECT:this.emit(oe.Disconnected,e==null?void 0:e.reason),this.close();break;case Pr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Hc);break;case Pr.RESUME:this.handleDisconnect(Hc)}}}makeRTCConfiguration(e){var t;const r=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const o=[];e.iceServers.forEach(l=>{const c={urls:l.urls};l.username&&(c.username=l.username),l.credential&&(c.credential=l.credential),o.push(c)}),r.iceServers=o}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Us.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(dm,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(hm,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,r){return C(this,void 0,void 0,function*(){if(vu())return yield this.createTransceiverRTCRtpSender(e,t,r);if(yu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new dt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,r,o){return C(this,void 0,void 0,function*(){if(vu())return this.createSimulcastTransceiverSender(e,t,r,o);if(yu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new dt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,r){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");const o=[];e.mediaStream&&o.push(e.mediaStream),xi(e)&&(e.codec=t.videoCodec);const l={direction:"sendonly",streams:o};return r&&(l.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,l)).sender})}createSimulcastTransceiverSender(e,t,r,o){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");const l={direction:"sendonly"};o&&(l.sendEncodings=o);const c=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,l);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,c.sender),c.sender})}createRTCRtpSender(e){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return C(this,void 0,void 0,function*(){var t,r,o;if(!this._isClosed){if(this.attemptingReconnect){_e.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===Us.DISABLED||((o=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&o!==void 0?o:Xe.NEW)===Xe.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(l){this.reconnectAttempts+=1;let c=!0;l instanceof dt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:l})),c=!1):l instanceof Tr||(this.fullReconnectOnNext=!0),c?this.handleDisconnect("reconnect",br.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(oe.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return C(this,void 0,void 0,function*(){var t,r,o;try{if(!this.url||!this.token)throw new dt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(oe.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let l;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Tr;l=yield this.join(e??this.url,this.token,this.signalOpts)}catch(c){throw c instanceof Be&&c.reason===Oe.NotAllowed?new dt("could not reconnect, token might be expired"):new Tr}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(oe.SignalRestarted,l),yield this.waitForPCReconnected(),this.client.currentState!==We.CONNECTED)throw new Tr("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(oe.Restarted)}catch(l){const c=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(c){yield this.restartConnection(c);return}else throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),l}})}resumeConnection(e){return C(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new dt("could not reconnect, url or token not saved");if(!this.pcManager)throw new dt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(oe.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(o){let l="";throw o instanceof Error&&(l=o.message,this.log.error(o.message,Object.assign(Object.assign({},this.logContext),{error:o}))),o instanceof Be&&o.reason===Oe.NotAllowed?new dt("could not reconnect, token might be expired"):o instanceof Be&&o.reason===Oe.LeaveRequest?o:new Tr(l)}if(this.emit(oe.SignalResumed),r){const o=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(o),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=r.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==We.CONNECTED)throw new Tr("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),r!=null&&r.lastMessageSeq&&this.resendReliableMessagesForResume(r.lastMessageSeq),this.emit(oe.Resumed)})}waitForPCInitialConnection(e,t){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return C(this,void 0,void 0,function*(){this.pcState=dn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ut(hC),!this.pcManager)throw new dt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=dn.Connected}catch(e){throw this.pcState=dn.Disconnected,new Be("could not establish PC connection, ".concat(e.message),Oe.InternalError)}})}publishRpcResponse(e,t,r,o){return C(this,void 0,void 0,function*(){const l=new Mt({destinationIdentities:[e],kind:Te.RELIABLE,value:{case:"rpcResponse",value:new ag({requestId:t,value:o?{case:"error",value:o.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(l,Te.RELIABLE)})}publishRpcAck(e,t){return C(this,void 0,void 0,function*(){const r=new Mt({destinationIdentities:[e],kind:Te.RELIABLE,value:{case:"rpcAck",value:new og({requestId:t})}});yield this.sendDataPacket(r,Te.RELIABLE)})}sendDataPacket(e,t){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(t),t===Te.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const r=e.toBinary(),o=this.dataChannelForKind(t);if(o){if(t===Te.RELIABLE&&this.reliableMessageBuffer.push({data:r,sequence:e.sequence}),this.attemptingReconnect)return;o.send(r)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Te.RELIABLE);const t=this.dataChannelForKind(Te.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(r=>{t.send(r.data)})),this.updateAndEmitDCBufferStatus(Te.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((t,r)=>C(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const o=()=>r("Engine closed");for(this.once(oe.Closing,o);!this.dcBufferStatus.get(e);)yield Ut(10);this.off(oe.Closing,o),t()}}))}ensureDataTransportConnected(e){return C(this,arguments,void 0,function(t){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var l;if(!r.pcManager)throw new dt("PC manager is closed");const c=o?r.pcManager.subscriber:r.pcManager.publisher,u=o?"Subscriber":"Publisher";if(!c)throw new Be("".concat(u," connection not set"),Oe.InternalError);let h=!1;!o&&!r.dataChannelForKind(t,o)&&(r.createDataChannels(),h=!0),!h&&!o&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(h=!0),h&&r.negotiate();const f=r.dataChannelForKind(t,o);if((f==null?void 0:f.readyState)==="open")return;const m=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<m;){if(c.isICEConnected&&((l=r.dataChannelForKind(t,o))===null||l===void 0?void 0:l.readyState)==="open")return;yield Ut(50)}throw new Be("could not establish ".concat(u," connection, state: ").concat(c.getICEConnectionState()),Oe.InternalError)})()})}ensurePublisherConnected(e){return C(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Xe.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return C(this,void 0,void 0,function*(){return new Promise((e,t)=>C(this,void 0,void 0,function*(){if(!this.pcManager){t(new pu("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,o=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(oe.Closing,o),this.pcManager.publisher.once(Nr.RTPVideoPayloadTypes,l=>{const c=new Map;l.forEach(u=>{const h=u.codec.toLowerCase();gT(h)&&c.set(u.payload,h)}),this.emit(oe.RTPVideoMapUpdate,c)});try{yield this.pcManager.negotiate(r),e()}catch(l){l instanceof pu&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",br.RR_UNKNOWN),t(l)}finally{this.off(oe.Closing,o)}}))})}dataChannelForKind(e,t){if(t){if(e===Te.LOSSY)return this.lossyDCSub;if(e===Te.RELIABLE)return this.reliableDCSub}else{if(e===Te.LOSSY)return this.lossyDC;if(e===Te.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var r,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.subscriber.getLocalDescription(),c=this.pcManager.subscriber.getRemoteDescription(),u=(o=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&o!==void 0?o:!0,h=new Array,f=new Array;e.forEach(m=>{m.isDesired!==u&&h.push(m.trackSid),m.isEnabled||f.push(m.trackSid)}),this.client.sendSyncState(new wg({answer:l?ba({sdp:l.sdp,type:l.type}):void 0,offer:c?ba({sdp:c.sdp,type:c.type}):void 0,subscription:new _a({trackSids:h,subscribe:!u,participantTracks:[]}),publishTracks:xT(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:f,datachannelReceiveStates:this.reliableReceivedState.map((m,v)=>new xg({publisherSid:v,lastSeq:m}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(r,o)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new Eg({label:r.label,id:r.id,target:o}))};return t(this.dataChannelForKind(Te.LOSSY),pn.PUBLISHER),t(this.dataChannelForKind(Te.RELIABLE),pn.PUBLISHER),t(this.dataChannelForKind(Te.LOSSY,!0),pn.SUBSCRIBER),t(this.dataChannelForKind(Te.RELIABLE,!0),pn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&kt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Lt()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Lt()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Tr extends Error{}function mC(i){return i!==void 0&&i>13}function gC(i,e){const t=i.participantIdentity?i.participantIdentity:e.participantIdentity;i.participantIdentity=t,e.participantIdentity=t;const r=i.destinationIdentities.length!==0?i.destinationIdentities:e.destinationIdentities;i.destinationIdentities=r,e.destinationIdentities=r}class Ru{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Su(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return C(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(t.length>0){const r=t[0];return this.attemptedRegions.push(r),_e.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return C(this,void 0,void 0,function*(){const t=yield fetch("".concat(vC(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const r=yield t.json();return this.lastUpdateAt=Date.now(),r}else throw new Be("Could not fetch region settings: ".concat(t.statusText),t.status===401?Oe.NotAllowed:Oe.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function vC(i){return"".concat(i.protocol.replace("ws","http"),"//").concat(i.host,"/settings")}class Sv{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new yi("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),mn.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new yi("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),mn.LengthExceeded)}}constructor(e,t,r,o){this.reader=t,this.totalByteSize=r,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=o}}class yC extends Sv{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new Rn,r=null,o=null;if(this.signal){const c=this.signal;o=()=>{var u;(u=t.reject)===null||u===void 0||u.call(t,c.reason)},c.addEventListener("abort",o),r=c}const l=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var c,u;try{const{done:h,value:f}=yield Promise.race([e.read(),t.promise,(u=(c=this.outOfBandFailureRejectingFuture)===null||c===void 0?void 0:c.promise)!==null&&u!==void 0?u:new Promise(()=>{})]);return h?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(f),{done:!1,value:f.content})}catch(h){throw l(),h}}),return(){return C(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,o,l,c;let u=new Set;const h=t.signal?e.withAbortSignal(t.signal):e;try{for(var f=!0,m=Kn(h),v;v=yield m.next(),r=v.done,!r;f=!0){c=v.value,f=!1;const k=c;u.add(k)}}catch(k){o={error:k}}finally{try{!f&&!r&&(l=m.return)&&(yield l.call(m))}finally{if(o)throw o.error}}return Array.from(u)})()})}}class kC extends Sv{constructor(e,t,r,o){super(e,t,r,o),this.receivedChunks=new Map}handleChunkReceived(e){var t;const r=ga(e.chunkIndex),o=this.receivedChunks.get(r);if(o&&o.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const l=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,l)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let r=new Rn,o=null,l=null;if(this.signal){const u=this.signal;l=()=>{var h;(h=r.reject)===null||h===void 0||h.call(r,u.reason)},u.addEventListener("abort",l),o=u}const c=()=>{e.releaseLock(),o&&l&&o.removeEventListener("abort",l),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var u,h;try{const{done:f,value:m}=yield Promise.race([e.read(),r.promise,(h=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&h!==void 0?h:new Promise(()=>{})]);if(f)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(m);let v;try{v=t.decode(m.content)}catch(k){throw new yi("Cannot decode datastream chunk ".concat(m.chunkIndex," as text: ").concat(k),mn.DecodeFailed)}return{done:!1,value:v}}}catch(f){throw c(),f}}),return(){return C(this,void 0,void 0,function*(){return c(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,o,l,c;let u="";const h=t.signal?e.withAbortSignal(t.signal):e;try{for(var f=!0,m=Kn(h),v;v=yield m.next(),r=v.done,!r;f=!0)c=v.value,f=!1,u+=c}catch(k){o={error:k}}finally{try{!f&&!r&&(l=m.return)&&(yield l.call(m))}finally{if(o)throw o.error}}return u})()})}}class SC{constructor(){this.log=_e,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new yi('A text stream handler for topic "'.concat(e,'" has already been set.'),mn.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new yi('A byte stream handler for topic "'.concat(e,'" has already been set.'),mn.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,r,o,l;const c=Array.from(this.textStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e),u=Array.from(this.byteStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e);if(c.length>0||u.length>0){const h=new yi("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),mn.AbnormalEnd);for(const[f,m]of u)(r=(t=m.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(t,h),this.byteStreamControllers.delete(f);for(const[f,m]of c)(l=(o=m.outOfBandFailureRejectingFuture).reject)===null||l===void 0||l.call(o,h),this.textStreamControllers.delete(f)}}handleDataStreamPacket(e){return C(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity);case"streamChunk":return this.handleStreamChunk(e.value.value);case"streamTrailer":return this.handleStreamTrailer(e.value.value);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t){return C(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let l;const c=new Rn,u={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:ga(e.timestamp),attributes:e.attributes},h=new ReadableStream({start:f=>{if(l=f,this.textStreamControllers.has(e.streamId))throw new yi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),mn.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:u,controller:l,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:c})}});o(new yC(u,h,ga(e.totalLength),c),{identity:t})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let l;const c=new Rn,u={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},h=new ReadableStream({start:f=>{if(l=f,this.textStreamControllers.has(e.streamId))throw new yi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),mn.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:u,controller:l,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:c})}});o(new kC(u,h,ga(e.totalLength),c),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const r=this.textStreamControllers.get(e.streamId);r&&e.content.length>0&&r.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.byteStreamControllers.delete(e.streamId))}}class bv{constructor(e,t,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return C(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class bC extends bv{}class TC extends bv{}const fm=15e3;class CC{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return C(this,void 0,void 0,function*(){var r;const o=crypto.randomUUID(),c=new TextEncoder().encode(e).byteLength,u=(r=t==null?void 0:t.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),h=new Array(u?u.length+1:1).fill(0),f=(v,k)=>{var b;h[k]=v;const P=h.reduce((w,_)=>w+_,0);(b=t==null?void 0:t.onProgress)===null||b===void 0||b.call(t,P)},m=yield this.streamText({streamId:o,totalSize:c,destinationIdentities:t==null?void 0:t.destinationIdentities,topic:t==null?void 0:t.topic,attachedStreamIds:u,attributes:t==null?void 0:t.attributes});return yield m.write(e),f(1,0),yield m.close(),t!=null&&t.attachments&&u&&(yield Promise.all(t.attachments.map((v,k)=>C(this,void 0,void 0,function*(){return this._sendFile(u[k],v,{topic:t.topic,mimeType:v.type,onProgress:b=>{f(b,k+1)}})})))),m.info})}streamText(e){return C(this,void 0,void 0,function*(){var t,r;const o=(t=e==null?void 0:e.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),l={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},c=new eu({streamId:o,mimeType:l.mimeType,topic:l.topic,timestamp:Bi(l.timestamp),totalLength:Bi(e==null?void 0:e.totalSize),attributes:l.attributes,contentHeader:{case:"textHeader",value:new mg({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Zc.UPDATE:Zc.CREATE})}}),u=e==null?void 0:e.destinationIdentities,h=new Mt({destinationIdentities:u,value:{case:"streamHeader",value:c}});yield this.engine.sendDataPacket(h,Te.RELIABLE);let f=0;const m=this.engine,v=new WritableStream({write(P){return C(this,void 0,void 0,function*(){for(const w of TT(P,fm)){yield m.waitForBufferStatusLow(Te.RELIABLE);const _=new tu({content:w,streamId:o,chunkIndex:Bi(f)}),M=new Mt({destinationIdentities:u,value:{case:"streamChunk",value:_}});yield m.sendDataPacket(M,Te.RELIABLE),f+=1}})},close(){return C(this,void 0,void 0,function*(){const P=new nu({streamId:o}),w=new Mt({destinationIdentities:u,value:{case:"streamTrailer",value:P}});yield m.sendDataPacket(w,Te.RELIABLE)})},abort(P){console.log("Sink error:",P)}});let k=()=>C(this,void 0,void 0,function*(){yield b.close()});m.once(oe.Closing,k);const b=new bC(v,l,()=>this.engine.off(oe.Closing,k));return b})}sendFile(e,t){return C(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,t),{id:r}})}_sendFile(e,t,r){return C(this,void 0,void 0,function*(){var o;const l=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:(o=r==null?void 0:r.mimeType)!==null&&o!==void 0?o:t.type,topic:r==null?void 0:r.topic,destinationIdentities:r==null?void 0:r.destinationIdentities}),c=t.stream().getReader();for(;;){const{done:u,value:h}=yield c.read();if(u)break;yield l.write(h)}return yield l.close(),l.info})}streamBytes(e){return C(this,void 0,void 0,function*(){var t,r,o,l,c;const u=(t=e==null?void 0:e.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),h=e==null?void 0:e.destinationIdentities,f={id:u,mimeType:(r=e==null?void 0:e.mimeType)!==null&&r!==void 0?r:"application/octet-stream",topic:(o=e==null?void 0:e.topic)!==null&&o!==void 0?o:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(l=e==null?void 0:e.name)!==null&&l!==void 0?l:"unknown"},m=new eu({totalLength:Bi((c=f.size)!==null&&c!==void 0?c:0),mimeType:f.mimeType,streamId:u,topic:f.topic,timestamp:Bi(Date.now()),attributes:f.attributes,contentHeader:{case:"byteHeader",value:new gg({name:f.name})}}),v=new Mt({destinationIdentities:h,value:{case:"streamHeader",value:m}});yield this.engine.sendDataPacket(v,Te.RELIABLE);let k=0;const b=new At,P=this.engine,w=this.log,_=new WritableStream({write(z){return C(this,void 0,void 0,function*(){const U=yield b.lock();let I=0;try{for(;I<z.byteLength;){const A=z.slice(I,I+fm);yield P.waitForBufferStatusLow(Te.RELIABLE);const V=new Mt({destinationIdentities:h,value:{case:"streamChunk",value:new tu({content:A,streamId:u,chunkIndex:Bi(k)})}});yield P.sendDataPacket(V,Te.RELIABLE),k+=1,I+=A.byteLength}}finally{U()}})},close(){return C(this,void 0,void 0,function*(){const z=new nu({streamId:u}),U=new Mt({destinationIdentities:h,value:{case:"streamTrailer",value:z}});yield P.sendDataPacket(U,Te.RELIABLE)})},abort(z){w.error("Sink error:",z)}});return new TC(_,f)})}}class Tv extends q{constructor(e,t,r,o,l){super(e,r,l),this.sid=t,this.receiver=o}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Z.Muted:Z.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Z.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Zu)),ET()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(t=this.receiver)===null||t===void 0?void 0:t.getSynchronizationSources()[0];if(r){const{timestamp:o,rtpTimestamp:l}=r;l&&this.rtpTimestamp!==l&&(this.emit(Z.TimeSyncUpdate,{timestamp:o,rtpTimestamp:l}),this.rtpTimestamp=l)}};e()}}class wC extends Tv{constructor(e,t,r,o,l,c){super(e,t,q.Kind.Audio,r,c),this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=Oa(u,this.prevStats)),this.prevStats=u}),this.audioContext=o,this.webAudioPluginNodes=[],l&&(this.sinkId=l.deviceId)}setVolume(e){var t;for(const r of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):r.volume=e;In()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(In())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return C(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(ku(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&ku(e)&&e.setSinkId(this.sinkId).catch(r=>{this.log.error("Failed to set sink id on remote audio track",r,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(o=>{r.connect(o),r=o}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Z.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(o=>{this.emit(Z.AudioPlaybackFailed,o)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(r=>{r.type==="inbound-rtp"&&(t={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),t})}}const Kc=100;class xC extends Tv{constructor(e,t,r,o,l){super(e,t,q.Kind.Video,r,l),this.elementInfos=[],this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const c=yield this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=Oa(c,this.prevStats)),this.prevStats=c}),this.debouncedHandleResize=Ju(()=>{this.updateDimensions()},Kc),this.adaptiveStreamSettings=o}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),console.log("setStreamState",e),e===q.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?_r(this._mediaStreamTrack,t):xr(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new EC(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(r=>r===e);for(const r of t)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const r of t)this.stopObservingElement(r);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,r="",o=new Map;return e.forEach(l=>{l.type==="inbound-rtp"?(r=l.codecId,t={type:"video",streamId:l.id,framesDecoded:l.framesDecoded,framesDropped:l.framesDropped,framesReceived:l.framesReceived,packetsReceived:l.packetsReceived,packetsLost:l.packetsLost,frameWidth:l.frameWidth,frameHeight:l.frameHeight,pliCount:l.pliCount,firCount:l.firCount,nackCount:l.nackCount,jitter:l.jitter,timestamp:l.timestamp,bytesReceived:l.bytesReceived,decoderImplementation:l.decoderImplementation}):l.type==="codec"&&o.set(l.id,l)}),t&&r!==""&&o.get(r)&&(t.mimeType=o.get(r).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(r=>r.element===e);for(const r of t)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var t,r;const o=this.elementInfos.reduce((h,f)=>Math.max(h,f.visibilityChangedAt||0),0),l=!((r=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&r!==void 0)||r?this.isInBackground:!1,c=this.elementInfos.some(h=>h.pictureInPicture),u=this.elementInfos.some(h=>h.visible)&&!l||c;if(!(this.lastVisible===u&&!e)){if(!u&&Date.now()-o<Kc){kt.setTimeout(()=>{this.updateVisibility()},Kc);return}this.lastVisible=u,this.emit(Z.VisibilityChanged,u,this)}}updateDimensions(){var e,t;let r=0,o=0;const l=this.getPixelDensity();for(const c of this.elementInfos){const u=c.width()*l,h=c.height()*l;u+h>r+o&&(r=u,o=h)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===o||(this.lastDimensions={width:r,height:o},this.emit(Z.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?Hp():t||(Hp()>2?2:1)}}class EC{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=r=>{var o;const{target:l,isIntersecting:c}=r;l===this.element&&(this.isIntersecting=c,this.isPiP=Es(this.element),this.visibilityChangedAt=Date.now(),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this))},this.onEnterPiP=()=>{var r,o,l;(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Es(this.element),(l=this.handleVisibilityChanged)===null||l===void 0||l.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=Es(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=t??_u(e),this.isPiP=Lt()&&Es(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,r;this.isIntersecting=_u(this.element),this.isPiP=Es(this.element),this.element.handleResize=()=>{var o;(o=this.handleResize)===null||o===void 0||o.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Gp().observe(this.element),Kp().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,r,o,l;(e=Gp())===null||e===void 0||e.unobserve(this.element),(t=Kp())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(l=(o=window.documentPictureInPicture)===null||o===void 0?void 0:o.window)===null||l===void 0||l.removeEventListener("pagehide",this.onLeavePiP)}}function Es(i){var e,t;return document.pictureInPictureElement===i?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?_u(i,(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window):!1}function _u(i,e){const t=e||window;let r=i.offsetTop,o=i.offsetLeft;const l=i.offsetWidth,c=i.offsetHeight,{hidden:u}=i,{display:h}=getComputedStyle(i);for(;i.offsetParent;)i=i.offsetParent,r+=i.offsetTop,o+=i.offsetLeft;return r<t.pageYOffset+t.innerHeight&&o<t.pageXOffset+t.innerWidth&&r+c>t.pageYOffset&&o+l>t.pageXOffset&&!u&&h!=="none"}class qn extends On.EventEmitter{constructor(e,t,r,o){var l;super(),this.metadataMuted=!1,this.encryption=Wt.NONE,this.log=_e,this.handleMuted=()=>{this.emit(Z.Muted)},this.handleUnmuted=()=>{this.emit(Z.Unmuted)},this.log=$n((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:vn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=r,this.source=q.Source.Unknown}setTrack(e){this.track&&(this.track.off(Z.Muted,this.handleMuted),this.track.off(Z.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Z.Muted,this.handleMuted),e.on(Z.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ee(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Wt.NONE}get audioTrack(){if(_n(this.track))return this.track}get videoTrack(){if(xi(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=q.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===q.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(i){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(i.SubscriptionStatus||(i.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(i.PermissionStatus||(i.PermissionStatus={}))})(qn||(qn={}));class Iu extends qn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,r,o){super(e,t.sid,t.name,o),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Z.Ended)},this.handleCpuConstrained=()=>{this.track&&xi(this.track)&&this.emit(Z.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(r)}setTrack(e){this.track&&(this.track.off(Z.Ended,this.handleTrackEnded),this.track.off(Z.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(Z.Ended,this.handleTrackEnded),e.on(Z.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(_n(this.track)){const t=this.track.getSourceTrackSettings(),r=new Set;return t.autoGainControl&&r.add(mt.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&r.add(mt.TF_ECHO_CANCELLATION),t.noiseSuppression&&r.add(mt.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&r.add(mt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(mt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(mt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function Da(i,e){return C(this,void 0,void 0,function*(){i??(i={});let t=!1;const{audioProcessor:r,videoProcessor:o,optionsWithoutProcessor:l}=hv(i);let c=l.audio,u=l.video;if(r&&typeof l.audio=="object"&&(l.audio.processor=r),o&&typeof l.video=="object"&&(l.video.processor=o),i.audio&&typeof l.audio=="object"&&typeof l.audio.deviceId=="string"){const v=l.audio.deviceId;l.audio.deviceId={exact:v},t=!0,c=Object.assign(Object.assign({},l.audio),{deviceId:{ideal:v}})}if(l.video&&typeof l.video=="object"&&typeof l.video.deviceId=="string"){const v=l.video.deviceId;l.video.deviceId={exact:v},t=!0,u=Object.assign(Object.assign({},l.video),{deviceId:{ideal:v}})}(l.audio===!0||typeof l.audio=="object"&&!l.audio.deviceId)&&(l.audio={deviceId:"default"}),l.video===!0?l.video={deviceId:"default"}:typeof l.video=="object"&&!l.video.deviceId&&(l.video.deviceId="default");const h=cv(l,pv,mv),f=Ku(h),m=navigator.mediaDevices.getUserMedia(f);l.audio&&(gt.userMediaPromiseMap.set("audioinput",m),m.catch(()=>gt.userMediaPromiseMap.delete("audioinput"))),l.video&&(gt.userMediaPromiseMap.set("videoinput",m),m.catch(()=>gt.userMediaPromiseMap.delete("videoinput")));try{const v=yield m;return yield Promise.all(v.getTracks().map(k=>C(this,void 0,void 0,function*(){const b=k.kind==="audio";let P=b?h.audio:h.video;(typeof P=="boolean"||!P)&&(P={});let w;const _=b?f.audio:f.video;typeof _!="boolean"&&(w=_);const M=k.getSettings().deviceId;w!=null&&w.deviceId&&Ci(w.deviceId)!==M?w.deviceId=M:w||(w={deviceId:M});const z=eC(k,w,e);return z.kind===q.Kind.Video?z.source=q.Source.Camera:z.kind===q.Kind.Audio&&(z.source=q.Source.Microphone),z.mediaStream=v,_n(z)&&r?yield z.setProcessor(r):xi(z)&&o&&(yield z.setProcessor(o)),z})))}catch(v){if(!t)throw v;return Da(Object.assign(Object.assign({},i),{audio:c,video:u}),e)}})}function PC(i){return C(this,void 0,void 0,function*(){return(yield Da({audio:!1,video:!0}))[0]})}function Cv(i){return C(this,void 0,void 0,function*(){return(yield Da({audio:i??!0,video:!1}))[0]})}var ki;(function(i){i.Excellent="excellent",i.Good="good",i.Poor="poor",i.Lost="lost",i.Unknown="unknown"})(ki||(ki={}));function RC(i){switch(i){case _s.EXCELLENT:return ki.Excellent;case _s.GOOD:return ki.Good;case _s.POOR:return ki.Poor;case _s.LOST:return ki.Lost;default:return ki.Unknown}}class wv extends On.EventEmitter{get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===js.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Er.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,r,o,l,c){let u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:js.STANDARD;var h;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ki.Unknown,this.log=_e,this.log=$n((h=c==null?void 0:c.loggerName)!==null&&h!==void 0?h:vn.Participant),this.loggerOptions=c,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=r,this.metadata=o,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=u,this._attributes=l??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Rn,this.once(ae.Active,()=>{var e,t;(t=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||t===void 0||t.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(q.Source.Camera);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(q.Source.Microphone);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(q.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var t;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Er.ACTIVE&&((t=this.participantInfo)===null||t===void 0?void 0:t.state)!==Er.ACTIVE&&this.emit(ae.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,r=this.metadata;this.metadata=e,t&&this.emit(ae.ParticipantMetadataChanged,r)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ae.ParticipantNameChanged,e)}_setAttributes(e){const t=PT(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ae.AttributesChanged,t)}setPermissions(e){var t,r,o,l,c,u;const h=this.permissions,f=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||e.hidden!==((l=this.permissions)===null||l===void 0?void 0:l.hidden)||e.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((m,v)=>{var k;return m!==((k=this.permissions)===null||k===void 0?void 0:k.canPublishSources[v])})||e.canSubscribeMetrics!==((u=this.permissions)===null||u===void 0?void 0:u.canSubscribeMetrics);return this.permissions=e,f&&this.emit(ae.ParticipantPermissionsChanged,h),f}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ae.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=RC(e),t!==this._connectionQuality&&this.emit(ae.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&((t=(e=this.activeFuture).reject)===null||t===void 0||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>_n(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(Z.Muted,()=>{this.emit(ae.TrackMuted,e)}),e.on(Z.Unmuted,()=>{this.emit(ae.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case q.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case q.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function _C(i){var e,t,r;if(!i.participantSid&&!i.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Tg({participantIdentity:(e=i.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=i.participantSid)!==null&&t!==void 0?t:"",allTracks:(r=i.allowAll)!==null&&r!==void 0?r:!1,trackSids:i.allowedTrackSids||[]})}class IC extends wv{constructor(e,t,r,o,l,c){super(e,t,void 0,void 0,void 0,{loggerName:o.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Wt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Rn)},this.handleReconnected=()=>{var u,h;(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||h===void 0||h.call(u),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var u,h,f,m,v,k;this.reconnectFuture&&(this.reconnectFuture.promise.catch(b=>this.log.warn(b.message,this.logContext)),(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||h===void 0||h.call(u,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((m=(f=this.signalConnectedFuture).reject)===null||m===void 0||m.call(f,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(k=(v=this.activeAgentFuture)===null||v===void 0?void 0:v.reject)===null||k===void 0||k.call(v,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=u=>{var h,f;u.participant&&this.updateInfo(u.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Rn),(f=(h=this.signalConnectedFuture).resolve)===null||f===void 0||f.call(h)},this.handleSignalRequestResponse=u=>{const{requestId:h,reason:f,message:m}=u,v=this.pendingSignalRequests.get(h);v&&(f!==zu.OK&&v.reject(new Vp(m,f)),this.pendingSignalRequests.delete(h))},this.handleDataPacket=u=>{switch(u.value.case){case"rpcResponse":let h=u.value.value,f=null,m=null;h.value.case==="payload"?f=h.value.value:h.value.case==="error"&&(m=et.fromProto(h.value.value)),this.handleIncomingRpcResponse(h.requestId,f,m);break;case"rpcAck":let v=u.value.value;this.handleIncomingRpcAck(v.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(u=>_C(u)))},this.onTrackUnmuted=u=>{this.onTrackMuted(u,u.isUpstreamPaused)},this.onTrackMuted=(u,h)=>{if(h===void 0&&(h=!0),!u.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Ee(u)));return}this.engine.updateMuteStatus(u.sid,h)},this.onTrackUpstreamPaused=u=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Ee(u))),this.onTrackMuted(u,!0)},this.onTrackUpstreamResumed=u=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Ee(u))),this.onTrackMuted(u,u.isMuted)},this.onTrackFeatureUpdate=u=>{const h=this.audioTrackPublications.get(u.sid);if(!h){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(h.trackSid,h.getTrackFeatures())},this.onTrackCpuConstrained=(u,h)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Ee(h))),this.emit(ae.LocalTrackCpuConstrained,u,h)},this.handleSubscribedQualityUpdate=u=>C(this,void 0,void 0,function*(){var h,f,m,v,k;if(!(!((k=this.roomOptions)===null||k===void 0)&&k.dynacast))return;const b=this.videoTrackPublications.get(u.trackSid);if(!b){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}if(!b.videoTrack)return;const P=yield b.videoTrack.setPublishingCodecs(u.subscribedCodecs);try{for(var w=!0,_=Kn(P),M;M=yield _.next(),h=M.done,!h;w=!0){v=M.value,w=!1;const z=v;rT(z)&&(this.log.debug("publish ".concat(z," for ").concat(b.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Ee(b))),yield this.publishAdditionalCodecForTrack(b.videoTrack,z,b.options))}}catch(z){f={error:z}}finally{try{!w&&!h&&(m=_.return)&&(yield m.call(_))}finally{if(f)throw f.error}}}),this.handleLocalTrackUnpublished=u=>{const h=this.trackPublications.get(u.trackSid);if(!h){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}this.unpublishTrack(h.track)},this.handleTrackEnded=u=>C(this,void 0,void 0,function*(){if(u.source===q.Source.ScreenShare||u.source===q.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Ee(u))),this.unpublishTrack(u);else if(u.isUserProvided)yield u.mute();else if(zn(u)||gi(u))try{if(Lt())try{const h=yield navigator==null?void 0:navigator.permissions.query({name:u.source===q.Source.Camera?"camera":"microphone"});if(h&&h.state==="denied")throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),Ee(u))),h.onchange=()=>{h.state!=="denied"&&(u.isMuted||u.restartTrack(),h.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}u.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Ee(u))),zn(u)?yield u.restartTrack({deviceId:"default"}):yield u.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Ee(u))),yield u.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=o,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=l,this.roomOutgoingDataStreamManager=c}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Wt.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(oe.RemoteMute,(r,o)=>{const l=this.trackPublications.get(r);!l||!l.track||(o?l.mute():l.unmute())}),!((t=this.signalConnectedFuture)===null||t===void 0)&&t.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(oe.Connected,this.handleReconnected).on(oe.SignalConnected,this.handleSignalConnected).on(oe.SignalRestarted,this.handleReconnected).on(oe.SignalResumed,this.handleReconnected).on(oe.Restarting,this.handleReconnecting).on(oe.Resuming,this.handleReconnecting).on(oe.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(oe.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(oe.Closing,this.handleClosing).on(oe.SignalRequestResponse,this.handleSignalRequestResponse).on(oe.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return C(this,arguments,void 0,function(t){var r=this;let{metadata:o,name:l,attributes:c}=t;return(function*(){return new Promise((u,h)=>C(r,void 0,void 0,function*(){var f,m;try{let v=!1;const k=yield this.engine.client.sendUpdateLocalMetadata((f=o??this.metadata)!==null&&f!==void 0?f:"",(m=l??this.name)!==null&&m!==void 0?m:"",c),b=performance.now();for(this.pendingSignalRequests.set(k,{resolve:u,reject:P=>{h(P),v=!0},values:{name:l,metadata:o,attributes:c}});performance.now()-b<5e3&&!v;){if((!l||this.name===l)&&(!o||this.metadata===o)&&(!c||Object.entries(c).every(P=>{let[w,_]=P;return this.attributes[w]===_||_===""&&!this.attributes[w]}))){this.pendingSignalRequests.delete(k),u();return}yield Ut(50)}h(new Vp("Request to update local metadata timed out","TimeoutError"))}catch(v){v instanceof Error&&h(v)}}))})()})}setCameraEnabled(e,t,r){return this.setTrackEnabled(q.Source.Camera,e,t,r)}setMicrophoneEnabled(e,t,r){return this.setTrackEnabled(q.Source.Microphone,e,t,r)}setScreenShareEnabled(e,t,r){return this.setTrackEnabled(q.Source.ScreenShare,e,t,r)}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){this.encryptionType=e?Wt.GCM:Wt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,r,o){return C(this,void 0,void 0,function*(){var l,c;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let u=this.getTrackPublication(e);if(t)if(u)yield u.unmute();else{let h;if(this.pendingPublishing.has(e)){const f=yield this.waitForPendingPublicationOfSource(e);return f||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield f==null?void 0:f.unmute(),f}this.pendingPublishing.add(e);try{switch(e){case q.Source.Camera:h=yield this.createTracks({video:(l=r)!==null&&l!==void 0?l:!0});break;case q.Source.Microphone:h=yield this.createTracks({audio:(c=r)!==null&&c!==void 0?c:!0});break;case q.Source.ScreenShare:h=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Gn(e)}}catch(f){throw h==null||h.forEach(m=>{m.stop()}),f instanceof Error&&this.emit(ae.MediaDevicesError,f,wu(e)),this.pendingPublishing.delete(e),f}for(const f of h){const m=Object.assign(Object.assign({},this.roomOptions.publishDefaults),r);e===q.Source.Microphone&&_n(f)&&m.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),f.startPreConnectBuffer())}try{const f=[];for(const v of h)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Ee(v))),f.push(this.publishTrack(v,o));[u]=yield Promise.all(f)}catch(f){throw h==null||h.forEach(m=>{m.stop()}),f}finally{this.pendingPublishing.delete(e)}}else if(!(u!=null&&u.track)&&this.pendingPublishing.has(e)&&(u=yield this.waitForPendingPublicationOfSource(e),u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),u&&u.track)if(e===q.Source.ScreenShare){u=yield this.unpublishTrack(u.track);const h=this.getTrackPublication(q.Source.ScreenShareAudio);h&&h.track&&this.unpublishTrack(h.track)}else yield u.mute();return u})}enableCameraAndMicrophone(){return C(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(q.Source.Camera)||this.pendingPublishing.has(q.Source.Microphone))){this.pendingPublishing.add(q.Source.Camera),this.pendingPublishing.add(q.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(q.Source.Camera),this.pendingPublishing.delete(q.Source.Microphone)}}})}createTracks(e){return C(this,void 0,void 0,function*(){var t,r;e??(e={});const o=cv(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults);try{return(yield Da(o,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(u=>(_n(u)&&(this.microphoneError=void 0,u.setAudioContext(this.audioContext),u.source=q.Source.Microphone,this.emit(ae.AudioStreamAcquired)),xi(u)&&(this.cameraError=void 0,u.source=q.Source.Camera),u))}catch(l){throw l instanceof Error&&(e.audio&&(this.microphoneError=l),e.video&&(this.cameraError=l)),l}})}createScreenTracks(e){return C(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Wu("getDisplayMedia not supported");e.resolution===void 0&&!uT()&&(e.resolution=Hu.h1080fps30.resolution);const t=wT(e),r=yield navigator.mediaDevices.getDisplayMedia(t),o=r.getVideoTracks();if(o.length===0)throw new Gn("no video track found");const l=new Ca(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=q.Source.ScreenShare,e.contentHint&&(l.mediaStreamTrack.contentHint=e.contentHint);const c=[l];if(r.getAudioTracks().length>0){this.emit(ae.AudioStreamAcquired);const u=new Ta(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});u.source=q.Source.ScreenShareAudio,c.push(u)}return c})}publishTrack(e,t){return C(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return C(this,arguments,void 0,function(r,o){var l=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var u,h,f,m;zn(r)&&r.setAudioContext(l.audioContext),yield(u=l.reconnectFuture)===null||u===void 0?void 0:u.promise,l.republishPromise&&!c&&(yield l.republishPromise),Ir(r)&&l.pendingPublishPromises.has(r)&&(yield l.pendingPublishPromises.get(r));let v;if(r instanceof MediaStreamTrack)v=r.getConstraints();else{v=r.constraints;let M;switch(r.source){case q.Source.Microphone:M="audioinput";break;case q.Source.Camera:M="videoinput"}M&&l.activeDeviceMap.has(M)&&(v=Object.assign(Object.assign({},v),{deviceId:l.activeDeviceMap.get(M)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new Ta(r,v,!0,l.audioContext,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;case"video":r=new Ca(r,v,!0,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;default:throw new Gn("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});let k;if(l.trackPublications.forEach(M=>{M.track&&M.track===r&&(k=M)}),k)return l.log.warn("track has already been published, skipping",Object.assign(Object.assign({},l.logContext),Ee(k))),k;const b=Object.assign(Object.assign({},l.roomOptions.publishDefaults),o),P="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,w=(h=b.forceStereo)!==null&&h!==void 0?h:P;w&&(b.dtx===void 0&&l.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},l.logContext),Ee(r))),b.red===void 0&&l.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(f=b.dtx)!==null&&f!==void 0||(b.dtx=!1),(m=b.red)!==null&&m!==void 0||(b.red=!1)),!hT()&&l.roomOptions.e2ee&&(l.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},l.logContext)),b.simulcast=!1),b.source&&(r.source=b.source);const _=new Promise((M,z)=>C(l,void 0,void 0,function*(){try{if(this.engine.client.currentState!==We.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Ee(r)}));const U=setTimeout(()=>{z(new Bp("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(U);const I=yield this.publish(r,b,w);M(I)}else try{const U=yield this.publish(r,b,w);M(U)}catch(U){z(U)}}catch(U){z(U)}}));l.pendingPublishPromises.set(r,_);try{return yield _}catch(M){throw M}finally{l.pendingPublishPromises.delete(r)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Rn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Ee(e))),!1;const{canPublish:t,canPublishSources:r}=this.permissions;return t&&(r.length===0||r.map(o=>RT(o)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Ee(e))),!1)}publish(e,t,r){return C(this,void 0,void 0,function*(){var o,l,c,u,h,f,m,v,k,b;if(!this.hasPermissionsToPublish(e))throw new Bp("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(B=>Ir(e)&&B.source===e.source)&&e.source!==q.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Ee(e))),t.stopMicTrackOnMute&&_n(e)&&(e.stopOnMute=!0),e.source===q.Source.ScreenShare&&Hi()&&(t.simulcast=!1),t.videoCodec==="av1"&&!aT()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!lT()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=xu),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(B=>t.videoCodec===Ds(B.mime))||(t.videoCodec=Ds(this.enabledPublishVideoCodecs[0].mime)));const w=t.videoCodec;e.on(Z.Muted,this.onTrackMuted),e.on(Z.Unmuted,this.onTrackUnmuted),e.on(Z.Ended,this.handleTrackEnded),e.on(Z.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Z.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Z.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const _=[],M=!(!((o=t.dtx)!==null&&o!==void 0)||o),z=e.getSourceTrackSettings();z.autoGainControl&&_.push(mt.TF_AUTO_GAIN_CONTROL),z.echoCancellation&&_.push(mt.TF_ECHO_CANCELLATION),z.noiseSuppression&&_.push(mt.TF_NOISE_SUPPRESSION),z.channelCount&&z.channelCount>1&&_.push(mt.TF_STEREO),M&&_.push(mt.TF_NO_DTX),zn(e)&&e.hasPreConnectBuffer&&_.push(mt.TF_PRECONNECT_BUFFER);const U=new su({cid:e.mediaStreamTrack.id,name:t.name,type:q.kindToProto(e.kind),muted:e.isMuted,source:q.sourceToProto(e.source),disableDtx:M,encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((l=t.red)!==null&&l!==void 0)||l),stream:t==null?void 0:t.stream,backupCodecPolicy:t==null?void 0:t.backupCodecPolicy,audioFeatures:_});let I;if(e.kind===q.Kind.Video){let B={width:0,height:0};try{B=yield e.waitForDimensions()}catch{const ne=(u=(c=this.roomOptions.videoCaptureDefaults)===null||c===void 0?void 0:c.resolution)!==null&&u!==void 0?u:Fs.h720.resolution;B={width:ne.width,height:ne.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(e)),{dims:B}))}U.width=B.width,U.height=B.height,gi(e)&&(Pn(w)&&(e.source===q.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Ee(e))))),t.scalabilityMode=(h=t.scalabilityMode)!==null&&h!==void 0?h:"L3T3_KEY"),U.simulcastCodecs=[new ru({codec:w,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:xu}),t.backupCodec&&w!==t.backupCodec.codec&&U.encryption===Wt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),U.simulcastCodecs.push(new ru({codec:t.backupCodec.codec,cid:""})))),I=Pu(e.source===q.Source.ScreenShare,U.width,U.height,t),U.layers=um(U.width,U.height,I,Pn(t.videoCodec))}else e.kind===q.Kind.Audio&&(I=[{maxBitrate:(f=t.audioPreset)===null||f===void 0?void 0:f.maxBitrate,priority:(v=(m=t.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&v!==void 0?v:"high",networkPriority:(b=(k=t.audioPreset)===null||k===void 0?void 0:k.priority)!==null&&b!==void 0?b:"high"}]);if(!this.engine||this.engine.isClosed)throw new dt("cannot publish track when not connected");const A=()=>C(this,void 0,void 0,function*(){var B,ee,ne;if(!this.engine.pcManager)throw new dt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,I),this.emit(ae.LocalSenderCreated,e.sender,e),gi(e)&&((B=t.degradationPreference)!==null&&B!==void 0||(t.degradationPreference=uC(e)),e.setDegradationPreference(t.degradationPreference)),I)if(Hi()&&e.kind===q.Kind.Audio){let ve;for(const Pe of this.engine.pcManager.publisher.getTransceivers())if(Pe.sender===e.sender){ve=Pe;break}ve&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ve,codec:"opus",maxbr:!((ee=I[0])===null||ee===void 0)&&ee.maxBitrate?I[0].maxBitrate/1e3:0})}else e.codec&&Pn(e.codec)&&(!((ne=I[0])===null||ne===void 0)&&ne.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:U.cid,codec:e.codec,maxbr:I[0].maxBitrate/1e3});yield this.engine.negotiate()});let V;const $=new Promise((B,ee)=>C(this,void 0,void 0,function*(){var ne;try{V=yield this.engine.addTrack(U),B(V)}catch(ve){e.sender&&(!((ne=this.engine.pcManager)===null||ne===void 0)&&ne.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Pe=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(e)),{error:Pe}))})),ee(ve)}}));if(this.enabledPublishVideoCodecs.length>0)V=(yield Promise.all([$,A()]))[0];else{V=yield $;let B;if(V.codecs.forEach(ee=>{B===void 0&&(B=ee.mimeType)}),B&&e.kind===q.Kind.Video){const ee=Ds(B);ee!==w&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(e)),{codec:ee})),t.videoCodec=ee,I=Pu(e.source===q.Source.ScreenShare,U.width,U.height,t))}yield A()}const Y=new Iu(e.kind,V,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(Y.on(Z.CpuConstrained,B=>this.onTrackCpuConstrained(B,Y)),Y.options=t,e.sid=V.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:I,trackInfo:V})),gi(e)?e.startMonitor(this.engine.client):zn(e)&&e.startMonitor(),this.addTrackPublication(Y),this.emit(ae.LocalTrackPublished,Y),zn(e)&&V.audioFeatures.includes(mt.TF_PRECONNECT_BUFFER)){const B=e.getPreConnectBuffer(),ee=e.getPreConnectBufferMimeType();this.on(ae.LocalTrackSubscribed,ne=>{if(ne.trackSid===V.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Ee(e))),e.stopPreConnectBuffer()}}),B&&new Promise((ve,Pe)=>C(this,void 0,void 0,function*(){var je,Me,$e,Ie,ie,te;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Ee(e)));const re=setTimeout(()=>{Pe(new Error("agent not active within 10 seconds"))},1e4),ue=yield this.waitUntilActiveAgentPresent();clearTimeout(re),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Ee(e)));const se=yield this.streamBytes({name:"preconnect-buffer",mimeType:ee,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ue.identity],attributes:{trackId:Y.trackSid,sampleRate:String((ie=z.sampleRate)!==null&&ie!==void 0?ie:"48000"),channels:String((te=z.channelCount)!==null&&te!==void 0?te:"1")}});try{for(var H=!0,x=Kn(B),D;D=yield x.next(),je=D.done,!je;H=!0){Ie=D.value,H=!1;const le=Ie;yield se.write(le)}}catch(le){Me={error:le}}finally{try{!H&&!je&&($e=x.return)&&(yield $e.call(x))}finally{if(Me)throw Me.error}}yield se.close(),ve()}catch(re){Pe(re)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Ee(e)))}).catch(ve=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(e)),{error:ve}))})}return Y})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,r){return C(this,void 0,void 0,function*(){var o;if(this.encryptionType!==Wt.NONE)return;let l;if(this.trackPublications.forEach(b=>{b.track&&b.track===e&&(l=b)}),!l)throw new Gn("track is not published");if(!gi(e))throw new Gn("track is not a video track");const c=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),r),u=aC(e,t,c);if(!u){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Ee(e)));return}const h=e.addSimulcastTrack(t,u);if(!h)return;const f=new su({cid:h.mediaStreamTrack.id,type:q.kindToProto(e.kind),muted:e.isMuted,source:q.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:c.videoCodec,cid:h.mediaStreamTrack.id}]});if(f.layers=um(f.width,f.height,u),!this.engine||this.engine.isClosed)throw new dt("cannot publish track when not connected");const m=()=>C(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,h,c,u),yield this.engine.negotiate()}),k=(yield Promise.all([this.engine.addTrack(f),m()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:u,trackInfo:k}))})}unpublishTrack(e,t){return C(this,void 0,void 0,function*(){var r,o;if(Ir(e)){const f=this.pendingPublishPromises.get(e);f&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Ee(e))),yield f)}const l=this.getPublicationForTrack(e),c=l?Ee(l):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),c)),!l||!l.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),c));return}e=l.track,e.off(Z.Muted,this.onTrackMuted),e.off(Z.Unmuted,this.onTrackUnmuted),e.off(Z.Ended,this.handleTrackEnded),e.off(Z.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Z.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Z.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),t===void 0&&(t=(o=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),t?e.stop():e.stopMonitor();let u=!1;const h=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Xe.FAILED&&h)try{for(const f of this.engine.pcManager.publisher.getTransceivers())f.sender===h&&(f.direction="inactive",u=!0);if(this.engine.removeTrack(h)&&(u=!0),gi(e)){for(const[,f]of e.simulcastCodecs)f.sender&&(this.engine.removeTrack(f.sender)&&(u=!0),f.sender=void 0);e.simulcastCodecs.clear()}}catch(f){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),c),{error:f}))}switch(this.trackPublications.delete(l.trackSid),l.kind){case q.Kind.Audio:this.audioTrackPublications.delete(l.trackSid);break;case q.Kind.Video:this.videoTrackPublications.delete(l.trackSid);break}return this.emit(ae.LocalTrackUnpublished,l),l.setTrack(void 0),u&&(yield this.engine.negotiate()),l})}unpublishTracks(e){return C(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return C(this,arguments,void 0,function(t){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((l,c)=>C(r,void 0,void 0,function*(){try{const u=[];this.trackPublications.forEach(h=>{h.track&&(t&&(h.options=Object.assign(Object.assign({},h.options),t)),u.push(h))}),yield Promise.all(u.map(h=>C(this,void 0,void 0,function*(){const f=h.track;yield this.unpublishTrack(f,!1),o&&!f.isMuted&&f.source!==q.Source.ScreenShare&&f.source!==q.Source.ScreenShareAudio&&(zn(f)||gi(f))&&!f.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:h.trackSid})),yield f.restartTrack()),yield this.publishOrRepublishTrack(f,h.options,!0)}))),l()}catch(u){c(u)}finally{this.republishPromise=void 0}})),yield r.republishPromise})()})}publishData(e){return C(this,arguments,void 0,function(t){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const l=o.reliable?Te.RELIABLE:Te.LOSSY,c=o.destinationIdentities,u=o.topic,h=new Mt({kind:l,value:{case:"user",value:new ig({participantIdentity:r.identity,payload:t,destinationIdentities:c,topic:u})}});yield r.engine.sendDataPacket(h,l)})()})}publishDtmf(e,t){return C(this,void 0,void 0,function*(){const r=new Mt({kind:Te.RELIABLE,value:{case:"sipDtmf",value:new rg({code:e,digit:t})}});yield this.engine.sendDataPacket(r,Te.RELIABLE)})}sendChatMessage(e,t){return C(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:t==null?void 0:t.attachments},o=new Mt({value:{case:"chatMessage",value:new Xc(Object.assign(Object.assign({},r),{timestamp:Ge.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(o,Te.RELIABLE),this.emit(ae.ChatMessage,r),r})}editChatMessage(e,t){return C(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),o=new Mt({value:{case:"chatMessage",value:new Xc(Object.assign(Object.assign({},r),{timestamp:Ge.parse(r.timestamp),editTimestamp:Ge.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(o,Te.RELIABLE),this.emit(ae.ChatMessage,r),r})}sendText(e,t){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return C(this,arguments,void 0,function(t){var r=this;let{destinationIdentity:o,method:l,payload:c,responseTimeout:u=1e4}=t;return(function*(){return new Promise((f,m)=>C(r,void 0,void 0,function*(){var v,k,b,P;if(Xu(c)>gv){m(et.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((k=(v=this.engine.latestJoinResponse)===null||v===void 0?void 0:v.serverInfo)===null||k===void 0)&&k.version&&Nn((P=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||P===void 0?void 0:P.version,"1.8.0")<0){m(et.builtIn("UNSUPPORTED_SERVER"));return}const w=crypto.randomUUID();yield this.publishRpcRequest(o,w,l,c,u-2e3);const _=setTimeout(()=>{this.pendingAcks.delete(w),m(et.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(w),clearTimeout(M)},2e3);this.pendingAcks.set(w,{resolve:()=>{clearTimeout(_)},participantIdentity:o});const M=setTimeout(()=>{this.pendingResponses.delete(w),m(et.builtIn("RESPONSE_TIMEOUT"))},u);this.pendingResponses.set(w,{resolve:(z,U)=>{clearTimeout(M),this.pendingAcks.has(w)&&(console.warn("RPC response received before ack",w),this.pendingAcks.delete(w),clearTimeout(_)),U?m(U):f(z??"")},participantIdentity:o})}))})()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,r){const o=this.pendingResponses.get(e);o?(o.resolve(t,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,r,o,l){return C(this,void 0,void 0,function*(){const c=new Mt({destinationIdentities:[e],kind:Te.RELIABLE,value:{case:"rpcRequest",value:new sg({id:t,method:r,payload:o,responseTimeoutMs:l,version:1})}});yield this.engine.sendDataPacket(c,Te.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:r,resolve:o}]of this.pendingResponses)r===e&&(o(null,et.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(t=>t.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(t=>{var r,o;const l=this.trackPublications.get(t.sid);if(l){const c=l.isMuted||((o=(r=l.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&o!==void 0?o:!1);c!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(l)),{mutedOnServer:c})),this.engine.client.sendMuteTrack(t.sid,c))}}),!0):!1}setActiveAgent(e){var t,r,o,l;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(r=(t=this.activeAgentFuture)===null||t===void 0?void 0:t.resolve)===null||r===void 0||r.call(t,e):(l=(o=this.activeAgentFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Rn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(r=>{const o=r.track;o&&(e instanceof MediaStreamTrack?(zn(o)||gi(o))&&o.mediaStreamTrack===e&&(t=r):e===o&&(t=r))}),t}waitForPendingPublicationOfSource(e){return C(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const o=Array.from(this.pendingPublishPromises.entries()).find(l=>{let[c]=l;return c.source===e});if(o)return o[1];yield Ut(20)}})}}class NC extends qn{constructor(e,t,r,o){super(e,t.sid,t.name,o),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=l=>{this.setTrack(void 0),this.emit(Z.Ended,l)},this.handleVisibilityChange=l=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(l),this.logContext),this.visible=l,this.emitTrackUpdate()},this.handleVideoDimensionsChange=l=>{this.log.debug("adaptivestream video dimensions ".concat(l.width,"x").concat(l.height),this.logContext),this.videoDimensionsAdaptiveStream=l,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const o=new _a({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new cg({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Z.UpdateSubscription,o),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?qn.SubscriptionStatus.Unsubscribed:super.isSubscribed?qn.SubscriptionStatus.Subscribed:qn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?qn.PermissionStatus.Allowed:qn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,r;this.isManualOperationAllowed()&&(((t=this.requestedVideoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((r=this.requestedVideoDimensions)===null||r===void 0?void 0:r.height)===e.height||(Fc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Fc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Ht.HIGH}setTrack(e){const t=this.subscriptionStatus,r=this.permissionStatus,o=this.track;o!==e&&(o&&(o.off(Z.VideoDimensionsChanged,this.handleVideoDimensionsChange),o.off(Z.VisibilityChanged,this.handleVisibilityChange),o.off(Z.Ended,this.handleEnded),o.detach(),o.stopMonitor(),this.emit(Z.Unsubscribed,o)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Z.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Z.VisibilityChanged,this.handleVisibilityChange),e.on(Z.Ended,this.handleEnded),this.emit(Z.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Z.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Z.Muted:Z.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Z.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Z.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Fc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new vg({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===q.Kind.Video){let t=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(t)Qp(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const r=_T(this.trackInfo,this.requestedMaxQuality);r&&Qp(this.videoDimensionsAdaptiveStream,r)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Ht.HIGH})),e.quality=Ht.HIGH)}this.emit(Z.UpdateSettings,e)}}class wa extends wv{static fromParticipantInfo(e,t,r){return new wa(e,t.sid,t.identity,t.name,t.metadata,t.attributes,r,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,r,o,l,c,u){let h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:js.STANDARD;super(t,r||"",o,l,c,u,h),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Z.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(Z.UpdateSubscription,t=>{t.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(Z.SubscriptionPermissionChanged,t=>{this.emit(ae.TrackSubscriptionPermissionChanged,e,t)}),e.on(Z.SubscriptionStatusChanged,t=>{this.emit(ae.TrackSubscriptionStatusChanged,e,t)}),e.on(Z.Subscribed,t=>{this.emit(ae.TrackSubscribed,t,e)}),e.on(Z.Unsubscribed,t=>{this.emit(ae.TrackUnsubscribed,t,e)}),e.on(Z.SubscriptionFailed,t=>{this.emit(ae.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:q.Source.Microphone;this.volumeMap.set(t,e);const r=this.getTrackPublication(t);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:q.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,r,o,l,c){let u=this.getTrackPublicationBySid(t);if(u||t.startsWith("TR")||this.trackPublications.forEach(m=>{!u&&e.kind===m.kind.toString()&&(u=m)}),!u){if(c===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(ae.TrackSubscriptionFailed,t);return}c===void 0&&(c=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,r,o,l,c-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Ee(u))),this.emit(ae.TrackSubscriptionFailed,t);return}const h=e.kind==="video";let f;return h?f=new xC(e,t,o,l):f=new wC(e,t,o,this.audioContext,this.audioOutput),f.source=u.source,f.isMuted=u.isMuted,f.setMediaStream(r),f.start(),u.setTrack(f),this.volumeMap.has(u.source)&&Tu(f)&&_n(f)&&f.setVolume(this.volumeMap.get(u.source)),u}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,r=new Map;return e.tracks.forEach(o=>{var l,c;let u=this.getTrackPublicationBySid(o.sid);if(u)u.updateInfo(o);else{const h=q.kindFromProto(o.type);if(!h)return;u=new NC(h,o,(l=this.signalClient.connectOptions)===null||l===void 0?void 0:l.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(c=this.loggerOptions)===null||c===void 0?void 0:c.loggerName}),u.updateInfo(o),r.set(o.sid,u);const f=Array.from(this.trackPublications.values()).find(m=>m.source===(u==null?void 0:u.source));f&&u.source!==q.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(u.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Ee(f),newTrack:Ee(u)})),this.addTrackPublication(u)}t.set(o.sid,u)}),this.trackPublications.forEach(o=>{t.has(o.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Ee(o))),this.unpublishTrack(o.trackSid,!0))}),r.forEach(o=>{this.emit(ae.TrackPublished,o)}),!0}unpublishTrack(e,t){const r=this.trackPublications.get(e);if(!r)return;const{track:o}=r;switch(o&&(o.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case q.Kind.Audio:this.audioTrackPublications.delete(e);break;case q.Kind.Video:this.videoTrackPublications.delete(e);break}t&&this.emit(ae.TrackUnpublished,r)}setAudioOutput(e){return C(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(r=>{var o;_n(r.track)&&Tu(r.track)&&t.push(r.track.setSinkId((o=e.deviceId)!==null&&o!==void 0?o:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var Ae;(function(i){i.Disconnected="disconnected",i.Connecting="connecting",i.Connected="connected",i.Reconnecting="reconnecting",i.SignalReconnecting="signalReconnecting"})(Ae||(Ae={}));const OC=4*1e3;class Gi extends On.EventEmitter{constructor(e){var t,r,o,l;if(super(),t=this,this.state=Ae.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=_e,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(c,u,h)=>C(this,void 0,void 0,function*(){var f;if(!cT())throw In()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const m=yield this.disconnectLock.lock();if(this.state===Ae.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),m(),Promise.resolve();if(this.connectFuture)return m(),this.connectFuture.promise;this.setAndEmitConnectionState(Ae.Connecting),((f=this.regionUrlProvider)===null||f===void 0?void 0:f.getServerUrl().toString())!==c&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Su(new URL(c))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ru(c,u):this.regionUrlProvider.updateToken(u),this.regionUrlProvider.fetchRegionSettings().then(b=>{var P;(P=this.regionUrlProvider)===null||P===void 0||P.setServerReportedRegions(b)}).catch(b=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:b}))}));const v=(b,P,w)=>C(this,void 0,void 0,function*(){var _,M;this.abortController&&this.abortController.abort();const z=new AbortController;this.abortController=z,m==null||m();try{yield this.attemptConnection(w??c,u,h,z),this.abortController=void 0,b()}catch(U){if(this.regionUrlProvider&&U instanceof Be&&U.reason!==Oe.Cancelled&&U.reason!==Oe.NotAllowed){let I=null;try{I=yield this.regionUrlProvider.getNextBestRegionUrl((_=this.abortController)===null||_===void 0?void 0:_.signal)}catch(A){if(A instanceof Be&&(A.status===401||A.reason===Oe.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),P(A);return}}I&&!(!((M=this.abortController)===null||M===void 0)&&M.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(U.message,". Retrying with another region: ").concat(I),this.logContext),this.recreateEngine(),yield v(b,P,I)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Jp(U)),P(U))}else{let I=gn.UNKNOWN_REASON;U instanceof Be&&(I=Jp(U)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,I),P(U)}}}),k=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Rn((b,P)=>{v(b,P,k)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(c,u,h,f,m,v)=>C(this,void 0,void 0,function*(){var k,b,P;const w=yield h.join(c,u,{autoSubscribe:f.autoSubscribe,adaptiveStream:typeof m.adaptiveStream=="object"?!0:m.adaptiveStream,maxRetries:f.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:f.websocketTimeout},v.signal);let _=w.serverInfo;if(_||(_={version:w.serverVersion,region:w.serverRegion}),this.serverInfo=_,this.log.debug("connected to Livekit Server ".concat(Object.entries(_).map(M=>{let[z,U]=M;return"".concat(z,": ").concat(U)}).join(", ")),{room:(k=w.room)===null||k===void 0?void 0:k.name,roomSid:(b=w.room)===null||b===void 0?void 0:b.sid,identity:(P=w.participant)===null||P===void 0?void 0:P.identity}),!_.version)throw new $b("unknown server version");return _.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),m.dynacast=!1),w}),this.applyJoinResponse=c=>{const u=c.participant;if(this.localParticipant.sid=u.sid,this.localParticipant.identity=u.identity,this.localParticipant.setEnabledPublishCodecs(c.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(c.sifTrailer)}catch(h){this.log.error(h instanceof Error?h.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:h}))}this.handleParticipantUpdates([u,...c.otherParticipants]),c.room&&this.handleRoomUpdate(c.room)},this.attemptConnection=(c,u,h,f)=>C(this,void 0,void 0,function*(){var m,v;this.state===Ae.Reconnecting||this.isResuming||!((m=this.engine)===null||m===void 0)&&m.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((v=this.regionUrlProvider)===null||v===void 0)&&v.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Yu),h),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const k=yield this.connectSignal(c,u,this.engine,this.connOptions,this.options,f);this.applyJoinResponse(k),this.setupLocalParticipantEvents(),this.emit(Q.SignalConnected)}catch(k){yield this.engine.close(),this.recreateEngine();const b=new Be("could not establish signal connection",Oe.ServerUnreachable);throw k instanceof Error&&(b.message="".concat(b.message,": ").concat(k.message)),k instanceof Be&&(b.reason=k.reason,b.status=k.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:k})),b}if(f.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Be("Connection attempt aborted",Oe.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,f)}catch(k){throw yield this.engine.close(),this.recreateEngine(),k}Lt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Lt()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ae.Connected),this.emit(Q.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];return C(t,[...u],void 0,function(){var f=this;let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var v,k,b,P;const w=yield f.disconnectLock.lock();try{if(f.state===Ae.Disconnected){f.log.debug("already disconnected",f.logContext);return}f.log.info("disconnect from room",Object.assign({},f.logContext)),(f.state===Ae.Connecting||f.state===Ae.Reconnecting||f.isResuming)&&(f.log.warn("abort connection attempt",f.logContext),(v=f.abortController)===null||v===void 0||v.abort(),(b=(k=f.connectFuture)===null||k===void 0?void 0:k.reject)===null||b===void 0||b.call(k,new Be("Client initiated disconnect",Oe.Cancelled)),f.connectFuture=void 0),!((P=f.engine)===null||P===void 0)&&P.client.isDisconnected||(yield f.engine.client.sendLeave()),f.engine&&(yield f.engine.close()),f.handleDisconnect(m,gn.CLIENT_INITIATED),f.engine=void 0}finally{w()}})()})},this.onPageLeave=()=>C(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>C(this,void 0,void 0,function*(){const c=[],u=Kt();if(u&&u.os==="iOS"){const h="livekit-dummy-audio-el";let f=document.getElementById(h);if(!f){f=document.createElement("audio"),f.id=h,f.autoplay=!0,f.hidden=!0;const m=jc();m.enabled=!0;const v=new MediaStream([m]);f.srcObject=v,document.addEventListener("visibilitychange",()=>{f&&(f.srcObject=document.hidden?null:v,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(f),this.once(Q.Disconnected,()=>{f==null||f.remove(),f=null})}c.push(f)}this.remoteParticipants.forEach(h=>{h.audioTrackPublications.forEach(f=>{f.track&&f.track.attachedElements.forEach(m=>{c.push(m)})})});try{yield Promise.all([this.acquireAudioContext(),...c.map(h=>(h.muted=!1,h.play()))]),this.handleAudioPlaybackStarted()}catch(h){throw this.handleAudioPlaybackFailed(h),h}}),this.startVideo=()=>C(this,void 0,void 0,function*(){const c=[];for(const u of this.remoteParticipants.values())u.videoTrackPublications.forEach(h=>{var f;(f=h.track)===null||f===void 0||f.attachedElements.forEach(m=>{c.includes(m)||c.push(m)})});yield Promise.all(c.map(u=>u.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(u=>{u.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const c of this.remoteParticipants.values())this.handleParticipantDisconnected(c.identity,c);this.setAndEmitConnectionState(Ae.Reconnecting)&&this.emit(Q.Reconnecting)},this.handleSignalRestarted=c=>C(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(c.serverRegion),Object.assign(Object.assign({},this.logContext),{region:c.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(c);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(u){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:u}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:c.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ae.Connected),this.emit(Q.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=c=>{c.forEach(u=>{var h;if(u.identity===this.localParticipant.identity){this.localParticipant.updateInfo(u);return}u.identity===""&&(u.identity=(h=this.sidToIdentity.get(u.sid))!==null&&h!==void 0?h:"");let f=this.remoteParticipants.get(u.identity);u.state===Er.DISCONNECTED?this.handleParticipantDisconnected(u.identity,f):f=this.getOrCreateParticipant(u.identity,u)})},this.handleActiveSpeakersUpdate=c=>{const u=[],h={};c.forEach(f=>{if(h[f.sid]=!0,f.sid===this.localParticipant.sid)this.localParticipant.audioLevel=f.level,this.localParticipant.setIsSpeaking(!0),u.push(this.localParticipant);else{const m=this.getRemoteParticipantBySid(f.sid);m&&(m.audioLevel=f.level,m.setIsSpeaking(!0),u.push(m))}}),h[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(f=>{h[f.sid]||(f.audioLevel=0,f.setIsSpeaking(!1))}),this.activeSpeakers=u,this.emitWhenConnected(Q.ActiveSpeakersChanged,u)},this.handleSpeakersChanged=c=>{const u=new Map;this.activeSpeakers.forEach(f=>{const m=this.remoteParticipants.get(f.identity);m&&m.sid!==f.sid||u.set(f.sid,f)}),c.forEach(f=>{let m=this.getRemoteParticipantBySid(f.sid);f.sid===this.localParticipant.sid&&(m=this.localParticipant),m&&(m.audioLevel=f.level,m.setIsSpeaking(f.active),f.active?u.set(f.sid,m):u.delete(f.sid))});const h=Array.from(u.values());h.sort((f,m)=>m.audioLevel-f.audioLevel),this.activeSpeakers=h,this.emitWhenConnected(Q.ActiveSpeakersChanged,h)},this.handleStreamStateUpdate=c=>{c.streamStates.forEach(u=>{const h=this.getRemoteParticipantBySid(u.participantSid);if(!h)return;const f=h.getTrackPublicationBySid(u.trackSid);if(!f||!f.track)return;const m=q.streamStateFromProto(u.state);f.track.setStreamState(m),m!==f.track.streamState&&(h.emit(ae.TrackStreamStateChanged,f,f.track.streamState),this.emitWhenConnected(Q.TrackStreamStateChanged,f,f.track.streamState,h))})},this.handleSubscriptionPermissionUpdate=c=>{const u=this.getRemoteParticipantBySid(c.participantSid);if(!u)return;const h=u.getTrackPublicationBySid(c.trackSid);h&&h.setAllowed(c.allowed)},this.handleSubscriptionError=c=>{const u=Array.from(this.remoteParticipants.values()).find(f=>f.trackPublications.has(c.trackSid));if(!u)return;const h=u.getTrackPublicationBySid(c.trackSid);h&&h.setSubscriptionError(c.err)},this.handleDataPacket=c=>{const u=this.remoteParticipants.get(c.participantIdentity);if(c.value.case==="user")this.handleUserPacket(u,c.value.value,c.kind);else if(c.value.case==="transcription")this.handleTranscription(u,c.value.value);else if(c.value.case==="sipDtmf")this.handleSipDtmf(u,c.value.value);else if(c.value.case==="chatMessage")this.handleChatMessage(u,c.value.value);else if(c.value.case==="metrics")this.handleMetrics(c.value.value,u);else if(c.value.case==="streamHeader"||c.value.case==="streamChunk"||c.value.case==="streamTrailer")this.handleDataStream(c);else if(c.value.case==="rpcRequest"){const h=c.value.value;this.handleIncomingRpcRequest(c.participantIdentity,h.id,h.method,h.payload,h.responseTimeoutMs,h.version)}},this.handleUserPacket=(c,u,h)=>{this.emit(Q.DataReceived,u.payload,c,h,u.topic),c==null||c.emit(ae.DataReceived,u.payload,h)},this.handleSipDtmf=(c,u)=>{this.emit(Q.SipDTMFReceived,u,c),c==null||c.emit(ae.SipDTMFReceived,u)},this.handleTranscription=(c,u)=>{const h=u.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(u.transcribedParticipantIdentity),f=h==null?void 0:h.trackPublications.get(u.trackId),m=yT(u,this.transcriptionReceivedTimes);f==null||f.emit(Z.TranscriptionReceived,m),h==null||h.emit(ae.TranscriptionReceived,m,f),this.emit(Q.TranscriptionReceived,m,h,f)},this.handleChatMessage=(c,u)=>{const h=kT(u);this.emit(Q.ChatMessage,h,c)},this.handleMetrics=(c,u)=>{this.emit(Q.MetricsReceived,c,u)},this.handleDataStream=c=>{this.incomingDataStreamManager.handleDataStreamPacket(c)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Q.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=c=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:c})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Q.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Q.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Q.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>C(this,void 0,void 0,function*(){var c;((c=Kt())===null||c===void 0?void 0:c.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(Q.MediaDevicesChanged)}),this.handleRoomUpdate=c=>{const u=this.roomInfo;this.roomInfo=c,u&&u.metadata!==c.metadata&&this.emitWhenConnected(Q.RoomMetadataChanged,c.metadata),(u==null?void 0:u.activeRecording)!==c.activeRecording&&this.emitWhenConnected(Q.RecordingStatusChanged,c.activeRecording)},this.handleConnectionQualityUpdate=c=>{c.updates.forEach(u=>{if(u.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(u.quality);return}const h=this.getRemoteParticipantBySid(u.participantSid);h&&h.setConnectionQuality(u.quality)})},this.onLocalParticipantMetadataChanged=c=>{this.emit(Q.ParticipantMetadataChanged,c,this.localParticipant)},this.onLocalParticipantNameChanged=c=>{this.emit(Q.ParticipantNameChanged,c,this.localParticipant)},this.onLocalAttributesChanged=c=>{this.emit(Q.ParticipantAttributesChanged,c,this.localParticipant)},this.onLocalTrackMuted=c=>{this.emit(Q.TrackMuted,c,this.localParticipant)},this.onLocalTrackUnmuted=c=>{this.emit(Q.TrackUnmuted,c,this.localParticipant)},this.onTrackProcessorUpdate=c=>{var u;(u=c==null?void 0:c.onPublish)===null||u===void 0||u.call(c,this)},this.onLocalTrackPublished=c=>C(this,void 0,void 0,function*(){var u,h,f,m,v,k;(u=c.track)===null||u===void 0||u.on(Z.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=c.track)===null||h===void 0||h.on(Z.Restarted,this.onLocalTrackRestarted),(v=(m=(f=c.track)===null||f===void 0?void 0:f.getProcessor())===null||m===void 0?void 0:m.onPublish)===null||v===void 0||v.call(m,this),this.emit(Q.LocalTrackPublished,c,this.localParticipant),zn(c.track)&&(yield c.track.checkForSilence())&&this.emit(Q.LocalAudioSilenceDetected,c);const b=yield(k=c.track)===null||k===void 0?void 0:k.getDeviceId(!1),P=wu(c.source);P&&b&&b!==this.localParticipant.activeDeviceMap.get(P)&&(this.localParticipant.activeDeviceMap.set(P,b),this.emit(Q.ActiveDeviceChanged,P,b))}),this.onLocalTrackUnpublished=c=>{var u,h;(u=c.track)===null||u===void 0||u.off(Z.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=c.track)===null||h===void 0||h.off(Z.Restarted,this.onLocalTrackRestarted),this.emit(Q.LocalTrackUnpublished,c,this.localParticipant)},this.onLocalTrackRestarted=c=>C(this,void 0,void 0,function*(){const u=yield c.getDeviceId(!1),h=wu(c.source);h&&u&&u!==this.localParticipant.activeDeviceMap.get(h)&&(this.log.debug("local track restarted, setting ".concat(h," ").concat(u," active"),this.logContext),this.localParticipant.activeDeviceMap.set(h,u),this.emit(Q.ActiveDeviceChanged,h,u))}),this.onLocalConnectionQualityChanged=c=>{this.emit(Q.ConnectionQualityChanged,c,this.localParticipant)},this.onMediaDevicesError=(c,u)=>{this.emit(Q.MediaDevicesError,c,u)},this.onLocalParticipantPermissionsChanged=c=>{this.emit(Q.ParticipantPermissionsChanged,c,this.localParticipant)},this.onLocalChatMessageSent=c=>{this.emit(Q.ChatMessage,c,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},KT),e),this.log=$n((r=this.options.loggerName)!==null&&r!==void 0?r:vn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},pv),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},mv),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},HT),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new SC,this.outgoingDataStreamManager=new CC(this.engine,this.log),this.disconnectLock=new At,this.localParticipant=new IC("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ci(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ci(this.options.audioCaptureDefaults.deviceId)),!((o=this.options.audioOutput)===null||o===void 0)&&o.deviceId&&this.switchActiveDevice("audiooutput",Ci(this.options.audioOutput.deviceId)).catch(c=>this.log.warn("Could not set audio output: ".concat(c.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),Lt()){const c=new AbortController;(l=navigator.mediaDevices)===null||l===void 0||l.addEventListener("devicechange",this.handleDeviceChange,{signal:c.signal}),Gi.cleanupRegistry&&Gi.cleanupRegistry.register(this,()=>{c.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new IT(this.options.e2ee),this.e2eeManager.on(bi.ParticipantEncryptionStatusChanged,(t,r)=>{bT(r)&&(this.isE2EEEnabled=t),this.emit(Q.ParticipantEncryptionStatusChanged,t,r)}),this.e2eeManager.on(bi.EncryptionError,t=>this.emit(Q.EncryptionError,t)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}getSid(){return C(this,void 0,void 0,function*(){return this.state===Ae.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,t)=>{const r=o=>{o.sid!==""&&(this.engine.off(oe.RoomUpdate,r),e(o.sid))};this.engine.on(oe.RoomUpdate,r),this.once(Q.Disconnected,()=>{this.engine.off(oe.RoomUpdate,r),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new pC(this.options),this.engine.on(oe.ParticipantUpdate,this.handleParticipantUpdates).on(oe.RoomUpdate,this.handleRoomUpdate).on(oe.SpeakersChanged,this.handleSpeakersChanged).on(oe.StreamStateChanged,this.handleStreamStateUpdate).on(oe.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(oe.SubscriptionError,this.handleSubscriptionError).on(oe.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(oe.MediaTrackAdded,(e,t,r)=>{this.onTrackAdded(e,t,r)}).on(oe.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(oe.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(oe.DataPacketReceived,this.handleDataPacket).on(oe.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ae.SignalReconnecting)&&this.emit(Q.SignalReconnecting)}).on(oe.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ae.Connected)&&this.emit(Q.Reconnected)}).on(oe.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ae.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(oe.Restarting,this.handleRestarting).on(oe.SignalRestarted,this.handleSignalRestarted).on(oe.Offline,()=>{this.setAndEmitConnectionState(Ae.Reconnecting)&&this.emit(Q.Reconnecting)}).on(oe.DCBufferStatusChanged,(e,t)=>{this.emit(Q.DCBufferStatusChanged,e,t)}).on(oe.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:o}=r;return o===e});if(!t){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ae.LocalTrackSubscribed,t),this.emitWhenConnected(Q.LocalTrackSubscribed,t,this.localParticipant)}).on(oe.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((t,r)=>{this.handleParticipantDisconnected(r,t)}),this.emit(Q.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return gt.getInstance().getDevices(e,t)}prepareConnection(e,t){return C(this,void 0,void 0,function*(){if(this.state===Ae.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Su(new URL(e))&&t){this.regionUrlProvider=new Ru(e,t);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===Ae.Disconnected&&(this.regionUrl=r,yield fetch(bu(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(bu(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return C(this,void 0,void 0,function*(){let r=()=>C(this,void 0,void 0,function*(){}),o;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":o=new xn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":o=new xn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":o=new xn({scenario:{case:"serverLeave",value:!0}});break;case"migration":o=new xn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new xn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new xn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":o=new xn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>C(this,void 0,void 0,function*(){const l=this.engine.client.onLeave;l&&l(new Ia({reason:gn.CLIENT_INITIATED,action:Pr.RECONNECT}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");o=new xn({scenario:{case:"subscriberBandwidth",value:Bi(t)}});break;case"leave-full-reconnect":o=new xn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}o&&(yield this.engine.client.sendSimulateScenario(o),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return C(this,arguments,void 0,function(r,o){var l=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var u,h,f,m,v,k,b;let P=!0,w=!1;const _=c?{exact:o}:o;if(r==="audioinput"){w=l.localParticipant.audioTrackPublications.size===0;const M=(u=l.getActiveDevice(r))!==null&&u!==void 0?u:l.options.audioCaptureDefaults.deviceId;l.options.audioCaptureDefaults.deviceId=_;const z=Array.from(l.localParticipant.audioTrackPublications.values()).filter(I=>I.source===q.Source.Microphone);try{P=(yield Promise.all(z.map(I=>{var A;return(A=I.audioTrack)===null||A===void 0?void 0:A.setDeviceId(_)}))).every(I=>I===!0)}catch(I){throw l.options.audioCaptureDefaults.deviceId=M,I}const U=z.some(I=>{var A,V;return(V=(A=I.track)===null||A===void 0?void 0:A.isMuted)!==null&&V!==void 0?V:!1});P&&U&&(w=!0)}else if(r==="videoinput"){w=l.localParticipant.videoTrackPublications.size===0;const M=(h=l.getActiveDevice(r))!==null&&h!==void 0?h:l.options.videoCaptureDefaults.deviceId;l.options.videoCaptureDefaults.deviceId=_;const z=Array.from(l.localParticipant.videoTrackPublications.values()).filter(I=>I.source===q.Source.Camera);try{P=(yield Promise.all(z.map(I=>{var A;return(A=I.videoTrack)===null||A===void 0?void 0:A.setDeviceId(_)}))).every(I=>I===!0)}catch(I){throw l.options.videoCaptureDefaults.deviceId=M,I}const U=z.some(I=>{var A,V;return(V=(A=I.track)===null||A===void 0?void 0:A.isMuted)!==null&&V!==void 0?V:!1});P&&U&&(w=!0)}else if(r==="audiooutput"){if(w=!0,!ku()&&!l.options.webAudioMix||l.options.webAudioMix&&l.audioContext&&!("setSinkId"in l.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");l.options.webAudioMix&&(o=(f=yield gt.getInstance().normalizeDeviceId("audiooutput",o))!==null&&f!==void 0?f:""),(m=(b=l.options).audioOutput)!==null&&m!==void 0||(b.audioOutput={});const M=(v=l.getActiveDevice(r))!==null&&v!==void 0?v:l.options.audioOutput.deviceId;l.options.audioOutput.deviceId=o;try{l.options.webAudioMix&&((k=l.audioContext)===null||k===void 0||k.setSinkId(o)),yield Promise.all(Array.from(l.remoteParticipants.values()).map(z=>z.setAudioOutput({deviceId:o})))}catch(z){throw l.options.audioOutput.deviceId=M,z}}return w&&(l.localParticipant.activeDeviceMap.set(r,o),l.emit(Q.ActiveDeviceChanged,r,o)),P})()})}setupLocalParticipantEvents(){this.localParticipant.on(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ae.AttributesChanged,this.onLocalAttributesChanged).on(ae.TrackMuted,this.onLocalTrackMuted).on(ae.TrackUnmuted,this.onLocalTrackUnmuted).on(ae.LocalTrackPublished,this.onLocalTrackPublished).on(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ae.MediaDevicesError,this.onMediaDevicesError).on(ae.AudioStreamAcquired,this.startAudio).on(ae.ChatMessage,this.onLocalChatMessageSent).on(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,r){if(this.state===Ae.Connecting||this.state===Ae.Reconnecting){const v=()=>{this.onTrackAdded(e,t,r),k()},k=()=>{this.off(Q.Reconnected,v),this.off(Q.Connected,v),this.off(Q.Disconnected,k)};this.once(Q.Reconnected,v),this.once(Q.Connected,v),this.once(Q.Disconnected,k);return}if(this.state===Ae.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const o=oT(t.id),l=o[0];let c=o[1],u=e.id;if(c&&c.startsWith("TR")&&(u=c),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const h=Array.from(this.remoteParticipants.values()).find(v=>v.sid===l);if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}let f;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?f=this.options.adaptiveStream:f={});const m=h.addSubscribedMediaTrack(e,u,t,r,f);m!=null&&m.isEncrypted&&!this.e2eeManager&&this.emit(Q.EncryptionError,new Error("Encrypted ".concat(m.source," track received from participant ").concat(h.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==Ae.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{o.unpublishTrack(l.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var l,c,u;o.track&&this.localParticipant.unpublishTrack(o.track,e),e?((l=o.track)===null||l===void 0||l.detach(),(c=o.track)===null||c===void 0||c.stop()):(u=o.track)===null||u===void 0||u.stopMonitor()}),this.localParticipant.off(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ae.AttributesChanged,this.onLocalAttributesChanged).off(ae.TrackMuted,this.onLocalTrackMuted).off(ae.TrackUnmuted,this.onLocalTrackUnmuted).off(ae.LocalTrackPublished,this.onLocalTrackPublished).off(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ae.MediaDevicesError,this.onMediaDevicesError).off(ae.AudioStreamAcquired,this.startAudio).off(ae.ChatMessage,this.onLocalChatMessageSent).off(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Lt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ae.Disconnected),this.emit(Q.Disconnected,t)}}}handleParticipantDisconnected(e,t){var r;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(o=>{t.unpublishTrack(o.trackSid,!0)}),this.emit(Q.ParticipantDisconnected,t),t.setDisconnected(),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,r,o,l,c){return C(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),c!==1){yield this.engine.publishRpcResponse(e,t,null,et.builtIn("UNSUPPORTED_VERSION"));return}const u=this.rpcHandlers.get(r);if(!u){yield this.engine.publishRpcResponse(e,t,null,et.builtIn("UNSUPPORTED_METHOD"));return}let h=null,f=null;try{const m=yield u({requestId:t,callerIdentity:e,payload:o,responseTimeout:l});Xu(m)>gv?(h=et.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(r))):f=m}catch(m){m instanceof et?h=m:(console.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),m),h=et.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,f,h)})}selectDefaultDevices(){return C(this,void 0,void 0,function*(){var e,t,r;const o=gt.getInstance().previousDevices,l=yield gt.getInstance().getDevices(void 0,!1),c=Kt();if((c==null?void 0:c.name)==="Chrome"&&c.os!=="iOS")for(let h of l){const f=o.find(m=>m.deviceId===h.deviceId);f&&f.label!==""&&f.kind===h.kind&&f.label!==h.label&&this.getActiveDevice(h.kind)==="default"&&this.emit(Q.ActiveDeviceChanged,h.kind,h.deviceId)}const u=["audiooutput","audioinput","videoinput"];for(let h of u){const f=CT(h),m=this.localParticipant.getTrackPublication(f);if(m&&(!((e=m.track)===null||e===void 0)&&e.isUserProvided))continue;const v=l.filter(b=>b.kind===h),k=this.getActiveDevice(h);if(k===((t=o.filter(b=>b.kind===h)[0])===null||t===void 0?void 0:t.deviceId)&&v.length>0&&((r=v[0])===null||r===void 0?void 0:r.deviceId)!==k){yield this.switchActiveDevice(h,v[0].deviceId);continue}h==="audioinput"&&!Bs()||h==="videoinput"||v.length>0&&!v.find(b=>b.deviceId===this.getActiveDevice(h))&&(h!=="audiooutput"||!Bs())&&(yield this.switchActiveDevice(h,v[0].deviceId))}})}acquireAudioContext(){return C(this,void 0,void 0,function*(){var e,t;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=dv())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(o=>o.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ut(200)])}catch(o){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}))}const r=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(Q.AudioPlaybackStatusChanged,r))})}createParticipant(e,t){var r;let o;return t?o=wa.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):o=new wa(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),o}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const o=this.remoteParticipants.get(e);return t&&o.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),o}const r=this.createParticipant(e,t);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(Q.ParticipantConnected,r),r.on(ae.TrackPublished,o=>{this.emitWhenConnected(Q.TrackPublished,o,r)}).on(ae.TrackSubscribed,(o,l)=>{o.kind===q.Kind.Audio?(o.on(Z.AudioPlaybackStarted,this.handleAudioPlaybackStarted),o.on(Z.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):o.kind===q.Kind.Video&&(o.on(Z.VideoPlaybackFailed,this.handleVideoPlaybackFailed),o.on(Z.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Q.TrackSubscribed,o,l,r)}).on(ae.TrackUnpublished,o=>{this.emit(Q.TrackUnpublished,o,r)}).on(ae.TrackUnsubscribed,(o,l)=>{this.emit(Q.TrackUnsubscribed,o,l,r)}).on(ae.TrackMuted,o=>{this.emitWhenConnected(Q.TrackMuted,o,r)}).on(ae.TrackUnmuted,o=>{this.emitWhenConnected(Q.TrackUnmuted,o,r)}).on(ae.ParticipantMetadataChanged,o=>{this.emitWhenConnected(Q.ParticipantMetadataChanged,o,r)}).on(ae.ParticipantNameChanged,o=>{this.emitWhenConnected(Q.ParticipantNameChanged,o,r)}).on(ae.AttributesChanged,o=>{this.emitWhenConnected(Q.ParticipantAttributesChanged,o,r)}).on(ae.ConnectionQualityChanged,o=>{this.emitWhenConnected(Q.ConnectionQualityChanged,o,r)}).on(ae.ParticipantPermissionsChanged,o=>{this.emitWhenConnected(Q.ParticipantPermissionsChanged,o,r)}).on(ae.TrackSubscriptionStatusChanged,(o,l)=>{this.emitWhenConnected(Q.TrackSubscriptionStatusChanged,o,l,r)}).on(ae.TrackSubscriptionFailed,(o,l)=>{this.emit(Q.TrackSubscriptionFailed,o,r,l)}).on(ae.TrackSubscriptionPermissionChanged,(o,l)=>{this.emitWhenConnected(Q.TrackSubscriptionPermissionChanged,o,l,r)}).on(ae.Active,()=>{this.emitWhenConnected(Q.ParticipantActive,r),r.kind===js.AGENT&&this.localParticipant.setActiveAgent(r)}),t&&r.updateInfo(t),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,o)=>(r.push(...o.getTrackPublications()),r),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&ST(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=kt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,gn.STATE_MISMATCH))):e=0},OC)}clearConnectionReconcile(){this.connectionReconcileInterval&&kt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(Q.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,r]=e;this.emit(t,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];if(this.state===Ae.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===Ae.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return C(this,void 0,void 0,function*(){var t,r;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),l=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Ra({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Ge.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new qi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Q.SignalConnected),this.emit(Q.Connected),this.setAndEmitConnectionState(Ae.Connected),o.video){const c=new Iu(q.Kind.Video,new wr({source:at.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO,name:"video-dummy"}),new Ca(o.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:$p(160*((t=l.aspectRatios[0])!==null&&t!==void 0?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ae.LocalTrackPublished,c)}if(o.audio){const c=new Iu(q.Kind.Audio,new wr({source:at.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO}),new Ta(o.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:jc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ae.LocalTrackPublished,c)}for(let c=0;c<l.count-1;c+=1){let u=new qi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(c),state:Er.ACTIVE,tracks:[],joinedAt:Ge.parse(Date.now())});const h=this.getOrCreateParticipant(u.identity,u);if(l.video){const f=$p(160*((r=l.aspectRatios[c%l.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),m=new wr({source:at.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO});h.addSubscribedMediaTrack(f,m.sid,new MediaStream([f]),new RTCRtpReceiver),u.tracks=[...u.tracks,m]}if(l.audio){const f=jc(),m=new wr({source:at.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:fn.AUDIO});h.addSubscribedMediaTrack(f,m.sid,new MediaStream([f]),new RTCRtpReceiver),u.tracks=[...u.tracks,m]}h.updateInfo(u)}})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];if(e!==Q.ActiveSpeakersChanged&&e!==Q.TranscriptionReceived){const l=xv(r).filter(c=>c!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:l}))}return super.emit(e,...r)}}Gi.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(i=>{i()});function xv(i){return i.map(e=>{if(e)return Array.isArray(e)?xv(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var hn;(function(i){i[i.IDLE=0]="IDLE",i[i.RUNNING=1]="RUNNING",i[i.SKIPPED=2]="SKIPPED",i[i.SUCCESS=3]="SUCCESS",i[i.FAILED=4]="FAILED"})(hn||(hn={}));class Ei extends On.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=hn.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Gi(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return C(this,void 0,void 0,function*(){if(this.status!==hn.IDLE)throw Error("check is running already");this.setStatus(hn.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==hn.SKIPPED&&this.setStatus(this.isSuccess()?hn.SUCCESS:hn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return C(this,void 0,void 0,function*(){return this.room.state===Ae.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return C(this,void 0,void 0,function*(){this.room&&this.room.state!==Ae.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(hn.SKIPPED)}switchProtocol(e){return C(this,void 0,void 0,function*(){let t=!1,r=!1;if(this.room.on(Q.Reconnecting,()=>{t=!0}),this.room.once(Q.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(l=>setTimeout(l,1e3)),!t)return;const o=Date.now()+1e4;for(;Date.now()<o;){if(r)return;yield Ut(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class DC extends Ei{get description(){return"Cloud regions"}perform(){return C(this,void 0,void 0,function*(){const e=new Ru(this.url,this.token);if(!e.isCloud()){this.skip();return}const t=[],r=new Set;for(let l=0;l<3;l++){const c=yield e.getNextBestRegionUrl();if(!c)break;if(r.has(c))continue;r.add(c);const u=yield this.checkCloudRegion(c);this.appendMessage("".concat(u.region," RTT: ").concat(u.rtt,"ms, duration: ").concat(u.duration,"ms")),t.push(u)}t.sort((l,c)=>(l.duration-c.duration)*.5+(l.rtt-c.rtt)*.5);const o=t[0];this.bestStats=o,this.appendMessage("best Cloud region: ".concat(o.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return C(this,void 0,void 0,function*(){var t,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const o=(t=this.room.serverInfo)===null||t===void 0?void 0:t.region;if(!o)throw new Error("Region not found");const l=yield this.room.localParticipant.streamText({topic:"test"}),c=1e3,h=1e6/c,f="A".repeat(c),m=Date.now();for(let P=0;P<h;P++)yield l.write(f);yield l.close();const v=Date.now(),k=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),b={region:o,rtt:1e4,duration:v-m};return k==null||k.forEach(P=>{P.type==="candidate-pair"&&P.nominated&&(b.rtt=P.currentRoundTripTime*1e3)}),yield this.disconnect(),b})}}const Gc=1e4;class MC extends Ei{get description(){return"Connection via UDP vs TCP"}perform(){return C(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(Gc/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(Gc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return C(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const r=t.getContext("2d");if(!r)throw new Error("Could not get canvas context");let o=0;const l=()=>{o=(o+1)%360,r.fillStyle="hsl(".concat(o,", 100%, 50%)"),r.fillRect(0,0,t.width,t.height),requestAnimationFrame(l)};l();const u=t.captureStream(30).getVideoTracks()[0],f=(yield this.room.localParticipant.publishTrack(u,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,m={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},v=setInterval(()=>C(this,void 0,void 0,function*(){const k=yield f.getRTCStatsReport();k==null||k.forEach(b=>{b.type==="outbound-rtp"?(m.packetsSent=b.packetsSent,m.qualityLimitationDurations=b.qualityLimitationDurations,m.bitrateTotal+=b.targetBitrate,m.count++):b.type==="remote-inbound-rtp"&&(m.packetsLost=b.packetsLost,m.rttTotal+=b.roundTripTime,m.jitterTotal+=b.jitter)})}),1e3);return yield new Promise(k=>setTimeout(k,Gc)),clearInterval(v),u.stop(),t.remove(),yield this.disconnect(),m})}}class LC extends Ei{get description(){return"Can publish audio"}perform(){return C(this,void 0,void 0,function*(){var e;const t=yield this.connect(),r=yield Cv();if(yield uv(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(r),yield new Promise(u=>setTimeout(u,3e3));const l=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!l)throw new Error("Could not get RTCStats");let c=0;if(l.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="audio"||!u.kind&&u.mediaType==="audio")&&(c=u.packetsSent)}),c===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(c," audio packets"))})}}class AC extends Ei{get description(){return"Can publish video"}perform(){return C(this,void 0,void 0,function*(){var e;const t=yield this.connect(),r=yield PC();yield this.checkForVideo(r.mediaStreamTrack),t.localParticipant.publishTrack(r),yield new Promise(c=>setTimeout(c,5e3));const o=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let l=0;if(o.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="video"||!c.kind&&c.mediaType==="video")&&(l+=c.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," video packets"))})}checkForVideo(e){return C(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const r=document.createElement("video");r.srcObject=t,r.muted=!0,yield new Promise(o=>{r.onplay=()=>{setTimeout(()=>{var l,c,u,h;const f=document.createElement("canvas"),m=e.getSettings(),v=(c=(l=m.width)!==null&&l!==void 0?l:r.videoWidth)!==null&&c!==void 0?c:1280,k=(h=(u=m.height)!==null&&u!==void 0?u:r.videoHeight)!==null&&h!==void 0?h:720;f.width=v,f.height=k;const b=f.getContext("2d");b.drawImage(r,0,0);const w=b.getImageData(0,0,f.width,f.height).data;let _=!0;for(let M=0;M<w.length;M+=4)if(w[M]!==0||w[M+1]!==0||w[M+2]!==0){_=!1;break}_?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),o()},1e3)},r.play()}),t.getTracks().forEach(o=>o.stop()),r.remove()})}}class UC extends Ei{get description(){return"Resuming connection after interruption"}perform(){return C(this,void 0,void 0,function*(){var e;const t=yield this.connect();let r=!1,o=!1,l;const c=new Promise(f=>{setTimeout(f,5e3),l=f}),u=()=>{r=!0};t.on(Q.SignalReconnecting,u).on(Q.Reconnecting,u).on(Q.Reconnected,()=>{o=!0,l(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const h=t.engine.client.onClose;if(h&&h(""),yield c,r){if(!o||t.state!==Ae.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class jC extends Ei{get description(){return"Can connect via TURN"}perform(){return C(this,void 0,void 0,function*(){var e,t;const r=new Gu,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let l=!1,c=!1,u=!1;for(let h of o.iceServers)for(let f of h.urls)f.startsWith("turn:")?(c=!0,u=!0):f.startsWith("turns:")&&(c=!0,u=!0,l=!0),f.startsWith("stun:")&&(u=!0);u?c&&!l&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((t=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||t===void 0)&&t.iceServers||c?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(h=>setTimeout(h,0)))})}}class FC extends Ei{get description(){return"Establishing WebRTC connection"}perform(){return C(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(Q.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,l)=>{if(o.candidate){const c=new RTCIceCandidate(o);let u="".concat(c.protocol," ").concat(c.address,":").concat(c.port," ").concat(c.type);c.address&&(BC(c.address)?u+=" (private)":c.protocol==="tcp"&&c.tcpType==="passive"?(e=!0,u+=" (passive)"):c.protocol==="udp"&&(t=!0)),this.appendMessage(u)}r&&r(o,l)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),_e.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function BC(i){const e=i.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class VC extends Ei{get description(){return"Connecting to signal connection via WebSocket"}perform(){return C(this,void 0,void 0,function*(){var e,t,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let o=new Gu;const l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(l.serverVersion,".")),((e=l.serverInfo)===null||e===void 0?void 0:e.edition)===dg.Cloud&&(!((t=l.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=l.serverInfo)===null||r===void 0?void 0:r.region)),yield o.close()})}}class tw extends On.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:hn.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==hn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return C(this,void 0,void 0,function*(){const t=this.getNextCheckId(),r=new e(this.url,this.token,this.options),o=c=>{this.updateCheck(t,c)};r.on("update",o);const l=yield r.run();return r.off("update",o),l})}checkWebsocket(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(VC)})}checkWebRTC(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(FC)})}checkTURN(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(jC)})}checkReconnect(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(UC)})}checkPublishAudio(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(LC)})}checkPublishVideo(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(AC)})}checkConnectionProtocol(){return C(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(MC);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(DC)})}}class zC{constructor(e){ot(this,"apiClient");ot(this,"room",null);ot(this,"localAudioTrack",null);ot(this,"sessionId",null);ot(this,"sessionAccessToken",null);this.apiClient=e}async connectWithLiveKit(e,t,r,o={},l){var c,u,h,f;await this.disconnect(),(c=o.onStatus)==null||c.call(o,"connecting");try{const m=new Gi;this.room=m,m.on(Q.Connected,()=>{var v;return(v=o.onStatus)==null?void 0:v.call(o,"connected")}),m.on(Q.Disconnected,()=>{var v;return(v=o.onStatus)==null?void 0:v.call(o,"disconnected")}),m.on(Q.TrackSubscribed,v=>{if(v.kind==="video"){v.attach(r);return}if(v.kind==="audio"){const k=v.attach();k.autoplay=!0,k.muted=!1,k.style.display="none",(r.parentElement??document.body).appendChild(k)}}),m.on(Q.TrackUnsubscribed,v=>v.detach().forEach(k=>k.remove())),await m.connect(e,t),this.sessionId=(l==null?void 0:l.sessionId)||null,this.sessionAccessToken=(l==null?void 0:l.sessionAccessToken)||null,(u=o.onStatus)==null||u.call(o,"connected")}catch(m){throw(h=o.onStatus)==null||h.call(o,"error"),(f=o.onError)==null||f.call(o,m instanceof Error?m.message:"LiveAgent connection failed"),m}}async disconnect(){if(this.room)try{this.localAudioTrack&&(await this.localAudioTrack.stop(),this.localAudioTrack=null),await this.room.disconnect()}catch{}finally{this.room=null,this.sessionId=null,this.sessionAccessToken=null}}get isConnected(){return!!this.room}async speakText(e){if(!this.isConnected||!this.sessionId||!this.sessionAccessToken||!e.trim())return!1;try{return!!(await this.apiClient.sendLiveAgentSessionEvent({sessionToken:this.sessionAccessToken,sessionId:this.sessionId,text:e.trim()})).ok}catch{return!1}}askAndRespond(e){}startListening(){this.startListeningAsync()}stopListening(){this.stopListeningAsync()}interrupt(){}async startListeningAsync(){if(this.room){if(!this.localAudioTrack){this.localAudioTrack=await Cv({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:1,sampleRate:48e3}),await this.room.localParticipant.publishTrack(this.localAudioTrack);return}await this.localAudioTrack.unmute()}}async stopListeningAsync(){this.localAudioTrack&&await this.localAudioTrack.mute()}}function ia(i){if(!("speechSynthesis"in window))return;const e=new SpeechSynthesisUtterance(i);e.rate=.95,e.pitch=1,e.volume=1,window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)}function pm(){return window.SpeechRecognition||window.webkitSpeechRecognition||null}function mm({mergedState:i}){var H;const{activeResidentId:e,apiClient:t,notify:r}=yn(),o="Good morning! I am your AI physical therapist to walk you through your exercises.",[l,c]=N.useState(!1),[u,h]=N.useState("Great posture. Keep a smooth pace and breathe steadily."),[f,m]=N.useState(""),[v,k]=N.useState(null),[b,P]=N.useState(!1),[w,_]=N.useState("idle"),[M,z]=N.useState(""),[U,I]=N.useState(!1),A=N.useRef(null),V=N.useRef(null),$=N.useRef(null),Y=(i==null?void 0:i.metrics)||{},B=(i==null?void 0:i.vision)||{},ee=!!Y.fallSuspected,ne=!!pm(),ve=N.useMemo(()=>l?ee?"Pause and stabilize before continuing.":"Excellent! Keep cadence steady and take small controlled steps.":"Tap Start Walk when ready. Keep the walker close.",[ee,l]);N.useEffect(()=>($.current=new zC(t),()=>{var x;(x=$.current)==null||x.disconnect(),$.current=null}),[t]);const Pe=async()=>{var x,D;if(!V.current){r("LiveAgent video element not ready yet.","warn");return}try{const re=await t.bootstrapLiveAgentSession({residentId:e,mode:"FULL",interactivityType:"PUSH_TO_TALK",language:"en"});if(!re.ok||!re.livekitUrl||!re.livekitClientToken){r(re.error||"Failed to bootstrap LiveAgent session.","warn");return}await((x=$.current)==null?void 0:x.connectWithLiveKit(re.livekitUrl,re.livekitClientToken,V.current,{onStatus:_,onAgentTranscript:(se,le)=>z(`${le}: ${se}`),onError:se=>r(se,"warn")},{sessionId:re.sessionId,sessionAccessToken:re.sessionAccessToken}));const ue=await((D=$.current)==null?void 0:D.speakText(o));r("LiveAgent connected.","info"),ue||r("LiveAgent connected, but intro speech did not play.","warn")}catch{r("LiveAgent unavailable. Falling back to browser voice.","warn"),_("error")}},je=async()=>{var x;await((x=$.current)==null?void 0:x.disconnect()),_("disconnected"),I(!1)},Me=async x=>{var le,fe,me;const D=Number(B.cadenceSpm),re=ee?"safety_warning":Number(Y.tiltDeg||0)>20?"correct_posture":"encourage";let ue=x.trim();try{const Re=await t.generateCoachScript({residentId:e,goal:re,tone:ee?"calm":"energetic",userPrompt:x.trim()||void 0,context:{steps:Number(B.stepCount??Y.steps??0),tiltDeg:Number(Y.tiltDeg||0),balance:Number(Y.balance||0),cadence:Number.isFinite(D)?D:void 0,fallSuspected:ee,sessionPhase:l?"walking":"idle"}});(le=Re.script)!=null&&le.trim()&&(ue=Re.script.trim(),h(Re.script.trim()))}catch{}const se=await((fe=$.current)==null?void 0:fe.speakText(ue));se||(ia(ue),(!((me=$.current)!=null&&me.isConnected)||!se)&&r("LiveAgent not connected. Used browser voice fallback.","warn"))},$e=x=>{var D;w==="connected"&&(x.preventDefault(),x.currentTarget.setPointerCapture(x.pointerId),I(!0),(D=$.current)==null||D.startListening())},Ie=x=>{var D;U&&(x.preventDefault(),(D=$.current)==null||D.stopListening(),I(!1)),x.currentTarget.hasPointerCapture(x.pointerId)&&x.currentTarget.releasePointerCapture(x.pointerId)},ie=()=>{const x=pm();if(!x)return;const D=new x;A.current=D,D.lang="en-US",D.continuous=!1,D.interimResults=!1,D.onresult=re=>{var se,le;const ue=((le=(se=re.results[0])==null?void 0:se[0])==null?void 0:le.transcript)||"";m(ue),P(!1)},D.onerror=()=>P(!1),D.onend=()=>P(!1),P(!0),D.start()},te=async()=>{var D,re,ue,se;const x=f.trim();if(x)try{const fe=(await t.generateCoachScript({residentId:e,goal:"answer_question",tone:"calm",userPrompt:x,context:{steps:Number(B.stepCount??Y.steps??0),tiltDeg:Number(Y.tiltDeg||0),balance:Number(Y.balance||0),cadence:Number(B.cadenceSpm||0),fallSuspected:ee,sessionPhase:l?"walking":"idle"}})).script||x;k({answer:fe,citations:[]}),await((D=$.current)==null?void 0:D.speakText(fe))||ia(fe)}catch{try{const fe=await t.askAgent({residentId:e,question:x});k(fe);const me=((re=fe.heygen)==null?void 0:re.textToSpeak)||fe.answer;await((ue=$.current)==null?void 0:ue.speakText(me))||ia(me)}catch(fe){const me=Qc(fe)?{answer:`Coach fallback: ${x}. Keep going safely!`,citations:[]}:{answer:`Temporary fallback response: ${x}`,citations:[]};k(me),await((se=$.current)==null?void 0:se.speakText(me.answer))||ia(me.answer),r("Agent endpoint unavailable. Showing fallback response.","warn")}}};return S.jsxs("section",{className:"space-y-4 pb-28",children:[S.jsx("div",{className:"rounded-2xl bg-slate-900 p-4 sm:p-6",children:l?S.jsxs("div",{className:"space-y-4",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("p",{className:"text-sm uppercase tracking-wider text-slate-300",children:"Exercising"}),S.jsx("button",{type:"button",onClick:()=>c(!1),className:"rounded-lg bg-rose-600 px-4 py-2 text-sm font-bold text-white",children:"Stop Walk"})]}),S.jsxs("div",{className:"text-center",children:[S.jsx("p",{className:"text-sm text-slate-300",children:"Step Count (Camera)"}),S.jsx("p",{className:"text-7xl font-black leading-none text-white sm:text-8xl",children:Ps(B.stepCount??Y.steps)})]}),S.jsx("div",{className:`rounded-xl px-4 py-3 text-center text-xl font-black ${ee?"bg-rose-700 text-white":"bg-emerald-700 text-white"}`,children:ee?"Possible fall detected":"All good"}),S.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[S.jsx(Ne,{label:"Cadence",value:Ps(B.cadenceSpm)}),S.jsx(Ne,{label:"StepVar",value:Ps(B.stepVar)}),S.jsx(Ne,{label:"Tilt Deg",value:Ps(Y.tiltDeg),accent:Number(Y.tiltDeg||0)>25?"warn":"normal"}),S.jsx(Ne,{label:"Balance",value:Ps(Y.balance)})]})]}):S.jsxs("div",{className:"space-y-4",children:[S.jsx("p",{className:"text-sm uppercase tracking-wider text-slate-300",children:"Not Exercising"}),S.jsx("h2",{className:"text-3xl font-black text-white sm:text-5xl",children:"Ready for your walk?"}),S.jsx("button",{type:"button",onClick:()=>c(!0),className:"rounded-2xl bg-emerald-600 px-8 py-5 text-2xl font-black text-white shadow-lg",children:"Start Walk"}),S.jsxs("div",{className:"rounded-xl bg-slate-800 p-4 text-slate-100",children:[S.jsx("p",{className:"text-sm font-semibold",children:"Daily Goal Progress"}),S.jsxs("p",{className:"mt-1 text-lg font-bold",children:[Math.min(100,Math.round(Number(B.stepCount??Y.steps??0)/500*100)),"% of 500-step target"]}),S.jsx("p",{className:"mt-2 text-sm text-slate-300",children:ve})]})]})}),S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4 sm:p-6",children:[S.jsx("h3",{className:"text-2xl font-black text-white",children:"HeyGen Coach"}),S.jsxs("div",{className:"mt-3 grid gap-4 lg:grid-cols-2",children:[S.jsxs("div",{className:"space-y-3",children:[S.jsx("div",{className:"flex min-h-[180px] items-center justify-center rounded-xl border-2 border-dashed border-slate-600 bg-slate-950",children:S.jsx("video",{ref:V,autoPlay:!0,playsInline:!0,controls:!0,muted:!1,className:"max-h-[220px] w-full rounded-lg bg-black"})}),S.jsxs("p",{className:"text-xs text-slate-300",children:["LiveAgent status: ",S.jsx("span",{className:"font-bold",children:w})]}),M?S.jsxs("p",{className:"text-xs text-slate-400",children:["Last transcript: ",M]}):null,S.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.jsx("button",{type:"button",onClick:Pe,className:"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-bold text-white",children:"Connect LiveAgent"}),S.jsx("button",{type:"button",onClick:je,className:"rounded-lg bg-slate-700 px-4 py-2 text-sm font-bold text-white",children:"Disconnect"}),S.jsx("button",{type:"button",disabled:w!=="connected",onPointerDown:$e,onPointerUp:Ie,onPointerCancel:Ie,onPointerLeave:Ie,onLostPointerCapture:Ie,className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-bold text-white disabled:cursor-not-allowed disabled:opacity-50",style:{touchAction:"none"},children:U?"Listening release to stop":"Hold to Talk"})]}),S.jsx("textarea",{value:u,onChange:x=>h(x.target.value),className:"h-24 w-full rounded-lg border border-slate-600 bg-slate-950 px-3 py-2 text-slate-100"}),S.jsx("button",{type:"button",onClick:()=>Me(u),className:"w-full rounded-xl bg-sky-600 px-4 py-3 text-lg font-black text-white",children:"Play Coach"})]}),S.jsxs("div",{className:"space-y-3",children:[S.jsx("h4",{className:"text-lg font-bold text-slate-100",children:"Speak to Coach"}),S.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.jsx("button",{type:"button",disabled:!ne,onClick:ie,className:"rounded-lg bg-slate-700 px-4 py-2 text-sm font-semibold text-white disabled:opacity-40",children:b?"Listening...":"Use Voice"}),ne?null:S.jsx("p",{className:"text-sm text-amber-300",children:"Voice unavailable on this browser, use text input."})]}),S.jsx("textarea",{value:f,onChange:x=>m(x.target.value),placeholder:"Ask the coach a question...",className:"h-24 w-full rounded-lg border border-slate-600 bg-slate-950 px-3 py-2 text-slate-100"}),S.jsx("button",{type:"button",onClick:te,className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-bold text-white",children:"Ask Coach"}),v?S.jsxs("div",{className:"rounded-lg bg-slate-950 p-3 text-sm text-slate-100",children:[S.jsx("p",{children:v.answer}),(H=v.citations)!=null&&H.length?S.jsxs("p",{className:"mt-2 text-xs text-slate-400",children:["Citations: ",v.citations.slice(0,3).join(" | ")]}):null]}):null]})]})]})]})}function Ps(i){const e=Number(i);return Number.isFinite(e)?String(Math.round(e*100)/100):"-"}function qC({status:i,errorText:e,logLines:t,onDisconnect:r,onInterrupt:o,onStartVoiceAgent:l,onStopVoiceAgent:c,onTalkToAgent:u,voiceAgentStatus:h,latestUserTranscript:f,latestAgentResponse:m,isListening:v,videoHostRef:k}){return S.jsxs("main",{className:"fixed inset-0 flex flex-col bg-black text-white",children:[S.jsxs("section",{className:"relative flex-1 p-4 sm:p-6",children:[S.jsx("div",{ref:k,className:"flex h-full w-full items-center justify-center overflow-hidden rounded-xl bg-slate-900",children:S.jsxs("p",{className:"text-sm text-slate-300",children:["Status: ",i]})}),e?S.jsx("p",{className:"absolute left-8 right-8 top-8 rounded-md bg-rose-800/80 px-3 py-2 text-sm",children:e}):null]}),S.jsxs("section",{className:"space-y-3 px-6 pb-8 pt-2",children:[S.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[S.jsx("button",{type:"button",onClick:l,className:"rounded-xl bg-emerald-600 px-4 py-2 font-bold",children:"Start Voice Agent"}),S.jsx("button",{type:"button",onClick:u,className:"rounded-xl bg-sky-700 px-4 py-2 font-bold",children:v?"Listening...":"Tap To Talk"}),S.jsx("button",{type:"button",onClick:c,className:"rounded-xl bg-amber-700 px-4 py-2 font-bold",children:"Stop Voice Agent"}),S.jsx("button",{type:"button",onClick:o,className:"rounded-xl bg-rose-700 px-4 py-2 font-bold",children:"Interrupt"}),S.jsx("button",{type:"button",onClick:r,className:"rounded-xl bg-slate-700 px-4 py-2 font-bold",children:"Disconnect"})]}),S.jsxs("div",{className:"mx-auto max-h-32 w-full max-w-3xl overflow-auto rounded-xl bg-slate-900/80 p-3 text-xs text-slate-200",children:[S.jsxs("p",{className:"mb-1 text-slate-300",children:["Voice Agent: ",h]}),S.jsxs("p",{className:"mb-1 text-slate-300",children:["You: ",f||"..."]}),S.jsxs("p",{className:"mb-2 text-slate-300",children:["Agent: ",m||"..."]}),t.length?t.map((b,P)=>S.jsx("p",{children:b},`${P}-${b}`)):S.jsx("p",{children:"No events yet."})]})]})]})}class Ev{constructor(e,t={}){ot(this,"apiClient");ot(this,"callbacks");ot(this,"room",null);ot(this,"statusPollTimer",null);ot(this,"sessionId",null);ot(this,"sessionToken",null);this.apiClient=e,this.callbacks=t}get currentSessionId(){return this.sessionId}async start(e,t){var o,l,c,u,h,f,m,v,k,b,P,w;await this.stop(),(l=(o=this.callbacks).onState)==null||l.call(o,"starting session...");const r=await this.apiClient.createAndStartLiveAvatarLiteSession(e);if(!r.ok||!r.session_id||!r.session_token||!r.livekit_url||!r.livekit_client_token){(u=(c=this.callbacks).onState)==null||u.call(c,"error"),(f=(h=this.callbacks).onError)==null||f.call(h,r.error||"Failed to create/start LITE session.");return}this.sessionId=r.session_id,this.sessionToken=r.session_token,(v=(m=this.callbacks).onState)==null||v.call(m,"connecting livekit..."),await this.connectLiveKit(r.livekit_url,r.livekit_client_token,t),(b=(k=this.callbacks).onState)==null||b.call(k,"connected"),(w=(P=this.callbacks).onState)==null||w.call(P,"ws connecting..."),this.startStatusPolling()}async stop(){var t,r;this.statusPollTimer&&(window.clearInterval(this.statusPollTimer),this.statusPollTimer=null);const e=this.room;if(this.room=null,e)try{e.removeAllListeners(),await e.disconnect()}catch{}if(this.sessionId&&this.sessionToken)try{await this.apiClient.stopLiveAvatarLiteSession({session_id:this.sessionId,session_token:this.sessionToken})}catch{}this.sessionId=null,this.sessionToken=null,(r=(t=this.callbacks).onState)==null||r.call(t,"idle")}async interrupt(){this.sessionId&&await this.apiClient.sendLiveAvatarLiteInterrupt({session_id:this.sessionId})}async speakTestTone(e=1,t=440){this.sessionId&&await this.apiClient.sendLiveAvatarLiteTestTone({session_id:this.sessionId,duration_seconds:e,frequency_hz:t})}async connectLiveKit(e,t,r){const o=new Gi;this.room=o,o.on(Q.TrackSubscribed,(l,c,u)=>{var f,m;(m=(f=this.callbacks).onLog)==null||m.call(f,`Track subscribed: ${l.kind} (${u.identity})`);const h=l.attach();if(l.kind===q.Kind.Video)h.className="h-full w-full rounded-xl object-cover bg-black";else{h.className="hidden";const v=h;v.autoplay=!0,v.muted=!1,v.play().catch(()=>{var k,b;return(b=(k=this.callbacks).onError)==null?void 0:b.call(k,"Audio autoplay blocked. Tap the screen and retry.")})}r.appendChild(h)}),o.on(Q.TrackUnsubscribed,l=>l.detach().forEach(c=>c.remove())),o.on(Q.Disconnected,()=>{var l,c;return(c=(l=this.callbacks).onLog)==null?void 0:c.call(l,"LiveKit disconnected.")}),await o.connect(e,t)}startStatusPolling(){if(!this.sessionId)return;const e=async()=>{var t,r,o,l,c,u;if(this.sessionId)try{const h=await this.apiClient.getLiveAvatarLiteStatus(this.sessionId);h.ready?(r=(t=this.callbacks).onState)==null||r.call(t,"ready"):h.exists&&((l=(o=this.callbacks).onState)==null||l.call(o,"ws connecting...")),h.last_error&&((u=(c=this.callbacks).onError)==null||u.call(c,String(h.last_error)))}catch{}};e(),this.statusPollTimer=window.setInterval(()=>void e(),2e3)}}class WC{constructor(){ot(this,"audioCtx",null);ot(this,"nextStartTime",0)}ensureAudioContext(){return this.audioCtx||(this.audioCtx=new AudioContext,this.nextStartTime=0),this.audioCtx}async enqueuePcm16Base64(e,t=24e3){const r=e.trim();if(!r)return;const o=this.ensureAudioContext();o.state==="suspended"&&await o.resume();const l=atob(r),c=Math.floor(l.length/2);if(c<=0)return;const u=new Float32Array(c);let h=0;for(let b=0;b<c;b+=1){const P=l.charCodeAt(h++)&255;let _=(l.charCodeAt(h++)&255)<<8|P;_&32768&&(_-=65536),u[b]=_/32768}const f=o.createBuffer(1,c,t);f.copyToChannel(u,0);const m=o.createBufferSource();m.buffer=f,m.connect(o.destination);const v=o.currentTime,k=Math.max(v+.02,this.nextStartTime);m.start(k),this.nextStartTime=k+f.duration}async reset(){if(this.nextStartTime=0,this.audioCtx){try{await this.audioCtx.close()}catch{}this.audioCtx=null}}}function Pv(){const{apiClient:i,activeResidentId:e,apiBaseUrl:t}=yn(),r="".toLowerCase()==="true",[o,l]=N.useState("idle"),[c,u]=N.useState(null),[h,f]=N.useState([]),[m,v]=N.useState("idle"),[k,b]=N.useState(""),[P,w]=N.useState(""),[_,M]=N.useState(!1),[z,U]=N.useState(!1),I=N.useRef(null),A=N.useRef(null),V=N.useRef(new WC),$=N.useRef(null),Y=N.useRef(null),B=N.useRef([]),ee=N.useMemo(()=>new Ev(i,{onState:l,onError:te=>u(te),onLog:te=>f(H=>[te,...H].slice(0,80))}),[i]),ne=te=>{f(H=>[`[${new Date().toLocaleTimeString()}] ${te}`,...H].slice(0,160))},ve=te=>{const H={...te},x=H.audio_base64||H.audio||H.chunk;if(typeof x=="string"){const D=Math.max(0,Math.floor(x.length*3/4));typeof H.audio_base64=="string"&&(H.audio_base64=`<${D} bytes base64>`),typeof H.audio=="string"&&(H.audio=`<${D} bytes base64>`),typeof H.chunk=="string"&&(H.chunk=`<${D} bytes base64>`)}return H},Pe=async()=>{I.current&&(I.current.innerHTML="",u(null),f([]),await ee.start({language:"en",video_quality:"high",video_encoding:"VP8",is_sandbox:!1},I.current))};N.useEffect(()=>(r?Pe():f(te=>["Avatar stream disabled for MVP (set VITE_ENABLE_HEYGEN_AVATAR=true to re-enable).",...te].slice(0,80)),()=>{je(),ee.stop()}),[r,ee]);const je=()=>{$.current&&$.current.state==="recording"&&$.current.stop(),$.current=null,B.current=[],Y.current&&(Y.current.getTracks().forEach(H=>H.stop()),Y.current=null);const te=A.current;te&&te.readyState<=WebSocket.OPEN&&te.close(1e3,"client stop"),A.current=null,V.current.reset(),v("idle"),M(!1)},Me=te=>{const H=A.current;!H||H.readyState!==WebSocket.OPEN||(H.send(JSON.stringify(te)),ne(`out ${JSON.stringify(ve(te))}`))},$e=te=>{for(const H of["agent_response","response","text"]){const x=te[H];if(typeof x=="string"&&x.trim())return x.trim();if(x&&typeof x=="object"){const D=x;for(const re of["text","response"]){const ue=D[re];if(typeof ue=="string"&&ue.trim())return ue.trim()}}}return""},Ie=async()=>{if(!(m==="connected"||m==="connecting"))try{v("connecting");const te=Mm(t),H="/ws/voice-agent",x=`?residentId=${encodeURIComponent(e)}`,D=new WebSocket(`${te}${H}${x}`);A.current=D,D.onopen=()=>{v("connected"),ne(`sys connected ws for resident=${e}`),Me({type:"session.start",resident_id:e,text:`STATE UPDATE:
- UI: user_view
- Session intent: short voice back-and-forth coaching`})},D.onclose=()=>{ne("sys websocket closed"),v("idle")},D.onerror=()=>{ne("sys websocket error"),v("error")},D.onmessage=re=>{let ue;try{ue=JSON.parse(String(re.data))}catch{return}if(!ue||typeof ue!="object")return;const se=ue;ne(`in ${JSON.stringify(ve(se))}`);const le=String(se.type||"");if(le==="ping"){const He=se.ping_event||{},Gt=String(He.event_id||se.event_id||"");Gt&&Me({type:"pong",event_id:Gt});return}const fe=se.user_transcript;typeof fe=="string"&&fe.trim()&&(U(!1),b(fe.trim()));const me=se.audio_base64||se.audio||se.chunk;if(typeof me=="string"&&me.trim()){const He=se.sample_rate_hz||se.sampleRateHz,Gt=typeof He=="number"&&Number.isFinite(He)?He:24e3;V.current.enqueuePcm16Base64(me,Gt)}const Re=$e(se);if(Re&&(le.includes("agent")||le.includes("response")||le.includes("text"))&&w(Re),le==="error"){U(!1);const He=String(se.error||"Unknown websocket error");u(He)}}}catch(te){v("error"),u(te instanceof Error?te.message:"Failed to start voice agent.")}},ie=()=>{var x;if(m!=="connected"){u("Connect the voice websocket first.");return}const te=$.current;if(te&&te.state==="recording"){ne("sys stopping active recording"),te.stop();return}if(!((x=navigator.mediaDevices)!=null&&x.getUserMedia)||typeof MediaRecorder>"u"){u("Microphone recording is not supported in this browser.");return}const H=D=>new Promise((re,ue)=>{const se=new FileReader;se.onloadend=()=>{const le=String(se.result||""),fe=le.indexOf(",");if(fe===-1){ue(new Error("Unable to encode audio payload."));return}re(le.slice(fe+1))},se.onerror=()=>ue(new Error("Failed to read recorded audio.")),se.readAsDataURL(D)});(async()=>{try{u(null);const D=await navigator.mediaDevices.getUserMedia({audio:!0});ne("sys microphone acquired"),Y.current=D;const ue=["audio/webm;codecs=opus","audio/webm","audio/mp4"].find(le=>MediaRecorder.isTypeSupported(le)),se=ue?new MediaRecorder(D,{mimeType:ue}):new MediaRecorder(D);$.current=se,B.current=[],se.ondataavailable=le=>{le.data.size>0&&B.current.push(le.data)},se.onerror=()=>{M(!1),u("Microphone recording failed."),ne("sys microphone recording error")},se.onstop=()=>{const le=se.mimeType||ue||"audio/webm",fe=new Blob(B.current,{type:le});B.current=[],Y.current&&(Y.current.getTracks().forEach(me=>me.stop()),Y.current=null),M(!1),ne(`sys recording stopped mime=${le} bytes=${fe.size}`),fe.size&&(U(!0),b("Transcribing audio..."),(async()=>{try{const me=await H(fe);Me({type:"user_audio",resident_id:e,mime_type:fe.type||le,audio_base64:me})}catch(me){U(!1),u(me instanceof Error?me.message:"Failed to send recorded audio.")}})())},M(!0),ne("sys recording started"),se.start(250),window.setTimeout(()=>{se.state==="recording"&&se.stop()},4500)}catch(D){M(!1),U(!1),u(D instanceof Error?D.message:"Could not access microphone.")}})()};return S.jsx(qC,{status:o,errorText:c,logLines:h,videoHostRef:I,onDisconnect:()=>{je(),ee.stop()},onInterrupt:()=>void ee.interrupt(),onStartVoiceAgent:()=>void Ie(),onStopVoiceAgent:je,onTalkToAgent:ie,voiceAgentStatus:m,latestUserTranscript:_?"Listening...":z?"Transcribing audio...":k,latestAgentResponse:P,isListening:_})}function HC(){return S.jsxs("div",{className:"space-y-4",children:[S.jsx("h2",{className:"text-xl font-bold text-white",children:"Live Exercise"}),S.jsx("p",{className:"text-sm text-slate-400",children:"Your AI coach will guide you through exercises. Connect to start."}),S.jsx(Pv,{})]})}const KC=[{title:"Morning coffee & chat",time:"9:00 AM",location:"Main Lounge",date:"Today"},{title:"Bingo",time:"2:00 PM",location:"Activity Room A",date:"Today"},{title:"Garden walk",time:"4:30 PM",location:"Garden Patio",date:"Today"},{title:"Movie night",time:"7:00 PM",location:"Main Lounge",date:"Tomorrow"},{title:"Exercise group",time:"10:00 AM",location:"Activity Room B",date:"Tomorrow"}];function GC(){const{apiClient:i,notify:e}=yn(),[t,r]=N.useState(null),[o,l]=N.useState(null),c=u=>{l(null),r(u);const h=`Zoom my ${u}`;i.requestZoomInvite({phrase:h}).then(f=>{const m=`Sent Zoom link to ${f.sentTo}.`;l({success:!0,message:m}),e(m,"info")}).catch(f=>{const m=f instanceof Ea&&typeof f.details=="object"&&f.details&&"detail"in f.details?String(f.details.detail):f instanceof Error?f.message:"Failed to send Zoom invite.";l({success:!1,message:m}),e(m,"error")}).finally(()=>r(null))};return S.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-5",children:[S.jsx("h3",{className:"text-lg font-semibold text-white",children:"Social"}),S.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Upcoming events at the nursing home. Use your walker to join."}),S.jsx("ul",{className:"mt-4 space-y-3",children:KC.map((u,h)=>S.jsxs("li",{className:"rounded-xl border border-slate-700 bg-slate-950/80 p-3",children:[S.jsx("p",{className:"font-medium text-white",children:u.title}),S.jsxs("p",{className:"mt-0.5 text-sm text-slate-400",children:[u.time,"  ",u.location,"  ",u.date]})]},h))}),S.jsxs("div",{className:"mt-4 border-t border-slate-700 pt-4",children:[S.jsx("p",{className:"mb-2 text-sm font-medium text-slate-300",children:"Zoom"}),S.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.jsx("button",{type:"button",disabled:t!==null,onClick:()=>c("physical therapist"),className:"rounded-xl bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-500 disabled:opacity-50",children:t==="physical therapist"?"Sending":"Zoom my physical therapist"}),S.jsx("button",{type:"button",disabled:t!==null,onClick:()=>c("daughter"),className:"rounded-xl bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-500 disabled:opacity-50",children:t==="daughter"?"Sending":"Zoom my daughter"})]}),o&&S.jsx("p",{className:`mt-2 text-sm ${o.success?"text-emerald-300":"text-rose-300"}`,children:o.message})]})]})}function $C(){const{activeResidentId:i,residents:e,latestMergedByResidentId:t}=yn(),r=t[i],o=(r==null?void 0:r.metrics)??{},l=(r==null?void 0:r.vision)??{},c=N.useMemo(()=>{const w=e.find(_=>_.residentId===i);return(w==null?void 0:w.name)??i},[e,i]),u=N.useMemo(()=>{const w=new Date().getHours();return w<12?"Good morning":w<17?"Good afternoon":"Good evening"},[]),h=o.steps??0,f=o.tiltDeg??null,m=o.balance??null,v=o.reliance??null,k=!!o.fallSuspected,b=l.cadenceSpm,P=l.stepVar;return S.jsxs("div",{className:"mx-auto max-w-5xl space-y-6 pb-10",children:[S.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-5",children:[S.jsxs("h2",{className:"text-xl font-bold text-white",children:["Hello ",c]}),S.jsxs("p",{className:"mt-1 text-slate-300",children:[u,", today is a great day to use your walker and stay active."]})]}),S.jsxs("section",{children:[S.jsx("h3",{className:"mb-3 text-lg font-semibold text-white",children:"Health overview"}),S.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[S.jsx(Ne,{label:"Steps",value:h,accent:"good"}),S.jsx(Ne,{label:"Tilt (deg)",value:f!=null?f.toFixed(1):"",accent:f!=null&&f>=60?"danger":"normal"}),S.jsx(Ne,{label:"Balance",value:m!=null?m.toFixed(2):"",accent:"normal"}),S.jsx(Ne,{label:"Reliance",value:v??"",accent:"normal"}),b!=null&&S.jsx(Ne,{label:"Cadence (spm)",value:b.toFixed(0),accent:"normal"}),P!=null&&S.jsx(Ne,{label:"Step variance",value:P.toFixed(1),accent:"normal"}),k&&S.jsx(Ne,{label:"Fall alert",value:"Suspected",accent:"danger"})]})]}),S.jsx("section",{children:S.jsx(GC,{})})]})}function JC(){const[i,e]=N.useState(!1),{latestMergedByResidentId:t,activeResidentId:r,mockMode:o,mode:l,setMode:c}=yn(),u=t[r],h=()=>l==="judge"?S.jsx(mm,{mergedState:u}):l==="debug"?S.jsx(Hk,{mergedState:u}):l==="liveExercise"?S.jsx(HC,{}):l==="patientHome"?S.jsx($C,{}):l==="doctorView"?S.jsx(Xk,{}):S.jsx(mm,{mergedState:u});return S.jsxs(S.Fragment,{children:[S.jsx(qk,{}),S.jsxs(Mk,{mode:l,setMode:c,onOpenSettings:()=>e(!0),children:[o?S.jsx("div",{className:"mb-4 rounded-xl border border-amber-600 bg-amber-900/40 p-3 text-sm text-amber-100",children:"API unreachable: mock mode active so the demo stays fully usable."}):null,h()]}),S.jsx(zk,{open:i,onClose:()=>e(!1)})]})}function QC(){const[i,e]=N.useState("connecting"),[t,r]=N.useState(null),o=N.useMemo(()=>Dm(),[]),l=N.useMemo(()=>new URLSearchParams(window.location.search).get("residentId")||"r1",[]);N.useEffect(()=>{const f=new Lm({baseUrl:o,residentId:l,onStatus:e,onMessage:m=>{if(m.type==="snapshot"&&Array.isArray(m.data)){const v=m.data.find(k=>k.residentId===l);v&&r(v);return}if(m.type==="merged_update"&&m.data&&typeof m.data=="object"&&"residentId"in m.data){const v=m.data;v.residentId===l&&r(v)}}});return f.connect(),()=>f.close()},[o,l]),N.useEffect(()=>{new Nm(o).getState(l).then(r).catch(()=>{})},[o,l]);const c=(t==null?void 0:t.metrics)||{},u=(t==null?void 0:t.vision)||{},h=!!c.fallSuspected;return S.jsxs("main",{className:"min-h-screen bg-slate-950 p-5 text-white",children:[S.jsxs("header",{className:"rounded-xl bg-slate-900 p-4",children:[S.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"CV Window - Independent websocket"}),S.jsxs("h1",{className:"text-4xl font-black",children:["Resident ",l]}),S.jsxs("p",{className:"text-sm text-slate-300",children:["WS: ",i," | Last updated: ",t!=null&&t.ts?new Date(t.ts*1e3).toLocaleString():"-"]})]}),S.jsx("div",{className:`mt-4 rounded-xl px-4 py-3 text-center text-2xl font-black ${h?"bg-rose-700 text-white":"bg-emerald-700 text-white"}`,children:h?"Possible fall detected":"All good"}),S.jsx("div",{className:"mt-4 flex min-h-[260px] items-center justify-center rounded-xl border-2 border-dashed border-slate-600 bg-slate-900",children:"Camera placeholder"}),S.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4",children:[S.jsx(Ne,{label:"Steps (Camera)",value:Rs(u.stepCount??c.steps)}),S.jsx(Ne,{label:"Cadence",value:Rs(u.cadenceSpm)}),S.jsx(Ne,{label:"StepVar",value:Rs(u.stepVar)}),S.jsx(Ne,{label:"Tilt",value:Rs(c.tiltDeg)}),S.jsx(Ne,{label:"Balance",value:Rs(c.balance)})]})]})}function Rs(i){const e=Number(i);return Number.isFinite(e)?String(Math.round(e*100)/100):"-"}function YC(){return S.jsx(QC,{})}function XC(){const{apiClient:i}=yn(),[e,t]=N.useState("idle"),[r,o]=N.useState(null),[l,c]=N.useState([]),[u,h]=N.useState(null),f=N.useRef(null),m=P=>c(w=>[P,...w].slice(0,24)),v=N.useMemo(()=>new Ev(i,{onState:t,onError:o,onLog:m}),[i]),k=async()=>{f.current&&(o(null),c([]),f.current.innerHTML="",await v.start({language:"en",video_quality:"high",video_encoding:"VP8"},f.current),h(v.currentSessionId))},b=async()=>{await v.stop(),h(null),m("Disconnected.")};return N.useEffect(()=>()=>{v.stop()},[v]),S.jsx("main",{className:"min-h-screen bg-slate-950 p-4 text-white sm:p-6",children:S.jsxs("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-4",children:[S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4 sm:p-6",children:[S.jsx("h1",{className:"text-2xl font-black",children:"LiveAvatar LITE Test"}),S.jsxs("p",{className:"mt-2 text-sm text-slate-300",children:["Status: ",S.jsx("span",{className:"font-bold",children:e}),u?` | sessionId: ${u}`:""]}),r?S.jsx("p",{className:"mt-2 rounded-lg bg-rose-900/40 p-3 text-sm text-rose-200",children:r}):null,S.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[S.jsx("button",{type:"button",onClick:()=>void k(),className:"rounded-xl bg-emerald-600 px-4 py-2 font-bold text-white",children:"Connect via /api/liveavatar/lite/new"}),S.jsx("button",{type:"button",onClick:()=>void b(),className:"rounded-xl bg-slate-700 px-4 py-2 font-bold text-white",children:"Disconnect"}),S.jsx("button",{type:"button",onClick:()=>void v.speakTestTone(1,660),className:"rounded-xl bg-sky-700 px-4 py-2 font-bold text-white",children:"Send Test Tone"}),S.jsx("button",{type:"button",onClick:()=>void v.interrupt(),className:"rounded-xl bg-rose-700 px-4 py-2 font-bold text-white",children:"Interrupt"})]})]}),S.jsx("div",{className:"h-[60vh] rounded-2xl bg-slate-900 p-3",children:S.jsx("div",{ref:f,className:"flex h-full w-full items-center justify-center rounded-xl bg-black",children:S.jsx("p",{className:"text-sm text-slate-400",children:"Waiting for remote track..."})})}),S.jsxs("div",{className:"rounded-2xl bg-slate-900 p-4",children:[S.jsx("h2",{className:"text-lg font-bold",children:"Event Log"}),S.jsx("div",{className:"mt-2 max-h-48 overflow-auto rounded-lg bg-slate-950 p-3 text-xs text-slate-300",children:l.length?l.map((P,w)=>S.jsx("p",{children:P},`${w}-${P}`)):S.jsx("p",{children:"No events yet."})})]})]})})}A0.createRoot(document.getElementById("root")).render(S.jsx(vm.StrictMode,{children:S.jsx(Ok,{children:S.jsx(Bk,{children:S.jsxs(_k,{children:[S.jsx(Cr,{path:"/",element:S.jsx(JC,{})}),S.jsx(Cr,{path:"/cv",element:S.jsx(YC,{})}),S.jsx(Cr,{path:"/user",element:S.jsx(Pv,{})}),S.jsx(Cr,{path:"/liveavatar-test",element:S.jsx(XC,{})}),S.jsx(Cr,{path:"*",element:S.jsx(Pk,{to:"/",replace:!0})})]})})})}));
